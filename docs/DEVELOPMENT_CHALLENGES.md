# 📋 프로젝트 개발 지연 원인 분석 보도자료
## 지역경제동향 보도자료 자동 생성 시스템

---

## 📊 개요

| 항목 | 내용 |
|------|------|
| **총 개발 기간** | 2025.12.11 ~ 12.30 (약 20일) |
| **총 커밋 수** | 147개 |
| **버그 수정 커밋** | 26개 (전체의 18%) |
| **Revert/롤백 커밋** | 4개 |
| **리팩토링 커밋** | 5개 |
| 🔴 **주요 지연 원인** | **2025년 4분기 보도자료 형식 전면 변경 및 GRDP 지수 추가** |

---

## 🗓️ 날짜별 커밋 분포

| 날짜 | 커밋 수 | 비고 |
|------|---------|------|
| 12/11~12 | 4개 | 초기 설정 |
| 12/15 | 8개 | 알파 버전 개발 |
| 12/16 | 9개 | 웹 앱 개발 |
| **12/17** | **30개** | 🔴 **가장 많은 커밋 - 문제 발생** |
| 12/18 | 9개 | 버그 수정 집중 |
| **12/21** | **8개** | 🔴 **보도자료 형식 변경 대응 - 스키마 전환** |
| 12/22 | 8개 | 물가/수출입 수정 |
| 12/23 | 12개 | 고용률/실업률 |
| **12/25** | **24개** | 🔴 **보도자료 형식 변경 대응 - 대규모 리팩토링** |
| 12/26 | 4개 | 영문화 |
| 12/28 | 1개 | - |
| **12/29** | **22개** | 🔴 **요약/통계표 버그 다수** |
| 12/30 | 8개 | 마무리 |

---

## 🔴 주요 지연 원인 분석

### 1. 엑셀 데이터 구조의 복잡성 및 비일관성

#### 문제 상황
국가데이터처에서 제공받은 분석표 엑셀 파일의 **시트명과 데이터 위치가 예상과 달랐습니다**. 특히 **2025년 4분기부터 보도자료 형식이 크게 변경**되면서 기존에 개발한 시스템이 전혀 작동하지 않게 되었습니다.

#### 발생한 이슈들
```
12/17: CSS 속성을 마커로 착각하는 오류해결
12/18: 엑셀 읽기오류 해결
12/18: 엑셀못찾는버그수성 및 pdf생성기능
12/22: 물가동향을 품목성질별 물가 시트로 변경 및 분류단계 1로 설정
12/22: 고용률 템플릿 마커 시트명 수정 (고용률 → 고용)
12/22: revert: 고용률 템플릿 마커 시트명 원복
12/29: 분석 시트 없을 때 기초자료에서 직접 데이터 추출
12/30: 시도별 보도자료 기초자료 시트 fallback 추가
```

#### 구체적인 문제
1. **시트명 불일치**: 예상한 "고용률" 시트가 실제로는 "D(고용률)분석", "고용", "D(실업)분석" 등 다양한 이름으로 존재
2. **열/행 위치 변동**: 같은 데이터가 분기별로 다른 위치에 있음
3. **결측치 다양성**: 빈 셀, 0, "-", "비공개" 등 다양한 형태로 존재
4. **시트 추가/제거**: 분기마다 시트 구조가 조금씩 변경됨

#### 해결에 소요된 시간
약 **3~4일** (12/17~12/18, 12/22, 12/29~12/30)

---

### 2. 템플릿 변수 바인딩 불일치

#### 문제 상황
Python 백엔드에서 생성한 데이터 구조와 Jinja2 HTML 템플릿의 변수명이 **일치하지 않는 문제**가 반복 발생했습니다.

#### 발생한 이슈들
```
12/25: fix: 템플릿 변수명 수정 (nationwide_change → nationwide_data.change)
12/25: fix: 보도자료별 다른 키 이름 호환성 수정
12/25: fix: 템플릿별 키 이름 호환성 개선
12/25: refactor: 템플릿 접근 방식 통일 (data.xxx → xxx)
12/25: refactor: generate_report_html 함수 전면 재구성
```

#### 구체적인 문제
1. **네이밍 컨벤션 혼재**: `nationwide_change`, `nationwide_data.change`, `data.nationwide.change` 등 여러 방식 혼재
2. **보도자료별 상이한 키**: 광공업생산은 `manufacturing_data`, 서비스업은 `service_data` 등 패턴 불일치
3. **중첩 객체 접근**: `{{ data.region.change }}` vs `{{ region_change }}` 혼용

#### 해결에 소요된 시간
약 **1일** (12/25 집중 수정)

---

### 3. 🔴 2025년 4분기 보도자료 형식 대규모 변경 및 GRDP 지수 추가

#### 문제 상황
**2025년 4분기부터 국가데이터처의 보도자료 형식이 크게 변경**되었고, **GRDP(실질지역내총생산) 지수가 나중에 추가**되면서 기존 시스템이 전혀 작동하지 않게 되었습니다. 이로 인해 **거의 처음부터 다시 개발**해야 하는 상황이 발생했습니다.

#### 발생한 이슈들
```
12/21: 프로젝트 스키마 기반 전환 (보도자료 형식 변경 대응)
12/23: refactor: 소스 파일 모듈화 구조 개선
12/25: refactor: generate_report_html 함수 전면 재구성
12/29: feat: 참고_GRDP 표 권역 그룹 정렬 및 기호 겹침 문제 수정
12/29: fix: 참고_GRDP 표 권역 그룹 정렬 및 기호 겹침 문제 수정
```

#### 구체적인 문제

1. **보도자료 형식 전면 변경 (2025년 4분기)**
   - 엑셀 파일의 **시트 구조가 완전히 달라짐**: 기존 시트명과 새로운 시트명이 전혀 일치하지 않음
   - **데이터 위치 변경**: 같은 지표가 다른 열/행에 배치됨
   - **표 구조 변경**: 기존 템플릿의 마커 기반 추출 로직이 전혀 작동하지 않음
   - **새로운 지표 추가**: 기존에 없던 지표들이 추가되어 데이터 매핑 재작업 필요

2. **GRDP 지수 추가로 인한 추가 작업**
   - **나중에 추가된 지표**: 초기 개발 시에는 GRDP 지수가 포함되지 않았음
   - **참고_GRDP 표 구현**: 권역별 그룹 정렬, 기호 겹침 문제 등 추가 이슈 발생
   - **데이터 소스 변경**: GRDP 데이터는 별도 파일(`grdp_2025년_2분기_실질_지역내총생산잠정_*.xlsx`)에서 추출해야 함
   - **통합 로직 재작성**: 기존 보도자료 생성 파이프라인에 GRDP 데이터 통합 과정 추가

3. **거의 처음부터 다시 개발**
   - **기존 코드 재사용 불가**: 하드코딩된 시트명, 셀 위치 참조가 모두 무효화됨
   - **스키마 기반 아키텍처로 전환**: 형식 변경에 유연하게 대응하기 위해 스키마 기반 시스템으로 전면 재구축
   - **템플릿 전면 재작성**: 모든 보도자료 템플릿을 새로운 형식에 맞게 재작성
   - **데이터 추출 로직 재구현**: 모든 generator를 새로운 데이터 구조에 맞게 재작성

#### 해결 과정

1. **스키마 기반 아키텍처 도입**
   - JSON 스키마 파일로 데이터 매핑을 분리하여 형식 변경에 유연하게 대응
   - 의미 기반 마커 시스템으로 전환하여 위치 의존성 제거

2. **모듈화 및 재구성**
   - 단일 파일(`app.py`)에서 `routes/`, `services/`, `utils/`로 모듈화
   - `generate_report_html` 함수 전면 재구성

3. **GRDP 통합**
   - 별도 GRDP 데이터 수집 모듈(`kosis_grdp_fetcher.py`) 개발
   - 보도자료 생성 파이프라인에 GRDP 데이터 통합
   - 참고_GRDP 표 구현 및 권역별 정렬 로직 추가

#### 해결에 소요된 시간
약 **5~6일** (12/21~12/25, 12/29)
- 보도자료 형식 변경 대응: 3일
- GRDP 지수 추가 및 통합: 2일
- 추가 버그 수정: 1일

#### 영향 범위
- **전체 보도자료 템플릿**: 36개 템플릿 재작성
- **데이터 추출 로직**: 모든 generator 재구현
- **아키텍처**: 하드코딩 방식에서 스키마 기반으로 전면 전환
- **코드베이스**: 약 **70% 이상 재작성**

---

### 4. 요약 페이지 데이터 추출 오류

#### 문제 상황
요약 페이지들(지역경제동향, 생산, 소비건설, 수출물가, 고용인구)에서 **데이터가 0으로 표시되거나 누락**되는 문제가 발생했습니다.

#### 발생한 이슈들
```
12/28: 프로젝트 구조 개선 및 요약 페이지 데이터 추출 로직 수정
12/29: fix: 요약_지역경제동향 데이터 추출 수정
12/29: fix: 요약_지역경제동향 테이블 데이터 추출 수정
12/29: fix: 요약 테이블 데이터가 0으로 표시되는 문제 수정
12/29: fix: 요약-지역경제동향 소비자물가/고용률 0값 문제 수정
```

#### 구체적인 문제
1. **복합 데이터 소스**: 요약 페이지는 여러 시트의 데이터를 조합해야 함
2. **계산 로직 복잡성**: 단순 추출이 아닌 계산이 필요한 지표 존재
3. **데이터 타입 불일치**: 문자열 "2.3"과 숫자 2.3 혼재로 계산 오류

#### 해결에 소요된 시간
약 **2일** (12/28~12/29)

---

### 5. 가중치 및 순위 계산 문제

#### 문제 상황
17개 시도의 경제지표 순위를 계산할 때 **가중치가 비공개(0)이거나 결측인 경우** 처리 로직이 필요했습니다.

#### 발생한 이슈들
```
12/21: feat: 가중치 기반 순위 스키마 추가
12/21: feat: 가중치 기반 순위 로직 백엔드 구현
12/22: 수입/수출 시트: 가중치 열 없을 때 원데이터로 비교, 결측치는 1로 채우기
12/29: feat: 가중치 비공개(0) 기본값 대체 기능 및 설정 UI 추가
```

#### 구체적인 문제
1. **비공개 가중치**: 일부 업종은 가중치가 0(비공개)으로 설정됨
2. **순위 역전**: 실업률 같은 지표는 낮을수록 좋아서 정렬 기준이 다름
3. **결측 지역**: 세종시 등 일부 지역은 특정 지표 데이터 없음

#### 해결에 소요된 시간
약 **2일** (12/21~12/22, 12/29)

---

### 6. 아키텍처 전환으로 인한 대규모 수정

#### 문제 상황
초기에 **하드코딩 방식**으로 개발했다가 **스키마 기반 아키텍처**로 전환하면서 대규모 수정이 발생했습니다.

#### 변경 이력
```
12/17: 의미 기반 마커로 개선 그리고 디버그 기능 향상
12/21: 프로젝트 스키마 기반 전환
12/23: refactor: 소스 파일 모듈화 구조 개선
12/25: refactor: generate_report_html 함수 전면 재구성
12/26: Rename template files from Korean to English
```

#### 구체적인 문제
1. **위치 기반 → 의미 기반**: 셀 위치(A5, B3) 참조를 텍스트 마커 기반으로 변경
2. **하드코딩 → 스키마**: JSON 스키마 파일로 데이터 매핑 분리
3. **단일 파일 → 모듈화**: app.py 하나에서 routes/, services/, utils/ 분리

#### 해결에 소요된 시간
약 **3일** (12/17, 12/21, 12/23, 12/25, 12/26)

---

### 7. 차트 및 시각화 문제

#### 문제 상황
요약 페이지의 차트에서 **막대그래프와 점 그래프의 복합 표현**, Y축 범위 설정 등에서 문제가 발생했습니다.

#### 발생한 이슈들
```
12/29: feat: 요약 차트를 Chart.js 복합 차트로 변경
12/29: fix: 요약 차트에서 증감률 꺾은선 제거, 점만 표시
12/29: feat: 차트 Y축(증감률) 범위를 데이터 기반으로 동적 설정
12/29: fix: 참고_GRDP 표 권역 그룹 정렬 및 기호 겹침 문제 수정
```

#### 구체적인 문제
1. **복합 차트**: 막대(지수)와 점(증감률)을 동시에 표현해야 함
2. **Y축 범위**: 증감률이 -5%~+10% 등 다양해서 동적 설정 필요
3. **기호 겹침**: 데이터 포인트가 많아 라벨이 겹치는 문제

#### 해결에 소요된 시간
약 **1일** (12/29)

---

### 8. 출력 포맷 변경

#### 문제 상황
처음에는 **HWPX(한글 파일) 직접 생성**을 시도했으나, 복잡성으로 인해 **한글 복붙용 HTML**로 전략을 변경했습니다.

#### 발생한 이슈들
```
12/23: DOCX 생성기 개선: 정답 이미지와 유사하게 포맷팅
12/23: fix: DOCX 생성 및 다운로드 기능 수정
12/25: feat: 페이지 편집 기능 및 HWPX 내보내기 기능 추가
12/29: feat: 한글 복붙용 HTML 내보내기 기능 구현
```

#### 전략 변경 이유
1. **HWPX 복잡성**: 한글 파일 형식이 복잡하고 문서화가 부족
2. **표 호환성**: HWPX로 생성한 표가 한글에서 깨지는 문제
3. **실용적 대안**: HTML을 복사-붙여넣기 하는 방식이 더 안정적

#### 해결에 소요된 시간
약 **2일** (12/23, 12/25, 12/29)

---

### 9. 결측치 표시 및 검토 기능

#### 문제 상황
데이터가 없거나 비공개인 항목을 **시각적으로 표시**하고 **사용자가 수정**할 수 있는 기능 구현에 시간이 소요되었습니다.

#### 발생한 이슈들
```
12/18: 결측치 개선
12/25: 결측치/비공개 정보를 노란색 형광펜 플레이스홀더로 표시
12/25: feat: 결측치 확인을 필수 필드만으로 제한
12/25: fix: 결측치 체크 간소화 - 전국 데이터 필수 필드 제거
12/30: feat: 검토완료 시 결측치 하이라이트 제거
12/30: fix: 표 결측치 플레이스홀더 텍스트 제거 및 하이라이트만 유지
```

#### 구체적인 문제
1. **결측치 판별**: None, 0, "", "-", "비공개" 등 다양한 형태 구분
2. **하이라이트 표시**: CSS로 노란색 형광펜 효과 구현
3. **검토 완료**: 사용자가 수정 후 하이라이트 제거 기능

#### 해결에 소요된 시간
약 **2일** (12/18, 12/25, 12/30)

---

### 10. 🔴 파일 업로드 과정에서 비어있는 보도자료 생성 (원인 파악 지연)

#### 문제 상황
파일을 업로드했는데 **보도자료가 비어있는 상태로 생성**되는 문제가 발생했습니다. 처음에는 템플릿 문제나 데이터 추출 로직 문제로 생각하고 해당 부분을 반복적으로 수정했으나, **실제 원인은 파일 업로드 프로세스 자체**에 있었습니다.

#### 증상
- 엑셀 파일 업로드 후 보도자료 미리보기가 모두 빈 화면으로 표시
- 데이터가 전혀 추출되지 않거나 None으로 표시
- 일부 보도자료만 정상 동작하고 나머지는 비어있음

#### 잘못된 원인 추적 (시간 낭비)
1. **템플릿 파일 문제로 오인**: Jinja2 변수명을 여러 차례 수정
2. **데이터 추출 로직 문제로 오인**: 스키마와 생성기 코드를 반복 수정
3. **엑셀 파싱 문제로 오인**: openpyxl 관련 코드 디버깅

#### 실제 원인
파일 업로드 과정에서 **업로드된 파일이 제대로 저장되지 않거나**, **세션/컨텍스트 간에 파일 경로가 올바르게 전달되지 않는 문제**였습니다.

구체적으로:
1. **파일 경로 불일치**: 업로드된 파일의 실제 저장 위치와 데이터 추출 시 참조하는 경로가 다름
2. **세션 상태 유실**: 파일 업로드 후 세션에 저장된 파일 정보가 다른 요청에서 접근 불가
3. **비동기 처리 문제**: 파일 저장이 완료되기 전에 데이터 추출이 시작됨

#### 왜 원인 파악이 늦었나?
1. **에러 메시지 없음**: 파일이 없어도 빈 데이터만 반환하고 에러가 발생하지 않음
2. **부분적 동작**: 일부 보도자료는 캐시된 데이터로 정상 표시되어 혼란
3. **복잡한 파이프라인**: 업로드 → 저장 → 경로 전달 → 데이터 추출 → 렌더링 과정이 길어서 어느 단계에서 문제인지 파악 어려움
4. **로그 부족**: 파일 업로드 과정에 대한 상세 로그가 없었음

#### 해결 방법
```python
# 업로드 시 파일 존재 여부 확인 로그 추가
print(f"업로드된 파일 경로: {file_path}")
print(f"파일 존재 여부: {os.path.exists(file_path)}")

# 데이터 추출 전 파일 검증
if not os.path.exists(file_path):
    raise FileNotFoundError(f"파일을 찾을 수 없습니다: {file_path}")
```

#### 해결에 소요된 시간
약 **2~3일** (원인 파악에만 상당 시간 소요, 실제 수정은 몇 줄)

#### 교훈
> ⚠️ **버그 발생 시 가장 기본적인 것부터 확인해야 한다.**
> 
> 복잡한 로직(템플릿, 데이터 추출)을 먼저 의심하기 전에, **파일이 실제로 존재하는지, 경로가 올바른지** 등 기초적인 부분을 먼저 확인했어야 했다.

---

## 📈 문제 유형별 분류

### 커밋 유형 분석

| 유형 | 커밋 수 | 비율 |
|------|---------|------|
| 기능 구현 (feat) | 45개 | 31% |
| 버그 수정 (fix) | 26개 | 18% |
| 리팩토링 (refactor) | 5개 | 3% |
| 스타일/문서 | 15개 | 10% |
| 기타 (업데이트/개선) | 56개 | 38% |

### 주요 버그 카테고리

| 카테고리 | 발생 건수 | 대표 사례 |
|----------|-----------|----------|
| 🔴 **보도자료 형식 변경** | 1건 | 2025년 4분기 형식 전면 변경으로 거의 처음부터 재개발 |
| **데이터 추출 오류** | 10건 | 시트명 불일치, 셀 위치 변경 |
| **템플릿 렌더링** | 8건 | 변수명 불일치, 키 호환성 |
| **수치 계산** | 5건 | 0값 표시, 순위 계산 오류 |
| **UI/UX** | 3건 | 다크모드, 스타일 유지 |
| 🔴 **파일 업로드/경로** | 1건 | 파일 경로 불일치로 빈 보도자료 생성 (원인 파악 지연) |

---

## 🎯 교훈 및 개선 방안

### 1. 🔴 외부 의존성 변경에 대한 대응 전략
> **문제**: 2025년 4분기 보도자료 형식이 전면 변경되면서 기존 시스템이 전혀 작동하지 않아 거의 처음부터 다시 개발해야 했음
> 
> **개선**: 
> - 외부 데이터 소스의 형식 변경 가능성을 사전에 고려한 유연한 아키텍처 설계
> - 스키마 기반 시스템으로 전환하여 형식 변경에 빠르게 대응 가능하도록 개선
> - 데이터 제공 기관과 형식 변경 사전 공지 체계 구축

### 2. 사전 데이터 분석의 중요성
> **문제**: 엑셀 파일 구조를 사전에 충분히 분석하지 않음
> 
> **개선**: 데이터 스키마 문서를 먼저 작성하고 의뢰 기관과 확인

### 3. 프로토타입의 중요성
> **문제**: 초기 아키텍처 결정이 잘못되어 중간에 대규모 수정
> 
> **개선**: 작은 범위로 프로토타입 구현 후 검증 후 확장

### 4. 템플릿-백엔드 계약
> **문제**: 템플릿 변수명과 백엔드 데이터 키가 불일치
> 
> **개선**: TypeScript처럼 인터페이스/스키마를 먼저 정의하고 양쪽에서 준수

### 5. 단위 테스트 부재
> **문제**: 데이터 추출 로직 변경 시 기존 기능이 깨지는 것을 늦게 발견
> 
> **개선**: 핵심 데이터 추출 함수에 대한 단위 테스트 작성

### 6. 출력 포맷 조기 결정
> **문제**: HWPX → DOCX → HTML 복붙 방식으로 여러 번 변경
> 
> **개선**: 출력 포맷 요구사항을 초기에 명확히 정의

### 7. 🔴 기본부터 확인하기 (가장 중요한 교훈)
> **문제**: 비어있는 보도자료 생성 시 복잡한 로직(템플릿, 데이터 추출)만 의심하고, **파일 자체가 제대로 업로드/저장되었는지** 기본적인 확인을 나중에 함
> 
> **개선**: 
> - 디버깅 시 **가장 기본적인 것부터 확인** (파일 존재, 경로 확인, 권한 등)
> - 파이프라인 각 단계에 **상세 로그 추가**
> - "복잡한 곳에 문제가 있을 것"이라는 선입견 버리기

---

## 📊 결론

### 총 지연 시간 추정

| 원인 | 추정 소요 시간 |
|------|---------------|
| 🔴 **2025년 4분기 보도자료 형식 변경 및 GRDP 추가** | **5~6일** |
| 엑셀 구조 파악 및 수정 | 3~4일 |
| 아키텍처 전환 | 3일 |
| 🔴 **파일 업로드 문제 원인 파악 지연** | **2~3일** |
| 요약 페이지 데이터 추출 | 2일 |
| 가중치/순위 계산 | 2일 |
| 결측치 처리 | 2일 |
| 출력 포맷 변경 | 2일 |
| 템플릿 변수 수정 | 1일 |
| 차트 문제 | 1일 |
| **합계** | **약 23~25일** |

### 핵심 지연 원인 요약

1. 🔴 **2025년 4분기 보도자료 형식 전면 변경**: 국가데이터처의 보도자료 형식이 크게 바뀌면서 **기존 시스템이 전혀 작동하지 않아 거의 처음부터 다시 개발**해야 했음. 시트 구조, 데이터 위치, 표 형식이 모두 변경되어 기존 코드의 70% 이상을 재작성
2. 🔴 **GRDP 지수 추가**: 나중에 추가된 GRDP(실질지역내총생산) 지수를 별도 파일에서 추출하고 보도자료에 통합하는 작업이 추가로 필요했음
3. **예상 외의 데이터 구조**: 제공받은 엑셀 파일의 구조가 문서와 다르고 분기별로 변동
4. **중간 아키텍처 변경**: 하드코딩 → 스키마 기반으로 전환하면서 대규모 수정
5. 🔴 **파일 업로드 버그 원인 파악 지연**: 비어있는 보도자료가 생성되는 문제의 원인이 복잡한 로직이 아닌 **파일 경로 문제**였으나, 이를 뒤늦게 발견
6. **복잡한 요구사항 발견**: 단순 데이터 추출이 아닌 계산, 순위, 가중치 등 복잡한 로직 필요
7. **출력 포맷 시행착오**: HWPX 직접 생성에서 HTML 복붙 방식으로 전략 변경
8. **테스트 자동화 부재**: 수정 시 기존 기능 깨짐을 수동으로만 확인

---

## 🔄 Revert/롤백 히스토리

시행착오로 인해 롤백이 필요했던 경우:

| 커밋 | 내용 | 원인 |
|------|------|------|
| `7104580` | revert: 고용률 템플릿 마커 시트명 원복 | 시트명이 "고용"이 아니라 "고용률"이었음 |
| `8e71329` | 복원: 증가/감소 판단 모듈 복원 | 리팩토링 중 필요한 모듈 삭제 |
| `1df97d4` | 정답복원 | 정답 이미지 파일 실수로 삭제 |
| `f6538b0` | 정답복원 | 정답 이미지 파일 실수로 삭제 |

---

<div align="center">

**이 문서는 프로젝트 개발 과정에서 겪은 어려움과 지연 원인을 분석한 것입니다.**

*Git 커밋 로그 기반 분석 | 작성일: 2025년 12월 30일*

</div>

