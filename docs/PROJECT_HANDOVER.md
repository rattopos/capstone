# 프로젝트 위임 문서 (Project Handover Document)

> **대상**: Gemini 3.0 Pro  
> **목적**: 지역경제동향 보도자료 생성 시스템 프로젝트의 완전한 위임  
> **작성일**: 2025년 1월  
> **프로젝트 상태**: 운영 중

---

## 📋 목차

1. [프로젝트 개요](#1-프로젝트-개요)
2. [핵심 규칙 및 제약사항](#2-핵심-규칙-및-제약사항)
3. [기술 스택 및 아키텍처](#3-기술-스택-및-아키텍처)
4. [프로젝트 구조](#4-프로젝트-구조)
5. [주요 워크플로우](#5-주요-워크플로우)
6. [API 엔드포인트](#6-api-엔드포인트)
7. [데이터 구조](#7-데이터-구조)
8. [개발 규칙 및 원칙](#8-개발-규칙-및-원칙)
9. [문제 해결 가이드](#9-문제-해결-가이드)
10. [참고 문서](#10-참고-문서)

---

## 1. 프로젝트 개요

### 1.1 프로젝트 목적

**지역경제동향 보도자료 생성 시스템**은 국가데이터처(구 통계청)에서 분기별로 발행하는 지역경제동향 보도자료를 자동으로 생성하는 Flask 기반 웹 애플리케이션입니다.

### 1.2 핵심 가치

- **업무 효율성 증대**: 보도자료 초안 작성 자동화로 반복 작업 시간 단축
- **정확성 향상**: 수동 입력 오류 방지 및 데이터 일관성 보장
- **실무자 만족도 향상**: 단순 반복 작업 해방으로 업무 피로도 감소

### 1.3 지원 보도자료

- **요약 보도자료** (9개): 표지, 일러두기, 목차, 인포그래픽, 요약 페이지들
- **부문별 보도자료** (10개): 광공업생산, 서비스업생산, 소비동향, 건설동향, 수출, 수입, 물가동향, 고용률, 실업률, 국내인구이동
- **시도별 보도자료** (18개): 17개 시도 + 참고_GRDP
- **통계표** (13개): 통계표 목차, 개별 통계표, 참고-GRDP, 부록

### 1.4 주요 사용자

- **실무팀**: 담당 사무관 1명, 주무관 1명 (총 2명)
- **작업 주기**: 분기별 (1년에 4회)
- **기존 작업 시간**: 약 7일
- **개선 후 작업 시간**: 약 3분 (생성) + 편집/검토 시간

---

## 2. 핵심 규칙 및 제약사항

### 2.1 데이터 무결성 원칙 (최우선)

⚠️ **절대 위반 금지**

- **데이터에 어떤 왜곡도 들어가서는 안 됨**
- 결측치(missing data)는 절대 기본값, 추정값, 평균값 등으로 채우지 말 것
- 결측치는 반드시 'N/A', None, 또는 빈 값으로 표시하여 담당자가 한눈에 알 수 있게 할 것
- 가중치, 통계값, 계산 결과 등 모든 데이터는 원본 그대로 유지할 것
- 데이터 변환 시에도 원본 데이터의 의미를 왜곡하지 않도록 주의할 것
- 기본값이나 플레이스홀더를 사용할 경우 반드시 명시적으로 표시하고, 실제 데이터와 구분할 수 있게 할 것

### 2.2 한글 파일 붙여넣기 형식 유지 원칙 (최우선)

⚠️ **절대 위반 금지**

- **한글(HWP) 파일에 붙여넣었을 때 형식이 깨지지 않는 것이 최우선 원칙입니다**
- HTML 생성 시 한글 프로그램에서 인식 가능한 형식으로 생성할 것
- 표(table)는 반드시 인라인 스타일로 border, padding, text-align 등을 명시할 것
- 텍스트는 한글에서 지원하는 폰트(맑은 고딕, 바탕 등)를 사용할 것
- 복잡한 CSS나 JavaScript는 제거하고 순수 HTML + 인라인 스타일만 사용할 것
- 차트나 이미지는 플레이스홀더로 대체하거나 한글에서 인식 가능한 형식으로 변환할 것
- 클립보드 복사 시 HTML 형식이 유지되도록 할 것
- 한글에서 붙여넣기 후에도 표 구조, 텍스트 서식, 줄바꿈 등이 정확히 유지되어야 함

### 2.3 기초자료 사용 금지 규칙

⚠️ **중요**

- **기초자료 수집표는 사용하지 않습니다**
- `raw_excel_path` 파라미터는 코드에서 제거되었거나 `None`으로 설정됨
- `session.get('raw_excel_path')`를 사용하는 코드는 모두 `None`으로 변경됨
- `DataConverter`나 기초자료 관련 변환 로직은 사용하지 않음
- **분석표만 사용하여 보도자료를 생성함**
- 기초자료 관련 엔드포인트(`/download-analysis`, `/generate-analysis-with-weights` 등)는 유지하되 실제로는 사용하지 않음

### 2.4 용어 정의 (절대 혼동 금지)

⚠️ **중요**

- **인포그래픽 = 지도(map)**를 의미함
- **차트 = 막대그래프와 점 그래프**를 의미함
- 이 두 가지는 완전히 다른 것이므로 수정 작업 시 절대 혼동하지 말고, 각각 독립적으로 취급해야 함

### 2.5 기존 코드 보존 원칙

- 정상 동작하고 있는 부분은 가급적 건드리지 말 것
- 버그 수정이나 기능 추가 시 최소한의 변경만 적용
- 기존 로직 변경이 필요한 경우 사전에 사용자에게 설명 및 동의 구함
- 불필요한 리팩토링이나 관련 없는 파일 수정 금지

### 2.6 디버그 로그 업데이트 규칙

- 디버그 작업을 수행할 때마다 `docs/DEBUG_LOG.md` 파일을 반드시 업데이트할 것
- 버그를 발견하거나 수정할 때 다음 정보를 기록:
  - 날짜/시간
  - 문제 설명
  - 원인 분석
  - **에이전트 사고 과정** (중요)
  - 해결 방법
  - 관련 파일 목록
  - 작업 상태 (진행중/완료/실패/보류)
- 버그 수정 작업을 시작하기 전에 반드시 `docs/DEBUG_LOG.md` 파일을 먼저 확인할 것

### 2.7 코드 무결성 감사관 역할

- 당신은 현재 프로젝트의 **'코드 무결성 감사관(Code Integrity Auditor)'**입니다.
- 당신의 목표는 **"누락 없는 완전한 구현"**입니다.
- 다음 **[작업 프로토콜]**을 엄격히 준수하여 작업을 수행하세요:

#### [작업 프로토콜]

1. **순차적 처리**: 한 번에 모든 파일을 열지 마세요. 체크리스트의 섹션별(1 -> 2 -> 3...)로 나누어 순서대로 처리하세요.
2. **상태 검증**: 각 항목에 대해 코드를 수정하기 전에, 현재 상태를 먼저 읽고 문제점이 있는지 확인하세요.
3. **강제 구현**: 체크리스트에 '수정 방안'이 명시된 경우, 코드가 비슷해 보이더라도 확실하게 해당 로직(파라미터 추가, report_info 반환 등)을 적용하세요.
4. **진행 상황 보고**: 한 섹션(예: 1. Generator 클래스들)이 끝날 때마다, 어떤 파일을 수정했는지 요약하고 다음 섹션으로 넘어가세요.
5. **최종 검수**: 모든 작업이 끝나면, 아래 체크리스트를 다시 훑어보고 누락된 항목이 없는지 스스로 검증하세요.

---

## 3. 기술 스택 및 아키텍처

### 3.1 기술 스택

#### 백엔드
- **Python 3.10+**: 메인 프로그래밍 언어
- **Flask 2.3.0+**: 웹 프레임워크
  - Blueprint 기반 모듈화된 라우팅
  - 세션 관리
  - 파일 업로드/다운로드 처리
- **Jinja2 3.1.0+**: 템플릿 엔진
  - 커스텀 필터 지원
  - 템플릿 상속 및 포함

#### 데이터 처리
- **pandas 2.0.0+**: 데이터 분석 및 처리
  - 엑셀 파일 읽기/쓰기
  - DataFrame 조작
  - 데이터 변환
- **openpyxl 3.1.0+**: 엑셀 파일 직접 조작
  - 시트 읽기/쓰기
  - 셀 수정
  - 수식 처리
- **xlwings 0.30.0+**: Excel 애플리케이션 연동 (수식 계산용, 선택사항)
- **formulas 1.2.0+**: 순수 Python 수식 계산 (선택사항)

#### 프론트엔드
- **HTML5/CSS3**: 마크업 및 스타일링
- **Vanilla JavaScript (ES6+)**: 클라이언트 사이드 로직
  - Fetch API (비동기 통신)
  - DOM 조작
  - 상태 관리
- **반응형 디자인**: CSS Grid, Flexbox

#### 기타 도구
- **BeautifulSoup4 4.12.0+**: HTML 파싱 및 조작
- **python-dateutil 2.8.0+**: 날짜 처리
- **requests 2.31.0+**: HTTP 요청 (KOSIS API 등)

### 3.2 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                    웹 브라우저 (클라이언트)                    │
│  - dashboard.html (단일 페이지 애플리케이션)                  │
│  - JavaScript (Fetch API, 상태 관리)                         │
└───────────────────┬─────────────────────────────────────────┘
                    │ HTTP/HTTPS
┌───────────────────▼─────────────────────────────────────────┐
│              Flask 웹 서버 (Python)                          │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  routes/        (라우팅 계층)                         │   │
│  │  - main.py      (메인 페이지, 파일 서빙)               │   │
│  │  - api.py       (REST API 엔드포인트)                 │   │
│  │  - preview.py   (미리보기 엔드포인트)                  │   │
│  │  - debug.py     (디버그 엔드포인트)                    │   │
│  └──────────────┬───────────────────────────────────────┘   │
│  ┌──────────────▼───────────────────────────────────────┐   │
│  │  services/     (비즈니스 로직 계층)                    │   │
│  │  - report_generator.py  (보도자료 생성)                │   │
│  │  - excel_processor.py   (엑셀 전처리)                  │   │
│  │  - grdp_service.py      (GRDP 데이터 처리)             │   │
│  │  - summary_data.py      (요약 데이터 추출)              │   │
│  └──────────────┬───────────────────────────────────────┘   │
│  ┌──────────────▼───────────────────────────────────────┐   │
│  │  templates/    (데이터 추출 및 템플릿)                  │   │
│  │  - *_generator.py  (데이터 추출기)                     │   │
│  │  - *_template.html (Jinja2 템플릿)                    │   │
│  └──────────────┬───────────────────────────────────────┘   │
│  ┌──────────────▼───────────────────────────────────────┐   │
│  │  utils/        (유틸리티 함수)                         │   │
│  │  - filters.py        (Jinja2 필터)                    │   │
│  │  - excel_utils.py    (엑셀 처리)                      │   │
│  │  - data_utils.py     (데이터 검증)                    │   │
│  └──────────────────────────────────────────────────────┘   │
└───────────────────┬─────────────────────────────────────────┘
                    │
┌───────────────────▼─────────────────────────────────────────┐
│              데이터 계층                                      │
│  - uploads/      (업로드된 파일)                             │
│  - templates/    (생성된 HTML)                              │
│  - exports/      (내보내기 파일)                             │
│  - Excel 파일    (분석표)                                    │
└─────────────────────────────────────────────────────────────┘
```

### 3.3 레이어 구조

1. **프레젠테이션 레이어** (dashboard.html)
   - 사용자 인터페이스
   - 상태 관리 (JavaScript)
   - API 호출 및 응답 처리

2. **라우팅 레이어** (routes/)
   - HTTP 요청 라우팅
   - 세션 관리
   - 파일 업로드/다운로드 처리

3. **비즈니스 로직 레이어** (services/)
   - 보도자료 생성 오케스트레이션
   - 데이터 전처리
   - GRDP 데이터 처리

4. **데이터 추출 레이어** (templates/*_generator.py)
   - 엑셀 데이터 추출
   - 데이터 변환 및 가공
   - 템플릿 데이터 준비

5. **템플릿 레이어** (templates/*_template.html)
   - Jinja2 템플릿
   - HTML 렌더링
   - 데이터 바인딩

6. **유틸리티 레이어** (utils/)
   - 공통 함수
   - 필터 및 헬퍼
   - 데이터 검증

---

## 4. 프로젝트 구조

### 4.1 디렉토리 구조

```
capstone/
├── app.py                          # Flask 애플리케이션 진입점
├── dashboard.html                  # 메인 대시보드 UI (단일 파일)
├── report_generator.py             # 통합 보도자료 생성기 (CLI용)
│
├── config/                         # 설정 파일
│   ├── __init__.py
│   ├── settings.py                 # 기본 설정 (경로, 상수)
│   └── reports.py                  # 보도자료 정의 및 순서
│
├── routes/                         # Flask 라우팅
│   ├── __init__.py
│   ├── main.py                     # 메인 페이지 라우트
│   ├── api.py                      # REST API 엔드포인트
│   ├── preview.py                  # 미리보기 라우트
│   └── debug.py                    # 디버그 라우트
│
├── services/                       # 비즈니스 로직
│   ├── __init__.py
│   ├── report_generator.py         # 보도자료 생성 서비스
│   ├── excel_processor.py          # 엑셀 전처리 서비스
│   ├── grdp_service.py             # GRDP 데이터 처리 서비스
│   └── summary_data.py            # 요약 데이터 추출 서비스
│
├── utils/                          # 유틸리티 함수
│   ├── __init__.py
│   ├── filters.py                  # Jinja2 커스텀 필터
│   ├── excel_utils.py              # 엑셀 관련 유틸리티
│   └── data_utils.py               # 데이터 검증 유틸리티
│
├── templates/                      # 템플릿 및 생성기
│   ├── *_generator.py              # 데이터 추출기 (각 보도자료별)
│   ├── *_template.html             # Jinja2 템플릿 (각 보도자료별)
│   ├── *_schema.json               # 데이터 스키마 (일부 보도자료)
│   └── grdp_extracted.json         # 추출된 GRDP 데이터 (런타임 생성)
│
├── uploads/                        # 업로드된 파일 저장소
│   └── *.xlsx                      # 업로드된 엑셀 파일 (분석표)
│
├── debug/                          # 디버그용 HTML 파일
│   └── *.html                      # 디버그 모드에서 생성된 보도자료 HTML
│
├── exports/                        # 내보내기 파일 (한글용 HTML 등)
│   └── *.html                      # 최종 내보내기된 HTML 파일
│
├── docs/                           # 문서
│   ├── PROJECT_COMPREHENSIVE_GUIDE.md  # 종합 가이드
│   ├── DEBUG_LOG.md                # 디버그 로그
│   ├── GLOSSARY.md                 # 용어 사전
│   ├── PROJECT_LOGIC_SUMMARY.md   # 로직 요약
│   └── PROJECT_HANDOVER.md        # 이 문서
│
├── correct_answer/                 # 참고용 정답 이미지
│   ├── MODS_MI_2025/              # 국가데이터처 메인 CI
│   ├── MODS_MI_sub_2025/          # 소속기관 CI
│   ├── whole/                      # 전체 보도자료 이미지
│   ├── 부문별/                     # 부문별 보도자료 이미지
│   ├── 시도별/                     # 시도별 보도자료 이미지
│   ├── 요약/                       # 요약 보도자료 이미지
│   └── 통계표/                     # 통계표 이미지
│
├── requirements.txt                # Python 의존성
└── README.md                       # 프로젝트 개요
```

### 4.2 주요 파일 역할

#### 애플리케이션 진입점
- **app.py**: Flask 애플리케이션 팩토리 및 설정
  - Flask 인스턴스 생성
  - Blueprint 등록
  - 필터 등록
  - 서버 실행 (포트 5050)

#### 설정 파일
- **config/settings.py**: 
  - BASE_DIR, TEMPLATES_DIR 등 경로 설정
  - UPLOAD_FOLDER, DEBUG_FOLDER, EXPORT_FOLDER
  - Flask 설정 (SECRET_KEY, MAX_CONTENT_LENGTH)

- **config/reports.py**:
  - REPORT_ORDER: 전체 보도자료 순서
  - SUMMARY_REPORTS: 요약 보도자료 목록
  - SECTOR_REPORTS: 부문별 보도자료 목록
  - REGIONAL_REPORTS: 시도별 보도자료 목록
  - STATISTICS_REPORTS: 통계표 보도자료 목록
  - PAGE_CONFIG: 페이지 번호 설정
  - TOC_SECTOR_ITEMS, TOC_REGION_ITEMS: 목차 항목

#### 라우팅 파일
- **routes/main.py**: 
  - `/`: 대시보드 페이지
  - `/uploads/<filename>`: 업로드 파일 다운로드
  - `/view/<filename>`: 파일 직접 보기
  - `/exports/<path:filepath>`: 내보내기 파일 보기
  - `/templates/<filename>`: 템플릿 파일 서빙

- **routes/api.py**:
  - `/api/upload`: 파일 업로드
  - `/api/generate-preview`: 미리보기 생성
  - `/api/generate-all`: 전체 보도자료 생성
  - `/api/upload-grdp`: GRDP 파일 업로드
  - `/api/export-final`: 최종 문서 내보내기
  - `/api/export-xlsx`: XLSX 형식 내보내기
  - `/api/export-hwp-ready`: 한글 복붙용 HTML 생성

#### 서비스 파일
- **services/report_generator.py**:
  - `generate_report_html()`: 개별 보도자료 HTML 생성
  - `generate_regional_report_html()`: 시도별 보도자료 생성
  - `generate_statistics_report_html()`: 통계표 보도자료 생성
  - Generator 모듈 로드 및 실행 오케스트레이션

- **services/excel_processor.py**:
  - `preprocess_excel()`: 엑셀 수식 계산
  - `_try_openpyxl_calculation()`: openpyxl로 직접 계산
  - `_try_formulas()`: formulas 라이브러리 사용
  - `_try_xlwings()`: xlwings로 Excel 앱 사용

- **services/grdp_service.py**:
  - `parse_kosis_grdp_file()`: KOSIS GRDP 파일 파싱
  - `get_default_grdp_data()`: 기본 GRDP 데이터 생성
  - `save_extracted_contributions()`: 기여율 데이터 저장

- **services/summary_data.py**:
  - `get_summary_overview_data()`: 요약-지역경제동향 데이터
  - `get_summary_production_data()`: 요약-생산 데이터
  - 각종 요약 데이터 추출 함수

#### 유틸리티 파일
- **utils/filters.py**:
  - `is_missing()`: 결측치 확인 필터
  - `format_value()`: 값 포맷팅 필터
  - `register_filters()`: Flask에 필터 등록

- **utils/excel_utils.py**:
  - `load_generator_module()`: Generator 모듈 동적 로드
  - `extract_year_quarter_from_excel()`: 연도/분기 추출
  - `detect_file_type()`: 파일 유형 감지

- **utils/data_utils.py**:
  - `check_missing_data()`: 데이터 결측치 검증

---

## 5. 주요 워크플로우

### 5.1 파일 업로드 및 전처리

```
분석표 엑셀 파일 업로드
    ↓
파일 유형 감지: 'analysis'
    ↓
수식 계산 전처리 (preprocess_excel)
    ├─→ openpyxl 직접 계산 시도 (1순위)
    ├─→ formulas 라이브러리 시도 (2순위)
    └─→ xlwings 시도 (3순위, Excel 앱 필요)
    ↓
연도/분기 자동 추출 (extract_year_quarter_from_excel)
    ↓
GRDP 데이터 확인 및 추출
    ├─→ 분석표 GRDP 시트 확인
    ├─→ 있음: GRDP 데이터 추출 및 세션 저장
    └─→ 없음: GRDP 업로드 요청 모달 표시
    ↓
세션에 저장:
    - excel_path
    - year, quarter
    - file_type: 'analysis'
    - grdp_data (있을 경우)
    ↓
대시보드 준비 완료
```

### 5.2 보도자료 생성 프로세스

```
보도자료 ID + 엑셀 경로
    ↓
Generator 모듈 동적 로드 (templates/{generator_name}.py)
    ├─→ 클래스 기반 Generator (대부분)
    └─→ 함수 기반 Generator (고용률, 실업률)
    ↓
데이터 추출
    ├─→ 엑셀 파일 읽기 (pandas/openpyxl)
    ├─→ 특정 시트 접근 (예: 'A 분석', 'B 분석')
    ├─→ 데이터 파싱 및 계산
    └─→ 딕셔너리 형태로 구조화
    ↓
커스텀 데이터 병합 (결측치 대체 등)
    ↓
결측치 검증 (check_missing_data)
    ↓
Jinja2 템플릿 렌더링
    ├─→ 템플릿 로드 (templates/{template_name}.html)
    ├─→ 데이터 바인딩
    └─→ HTML 문자열 생성
    ↓
HTML 반환 (미리보기 또는 최종 생성)
```

### 5.3 Generator 패턴

#### 클래스 기반 Generator

```python
class MiningManufacturingGenerator:
    def __init__(self, excel_path: str):
        self.excel_path = excel_path
        self.df = None
    
    def load_data(self):
        # 엑셀 파일 로드
        pass
    
    def extract_all_data(self) -> dict:
        # 모든 데이터 추출
        return {
            'report_info': {...},
            'national_data': {...},
            'regional_data': {...},
            # ...
        }
```

#### 함수 기반 Generator (고용률, 실업률)

```python
def load_data(excel_path: str):
    # 데이터 로드
    return df_analysis, df_index

def get_nationwide_data(df_analysis, df_index):
    # 전국 데이터 추출
    return {...}

def generate_report_data(excel_path: str, raw_excel_path: str = None, 
                        year: int = None, quarter: int = None) -> dict:
    # 데이터 추출 및 반환
    return {...}
```

---

## 6. API 엔드포인트

### 6.1 파일 업로드 및 관리

| 메서드 | 엔드포인트 | 설명 |
|--------|-----------|------|
| `POST` | `/api/upload` | 엑셀 파일 업로드 |
| `POST` | `/api/upload-grdp` | GRDP 파일 업로드 |
| `POST` | `/api/use-default-grdp` | 기본 GRDP 데이터 사용 |
| `GET` | `/api/check-grdp` | GRDP 데이터 상태 확인 |

### 6.2 보도자료 생성

| 메서드 | 엔드포인트 | 설명 |
|--------|-----------|------|
| `POST` | `/api/generate-preview` | 특정 보도자료 미리보기 생성 |
| `POST` | `/api/generate-all` | 전체 보도자료 생성 |
| `POST` | `/api/generate-all-regional` | 시도별 보도자료 전체 생성 |

### 6.3 보도자료 순서 관리

| 메서드 | 엔드포인트 | 설명 |
|--------|-----------|------|
| `GET` | `/api/report-order` | 현재 보도자료 순서 반환 |
| `POST` | `/api/report-order` | 보도자료 순서 업데이트 (설정 파일 기반) |

### 6.4 세션 관리

| 메서드 | 엔드포인트 | 설명 |
|--------|-----------|------|
| `GET` | `/api/session-info` | 현재 세션 정보 반환 |

### 6.5 내보내기

| 메서드 | 엔드포인트 | 설명 |
|--------|-----------|------|
| `POST` | `/api/export-final` | 최종 문서 HTML 생성 (PDF용) |
| `POST` | `/api/export-xlsx` | XLSX 형식 내보내기 |
| `POST` | `/api/export-hwp-ready` | 한글 복붙용 HTML 생성 |
| `POST` | `/api/save-html-to-project` | HTML을 프로젝트 메인 디렉토리에 저장 |

---

## 7. 데이터 구조

### 7.1 보도자료 데이터 구조

모든 보도자료는 공통된 기본 구조를 따릅니다:

```python
{
    'report_info': {
        'year': int,           # 연도 (예: 2025)
        'quarter': int,        # 분기 (1, 2, 3, 4)
        'page_number': str,    # 페이지 번호 (선택사항)
        'organization': str,   # 조직명 (예: '국가데이터처')
        'department': str       # 부서명 (예: '경제통계심의관')
    },
    # 보도자료별 특정 데이터...
}
```

### 7.2 엑셀 파일 구조

#### 분석표 시트 구조

**분석 시트:**
- `A 분석`: 광공업생산 분석
- `B 분석`: 서비스업생산 분석
- `C 분석`: 소비 분석
- `D(고용률)분석`: 고용률 분석
- `D(실업)분석`: 실업률 분석
- `E(품목성질물가)분석`: 물가 분석
- `G 분석`: 수출 분석
- `H 분석`: 수입 분석
- `I(순인구이동)집계`: 인구이동 집계

**집계 시트:**
- `A(광공업생산)집계`: 광공업생산 집계 데이터
- `B(서비스업생산)집계`: 서비스업생산 집계 데이터
- `C(소비)집계`: 소비 집계 데이터
- `D(고용률)집계`: 고용률 집계 데이터
- `D(실업)집계`: 실업률 집계 데이터
- `E(품목성질물가)집계`: 물가 집계 데이터
- `G(수출)집계`: 수출 집계 데이터
- `H(수입)집계`: 수입 집계 데이터
- `I(순인구이동)집계`: 인구이동 집계 데이터

**기타 시트:**
- `I GRDP` 또는 `GRDP`: GRDP 데이터 (선택사항)
- `본청`: 메타데이터
- `이용관련`: 이용 안내 (연도/분기 정보: K17 셀에 연도, M17 셀에 분기)

#### 분석 시트 컬럼 구조 (0-based 인덱스)

| 컬럼명 | A분석 | B분석 | C분석 | D(고용률)분석 | G분석 | F'분석 |
|--------|-------|-------|-------|--------------|-------|--------|
| 지역이름 | 3 | 3 | 3 | 2 | 3 | 2 |
| 산업/업태코드 | 6 | 6 | 6 | - | 7 | 4 |
| 산업/업태명 | 7 | 7 | 7 | - | 8 | 6 |
| 연령대 | - | - | - | 5 | - | - |
| 가중치 | 8 | 8 | 8 | - | - | - |
| 2025_2Q 증감률 | 21 | 20 | 20 | 18 | 22 | 19 |
| 기여도 | 28 | - | 26 | - | 26 | - |

#### 집계 시트 열 구조 정의 (1-based 인덱스)

| 시트명 | 메타시작열 | 연도시작열 | 분기시작열 | 가중치열 |
|--------|-----------|-----------|-----------|---------|
| A(광공업생산)집계 | 4 | 10 | 15 | 7 |
| B(서비스업생산)집계 | 4 | 9 | 14 | 7 |
| C(소비)집계 | 3 | 8 | 13 | 없음 |
| D(고용률)집계 | 3 | 8 | 13 | 없음 |
| D(실업)집계 | 3 | 8 | 13 | 없음 |
| E(지출목적물가)집계 | 3 | 8 | 13 | 없음 |
| E(품목성질물가)집계 | 3 | 8 | 13 | 없음 |
| F'(건설)집계 | 2 | 6 | 11 | 없음 |
| G(수출)집계 | 4 | 10 | 15 | 없음 |
| H(수입)집계 | 4 | 10 | 15 | 없음 |
| I(순인구이동)집계 | 3 | 8 | 13 | 없음 |

**설명:**
- **메타시작열**: 메타데이터(지역코드, 지역이름 등)가 시작하는 열 번호
- **연도시작열**: 연도별 데이터가 시작하는 열 번호 (최근 5개년)
- **분기시작열**: 분기별 데이터가 시작하는 열 번호 (최근 13개 분기)
- **가중치열**: 가중치 데이터가 있는 열 번호 (없으면 None)

**데이터 범위:**
- **연도 데이터**: 당해 제외 최근 5개년 (예: 2025년 2분기 기준 → 2020, 2021, 2022, 2023, 2024)
- **분기 데이터**: 최근 13개 분기 (예: 2025년 2분기 기준 → 2022 2/4 ~ 2025 2/4)

### 7.3 GRDP 데이터 구조

```python
{
    'report_info': {
        'year': int,
        'quarter': int,
        'page_number': str
    },
    'national_summary': {
        'growth_rate': float,        # 전국 성장률 (%)
        'direction': str,            # '증가' or '감소'
        'contributions': {
            'manufacturing': float,  # 제조업 기여율
            'construction': float,   # 건설업 기여율
            'service': float,        # 서비스업 기여율
            'other': float           # 기타 기여율
        },
        'placeholder': bool          # 플레이스홀더 여부
    },
    'top_region': {
        'name': str,                 # 최고 성장 지역
        'growth_rate': float,
        'contributions': {...}
    },
    'regional_data': [
        {
            'region': str,
            'region_group': str,     # 권역 (경인, 충청, 호남 등)
            'growth_rate': float,
            'manufacturing': float,
            'construction': float,
            'service': float,
            'other': float,
            'is_group_start': bool,  # 권역 시작 여부
            'group_size': int,       # 권역 지역 수
            'placeholder': bool
        },
        ...
    ],
    'source': str,                   # 데이터 소스
    'kosis_info': {...}              # KOSIS 정보 (선택사항)
}
```

---

## 8. 개발 규칙 및 원칙

### 8.1 파일 수정 범위 제한

- 현재 하고 있는 작업과 직접 관련된 파일만 수정할 것
- 불필요한 리팩토링이나 관련 없는 파일 수정 금지
- 수정 대상 파일이 불명확한 경우 사용자에게 확인 요청

### 8.2 .cursorrules 수정 규칙

- `.cursorrules` 파일을 수정할 때는 반드시 사용자의 동의를 얻을 것
- 수정 전 변경 사항을 명확히 설명하고 승인을 받은 후에만 수정 진행

### 8.3 국가데이터처 관련 용어

- **"통계청"**이라는 명칭 대신 **"국가데이터처"**를 사용해야 합니다
- 문서 작성 시 항상 "국가데이터처"로 표기해야 합니다
- 영문명: **"Ministry of Data and Statistics"**

### 8.4 로고 및 이미지

- 문서에 필요한 로고, 아이콘, CI 이미지들은 `correct_answer/MODS_MI_2025` 및 `correct_answer/MODS_MI_sub_2025` 폴더를 참조합니다
- MODS_MI_2025에는 국가데이터처 메인 CI(컬러, 단색1~3, 흰색)가 있습니다
- MODS_MI_sub_2025에는 소속기관(지방데이터청, 국가데이터연구원 등) CI가 있습니다
- 이 폴더들에 없는 이미지는 별도로 추가하지 않고 그대로 둡니다

### 8.5 한글 파일 출력

- 한글(HWP) 파일을 직접 출력하는 기능은 구현하지 않습니다
- 대신 "한글 복붙용 HTML"을 생성하여 사용자가 복사-붙여넣기로 한글 문서에 옮길 수 있도록 합니다

### 8.6 기초자료 관련 개발 목표 (향후 계획)

⚠️ **현재는 미구현 상태이며, 향후 개발 목표로 참고:**

1. 분석표 대신 기초자료 수집표에서 가중치가 붙은 자료만 입력받도록 변경
2. 가중치를 이용해 현재 필요한 데이터 생성 (가중치 정보가 있으면 기여율 정보 도출 가능)
3. 가중치나 품목 등의 결측치는 비공개자료이므로 실무자가 직접 채울 수 있도록 플레이스홀더만 제공

**⚠️ 중요: 이 계획은 현재 미구현 상태이며, 사용자가 요청할 때만 진행하며, 미리 구현하지 않음**

---

## 9. 문제 해결 가이드

### 9.1 일반적인 오류

#### 파일 업로드 실패
- **원인**: 파일 크기 초과 (50MB 제한), 파일 형식 오류, 디스크 공간 부족
- **해결**: 파일 크기 확인, `.xlsx` 또는 `.xls` 형식 확인, 디스크 공간 확인

#### Generator 모듈 로드 실패
- **원인**: Generator 파일 경로 오류, Python 문법 오류, 모듈 의존성 문제
- **해결**: Generator 파일 존재 확인, Python 문법 검사, 필요한 라이브러리 설치 확인

#### 데이터 추출 실패
- **원인**: 시트명 불일치, 데이터 형식 오류, 셀 위치 변경
- **해결**: 엑셀 파일 시트명 확인, 데이터 형식 검증, Generator 코드 확인 및 수정

### 9.2 성능 문제

#### 보도자료 생성 느림
- **원인**: 대용량 엑셀 파일, 복잡한 데이터 처리, 네트워크 지연
- **해결**: 파일 크기 최적화, 데이터 캐싱 고려, 병렬 처리 (향후 개선)

#### 메모리 부족
- **원인**: 대용량 파일 처리, 여러 파일 동시 처리
- **해결**: 파일 크기 제한, 순차 처리, 메모리 효율적인 데이터 구조 사용

### 9.3 데이터 문제

#### 결측치 발생
- **원인**: 원본 데이터 누락, 데이터 형식 불일치, 셀 위치 오류
- **해결**: 원본 엑셀 파일 확인, 결측치 입력 모달 사용, Generator 코드 검증

#### 수식 계산 오류
- **원인**: 수식 계산 라이브러리 부재, 복잡한 수식, Excel 앱 미설치 (xlwings 사용 시)
- **해결**: `formulas` 라이브러리 설치, Excel 앱 설치 (xlwings 사용 시), 수식 단순화 고려

### 9.4 템플릿 문제

#### HTML 렌더링 오류
- **원인**: 템플릿 문법 오류, 데이터 형식 불일치, 필터 함수 오류
- **해결**: Jinja2 문법 확인, 데이터 구조 검증, 필터 함수 테스트

#### 스타일 적용 안 됨
- **원인**: CSS 경로 오류, 인라인 스타일 누락, 브라우저 호환성
- **해결**: CSS 파일 경로 확인, 인라인 스타일 사용, 브라우저 호환성 테스트

### 9.5 디버깅 방법

#### 로그 확인
- 콘솔 출력 확인
- Flask 디버그 모드 활성화

#### 단계별 테스트
1. 파일 업로드 테스트
2. 데이터 추출 테스트
3. 템플릿 렌더링 테스트
4. 전체 프로세스 테스트

#### 디버그 모드
- `app.py`에서 `debug=True` 설정
- 자동 재로드 활성화
- 상세 오류 메시지 표시

---

## 10. 참고 문서

### 10.1 프로젝트 내 문서

- **PROJECT_COMPREHENSIVE_GUIDE.md**: 프로젝트 종합 가이드 (상세한 기술 문서)
- **PROJECT_LOGIC_SUMMARY.md**: 프로젝트 로직 요약 (빠른 참조용)
- **GLOSSARY.md**: 용어 사전 (프로젝트 용어 정의)
- **DEBUG_LOG.md**: 디버그 로그 (버그 수정 이력)
- **README.md**: 프로젝트 개요 및 사용법

### 10.2 외부 참고 자료

- **Flask 공식 문서**: https://flask.palletsprojects.com/
- **Jinja2 문서**: https://jinja.palletsprojects.com/
- **pandas 문서**: https://pandas.pydata.org/
- **openpyxl 문서**: https://openpyxl.readthedocs.io/

### 10.3 국가데이터처 관련

- **국가데이터처 홈페이지**: http://mods.go.kr/
- **국가통계포털 KOSIS**: https://kosis.kr/

---

## 11. 핵심 체크리스트

작업 시 반드시 확인할 사항:

- [ ] 데이터 무결성 원칙 준수 (결측치를 기본값으로 채우지 않음)
- [ ] 한글 복붙 형식 유지 (인라인 스타일 사용)
- [ ] 기초자료 사용 금지 (분석표만 사용)
- [ ] 용어 정의 혼동 금지 (인포그래픽 ≠ 차트)
- [ ] 기존 코드 보존 (정상 동작하는 코드는 건드리지 않음)
- [ ] 디버그 로그 업데이트 (버그 수정 시)
- [ ] 국가데이터처 명칭 사용 (통계청 대신)
- [ ] 최소한의 변경 원칙 (필요한 부분만 수정)

---

## 12. 연락 및 지원

### 12.1 프로젝트 정보

- **프로젝트명**: 지역경제동향 보도자료 생성 시스템
- **프로젝트 유형**: 캡스톤 프로젝트
- **개발 환경**: Python 3.10+, Flask 2.3.0+
- **배포 환경**: On-Premise / Local (로컬 또는 일반 서버)

### 12.2 작업 원칙 요약

1. **데이터 무결성 최우선**: 원본 데이터 왜곡 금지
2. **한글 호환성 최우선**: 한글 프로그램에서 형식 유지
3. **최소한의 변경**: 정상 동작하는 코드 보존
4. **순차적 처리**: 체크리스트 기반 작업
5. **상태 검증**: 코드 수정 전 현재 상태 확인

---

**문서 버전**: 1.0  
**최종 업데이트**: 2025년 1월  
**작성자**: 프로젝트 개발팀  
**대상**: Gemini 3.0 Pro

---

> **중요**: 이 문서는 프로젝트의 완전한 위임을 위한 종합 가이드입니다. 모든 작업은 이 문서의 규칙과 원칙을 엄격히 준수해야 합니다.
