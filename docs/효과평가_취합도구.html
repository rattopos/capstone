<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¤ë¬¸ ê²°ê³¼ ì·¨í•© ë° ë¶„ì„ ë„êµ¬</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', 'ë§‘ì€ ê³ ë”•', 'Malgun Gothic', sans-serif;
            font-size: 11pt;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 30px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* í—¤ë” */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 24pt;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 11pt;
            opacity: 0.9;
        }
        
        /* ì¹´ë“œ */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .card-title {
            font-size: 14pt;
            font-weight: 600;
            color: #1a365d;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* ì—…ë¡œë“œ ì˜ì—­ */
        .upload-area {
            border: 3px dashed #cbd5e0;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            background: #f7fafc;
        }
        
        .upload-area:hover, .upload-area.dragover {
            border-color: #667eea;
            background: #ebf4ff;
        }
        
        .upload-area .icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .upload-area h3 {
            font-size: 13pt;
            color: #4a5568;
            margin-bottom: 8px;
        }
        
        .upload-area p {
            font-size: 10pt;
            color: #718096;
        }
        
        #fileInput {
            display: none;
        }
        
        /* íŒŒì¼ ëª©ë¡ */
        .file-list {
            margin-top: 20px;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .file-item .file-name {
            font-size: 10pt;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-item .file-status {
            font-size: 9pt;
            padding: 4px 10px;
            border-radius: 12px;
        }
        
        .file-item .file-status.success {
            background: #c6f6d5;
            color: #276749;
        }
        
        .file-item .file-status.error {
            background: #fed7d7;
            color: #c53030;
        }
        
        .file-item .btn-remove {
            background: none;
            border: none;
            color: #a0aec0;
            cursor: pointer;
            font-size: 16px;
        }
        
        .file-item .btn-remove:hover {
            color: #e53e3e;
        }
        
        /* ë²„íŠ¼ */
        .btn {
            padding: 12px 25px;
            font-size: 11pt;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #48bb78;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #38a169;
        }
        
        .btn-outline {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
        }
        
        .btn-outline:hover {
            background: #667eea;
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        /* í†µê³„ ê²°ê³¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-box .label {
            font-size: 10pt;
            color: #4a5568;
            margin-bottom: 8px;
        }
        
        .stat-box .value {
            font-size: 28pt;
            font-weight: 700;
            color: #667eea;
        }
        
        .stat-box .value.score {
            color: #48bb78;
        }
        
        .stat-box .sub {
            font-size: 9pt;
            color: #718096;
            margin-top: 5px;
        }
        
        /* ìƒì„¸ ê²°ê³¼ í…Œì´ë¸” */
        .result-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10pt;
        }
        
        .result-table th {
            background: #2d3748;
            color: white;
            padding: 12px 10px;
            text-align: left;
            font-weight: 500;
        }
        
        .result-table th:not(:first-child) {
            text-align: center;
        }
        
        .result-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .result-table td:not(:first-child) {
            text-align: center;
        }
        
        .result-table tr:hover {
            background: #f7fafc;
        }
        
        .result-table .category-header {
            background: #edf2f7;
            font-weight: 600;
            color: #1a365d;
        }
        
        .score-bar {
            display: inline-block;
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            width: 100px;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        .score-bar .fill {
            height: 100%;
            border-radius: 4px;
            background: linear-gradient(90deg, #667eea, #48bb78);
        }
        
        /* ì„œìˆ í˜• ì‘ë‹µ */
        .text-responses {
            margin-top: 20px;
        }
        
        .text-response-item {
            background: #f7fafc;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 0 8px 8px 0;
        }
        
        .text-response-item .respondent {
            font-size: 9pt;
            color: #718096;
            margin-bottom: 8px;
        }
        
        .text-response-item .content {
            font-size: 10pt;
            color: #2d3748;
            line-height: 1.6;
        }
        
        /* íƒ­ */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 25px;
            font-size: 11pt;
            color: #4a5568;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }
        
        .tab:hover {
            color: #667eea;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ì¸ì‡„ ìŠ¤íƒ€ì¼ */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #e2e8f0;
            }
            
            .upload-area, .button-group, .tabs {
                display: none;
            }
            
            .tab-content {
                display: block !important;
            }
            
            @page {
                size: A4;
                margin: 15mm;
            }
        }
        
        /* ìˆ¨ê¹€ í´ë˜ìŠ¤ */
        .hidden {
            display: none !important;
        }
        
        /* ë¡œë”© */
        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }
        
        .loading .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <header class="header">
            <h1>ğŸ“Š ì„¤ë¬¸ ê²°ê³¼ ì·¨í•© ë° ë¶„ì„ ë„êµ¬</h1>
            <p>ê°œë³„ ì‘ë‹µ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ìë™ìœ¼ë¡œ í†µê³„ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤</p>
        </header>
        
        <!-- íŒŒì¼ ì—…ë¡œë“œ -->
        <div class="card">
            <h2 class="card-title">ğŸ“ ì‘ë‹µ íŒŒì¼ ì—…ë¡œë“œ</h2>
            
            <div class="upload-area" id="uploadArea">
                <div class="icon">ğŸ“¤</div>
                <h3>CSV íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</h3>
                <p>ì„¤ë¬¸ ì‘ë‹µ CSV íŒŒì¼ì„ ì—¬ëŸ¬ ê°œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
            </div>
            <input type="file" id="fileInput" accept=".csv" multiple>
            
            <div class="file-list" id="fileList"></div>
            
            <div class="button-group">
                <button class="btn btn-primary" id="btnAnalyze" onclick="analyzeData()" disabled>
                    ğŸ“ˆ ë¶„ì„ ì‹¤í–‰
                </button>
                <button class="btn btn-outline" onclick="clearFiles()">
                    ğŸ—‘ï¸ íŒŒì¼ ì´ˆê¸°í™”
                </button>
            </div>
        </div>
        
        <!-- ë¶„ì„ ê²°ê³¼ -->
        <div class="card hidden" id="resultsCard">
            <h2 class="card-title">ğŸ“ˆ ë¶„ì„ ê²°ê³¼</h2>
            
            <!-- ìš”ì•½ í†µê³„ -->
            <div class="stats-grid" id="summaryStats"></div>
            
            <!-- íƒ­ -->
            <div class="tabs">
                <div class="tab active" data-tab="overview">ğŸ“‹ í•­ëª©ë³„ ê²°ê³¼</div>
                <div class="tab" data-tab="category">ğŸ“Š ì˜ì—­ë³„ í‰ê· </div>
                <div class="tab" data-tab="text">ğŸ’¬ ì„œìˆ í˜• ì‘ë‹µ</div>
                <div class="tab" data-tab="raw">ğŸ“„ ì›ë³¸ ë°ì´í„°</div>
            </div>
            
            <!-- í•­ëª©ë³„ ê²°ê³¼ -->
            <div class="tab-content active" id="tab-overview">
                <table class="result-table" id="overviewTable"></table>
            </div>
            
            <!-- ì˜ì—­ë³„ í‰ê·  -->
            <div class="tab-content" id="tab-category">
                <table class="result-table" id="categoryTable"></table>
            </div>
            
            <!-- ì„œìˆ í˜• ì‘ë‹µ -->
            <div class="tab-content" id="tab-text">
                <div id="textResponses"></div>
            </div>
            
            <!-- ì›ë³¸ ë°ì´í„° -->
            <div class="tab-content" id="tab-raw">
                <div style="overflow-x: auto;">
                    <table class="result-table" id="rawTable"></table>
                </div>
            </div>
            
            <!-- ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ -->
            <div class="button-group">
                <button class="btn btn-secondary" onclick="exportSummary()">
                    ğŸ“¥ ìš”ì•½ ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ (CSV)
                </button>
                <button class="btn btn-outline" onclick="exportMerged()">
                    ğŸ“¥ í†µí•© ë°ì´í„° ë‹¤ìš´ë¡œë“œ (CSV)
                </button>
                <button class="btn btn-outline" onclick="window.print()">
                    ğŸ–¨ï¸ ì¸ì‡„
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // ë°ì´í„° ì €ì¥
        let uploadedFiles = [];
        let allResponses = [];
        
        // ì§ˆë¬¸ ì •ì˜
        const questions = {
            'Q1_ì´ˆì•ˆì‘ì„±ì‹œê°„ë‹¨ì¶•': { num: 1, text: 'ë³´ë„ìë£Œ ì´ˆì•ˆ ì‘ì„± ì‹œê°„ ë‹¨ì¶•', category: 'ì‹œê°„ì ˆê°' },
            'Q2_ë°ì´í„°ì…ë ¥ì‹œê°„ê°ì†Œ': { num: 2, text: 'ë°ì´í„° ì…ë ¥ ë° ì •ë¦¬ ì‹œê°„ ê°ì†Œ', category: 'ì‹œê°„ì ˆê°' },
            'Q3_ë³µë¶™ì‘ì—…ê°ì†Œ': { num: 3, text: 'ë°˜ë³µì  ë³µì‚¬-ë¶™ì—¬ë„£ê¸° ì‘ì—… ê°ì†Œ', category: 'ì‹œê°„ì ˆê°' },
            'Q4_ë¶„ì„ì‹œê°„í™•ë³´': { num: 4, text: 'ë°ì´í„° í•´ì„ ë° ë¶„ì„ ì‹œê°„ í™•ë³´', category: 'ì‹œê°„ì ˆê°' },
            'Q5_ì •ì‹ ì í”¼ë¡œê°ì†Œ': { num: 5, text: 'ë‹¨ìˆœ ë°˜ë³µ ì‘ì—…ìœ¼ë¡œ ì¸í•œ ì •ì‹ ì  í”¼ë¡œ ê°ì†Œ', category: 'í”¼ë¡œë„ê°ì†Œ' },
            'Q6_ì‹ ì²´ì í”¼ë¡œê°ì†Œ': { num: 6, text: 'ìˆ˜ë™ íƒ€ì´í•‘ìœ¼ë¡œ ì¸í•œ ì‹ ì²´ì  í”¼ë¡œ ê°ì†Œ', category: 'í”¼ë¡œë„ê°ì†Œ' },
            'Q7_ì‹¤ìˆ˜ìŠ¤íŠ¸ë ˆìŠ¤ê°ì†Œ': { num: 7, text: 'ë°ì´í„° ì…ë ¥ ì‹¤ìˆ˜ì— ëŒ€í•œ ìŠ¤íŠ¸ë ˆìŠ¤ ê°ì†Œ', category: 'í”¼ë¡œë„ê°ì†Œ' },
            'Q8_ì•¼ê·¼ê°ì†Œ': { num: 8, text: 'ì•¼ê·¼ ë˜ëŠ” ì¶”ê°€ ê·¼ë¬´ í•„ìš”ì„± ê°ì†Œ', category: 'í”¼ë¡œë„ê°ì†Œ' },
            'Q9_ì—…ë¬´ë¶€ë‹´ê°ì†Œ': { num: 9, text: 'ë³´ë„ìë£Œ ì‘ì„± ì—…ë¬´ ë¶€ë‹´ê° ê°ì†Œ', category: 'í”¼ë¡œë„ê°ì†Œ' },
            'Q10_ì…ë ¥ì˜¤ë¥˜ê°ì†Œ': { num: 10, text: 'ë°ì´í„° ì…ë ¥ ì˜¤ë¥˜ ê°ì†Œ', category: 'í’ˆì§ˆí–¥ìƒ' },
            'Q11_í˜•ì‹ì¼ê´€ì„±': { num: 11, text: 'ë³´ë„ìë£Œ í˜•ì‹ ì¼ê´€ì„± í–¥ìƒ', category: 'í’ˆì§ˆí–¥ìƒ' },
            'Q12_ì‹¬ì¸µë¶„ì„ê°€ëŠ¥': { num: 12, text: 'ì‹¬ì¸µ ë°ì´í„° ë¶„ì„ ê°€ëŠ¥', category: 'í’ˆì§ˆí–¥ìƒ' },
            'Q13_í’ˆì§ˆìì‹ ê°': { num: 13, text: 'ë³´ë„ìë£Œ í’ˆì§ˆì— ëŒ€í•œ ìì‹ ê° í–¥ìƒ', category: 'í’ˆì§ˆí–¥ìƒ' },
            'Q14_ì¡°ì‘ìš©ì´ì„±': { num: 14, text: 'ì‹œìŠ¤í…œ ì¡°ì‘ ìš©ì´ì„±', category: 'ì‚¬ìš©ì„±' },
            'Q15_ì§ê´€ì„±': { num: 15, text: 'íŒŒì¼ ì—…ë¡œë“œ ë° ìƒì„± ê³¼ì • ì§ê´€ì„±', category: 'ì‚¬ìš©ì„±' },
            'Q16_ê²°ì¸¡ì¹˜ì²˜ë¦¬': { num: 16, text: 'ê²°ì¸¡ì¹˜ ì²˜ë¦¬ ê¸°ëŠ¥ ìœ ìš©ì„±', category: 'ì‚¬ìš©ì„±' },
            'Q17_ë¯¸ë¦¬ë³´ê¸°ê¸°ëŠ¥': { num: 17, text: 'ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ ë„ì›€', category: 'ì‚¬ìš©ì„±' },
            'Q18_í•œê¸€ë³µë¶™í¸ì˜': { num: 18, text: 'í•œê¸€(HWP) ë³µì‚¬-ë¶™ì—¬ë„£ê¸° í¸ì˜ì„±', category: 'ì‚¬ìš©ì„±' },
            'Q19_ì „ë°˜ë§Œì¡±ë„': { num: 19, text: 'ì „ë°˜ì  ì‹œìŠ¤í…œ ë§Œì¡±ë„', category: 'ë§Œì¡±ë„' },
            'Q20_íƒ€ì¸ì¶”ì²œ': { num: 20, text: 'íƒ€ì¸ ì¶”ì²œ ì˜ì‚¬', category: 'ë§Œì¡±ë„' },
            'Q21_ì—…ë¬´ë§Œì¡±ë„í–¥ìƒ': { num: 21, text: 'ì—…ë¬´ ë§Œì¡±ë„ í–¥ìƒ', category: 'ë§Œì¡±ë„' },
            'Q22_í™•ëŒ€ë„ì…í¬ë§': { num: 22, text: 'ìœ ì‚¬ ì—…ë¬´ ìë™í™” í™•ëŒ€ í¬ë§', category: 'ë§Œì¡±ë„' }
        };
        
        const categories = {
            'ì‹œê°„ì ˆê°': { name: 'â…¡. ì‹œê°„ ì ˆê° íš¨ê³¼', color: '#3182ce' },
            'í”¼ë¡œë„ê°ì†Œ': { name: 'â…¢. ì—…ë¬´ í”¼ë¡œë„ ê°ì†Œ', color: '#48bb78' },
            'í’ˆì§ˆí–¥ìƒ': { name: 'â…£. ì—…ë¬´ í’ˆì§ˆ í–¥ìƒ', color: '#ed8936' },
            'ì‚¬ìš©ì„±': { name: 'â…¤. ì‹œìŠ¤í…œ ì‚¬ìš©ì„±', color: '#9f7aea' },
            'ë§Œì¡±ë„': { name: 'â…¥. ì „ë°˜ì  ë§Œì¡±ë„', color: '#e53e3e' }
        };
        
        // íŒŒì¼ ì—…ë¡œë“œ ì´ë²¤íŠ¸
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));
        
        // íŒŒì¼ ì²˜ë¦¬
        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.name.endsWith('.csv')) {
                    readCSVFile(file);
                }
            });
        }
        
        // CSV íŒŒì¼ ì½ê¸°
        function readCSVFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const content = e.target.result;
                    const data = parseCSV(content);
                    
                    if (data && data.length > 0) {
                        uploadedFiles.push({
                            name: file.name,
                            data: data[0], // ì²« ë²ˆì§¸ ë°ì´í„° í–‰
                            status: 'success'
                        });
                    } else {
                        uploadedFiles.push({
                            name: file.name,
                            data: null,
                            status: 'error',
                            error: 'ë°ì´í„° ì—†ìŒ'
                        });
                    }
                    
                    updateFileList();
                } catch (err) {
                    uploadedFiles.push({
                        name: file.name,
                        data: null,
                        status: 'error',
                        error: err.message
                    });
                    updateFileList();
                }
            };
            reader.readAsText(file, 'UTF-8');
        }
        
        // CSV íŒŒì‹±
        function parseCSV(content) {
            // BOM ì œê±°
            if (content.charCodeAt(0) === 0xFEFF) {
                content = content.slice(1);
            }
            
            const lines = content.split('\n').filter(line => line.trim());
            if (lines.length < 2) return null;
            
            const headers = parseCSVLine(lines[0]);
            const result = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                const obj = {};
                headers.forEach((header, index) => {
                    obj[header] = values[index] || '';
                });
                result.push(obj);
            }
            
            return result;
        }
        
        // CSV ë¼ì¸ íŒŒì‹± (ë”°ì˜´í‘œ ì²˜ë¦¬)
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            
            return result;
        }
        
        // íŒŒì¼ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateFileList() {
            const listEl = document.getElementById('fileList');
            listEl.innerHTML = uploadedFiles.map((file, index) => `
                <div class="file-item">
                    <span class="file-name">ğŸ“„ ${file.name}</span>
                    <span class="file-status ${file.status}">${file.status === 'success' ? 'âœ“ ë¡œë“œ ì™„ë£Œ' : 'âœ— ' + file.error}</span>
                    <button class="btn-remove" onclick="removeFile(${index})">âœ•</button>
                </div>
            `).join('');
            
            const validFiles = uploadedFiles.filter(f => f.status === 'success').length;
            document.getElementById('btnAnalyze').disabled = validFiles === 0;
        }
        
        // íŒŒì¼ ì œê±°
        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateFileList();
        }
        
        // íŒŒì¼ ì´ˆê¸°í™”
        function clearFiles() {
            uploadedFiles = [];
            allResponses = [];
            updateFileList();
            document.getElementById('resultsCard').classList.add('hidden');
        }
        
        // ë°ì´í„° ë¶„ì„
        function analyzeData() {
            allResponses = uploadedFiles
                .filter(f => f.status === 'success')
                .map(f => f.data);
            
            if (allResponses.length === 0) {
                alert('ë¶„ì„í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            renderSummaryStats();
            renderOverviewTable();
            renderCategoryTable();
            renderTextResponses();
            renderRawTable();
            
            document.getElementById('resultsCard').classList.remove('hidden');
        }
        
        // í†µê³„ ê³„ì‚°
        function calculateStats(key) {
            const values = allResponses
                .map(r => parseFloat(r[key]))
                .filter(v => !isNaN(v) && v > 0);
            
            if (values.length === 0) return { avg: 0, min: 0, max: 0, count: 0 };
            
            return {
                avg: values.reduce((a, b) => a + b, 0) / values.length,
                min: Math.min(...values),
                max: Math.max(...values),
                count: values.length
            };
        }
        
        // ìš”ì•½ í†µê³„ ë Œë”ë§
        function renderSummaryStats() {
            const totalResponses = allResponses.length;
            
            // ì „ì²´ í‰ê·  ì ìˆ˜
            let totalSum = 0;
            let totalCount = 0;
            Object.keys(questions).forEach(key => {
                const stats = calculateStats(key);
                totalSum += stats.avg * stats.count;
                totalCount += stats.count;
            });
            const overallAvg = totalCount > 0 ? totalSum / totalCount : 0;
            
            // ë§Œì¡±ë„ í‰ê· 
            const satisfactionKeys = Object.keys(questions).filter(k => questions[k].category === 'ë§Œì¡±ë„');
            let satSum = 0;
            let satCount = 0;
            satisfactionKeys.forEach(key => {
                const stats = calculateStats(key);
                satSum += stats.avg * stats.count;
                satCount += stats.count;
            });
            const satisfactionAvg = satCount > 0 ? satSum / satCount : 0;
            
            // í”¼ë¡œë„ ê°ì†Œ í‰ê· 
            const fatigueKeys = Object.keys(questions).filter(k => questions[k].category === 'í”¼ë¡œë„ê°ì†Œ');
            let fatSum = 0;
            let fatCount = 0;
            fatigueKeys.forEach(key => {
                const stats = calculateStats(key);
                fatSum += stats.avg * stats.count;
                fatCount += stats.count;
            });
            const fatigueAvg = fatCount > 0 ? fatSum / fatCount : 0;
            
            document.getElementById('summaryStats').innerHTML = `
                <div class="stat-box">
                    <div class="label">ì´ ì‘ë‹µ ìˆ˜</div>
                    <div class="value">${totalResponses}</div>
                    <div class="sub">ëª…</div>
                </div>
                <div class="stat-box">
                    <div class="label">ì „ì²´ í‰ê·  ì ìˆ˜</div>
                    <div class="value score">${overallAvg.toFixed(2)}</div>
                    <div class="sub">/ 5.00ì </div>
                </div>
                <div class="stat-box">
                    <div class="label">ì „ë°˜ì  ë§Œì¡±ë„</div>
                    <div class="value score">${satisfactionAvg.toFixed(2)}</div>
                    <div class="sub">/ 5.00ì </div>
                </div>
                <div class="stat-box">
                    <div class="label">í”¼ë¡œë„ ê°ì†Œ í‰ê°€</div>
                    <div class="value score">${fatigueAvg.toFixed(2)}</div>
                    <div class="sub">/ 5.00ì </div>
                </div>
            `;
        }
        
        // í•­ëª©ë³„ ê²°ê³¼ í…Œì´ë¸”
        function renderOverviewTable() {
            let html = `
                <thead>
                    <tr>
                        <th>ë¬¸í•­</th>
                        <th>í‰ê· </th>
                        <th>ë¶„í¬</th>
                        <th>ìµœì†Œ</th>
                        <th>ìµœëŒ€</th>
                        <th>ì‘ë‹µìˆ˜</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            let currentCategory = '';
            Object.entries(questions)
                .sort((a, b) => a[1].num - b[1].num)
                .forEach(([key, q]) => {
                    if (q.category !== currentCategory) {
                        currentCategory = q.category;
                        html += `<tr class="category-header"><td colspan="6">${categories[currentCategory].name}</td></tr>`;
                    }
                    
                    const stats = calculateStats(key);
                    const barWidth = (stats.avg / 5) * 100;
                    
                    html += `
                        <tr>
                            <td>${q.num}. ${q.text}</td>
                            <td><strong>${stats.avg.toFixed(2)}</strong></td>
                            <td>
                                <span class="score-bar"><span class="fill" style="width: ${barWidth}%"></span></span>
                            </td>
                            <td>${stats.min || '-'}</td>
                            <td>${stats.max || '-'}</td>
                            <td>${stats.count}</td>
                        </tr>
                    `;
                });
            
            html += '</tbody>';
            document.getElementById('overviewTable').innerHTML = html;
        }
        
        // ì˜ì—­ë³„ í‰ê·  í…Œì´ë¸”
        function renderCategoryTable() {
            let html = `
                <thead>
                    <tr>
                        <th>í‰ê°€ ì˜ì—­</th>
                        <th>í¬í•¨ ë¬¸í•­</th>
                        <th>í‰ê·  ì ìˆ˜</th>
                        <th>ë¶„í¬</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            Object.entries(categories).forEach(([catKey, cat]) => {
                const catQuestions = Object.entries(questions).filter(([k, q]) => q.category === catKey);
                const questionNums = catQuestions.map(([k, q]) => q.num).join(', ');
                
                let sum = 0;
                let count = 0;
                catQuestions.forEach(([key]) => {
                    const stats = calculateStats(key);
                    sum += stats.avg * stats.count;
                    count += stats.count;
                });
                const avg = count > 0 ? sum / count : 0;
                const barWidth = (avg / 5) * 100;
                
                html += `
                    <tr>
                        <td><strong>${cat.name}</strong></td>
                        <td>Q${questionNums}</td>
                        <td><strong style="color: ${cat.color}">${avg.toFixed(2)}</strong></td>
                        <td>
                            <span class="score-bar"><span class="fill" style="width: ${barWidth}%; background: ${cat.color}"></span></span>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody>';
            document.getElementById('categoryTable').innerHTML = html;
        }
        
        // ì„œìˆ í˜• ì‘ë‹µ ë Œë”ë§
        function renderTextResponses() {
            const textQuestions = [
                { key: 'Q23_ê°œì„ ì ', title: 'ğŸ“Œ Q23. ê°€ì¥ í¬ê²Œ ê°œì„ ë˜ì—ˆë‹¤ê³  ëŠë¼ëŠ” ì ' },
                { key: 'Q24_ë¶ˆí¸ì‚¬í•­', title: 'ğŸ“Œ Q24. ë¶ˆí¸í•˜ê±°ë‚˜ ê°œì„ ì´ í•„ìš”í•œ ì ' },
                { key: 'Q25_ì¶”ê°€ì˜ê²¬', title: 'ğŸ“Œ Q25. ì¶”ê°€ ê¸°ëŠ¥ ë° ê¸°íƒ€ ì˜ê²¬' }
            ];
            
            let html = '';
            
            textQuestions.forEach(tq => {
                const responses = allResponses
                    .map((r, i) => ({ 
                        id: r['ì‘ë‹µID'] || `ì‘ë‹µì ${i + 1}`,
                        content: r[tq.key]?.replace(/^"|"$/g, '') || ''
                    }))
                    .filter(r => r.content.trim());
                
                html += `<h3 style="margin: 20px 0 15px; color: #1a365d;">${tq.title}</h3>`;
                
                if (responses.length === 0) {
                    html += '<p style="color: #718096; padding: 10px;">ì‘ë‹µ ì—†ìŒ</p>';
                } else {
                    responses.forEach(r => {
                        html += `
                            <div class="text-response-item">
                                <div class="respondent">${r.id}</div>
                                <div class="content">${r.content}</div>
                            </div>
                        `;
                    });
                }
            });
            
            document.getElementById('textResponses').innerHTML = html;
        }
        
        // ì›ë³¸ ë°ì´í„° í…Œì´ë¸”
        function renderRawTable() {
            if (allResponses.length === 0) return;
            
            const headers = Object.keys(allResponses[0]);
            
            let html = `
                <thead>
                    <tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>
                </thead>
                <tbody>
            `;
            
            allResponses.forEach(r => {
                html += `<tr>${headers.map(h => `<td>${r[h] || ''}</td>`).join('')}</tr>`;
            });
            
            html += '</tbody>';
            document.getElementById('rawTable').innerHTML = html;
        }
        
        // ìš”ì•½ ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸°
        function exportSummary() {
            const BOM = '\uFEFF';
            let csv = BOM;
            
            // ê¸°ë³¸ ì •ë³´
            csv += 'ì§€ì—­ê²½ì œë™í–¥ ë³´ë„ìë£Œ ìƒì„± ì‹œìŠ¤í…œ - íš¨ê³¼ í‰ê°€ ê²°ê³¼ ìš”ì•½\n';
            csv += `ë¶„ì„ì¼ì‹œ,${new Date().toLocaleString('ko-KR')}\n`;
            csv += `ì´ ì‘ë‹µìˆ˜,${allResponses.length}\n\n`;
            
            // ì˜ì—­ë³„ í‰ê· 
            csv += 'ì˜ì—­,í¬í•¨ë¬¸í•­,í‰ê· ì ìˆ˜\n';
            Object.entries(categories).forEach(([catKey, cat]) => {
                const catQuestions = Object.entries(questions).filter(([k, q]) => q.category === catKey);
                const questionNums = catQuestions.map(([k, q]) => q.num).join(' ');
                
                let sum = 0;
                let count = 0;
                catQuestions.forEach(([key]) => {
                    const stats = calculateStats(key);
                    sum += stats.avg * stats.count;
                    count += stats.count;
                });
                const avg = count > 0 ? sum / count : 0;
                
                csv += `${cat.name},Q${questionNums},${avg.toFixed(2)}\n`;
            });
            
            csv += '\në¬¸í•­ë³„ ìƒì„¸ ê²°ê³¼\n';
            csv += 'ë²ˆí˜¸,ë¬¸í•­,í‰ê· ,ìµœì†Œ,ìµœëŒ€,ì‘ë‹µìˆ˜\n';
            
            Object.entries(questions)
                .sort((a, b) => a[1].num - b[1].num)
                .forEach(([key, q]) => {
                    const stats = calculateStats(key);
                    csv += `${q.num},"${q.text}",${stats.avg.toFixed(2)},${stats.min},${stats.max},${stats.count}\n`;
                });
            
            downloadCSV(csv, `ì„¤ë¬¸ë¶„ì„ê²°ê³¼_${new Date().toISOString().slice(0,10)}.csv`);
        }
        
        // í†µí•© ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportMerged() {
            if (allResponses.length === 0) return;
            
            const BOM = '\uFEFF';
            const headers = Object.keys(allResponses[0]);
            
            let csv = BOM + headers.join(',') + '\n';
            allResponses.forEach(r => {
                csv += headers.map(h => {
                    const val = r[h] || '';
                    return val.includes(',') ? `"${val}"` : val;
                }).join(',') + '\n';
            });
            
            downloadCSV(csv, `ì„¤ë¬¸ì‘ë‹µ_í†µí•©_${new Date().toISOString().slice(0,10)}.csv`);
        }
        
        // CSV ë‹¤ìš´ë¡œë“œ
        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }
        
        // íƒ­ ì „í™˜
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(`tab-${this.dataset.tab}`).classList.add('active');
            });
        });
    </script>
</body>
</html>

