# 📝 문구 생성 규칙 상세 분석

## 개요

본 프로젝트는 **LLM을 사용하지 않고** **Jinja2 템플릿 기반 규칙 생성** 방식으로 문구를 생성합니다.

**핵심 원리:**
```
고정 문장 구조 + 동적 데이터 삽입 = 최종 문구
```

---

## 1. 문구 생성 방식: Jinja2 템플릿

### 1.1 기본 구조

```html
<!-- 템플릿 (mining_manufacturing_template.html) -->
□ 전국 광공업생산({{ "%.1f"|format(nationwide_data.production_index) }})은 
{{ nationwide_data.main_increase_industries | map(attribute='name') | join(', ') }} 
등의 생산이 늘어 전년동분기대비 
<span class="increase">{{ "%.1f"|format(nationwide_data.growth_rate) }}% 증가</span>
```

**렌더링 결과:**
```
□ 전국 광공업생산(108.2)은 반도체·전자부품, 자동차·트레일러, 의약품 등의 생산이 늘어 전년동분기대비 3.2% 증가
```

### 1.2 구성 요소

| 구분 | 설명 | 예시 |
|------|------|------|
| **고정 문구** | 템플릿에 미리 작성된 텍스트 | "등의 생산이 늘어 전년동분기대비" |
| **데이터 삽입** | `{{ 변수명 }}` 형태로 데이터 주입 | `{{ nationwide_data.growth_rate }}` |
| **필터** | `|` 뒤에 데이터 가공 함수 | `"%.1f"|format(value)` (소수점 1자리) |
| **반복문** | `{% for %}` 루프로 목록 나열 | `{% for region in regions %}` |
| **조건문** | `{% if %}` 로 분기 처리 | `{% if growth_rate > 0 %}증가{% endif %}` |

---

## 2. 6가지 핵심 규칙

### 규칙 1: 증감 방향 결정

**규칙:** 수치의 부호에 따라 표현 결정

| 지표 | 양수(+) | 음수(-) | 0 |
|------|---------|---------|-----|
| 생산, 소비, 수출입 | 증가 | 감소 | 보합 |
| 고용률 | 상승 | 하락 | 동일 |
| 실업률 | 상승 | 하락 | 동일 |
| 물가 | 상승 | 하락 | 동일 |
| 인구이동 | 순유입 | 순유출 | - |

**템플릿 코드:**
```html
{% if nationwide_data.growth_rate > 0 %}
    <span class="increase">{{ "%.1f"|format(nationwide_data.growth_rate) }}% 증가</span>
{% else %}
    <span class="decrease">{{ "%.1f"|format(nationwide_data.growth_rate|abs) }}% 감소</span>
{% endif %}
```

**Generator 코드 (`mining_manufacturing_generator.py:239`):**
```python
"growth_direction": "증가" if safe_float(growth_rate, 0) > 0 else "감소"
```

---

### 규칙 2: 숫자 포맷팅

**규칙:** 모든 수치는 소수점 첫째 자리까지 표시

| 타입 | 포맷 | 예시 |
|------|------|------|
| 지수 | `%.1f` | 108.2 |
| 증감률 | `%.1f%` | 3.2% |
| 증감폭 | `%.1f%p` | 0.3%p |
| 금액 | 천단위 구분 | 1,234,567 |

**템플릿 코드:**
```html
{{ "%.1f"|format(value) }}
```

---

### 규칙 3: 업종/지역명 매핑

**규칙:** 엑셀의 긴 공식 명칭을 보도자료용 간결한 표현으로 변환

**Generator 코드 (`mining_manufacturing_generator.py:59-89`):**
```python
INDUSTRY_NAME_MAP = {
    "전자 부품, 컴퓨터, 영상, 음향 및 통신장비 제조업": "반도체·전자부품",
    "의료, 정밀, 광학 기기 및 시계 제조업": "의료·정밀",
    "자동차 및 트레일러 제조업": "자동차·트레일러",
    # ... 28개 업종 매핑
}
```

| 엑셀 원본 (31자) | → | 보도자료 표기 (7자) |
|-----------------|---|-------------------|
| 전자 부품, 컴퓨터, 영상, 음향 및 통신장비 제조업 | → | 반도체·전자부품 |
| 의료, 정밀, 광학 기기 및 시계 제조업 | → | 의료·정밀 |

---

### 규칙 4: 나열 규칙

**규칙:** 기여도/증감률 상위 N개 항목을 나열

| 섹션 | 나열 대상 | 개수 | 정렬 기준 |
|------|----------|------|----------|
| 요약 박스 | 증가 지역 + 업종 | 3개 | 증감률 높은 순 |
| 본문 첫 문장 | 증가 업종 | 3~5개 | 기여도 높은 순 |
| 상세 박스 | 지역별 업종 | 3개 | 기여도 높은 순 |

**템플릿 코드:**
```html
{% for region in summary_box.main_increase_regions[:3] %}
    <span class="highlight">{{ region.region }}</span>({{ region.industries | join(', ') }})
    {% if not loop.last %}, {% endif %}
{% endfor %}
```

**결과:**
```
경기(반도체·전자부품, 자동차·트레일러), 충남(반도체·전자부품), 충북(의약품)
```

---

### 규칙 5: 문장 패턴 (고정 구조)

**규칙:** 각 섹션별 고정된 문장 패턴 사용

#### 5.1 요약 박스 헤드라인
```
◆ {지표}은 {지역1}({업종1, 업종2}), {지역2}({업종}), ... 등 {N}개 시도에서 전년동분기대비 {증가/감소}
```

#### 5.2 전국 본문
```
□ 전국 {지표}({지수})은 {업종1}, {업종2}, {업종3} 등의 {생산/소비}이 {늘어/줄어} 전년동분기대비 {N}% {증가/감소}
```

#### 5.3 시도별 본문 (감소 → 증가 순서)
```
○ {감소지역1}({증감률}%), {감소지역2}({증감률}%), {감소지역3}({증감률}%)은 {업종} 등의 생산이 줄어 감소하였으나,
   {증가지역1}({증감률}%), {증가지역2}({증감률}%), {증가지역3}({증감률}%)은 {업종} 등의 생산이 늘어 증가
```

#### 5.4 상세 박스
```
< 주요 증감 지역 및 업종 >
·전 국( {증감률}%): {업종1}({증감률}%), {업종2}({증감률}%), {업종3}({증감률}%)
────────────────
·{증가지역1}( {증감률}%): {업종1}({증감률}%), {업종2}({증감률}%), {업종3}({증감률}%)
·{증가지역2}( {증감률}%): ...
·{증가지역3}( {증감률}%): ...
────────────────
·{감소지역1}({증감률}%): {업종1}({증감률}%), {업종2}({증감률}%), {업종3}({증감률}%)
·{감소지역2}({증감률}%): ...
·{감소지역3}({증감률}%): ...
```

---

### 규칙 6: 결측치 처리

**규칙:** 데이터가 없으면 플레이스홀더 표시

**템플릿 매크로:**
```html
{% macro val(value, format="%.1f", suffix="") %}
    {%- if value is none or value == '' or value == '-' or value == 'N/A' -%}
        <span class="editable-placeholder" contenteditable="true">[  ]</span>{{ suffix }}
    {%- else -%}
        {{ format|format(value) }}{{ suffix }}
    {%- endif -%}
{% endmacro %}
```

**결과:**
- 값이 있으면: `3.2`
- 값이 없으면: `[  ]` (노란색 하이라이트, 편집 가능)

---

## 3. 실제 문구 생성 흐름

### 예시: 광공업생산 요약 문구

```
┌─────────────────────────────────────────────────────────────┐
│  1. 엑셀에서 데이터 추출 (Generator)                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
nationwide_data = {
    "production_index": 108.2,
    "growth_rate": 3.2,
    "growth_direction": "증가",
    "main_increase_industries": [
        {"name": "반도체·전자부품", "growth_rate": 12.3},
        {"name": "자동차·트레일러", "growth_rate": 7.8},
        {"name": "의약품", "growth_rate": 5.2}
    ]
}
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  2. 템플릿에 데이터 주입 (Jinja2)                             │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
템플릿:
"□ 전국 광공업생산({{ production_index }})은 
 {{ industries | join(', ') }} 등의 생산이 늘어 
 전년동분기대비 {{ growth_rate }}% {{ direction }}"
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  3. 최종 문구 생성                                           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
"□ 전국 광공업생산(108.2)은 반도체·전자부품, 자동차·트레일러, 의약품 등의 
   생산이 늘어 전년동분기대비 3.2% 증가"
```

---

## 4. LLM과의 차이점

| 구분 | LLM (ChatGPT 등) | 규칙기반 (본 시스템) |
|------|------------------|---------------------|
| **문장 생성** | AI가 창작 | 템플릿에 데이터 삽입 |
| **정확도** | 가끔 오류 가능 | **100% 정확** |
| **일관성** | 매번 다른 표현 | **항상 동일** |
| **추적성** | 블랙박스 | **규칙으로 설명 가능** |
| **유연성** | 높음 | 낮음 (템플릿 수정 필요) |
| **적합 용도** | 창작, 요약 | **공식 보도자료** |

---

## 5. 템플릿 파일 위치

| 보도자료 | 템플릿 파일 | 문장 패턴 |
|----------|------------|----------|
| 광공업생산 | `mining_manufacturing_template.html` | 생산 증가/감소 |
| 서비스업생산 | `service_industry_template.html` | 생산 증가/감소 |
| 소비동향 | `consumption_template.html` | 판매 증가/감소 |
| 건설동향 | `construction_template.html` | 수주 증가/감소 |
| 수출 | `export_template.html` | 수출 증가/감소 |
| 수입 | `import_template.html` | 수입 증가/감소 |
| 물가동향 | `price_trend_template.html` | 물가 상승/하락 |
| 고용률 | `employment_rate_template.html` | 고용률 상승/하락 |
| 실업률 | `unemployment_template.html` | 실업률 상승/하락 |
| 인구이동 | `domestic_migration_template.html` | 순유입/순유출 |

---

## 6. 요약

### 문구 생성 = 템플릿 + 데이터

```
"□ 전국 광공업생산({지수})은 {업종} 등의 생산이 늘어 전년동분기대비 {증감률}% 증가"
         │              │                                    │
         │              │                                    │
      [데이터]       [데이터]                             [데이터]
```

### 핵심 규칙 6가지

1. **증감 방향 결정**: 부호 → 증가/감소, 상승/하락
2. **숫자 포맷팅**: 소수점 첫째 자리
3. **업종/지역명 매핑**: 긴 이름 → 짧은 이름
4. **나열 규칙**: 상위 N개, 기여도 순
5. **문장 패턴**: 고정 구조 + 동적 데이터
6. **결측치 처리**: `[  ]` 플레이스홀더

### 왜 이 방식인가?

> "공식 통계 보도자료는 **0.1%의 오류도 허용되지 않습니다.**
> LLM이 "3.5%"를 "3.6%"로 잘못 생성하면 **정정 보도**가 필요합니다.
> 템플릿 기반은 **입력된 숫자를 그대로 출력**하므로 **100% 정확합니다.**"

---

*작성일: 2026년 1월 4일*

