#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
데이터 추출기 설정
시트 매핑, 컬럼 설정, 지역 목록 등 공통 상수 정의
"""

from typing import Dict, List

# 유효한 지역 목록
ALL_REGIONS: List[str] = [
    '전국', '서울', '부산', '대구', '인천', '광주', '대전', '울산', '세종',
    '경기', '강원', '충북', '충남', '전북', '전남', '경북', '경남', '제주'
]

# 지역 그룹핑
REGION_GROUPS: Dict[str, List[str]] = {
    '수도권': ['서울', '인천', '경기'],
    '충청권': ['대전', '세종', '충북', '충남'],
    '호남권': ['광주', '전북', '전남'],
    '영남권': ['부산', '대구', '울산', '경북', '경남'],
    '기타': ['강원', '제주']
}

# 기초자료 시트 → 보도자료 시트 매핑
RAW_SHEET_MAPPING: Dict[str, str] = {
    "광공업생산지수": "광공업생산",
    "서비스업생산지수": "서비스업생산",
    "소매판매액지수": "소비(소매, 추가)",
    "건설수주액": "건설 (공표자료)",
    "고용률": "연령별고용률",
    "실업률": "실업자 수",
    "수출액": "수출",
    "수입액": "수입",
    "국내인구이동": "시도 간 이동",
    "물가": "품목성질별 물가"
}

# 시트명 키워드 매핑 (fuzzy matching용)
# 각 시트를 찾기 위한 키워드 리스트
SHEET_KEYWORDS: Dict[str, List[str]] = {
    "광공업생산": ["광공업", "생산"],
    "서비스업생산": ["서비스", "생산"],
    "소비(소매, 추가)": ["소비", "소매", "판매"],
    "건설 (공표자료)": ["건설", "공표"],
    "건설 (비공표자료)": ["건설", "비공표"],
    "연령별고용률": ["고용률", "연령별"],
    "실업자 수": ["실업", "실업자"],
    "수출": ["수출"],
    "수입": ["수입"],
    "품목성질별 물가": ["물가", "품목"],
    "지출목적별 물가": ["물가", "지출"],
    "시도 간 이동": ["인구", "이동", "시도"],
    "연령별 인구이동": ["인구", "이동", "연령"],
    "시군구인구이동": ["인구", "이동", "시군구"],
    "분기 GRDP": ["GRDP", "분기"],
    "성장률": ["성장률"],
    "기여도": ["기여도"],
}

# 기초자료 시트별 분기 열 매핑 (동적 확장 지원)
RAW_SHEET_QUARTER_COLS: Dict[str, Dict] = {
    "광공업생산": {
        'region_col': 1, 'level_col': 2, 'name_col': 5, 'header_row': 2,
        '2023_1Q': 55, '2023_2Q': 56, '2023_3Q': 57, '2023_4Q': 58,
        '2024_1Q': 59, '2024_2Q': 60, '2024_3Q': 61, '2024_4Q': 62,
        '2025_1Q': 63, '2025_2Q': 64, '2025_3Q': 65, '2025_4Q': 66,
        '2026_1Q': 67, '2026_2Q': 68, '2026_3Q': 69, '2026_4Q': 70
    },
    "서비스업생산": {
        'region_col': 1, 'level_col': 2, 'name_col': 5, 'header_row': 2,
        '2023_1Q': 55, '2023_2Q': 56, '2023_3Q': 57, '2023_4Q': 58,
        '2024_1Q': 59, '2024_2Q': 60, '2024_3Q': 61, '2024_4Q': 62,
        '2025_1Q': 63, '2025_2Q': 64, '2025_3Q': 65, '2025_4Q': 66,
        '2026_1Q': 67, '2026_2Q': 68, '2026_3Q': 69, '2026_4Q': 70
    },
    "소비(소매, 추가)": {
        'region_col': 1, 'level_col': 2, 'name_col': 4, 'header_row': 2,
        '2023_1Q': 54, '2023_2Q': 55, '2023_3Q': 56, '2023_4Q': 57,
        '2024_1Q': 58, '2024_2Q': 59, '2024_3Q': 60, '2024_4Q': 61,
        '2025_1Q': 62, '2025_2Q': 63, '2025_3Q': 64, '2025_4Q': 65,
        '2026_1Q': 66, '2026_2Q': 67, '2026_3Q': 68, '2026_4Q': 69
    },
    "건설 (공표자료)": {
        'region_col': 1, 'level_col': 2, 'name_col': 4, 'header_row': 2,
        '2023_1Q': 58, '2023_2Q': 59, '2023_3Q': 60, '2023_4Q': 61,
        '2024_1Q': 62, '2024_2Q': 63, '2024_3Q': 64, '2024_4Q': 65,
        '2025_1Q': 66, '2025_2Q': 67, '2025_3Q': 68, '2025_4Q': 69,
        '2026_1Q': 70, '2026_2Q': 71, '2026_3Q': 72, '2026_4Q': 73
    },
    "수출": {
        'region_col': 1, 'level_col': 2, 'name_col': 5, 'header_row': 2, 'total_code': '계',
        '2023_1Q': 59, '2023_2Q': 60, '2023_3Q': 61, '2023_4Q': 62,
        '2024_1Q': 63, '2024_2Q': 64, '2024_3Q': 65, '2024_4Q': 66,
        '2025_1Q': 67, '2025_2Q': 68, '2025_3Q': 69, '2025_4Q': 70,
        '2026_1Q': 71, '2026_2Q': 72, '2026_3Q': 73, '2026_4Q': 74
    },
    "수입": {
        'region_col': 1, 'level_col': 2, 'name_col': 5, 'header_row': 2, 'total_code': '계',
        '2023_1Q': 59, '2023_2Q': 60, '2023_3Q': 61, '2023_4Q': 62,
        '2024_1Q': 63, '2024_2Q': 64, '2024_3Q': 65, '2024_4Q': 66,
        '2025_1Q': 67, '2025_2Q': 68, '2025_3Q': 69, '2025_4Q': 70,
        '2026_1Q': 71, '2026_2Q': 72, '2026_3Q': 73, '2026_4Q': 74
    },
    "품목성질별 물가": {
        'region_col': 0, 'level_col': 1, 'name_col': 3, 'header_row': 2, 'total_code': '총지수',
        '2023_1Q': 47, '2023_2Q': 48, '2023_3Q': 49, '2023_4Q': 50,
        '2024_1Q': 51, '2024_2Q': 52, '2024_3Q': 53, '2024_4Q': 54,
        '2025_1Q': 55, '2025_2Q': 56, '2025_3Q': 57, '2025_4Q': 58,
        '2026_1Q': 59, '2026_2Q': 60, '2026_3Q': 61, '2026_4Q': 62
    },
    "연령별고용률": {
        'region_col': 1, 'level_col': 2, 'name_col': 3, 'header_row': 2, 'total_code': '계',
        '2023_1Q': 57, '2023_2Q': 58, '2023_3Q': 59, '2023_4Q': 60,
        '2024_1Q': 61, '2024_2Q': 62, '2024_3Q': 63, '2024_4Q': 64,
        '2025_1Q': 65, '2025_2Q': 66, '2025_3Q': 67, '2025_4Q': 68,
        '2026_1Q': 69, '2026_2Q': 70, '2026_3Q': 71, '2026_4Q': 72
    },
    "실업자 수": {
        'region_col': 0, 'level_col': 1, 'name_col': 1, 'header_row': 2, 'total_code': '계',
        '2023_1Q': 52, '2023_2Q': 53, '2023_3Q': 54, '2023_4Q': 55,
        '2024_1Q': 56, '2024_2Q': 57, '2024_3Q': 58, '2024_4Q': 59,
        '2025_1Q': 60, '2025_2Q': 61, '2025_3Q': 62, '2025_4Q': 63,
        '2026_1Q': 64, '2026_2Q': 65, '2026_3Q': 66, '2026_4Q': 67
    },
    "시도 간 이동": {
        'region_col': 1, 'level_col': 2, 'name_col': 1, 'header_row': 2,
        '2023_1Q': 71, '2023_2Q': 72, '2023_3Q': 73, '2023_4Q': 74,
        '2024_1Q': 75, '2024_2Q': 76, '2024_3Q': 77, '2024_4Q': 78,
        '2025_1Q': 79, '2025_2Q': 80, '2025_3Q': 81, '2025_4Q': 82,
        '2026_1Q': 83, '2026_2Q': 84, '2026_3Q': 85, '2026_4Q': 86
    },
}


def get_quarter_col(sheet_name: str, year: int, quarter: int) -> int:
    """시트별 분기 열 인덱스를 동적으로 계산"""
    config = RAW_SHEET_QUARTER_COLS.get(sheet_name)
    if not config:
        return None
    
    key = f"{year}_{quarter}Q"
    
    # 매핑에 있으면 직접 반환
    if key in config:
        return config[key]
    
    # 없으면 패턴 기반으로 계산 (마지막 알려진 열에서 분기 차이만큼 더함)
    # 기준점: 2025_2Q
    base_year, base_quarter = 2025, 2
    base_key = f"{base_year}_{base_quarter}Q"
    
    if base_key in config:
        base_col = config[base_key]
        quarters_diff = (year - base_year) * 4 + (quarter - base_quarter)
        return base_col + quarters_diff
    
    return None

# 보도자료별 설정
REPORT_CONFIG: Dict[str, Dict] = {
    'manufacturing': {
        'sheet': '광공업생산',
        'name': '광공업생산',
        'unit': '%',
        'calculation': 'growth_rate'
    },
    'service': {
        'sheet': '서비스업생산',
        'name': '서비스업생산',
        'unit': '%',
        'calculation': 'growth_rate'
    },
    'consumption': {
        'sheet': '소비(소매, 추가)',
        'name': '소비동향',
        'unit': '%',
        'calculation': 'growth_rate'
    },
    'construction': {
        'sheet': '건설 (공표자료)',
        'name': '건설동향',
        'unit': '%',
        'calculation': 'growth_rate'
    },
    'export': {
        'sheet': '수출',
        'name': '수출',
        'unit': '%',
        'calculation': 'growth_rate'
    },
    'import': {
        'sheet': '수입',
        'name': '수입',
        'unit': '%',
        'calculation': 'growth_rate'
    },
    'price': {
        'sheet': '품목성질별 물가',
        'name': '물가동향',
        'unit': '%',
        'calculation': 'growth_rate'
    },
    'employment': {
        'sheet': '연령별고용률',
        'name': '고용률',
        'unit': '%p',
        'calculation': 'difference'
    },
    'unemployment': {
        'sheet': '실업자 수',
        'name': '실업률',
        'unit': '%p',
        'calculation': 'difference'
    },
    'population': {
        'sheet': '시도 간 이동',
        'name': '국내인구이동',
        'unit': '천 명',
        'calculation': 'absolute'
    }
}
