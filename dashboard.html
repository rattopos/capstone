<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€ì—­ê²½ì œë™í–¥ ë³´ê³ ì„œ ìƒì„± ì‹œìŠ¤í…œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --bg-card: #1e1e2a;
            --bg-card-hover: #252535;
            --accent-primary: #6366f1;
            --accent-secondary: #818cf8;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --success: #22c55e;
            --success-glow: rgba(34, 197, 94, 0.3);
            --warning: #f59e0b;
            --warning-glow: rgba(245, 158, 11, 0.3);
            --danger: #ef4444;
            --danger-glow: rgba(239, 68, 68, 0.3);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #2e2e3e;
            --border-hover: #3e3e50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated background */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, var(--accent-glow) 0%, transparent 40%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        /* Header */
        .header {
            position: relative;
            z-index: 10;
            background: linear-gradient(180deg, var(--bg-secondary) 0%, transparent 100%);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 2rem;
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, #8b5cf6 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 20px var(--accent-glow);
        }

        .logo-text h1 {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-text p {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .select-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-tertiary);
            padding: 0.5rem 1rem;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .select-group label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .select-group select {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.4rem 0.75rem;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .select-group select:hover {
            border-color: var(--accent-primary);
        }

        .select-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        /* Period Display (ìë™ê°ì§€) */
        .period-display {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-card));
            padding: 0.6rem 1.2rem;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .period-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .period-value {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--accent-primary);
            padding: 0.3rem 0.8rem;
            background: var(--accent-glow);
            border-radius: 8px;
        }

        .period-value.waiting {
            color: var(--text-secondary);
            background: transparent;
            font-weight: 400;
        }

        /* Main Layout */
        .main-container {
            position: relative;
            z-index: 10;
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 360px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 100px);
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .upload-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s;
        }

        .upload-section:hover {
            border-color: var(--border-hover);
        }

        .section-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--bg-tertiary);
        }

        .upload-zone:hover {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .upload-zone.dragover {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
            transform: scale(1.02);
        }

        .upload-zone.uploaded {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.05);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.8;
        }

        .upload-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .upload-hint {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .upload-filename {
            color: var(--success);
            font-size: 0.9rem;
            font-weight: 500;
            margin-top: 0.5rem;
            word-break: break-all;
        }

        /* Report List */
        .report-list-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            flex: 1;
            overflow-y: auto;
        }

        /* Tab Buttons */
        .tab-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tab-btn {
            flex: 1;
            padding: 0.6rem 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.1) 100%);
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .report-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .report-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .report-item:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
            transform: translateX(4px);
        }

        .report-item.active {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.1) 100%);
            border-color: var(--accent-primary);
        }

        .report-item.reviewed {
            background: rgba(34, 197, 94, 0.1);
            border-color: var(--success);
        }

        .report-item.has-missing {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--warning);
        }

        .report-item.generated {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--accent-secondary);
        }

        .report-icon {
            width: 36px;
            height: 36px;
            background: var(--bg-card);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .report-info {
            flex: 1;
        }

        .report-name {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.125rem;
        }

        .report-sheet {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .report-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
        }

        .report-status.pending {
            color: var(--text-muted);
        }

        .report-status.generated {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .report-status.reviewed {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .report-status.edited {
            background: #f59e0b;
            border-color: #f59e0b;
            color: white;
        }

        .report-item.edited {
            border-left: 3px solid #f59e0b;
        }

        .report-status.has-missing {
            background: var(--warning);
            border-color: var(--warning);
            color: white;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Control Bar */
        .control-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .nav-btn {
            width: 40px;
            height: 40px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-btn:hover:not(:disabled) {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .page-indicator {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .action-btns {
            display: flex;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary) 0%, #8b5cf6 100%);
            border: none;
            color: white;
            box-shadow: 0 4px 15px var(--accent-glow);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px var(--accent-glow);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
        }

        .btn-success {
            background: var(--success);
            border: none;
            color: white;
            box-shadow: 0 4px 15px var(--success-glow);
        }

        .btn-edit {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        .btn-edit:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-save {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        .btn-save:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-cancel {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        .btn-cancel:hover:not(:disabled) {
            background: var(--bg-card-hover);
            color: var(--error);
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px var(--success-glow);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Preview Area */
        .preview-area {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
        }

        .preview-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
        }

        .preview-content {
            flex: 1;
            overflow: auto;
            background: white;
        }

        .preview-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        .preview-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-muted);
            background: var(--bg-tertiary);
        }

        .preview-placeholder-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        .preview-placeholder h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .preview-placeholder p {
            font-size: 0.9rem;
            max-width: 400px;
            text-align: center;
            line-height: 1.6;
        }

        /* Preview Actions */
        .preview-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Edit Mode Styles */
        .edit-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
        }

        .edit-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-bottom: 2px solid #f59e0b;
        }

        .edit-mode-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: #92400e;
            font-size: 0.9rem;
        }

        .edit-hint {
            font-size: 0.8rem;
            color: #b45309;
        }

        .edit-content {
            flex: 1;
            overflow: auto;
            padding: 1rem;
            background: white;
        }

        .edit-content [contenteditable="true"] {
            outline: none;
            min-height: 1em;
            transition: background-color 0.2s;
        }

        .edit-content [contenteditable="true"]:hover {
            background-color: rgba(245, 158, 11, 0.1);
        }

        .edit-content [contenteditable="true"]:focus {
            background-color: rgba(245, 158, 11, 0.2);
            box-shadow: inset 0 0 0 2px #f59e0b;
        }

        /* í¸ì§‘ ë¶ˆê°€ ìš”ì†Œ í‘œì‹œ */
        .edit-content .no-edit {
            pointer-events: none;
            opacity: 0.7;
        }

        .edit-content img,
        .edit-content svg,
        .edit-content canvas {
            pointer-events: none;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: all 0.3s;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--danger);
            border-color: var(--danger);
        }

        .missing-field-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .missing-field-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
        }

        .missing-field-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .missing-field-input {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .missing-field-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        /* Progress */
        .progress-bar {
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary) 0%, #8b5cf6 100%);
            border-radius: 2px;
            transition: width 0.5s ease;
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .toast {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 300px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            border-color: var(--success);
        }

        .toast.error {
            border-color: var(--danger);
        }

        .toast.warning {
            border-color: var(--warning);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Upload Modal */
        .upload-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1003;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .upload-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .upload-modal-content {
            width: 90%;
            max-width: 450px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
        }

        .upload-modal-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .upload-modal-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .upload-modal-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .upload-steps {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .upload-step {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .upload-step.active {
            border-color: var(--accent-primary);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), transparent);
        }

        .upload-step.completed {
            border-color: var(--success);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), transparent);
        }

        .upload-step.skipped {
            opacity: 0.5;
        }

        .upload-step .step-icon {
            font-size: 1.2rem;
            width: 28px;
            text-align: center;
        }

        .upload-step .step-text {
            flex: 1;
            text-align: left;
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        .upload-step .step-status {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .upload-progress-bar {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .upload-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            width: 0%;
            transition: width 0.3s;
        }

        .upload-result {
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border: 1px solid var(--success);
        }

        .upload-result .result-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
        }

        .upload-result .result-item:not(:last-child) {
            border-bottom: 1px solid var(--border);
        }

        .upload-result .result-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .upload-result .result-value {
            color: var(--accent-primary);
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Loading - í° ì§„í–‰ë¥  í‘œì‹œ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-content {
            width: 90%;
            max-width: 600px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2.5rem;
            text-align: center;
        }

        .loading-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .loading-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .loading-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 2rem;
        }

        .loading-progress-container {
            margin-bottom: 1.5rem;
        }

        .loading-progress-bar {
            height: 12px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .loading-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary) 0%, #8b5cf6 50%, var(--success) 100%);
            border-radius: 6px;
            transition: width 0.3s ease;
            box-shadow: 0 0 20px var(--accent-glow);
        }

        .loading-stats {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .loading-current-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin-bottom: 1.5rem;
        }

        .loading-current-icon {
            font-size: 1.5rem;
        }

        .loading-current-text {
            color: var(--text-primary);
            font-weight: 500;
        }

        .loading-time-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .loading-time-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .loading-time-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-secondary);
            font-variant-numeric: tabular-nums;
        }

        .loading-time-label {
            font-size: 0.75rem;
        }

        /* ìƒì„± ì™„ë£Œ ìƒíƒœ */
        .generation-status {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            display: none;
        }

        .generation-status.active {
            display: block;
        }

        .generation-status-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .generation-status-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: var(--success);
        }

        .generation-status-count {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .generation-mini-progress {
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            overflow: hidden;
        }

        .generation-mini-fill {
            height: 100%;
            background: var(--success);
            border-radius: 2px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 300px 1fr;
            }
        }

        @media (max-width: 900px) {
            .main-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                max-height: 300px;
            }

            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">ğŸ“Š</div>
                <div class="logo-text">
                    <h1>ì§€ì—­ê²½ì œë™í–¥ ë³´ê³ ì„œ ì‹œìŠ¤í…œ</h1>
                    <p>Regional Economic Report Generator</p>
                </div>
            </div>
            <div class="header-controls">
                <div class="period-display" id="periodDisplay">
                    <span class="period-label">ğŸ“… ê¸°ì¤€ì‹œì </span>
                    <span class="period-value waiting" id="periodValue">íŒŒì¼ ì—…ë¡œë“œ ëŒ€ê¸°ì¤‘...</span>
                    <input type="hidden" id="yearSelect" value="2025">
                    <input type="hidden" id="quarterSelect" value="2">
                </div>
                <button class="btn btn-secondary" id="weightInfoBtn" onclick="openWeightSettingsModal()" title="ê°€ì¤‘ì¹˜ ì„¤ì •">
                    âš–ï¸ ê°€ì¤‘ì¹˜ ì„¤ì •
                </button>
                <button class="btn btn-secondary" id="contactInfoBtn" onclick="openContactModal()" title="ë‹´ë‹¹ë¶€ì„œ/ë‹´ë‹¹ì ì„¤ì •">
                    âš™ï¸ ë‹´ë‹¹ì ì„¤ì •
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Upload Section -->
            <div class="upload-section">
                <div class="section-title">ğŸ“ ë°ì´í„° ì—…ë¡œë“œ</div>
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">ğŸ“„</div>
                    <p class="upload-text">ì—‘ì…€ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</p>
                    <p class="upload-hint">ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œ (*.xlsx, *.xls)</p>
                    <p class="upload-filename" id="uploadFilename" style="display: none;"></p>
                </div>
                <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;">
                <div class="progress-bar" id="progressBar" style="display: none;">
                    <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                </div>
                
                <!-- Conversion Info (ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œ ì—…ë¡œë“œ ì‹œ í‘œì‹œ) -->
                <div class="conversion-info" id="conversionInfo" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 10px; border: 1px solid var(--border);">
                    <div style="font-size: 0.85rem; font-weight: 600; color: var(--success); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                        <span>âœ¨</span>
                        <span>ê¸°ì´ˆìë£Œ â†’ ë¶„ì„í‘œ ë³€í™˜ ì™„ë£Œ</span>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.75rem;" id="conversionDetails"></div>
                    
                    <!-- GRDP ì¶”ì¶œ ê²°ê³¼ -->
                    <div class="grdp-info" id="grdpInfo" style="display: none; padding: 0.75rem; background: var(--bg-card); border-radius: 8px; border-left: 3px solid var(--accent-primary);">
                        <div style="font-size: 0.8rem; font-weight: 600; color: var(--accent-secondary); margin-bottom: 0.5rem;">ğŸ“Š GRDP ì¶”ì¶œ ì™„ë£Œ</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.75rem;">
                            <div>
                                <span style="color: var(--text-muted);">ì „êµ­ ì„±ì¥ë¥ :</span>
                                <span id="grdpNational" style="color: var(--text-primary); font-weight: 600;"></span>
                            </div>
                            <div>
                                <span style="color: var(--text-muted);">1ìœ„ ì§€ì—­:</span>
                                <span id="grdpTopRegion" style="color: var(--text-primary); font-weight: 600;"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- GRDP ëˆ„ë½ ì•ˆë‚´ (ê°„ì†Œí™”) -->
                    <div class="grdp-missing" id="grdpMissing" style="display: none; padding: 0.75rem; background: var(--bg-card); border-radius: 8px; border-left: 3px solid #f59e0b;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 0.8rem; font-weight: 600; color: #f59e0b;">âš ï¸ GRDP ë°ì´í„° ëˆ„ë½</div>
                                <div style="font-size: 0.7rem; color: var(--text-muted);">ì°¸ê³ _GRDP ë³´ê³ ì„œì— ì˜í–¥</div>
                            </div>
                            <button onclick="showGrdpModal()" style="
                                padding: 0.4rem 0.75rem;
                                background: #f59e0b;
                                color: white;
                                border: none;
                                border-radius: 6px;
                                font-size: 0.75rem;
                                cursor: pointer;
                            ">ì¶”ê°€</button>
                        </div>
                    </div>
                    
                    <!-- ë¶„ì„í‘œ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
                    <button id="downloadAnalysisBtn" onclick="downloadAnalysisFile()" style="
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 0.5rem;
                        width: 100%;
                        margin-top: 1rem;
                        padding: 0.75rem 1rem;
                        background: linear-gradient(135deg, var(--accent-tertiary), var(--accent-secondary));
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-size: 0.85rem;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s;
                    ">
                        <span>ğŸ“¥</span>
                        <span>ë¶„ì„í‘œ ë‹¤ìš´ë¡œë“œ</span>
                    </button>
                    
                    <!-- ê°€ì¤‘ì¹˜ ì •ë³´ ì•ˆë‚´ -->
                    <div style="margin-top: 0.75rem; padding: 0.75rem; background: var(--bg-card); border-radius: 8px; border-left: 3px solid var(--accent-primary);">
                        <div style="font-size: 0.75rem; color: var(--text-muted); line-height: 1.5;">
                            <strong style="color: var(--text-secondary);">ğŸ’¡ ê°€ì¤‘ì¹˜ ì²˜ë¦¬ ì•ˆë‚´</strong><br>
                            ìƒë‹¨ì˜ <strong>âš–ï¸ ê°€ì¤‘ì¹˜ ì„¤ì •</strong> ë²„íŠ¼ì—ì„œ ë¯¸ë¦¬ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report List -->
            <div class="report-list-section">
                <div class="section-title">ğŸ“‹ ë³´ê³ ì„œ ëª©ë¡ <span id="reportCountBadge" style="font-size: 0.75rem; color: var(--text-secondary);"></span></div>
                
                <!-- ì „ì²´ ë³´ê³ ì„œ í†µí•© ë¦¬ìŠ¤íŠ¸ (ìˆœì°¨ì  í˜ì´ì§€ ë„˜ê¹€) -->
                <div class="report-list" id="allReportsList" style="max-height: calc(100vh - 350px); overflow-y: auto;">
                    <!-- All reports will be rendered here -->
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Generation Status -->
            <div class="generation-status" id="generationStatus">
                <div class="generation-status-header">
                    <span class="generation-status-title">
                        <span>âœ…</span>
                        <span>ë¯¸ë¦¬ë³´ê¸° ìƒì„± ì™„ë£Œ</span>
                    </span>
                    <span class="generation-status-count" id="generationStatusCount">50/50</span>
                </div>
                <div class="generation-mini-progress">
                    <div class="generation-mini-fill" id="generationMiniFill" style="width: 100%;"></div>
                </div>
            </div>

            <!-- Control Bar -->
            <div class="control-bar">
                <div class="nav-controls">
                    <button class="nav-btn" id="prevBtn" disabled title="ì´ì „">â—€</button>
                    <span class="page-indicator" id="pageIndicator">0 / 0</span>
                    <button class="nav-btn" id="nextBtn" disabled title="ë‹¤ìŒ">â–¶</button>
                </div>
                <div class="action-btns">
                    <button class="btn btn-success" id="exportBtn" style="display: none;">
                        ğŸ“° HTML ë³´ë„ìë£Œ
                    </button>
                    <button class="btn btn-hwp" id="exportHwpBtn" style="display: none; background: linear-gradient(135deg, #2196f3, #1976d2); border-color: #1565c0;">
                        ğŸ“‹ í•œê¸€ ë³µë¶™ìš©
                    </button>
                </div>
            </div>

            <!-- Preview Area -->
            <div class="preview-area">
                <div class="preview-header">
                    <div class="preview-title" id="previewTitle">
                        <span>ğŸ“„</span>
                        <span>ë¯¸ë¦¬ë³´ê¸°</span>
                    </div>
                    <div class="preview-actions">
                        <button class="btn btn-edit" id="editBtn" style="display: none;" title="í¸ì§‘ ëª¨ë“œ">
                            âœï¸ í¸ì§‘
                        </button>
                        <button class="btn btn-save" id="saveEditBtn" style="display: none;" title="ë³€ê²½ì‚¬í•­ ì €ì¥">
                            ğŸ’¾ ì €ì¥
                        </button>
                        <button class="btn btn-cancel" id="cancelEditBtn" style="display: none;" title="í¸ì§‘ ì·¨ì†Œ">
                            âœ• ì·¨ì†Œ
                        </button>
                        <button class="btn btn-secondary" id="markReviewedBtn" style="display: none;">
                            âœ“ ê²€í†  ì™„ë£Œ
                        </button>
                    </div>
                </div>
                <div class="preview-content" id="previewContent">
                    <div class="preview-placeholder" id="previewPlaceholder">
                        <div class="preview-placeholder-icon">ğŸ“Š</div>
                        <h3>ë³´ê³ ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
                        <p>ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ìë™ìœ¼ë¡œ ë³´ê³ ì„œê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>
                    </div>
                    <iframe class="preview-iframe" id="previewIframe" style="display: none;"></iframe>
                    <!-- í¸ì§‘ ëª¨ë“œìš© ì—ë””í„° -->
                    <div class="edit-container" id="editContainer" style="display: none;">
                        <div class="edit-toolbar">
                            <span class="edit-mode-badge">ğŸ“ í¸ì§‘ ëª¨ë“œ</span>
                            <span class="edit-hint">í…ìŠ¤íŠ¸ë¥¼ í´ë¦­í•˜ì—¬ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”. ë ˆì´ì•„ì›ƒì€ ìœ ì§€ë©ë‹ˆë‹¤.</span>
                        </div>
                        <div class="edit-content" id="editContent"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Contact Info Modal (ë‹´ë‹¹ë¶€ì„œ/ë‹´ë‹¹ì ì •ë³´ ì…ë ¥) -->
    <div class="modal-overlay" id="contactInfoModal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <span>ğŸ“</span>
                    <span>ë‹´ë‹¹ë¶€ì„œ ë° ë‹´ë‹¹ì ì •ë³´</span>
                </h2>
                <button class="modal-close" onclick="closeContactModal()">Ã—</button>
            </div>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                ë³´ê³ ì„œ í‘œì§€ì— í‘œì‹œë  ë‹´ë‹¹ë¶€ì„œ ë° ë‹´ë‹¹ì ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
            </p>
            
            <!-- ë³´ë„ìë£Œ ì •ë³´ -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 0.95rem; color: var(--accent-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ“…</span> ë³´ë„ìë£Œ ì •ë³´
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="missing-field-item">
                        <label class="missing-field-label">ë³´ë„ì‹œì </label>
                        <input type="text" class="missing-field-input" id="releaseDateTime" 
                               placeholder="ì˜ˆ: 2025. 8. 12.(í™”) 12:00" value="2025. 8. 12.(í™”) 12:00">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ë°°í¬ì¼ì‹œ</label>
                        <input type="text" class="missing-field-input" id="distributionDateTime" 
                               placeholder="ì˜ˆ: 2025. 8. 12.(í™”) 08:30" value="2025. 8. 12.(í™”) 08:30">
                    </div>
                </div>
            </div>
            
            <!-- ë‹´ë‹¹ë¶€ì„œ ì •ë³´ -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 0.95rem; color: var(--accent-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ›ï¸</span> ë‹´ë‹¹ë¶€ì„œ
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="missing-field-item">
                        <label class="missing-field-label">ë¶€ì„œëª…</label>
                        <input type="text" class="missing-field-input" id="department" 
                               placeholder="ì˜ˆ: êµ­ê°€ë°ì´í„°ì²˜ ê²½ì œí†µê³„êµ­" value="êµ­ê°€ë°ì´í„°ì²˜ ê²½ì œí†µê³„êµ­">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ê³¼ëª…</label>
                        <input type="text" class="missing-field-input" id="division" 
                               placeholder="ì˜ˆ: ì†Œë“í†µê³„ê³¼" value="ì†Œë“í†µê³„ê³¼">
                    </div>
                </div>
            </div>
            
            <!-- ì±…ì„ì ì •ë³´ -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 0.95rem; color: var(--accent-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ‘”</span> ì±…ì„ì ì •ë³´
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì§ì±…</label>
                        <input type="text" class="missing-field-input" id="managerTitle" 
                               placeholder="ì˜ˆ: ê³¼ ì¥" value="ê³¼ ì¥">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì´ë¦„</label>
                        <input type="text" class="missing-field-input" id="managerName" 
                               placeholder="ì˜ˆ: í™ê¸¸ë™" value="ì •ì„ ê²½">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì „í™”ë²ˆí˜¸</label>
                        <input type="text" class="missing-field-input" id="managerPhone" 
                               placeholder="ì˜ˆ: 042-481-2206" value="042-481-2206">
                    </div>
                </div>
            </div>
            
            <!-- ë‹´ë‹¹ì ì •ë³´ -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 0.95rem; color: var(--accent-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ‘¤</span> ë‹´ë‹¹ì ì •ë³´
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì§ì±…</label>
                        <input type="text" class="missing-field-input" id="staffTitle" 
                               placeholder="ì˜ˆ: ì‚¬ë¬´ê´€" value="ì‚¬ë¬´ê´€">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì´ë¦„</label>
                        <input type="text" class="missing-field-input" id="staffName" 
                               placeholder="ì˜ˆ: ê¹€ì² ìˆ˜" value="ìœ¤ë¯¼í¬">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì „í™”ë²ˆí˜¸</label>
                        <input type="text" class="missing-field-input" id="staffPhone" 
                               placeholder="ì˜ˆ: 042-481-2226" value="042-481-2226">
                    </div>
                </div>
            </div>
            
            <!-- ê´€ì„¸ì²­ ë‹´ë‹¹ ì •ë³´ -->
            <div style="margin-bottom: 1rem;">
                <h3 style="font-size: 0.95rem; color: var(--accent-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸš¢</span> ê´€ì„¸ì²­ ë‹´ë‹¹ (ìˆ˜ì¶œì… í†µê³„)
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="missing-field-item">
                        <label class="missing-field-label">ë‹´ë‹¹ë¶€ì„œ</label>
                        <input type="text" class="missing-field-input" id="customsDepartment" 
                               placeholder="ì˜ˆ: ê´€ì„¸ì²­ ì •ë³´ë°ì´í„°ê¸°íšë‹´ë‹¹ê´€" value="ê´€ì„¸ì²­ ì •ë³´ë°ì´í„°ê¸°íšë‹´ë‹¹ê´€">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì „í™”ë²ˆí˜¸</label>
                        <input type="text" class="missing-field-input" id="customsPhone" 
                               placeholder="ì˜ˆ: 042-481-7845" value="042-481-7845">
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeContactModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveContactInfo()">ğŸ’¾ ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- Weight Settings Modal (ê°€ì¤‘ì¹˜ ì„¤ì •) -->
    <div class="modal-overlay" id="weightSettingsModal">
        <div class="modal" style="max-width: 900px; max-height: 85vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <span>âš–ï¸</span>
                    <span>ê°€ì¤‘ì¹˜ ì„¤ì •</span>
                </h2>
                <button class="modal-close" onclick="closeWeightSettingsModal()">Ã—</button>
            </div>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                ë¶„ì„í‘œ ìƒì„± ì‹œ ì‚¬ìš©í•  ê°€ì¤‘ì¹˜ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”. ê¸°ì´ˆìë£Œì—ì„œ ìë™ ì¶”ì¶œë˜ì§€ ì•ŠëŠ” ê²½ìš° ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
            
            <!-- ê°€ì¤‘ì¹˜ ì„¤ì • ì•ˆë‚´ -->
            <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: 10px; margin-bottom: 1.5rem; border-left: 3px solid var(--accent-primary);">
                <div style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6;">
                    <strong style="color: var(--text-primary);">ğŸ’¡ ê°€ì¤‘ì¹˜ ì²˜ë¦¬ ë°©ì‹</strong><br>
                    â€¢ <strong>ê´‘ê³µì—…ìƒì‚°</strong>, <strong>ì„œë¹„ìŠ¤ì—…ìƒì‚°</strong>: ê¸°ì´ˆìë£Œì—ì„œ ìë™ ì¶”ì¶œ ë˜ëŠ” í–‰ë³„ ìˆ˜ë™ ì…ë ¥<br>
                    â€¢ <strong>ë¹„ê³µê°œ ê°€ì¤‘ì¹˜ (0)</strong>: ê¸°ë³¸ê°’ìœ¼ë¡œ ëŒ€ì²´ë¨ (ì•„ë˜ì—ì„œ ì„¤ì • ê°€ëŠ¥)<br>
                    â€¢ ê¸°íƒ€ ì‹œíŠ¸: ê°€ì¤‘ì¹˜ ì—†ìŒ (ê³µë€ ì²˜ë¦¬)
                </div>
            </div>
            
            <!-- ë¹„ê³µê°œ ê°€ì¤‘ì¹˜ ê¸°ë³¸ê°’ ì„¤ì • -->
            <div style="padding: 1rem; background: var(--bg-card); border-radius: 10px; margin-bottom: 1.5rem; border: 1px solid var(--accent-secondary);">
                <h3 style="font-size: 0.9rem; color: var(--accent-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ”’</span> ë¹„ê³µê°œ ê°€ì¤‘ì¹˜ ê¸°ë³¸ê°’
                </h3>
                <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.75rem;">
                    ê¸°ì´ˆìë£Œì—ì„œ ê°€ì¤‘ì¹˜ê°€ 0(ë¹„ê³µê°œ)ì¸ ê²½ìš° ì•„ë˜ ê¸°ë³¸ê°’ìœ¼ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.
                </p>
                <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
                    <div class="missing-field-item" style="max-width: 200px;">
                        <label class="missing-field-label">ê´‘ê³µì—…ìƒì‚° ê¸°ë³¸ê°’</label>
                        <input type="number" class="missing-field-input" id="miningDefaultWeight" value="1" min="0" step="1" placeholder="1">
                    </div>
                    <div class="missing-field-item" style="max-width: 200px;">
                        <label class="missing-field-label">ì„œë¹„ìŠ¤ì—…ìƒì‚° ê¸°ë³¸ê°’</label>
                        <input type="number" class="missing-field-input" id="serviceDefaultWeight" value="1" min="0" step="1" placeholder="1">
                    </div>
                </div>
            </div>
            
            <!-- ê´‘ê³µì—…ìƒì‚° ê°€ì¤‘ì¹˜ -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 0.95rem; color: var(--accent-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ­</span> ê´‘ê³µì—…ìƒì‚° ê°€ì¤‘ì¹˜
                </h3>
                <div style="margin-bottom: 0.75rem;">
                    <div class="missing-field-item" style="max-width: 300px;">
                        <label class="missing-field-label">ê°€ì¤‘ì¹˜ ì‚¬ìš© ë°©ì‹</label>
                        <select class="missing-field-input" id="miningWeightMode" onchange="toggleWeightInput('mining')">
                            <option value="auto">ê¸°ì´ˆìë£Œì—ì„œ ìë™ ì¶”ì¶œ</option>
                            <option value="manual">ìˆ˜ë™ ì…ë ¥</option>
                            <option value="empty">ê°€ì¤‘ì¹˜ ì—†ìŒ (ê³µë€)</option>
                        </select>
                    </div>
                </div>
                <!-- ìˆ˜ë™ ì…ë ¥ ì˜ì—­ (í–‰ë³„ ì…ë ¥) -->
                <div id="miningWeightInputContainer" style="display: none; margin-top: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <label class="missing-field-label" style="margin-bottom: 0;">ì—…ì¢…ë³„ ê°€ì¤‘ì¹˜ ì…ë ¥</label>
                        <button class="btn btn-secondary" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="loadMiningIndustries()">ğŸ“¥ ê¸°ì´ˆìë£Œì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                    </div>
                    <div id="miningWeightRows" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-card);">
                        <div style="display: grid; grid-template-columns: 80px 1fr 100px; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--bg-tertiary); border-bottom: 1px solid var(--border); font-size: 0.75rem; font-weight: 600; color: var(--text-secondary);">
                            <span>í–‰ ë²ˆí˜¸</span>
                            <span>ì—…ì¢…ëª…</span>
                            <span>ê°€ì¤‘ì¹˜</span>
                        </div>
                        <!-- í–‰ë³„ ì…ë ¥ (ë™ì  ìƒì„±) -->
                    </div>
                    <p style="font-size: 0.7rem; color: var(--text-muted); margin-top: 0.5rem;">
                        * ê¸°ì´ˆìë£Œì—ì„œ ì—…ì¢… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”. ë¹ˆ ê°’ì€ ê³µë€ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
            
            <!-- ì„œë¹„ìŠ¤ì—…ìƒì‚° ê°€ì¤‘ì¹˜ -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 0.95rem; color: var(--accent-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ¢</span> ì„œë¹„ìŠ¤ì—…ìƒì‚° ê°€ì¤‘ì¹˜
                </h3>
                <div style="margin-bottom: 0.75rem;">
                    <div class="missing-field-item" style="max-width: 300px;">
                        <label class="missing-field-label">ê°€ì¤‘ì¹˜ ì‚¬ìš© ë°©ì‹</label>
                        <select class="missing-field-input" id="serviceWeightMode" onchange="toggleWeightInput('service')">
                            <option value="auto">ê¸°ì´ˆìë£Œì—ì„œ ìë™ ì¶”ì¶œ</option>
                            <option value="manual">ìˆ˜ë™ ì…ë ¥</option>
                            <option value="empty">ê°€ì¤‘ì¹˜ ì—†ìŒ (ê³µë€)</option>
                        </select>
                    </div>
                </div>
                <!-- ìˆ˜ë™ ì…ë ¥ ì˜ì—­ (í–‰ë³„ ì…ë ¥) -->
                <div id="serviceWeightInputContainer" style="display: none; margin-top: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <label class="missing-field-label" style="margin-bottom: 0;">ì—…ì¢…ë³„ ê°€ì¤‘ì¹˜ ì…ë ¥</label>
                        <button class="btn btn-secondary" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" onclick="loadServiceIndustries()">ğŸ“¥ ê¸°ì´ˆìë£Œì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                    </div>
                    <div id="serviceWeightRows" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-card);">
                        <div style="display: grid; grid-template-columns: 80px 1fr 100px; gap: 0.5rem; padding: 0.5rem 0.75rem; background: var(--bg-tertiary); border-bottom: 1px solid var(--border); font-size: 0.75rem; font-weight: 600; color: var(--text-secondary);">
                            <span>í–‰ ë²ˆí˜¸</span>
                            <span>ì—…ì¢…ëª…</span>
                            <span>ê°€ì¤‘ì¹˜</span>
                        </div>
                        <!-- í–‰ë³„ ì…ë ¥ (ë™ì  ìƒì„±) -->
                    </div>
                    <p style="font-size: 0.7rem; color: var(--text-muted); margin-top: 0.5rem;">
                        * ê¸°ì´ˆìë£Œì—ì„œ ì—…ì¢… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”. ë¹ˆ ê°’ì€ ê³µë€ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
            
            <!-- ê¸°íƒ€ ì‹œíŠ¸ ì•ˆë‚´ -->
            <div style="padding: 1rem; background: var(--bg-card); border-radius: 10px; margin-bottom: 1rem; border: 1px solid var(--border);">
                <div style="font-size: 0.85rem; color: var(--text-muted);">
                    <strong style="color: var(--text-secondary);">ğŸ“‹ ê¸°íƒ€ ì‹œíŠ¸ (ê°€ì¤‘ì¹˜ ì—†ìŒ)</strong><br>
                    ì†Œë¹„, ê³ ìš©ë¥ , ì‹¤ì—…, ë¬¼ê°€, ê±´ì„¤, ìˆ˜ì¶œ, ìˆ˜ì…, ì¸êµ¬ì´ë™ ë“±ì˜ ì‹œíŠ¸ëŠ” ê°€ì¤‘ì¹˜ ì—´ì´ ì—†ì–´ ê³µë€ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeWeightSettingsModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveWeightSettings()">ğŸ’¾ ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- Upload Progress Modal -->
    <div class="upload-modal-overlay" id="uploadModal">
        <div class="upload-modal-content">
            <div class="upload-modal-icon" id="uploadModalIcon">ğŸ“¤</div>
            <h2 class="upload-modal-title" id="uploadModalTitle">íŒŒì¼ ì—…ë¡œë“œ ì¤‘</h2>
            <p class="upload-modal-subtitle" id="uploadModalSubtitle">íŒŒì¼ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
            
            <div class="upload-steps">
                <div class="upload-step" id="uploadStep1">
                    <span class="step-icon">â³</span>
                    <span class="step-text">íŒŒì¼ ì—…ë¡œë“œ</span>
                    <span class="step-status"></span>
                </div>
                <div class="upload-step" id="uploadStep2">
                    <span class="step-icon">â³</span>
                    <span class="step-text">íŒŒì¼ ìœ í˜• ë¶„ì„</span>
                    <span class="step-status"></span>
                </div>
                <div class="upload-step" id="uploadStep3">
                    <span class="step-icon">â³</span>
                    <span class="step-text">ë¶„ì„í‘œ ë³€í™˜</span>
                    <span class="step-status"></span>
                </div>
                <div class="upload-step" id="uploadStep4">
                    <span class="step-icon">â³</span>
                    <span class="step-text">GRDP ë°ì´í„° ì¶”ì¶œ</span>
                    <span class="step-status"></span>
                </div>
            </div>
            
            <div class="upload-progress-bar">
                <div class="upload-progress-fill" id="uploadProgressFill"></div>
            </div>
            
            <div class="upload-result" id="uploadResult" style="display: none;">
                <div class="result-item">
                    <span class="result-label">ê¸°ì¤€ì‹œì :</span>
                    <span class="result-value" id="resultPeriod"></span>
                </div>
                <div class="result-item">
                    <span class="result-label">ì „êµ­ GRDP:</span>
                    <span class="result-value" id="resultGrdp"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay with Progress -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-icon" id="loadingIcon">ğŸ“Š</div>
            <h2 class="loading-title" id="loadingTitle">ë³´ê³ ì„œ ìƒì„± ì¤‘</h2>
            <p class="loading-subtitle" id="loadingSubtitle">ëª¨ë“  ë³´ê³ ì„œë¥¼ ë¯¸ë¦¬ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
            
            <div class="loading-progress-container">
                <div class="loading-progress-bar">
                    <div class="loading-progress-fill" id="loadingProgressFill" style="width: 0%;"></div>
                </div>
                <div class="loading-stats">
                    <span id="loadingProgressText">0 / 50</span>
                    <span id="loadingProgressPercent">0%</span>
                </div>
            </div>
            
            <div class="loading-current-item" id="loadingCurrentItem">
                <span class="loading-current-icon" id="loadingCurrentIcon">ğŸ“„</span>
                <span class="loading-current-text" id="loadingCurrentText">ì¤€ë¹„ ì¤‘...</span>
            </div>
            
            <div class="loading-time-container">
                <div class="loading-time-item">
                    <span class="loading-time-value" id="elapsedTime">00:00</span>
                    <span class="loading-time-label">ê²½ê³¼ ì‹œê°„</span>
                </div>
            </div>
        </div>
    </div>

    <!-- GRDP Upload Modal -->
    <div class="upload-modal-overlay" id="grdpModal">
        <div class="upload-modal-content" style="max-width: 450px;">
            <div class="upload-modal-icon" style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“Š</div>
            <h2 class="upload-modal-title" style="color: #f59e0b;">GRDP ë°ì´í„° í•„ìš”</h2>
            <p class="upload-modal-subtitle" style="margin-bottom: 1.5rem;">
                ê¸°ì´ˆìë£Œì— GRDP ë°ì´í„°ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
                GRDP íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.
            </p>
            
            <!-- GRDP íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
            <div class="grdp-upload-area" style="
                border: 2px dashed var(--border);
                border-radius: 12px;
                padding: 1.5rem;
                margin-bottom: 1rem;
                cursor: pointer;
                transition: all 0.3s;
            " onclick="document.getElementById('grdpModalFileInput').click()">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“</div>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">GRDP ì—‘ì…€ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</p>
                <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: 0.5rem;">ë¶„ê¸° ì§€ì—­ë‚´ì´ìƒì‚° (*.xlsx)</p>
                <input type="file" id="grdpModalFileInput" accept=".xlsx,.xls" style="display: none;" onchange="handleGrdpModalUpload(this)">
            </div>
            
            <!-- ì—…ë¡œë“œ ì§„í–‰ ìƒíƒœ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
            <div id="grdpUploadProgress" style="display: none; margin-bottom: 1rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--accent-secondary);">
                    <span class="spinner" style="
                        width: 16px;
                        height: 16px;
                        border: 2px solid var(--border);
                        border-top-color: var(--accent-primary);
                        border-radius: 50%;
                        animation: spin 1s linear infinite;
                    "></span>
                    <span id="grdpUploadStatus">ì—…ë¡œë“œ ì¤‘...</span>
                </div>
            </div>
            
            <!-- ë²„íŠ¼ ì˜ì—­ -->
            <div style="display: flex; gap: 0.75rem; margin-top: 1rem;">
                <button onclick="openKosisGrdpPage()" style="
                    flex: 1;
                    padding: 0.75rem 1rem;
                    background: transparent;
                    color: var(--text-secondary);
                    border: 1px solid var(--border);
                    border-radius: 8px;
                    font-size: 0.85rem;
                    cursor: pointer;
                    transition: all 0.3s;
                ">
                    GRDP íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤
                </button>
                <button onclick="closeGrdpModal()" style="
                    flex: 1;
                    padding: 0.75rem 1rem;
                    background: var(--bg-tertiary);
                    color: var(--text-primary);
                    border: 1px solid var(--border);
                    border-radius: 8px;
                    font-size: 0.85rem;
                    cursor: pointer;
                    transition: all 0.3s;
                ">
                    ë‚˜ì¤‘ì— ì¶”ê°€
                </button>
            </div>
            
            <!-- ì•ˆë‚´ ë¬¸êµ¬ -->
            <p style="color: var(--text-muted); font-size: 0.7rem; margin-top: 1rem; text-align: center;">
                * GRDP ì—†ì´ë„ ë‹¤ë¥¸ ë³´ê³ ì„œëŠ” ì •ìƒì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤
            </p>
        </div>
    </div>
    
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .grdp-upload-area:hover {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.05);
        }
        
        .grdp-upload-area.dragover {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }
    </style>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // State
        const state = {
            fileUploaded: false,
            allGenerated: false,
            currentReportIndex: -1,
            currentGlobalIndex: -1,  // ì „ì²´ ë³´ê³ ì„œ í†µí•© ì¸ë±ìŠ¤
            allReports: [],  // ëª¨ë“  ë³´ê³ ì„œ í†µí•© ë°°ì—´
            fileType: null,  // 'raw' (ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œ)
            analysisFilename: null,  // ìƒì„±ëœ ë¶„ì„í‘œ íŒŒì¼ëª…
            reports: [],
            summaryReports: [],
            sectoralReports: [],
            regionalReports: [],
            statisticsReports: [
                { id: 'stat_toc', name: 'í†µê³„í‘œ-ëª©ì°¨', icon: 'ğŸ“‹', description: 'í†µê³„í‘œ ëª©ì°¨' },
                { id: 'stat_mining', name: 'í†µê³„í‘œ-ê´‘ê³µì—…ìƒì‚°ì§€ìˆ˜', icon: 'ğŸ­', description: 'ê´‘ê³µì—…ìƒì‚°ì§€ìˆ˜' },
                { id: 'stat_service', name: 'í†µê³„í‘œ-ì„œë¹„ìŠ¤ì—…ìƒì‚°ì§€ìˆ˜', icon: 'ğŸ¢', description: 'ì„œë¹„ìŠ¤ì—…ìƒì‚°ì§€ìˆ˜' },
                { id: 'stat_retail', name: 'í†µê³„í‘œ-ì†Œë§¤íŒë§¤ì•¡ì§€ìˆ˜', icon: 'ğŸ›’', description: 'ì†Œë§¤íŒë§¤ì•¡ì§€ìˆ˜' },
                { id: 'stat_construction', name: 'í†µê³„í‘œ-ê±´ì„¤ìˆ˜ì£¼ì•¡', icon: 'ğŸ—ï¸', description: 'ê±´ì„¤ìˆ˜ì£¼ì•¡' },
                { id: 'stat_employment', name: 'í†µê³„í‘œ-ê³ ìš©ë¥ ', icon: 'ğŸ‘”', description: 'ê³ ìš©ë¥ ' },
                { id: 'stat_unemployment', name: 'í†µê³„í‘œ-ì‹¤ì—…ë¥ ', icon: 'ğŸ“‰', description: 'ì‹¤ì—…ë¥ ' },
                { id: 'stat_population', name: 'í†µê³„í‘œ-êµ­ë‚´ì¸êµ¬ì´ë™', icon: 'ğŸ‘¥', description: 'êµ­ë‚´ì¸êµ¬ì´ë™' },
                { id: 'stat_export', name: 'í†µê³„í‘œ-ìˆ˜ì¶œì•¡', icon: 'ğŸ“¦', description: 'ìˆ˜ì¶œì•¡' },
                { id: 'stat_import', name: 'í†µê³„í‘œ-ìˆ˜ì…ì•¡', icon: 'ğŸš¢', description: 'ìˆ˜ì…ì•¡' },
                { id: 'stat_price', name: 'í†µê³„í‘œ-ì†Œë¹„ìë¬¼ê°€ì§€ìˆ˜', icon: 'ğŸ’°', description: 'ì†Œë¹„ìë¬¼ê°€ì§€ìˆ˜' },
                { id: 'stat_grdp', name: 'í†µê³„í‘œ-ì°¸ê³ -GRDP', icon: 'ğŸ“Š', description: 'GRDP ì°¸ê³ ' },
                { id: 'stat_appendix', name: 'ë¶€ë¡-ì£¼ìš”ìš©ì–´ì •ì˜', icon: 'ğŸ“–', description: 'ì£¼ìš” ìš©ì–´ ì •ì˜' }
            ],
            // ìºì‹œëœ HTML
            cachedHtml: {
                summary: {},
                sectoral: {},
                regional: {},
                statistics: {}
            },
            generatedReports: {
                summary: new Set(),
                sectoral: new Set(),
                regional: new Set(),
                statistics: new Set()
            },
            reviewedReports: {
                summary: new Set(),
                sectoral: new Set(),
                regional: new Set(),
                statistics: new Set()
            },
            editedReports: {
                summary: new Set(),
                sectoral: new Set(),
                regional: new Set(),
                statistics: new Set()
            },
            htmlCache: {},  // ìµœì¢… ë¬¸ì„œ ìƒì„±ìš© ìºì‹œ
            currentTab: 'summary',
            currentSummaryIndex: -1,
            currentRegionalIndex: -1,
            currentStatisticsIndex: -1,
            // ìƒì„± í†µê³„
            generationStats: {
                total: 0,
                completed: 0,
                startTime: null
            },
            // ë‹´ë‹¹ì ì •ë³´
            contactInfo: {
                release_datetime: '2025. 8. 12.(í™”) 12:00',
                distribution_datetime: '2025. 8. 12.(í™”) 08:30',
                department: 'êµ­ê°€ë°ì´í„°ì²˜ ê²½ì œí†µê³„êµ­',
                division: 'ì†Œë“í†µê³„ê³¼',
                manager_title: 'ê³¼ ì¥',
                manager_name: 'ì •ì„ ê²½',
                manager_phone: '042-481-2206',
                staff_title: 'ì‚¬ë¬´ê´€',
                staff_name: 'ìœ¤ë¯¼í¬',
                staff_phone: '042-481-2226',
                customs_department: 'ê´€ì„¸ì²­ ì •ë³´ë°ì´í„°ê¸°íšë‹´ë‹¹ê´€',
                customs_phone: '042-481-7845'
            },
            // ê°€ì¤‘ì¹˜ ì„¤ì •
            weightSettings: {
                mining: {
                    mode: 'auto',  // 'auto', 'manual', 'empty'
                    values: [],    // ìˆ˜ë™ ì…ë ¥ ì‹œ ê°€ì¤‘ì¹˜ ë°°ì—´
                    rows: [],      // í–‰ë³„ ë°ì´í„° [{row, name, weight}]
                    default_value: 1  // ë¹„ê³µê°œ ê°€ì¤‘ì¹˜(0) ëŒ€ì²´ ê¸°ë³¸ê°’
                },
                service: {
                    mode: 'auto',
                    values: [],
                    rows: [],
                    default_value: 1  // ë¹„ê³µê°œ ê°€ì¤‘ì¹˜(0) ëŒ€ì²´ ê¸°ë³¸ê°’
                }
            }
        };

        // DOM Elements
        const elements = {
            uploadZone: document.getElementById('uploadZone'),
            fileInput: document.getElementById('fileInput'),
            uploadFilename: document.getElementById('uploadFilename'),
            allReportsList: document.getElementById('allReportsList'),
            reportCountBadge: document.getElementById('reportCountBadge'),
            // ê¸°ì¡´ í˜¸í™˜ì„± ìœ ì§€ (ë”ë¯¸)
            summaryReportList: { innerHTML: '', style: { display: 'flex' } },
            reportList: { innerHTML: '', style: { display: 'flex' } },
            regionalReportList: { innerHTML: '', style: { display: 'flex' } },
            statisticsReportList: { innerHTML: '', style: { display: 'flex' } },
            tabSummary: null,
            tabSectoral: null,
            tabRegional: null,
            tabStatistics: null,
            yearSelect: document.getElementById('yearSelect'),
            quarterSelect: document.getElementById('quarterSelect'),
            prevBtn: document.getElementById('prevBtn'),
            nextBtn: document.getElementById('nextBtn'),
            pageIndicator: document.getElementById('pageIndicator'),
            exportBtn: document.getElementById('exportBtn'),
            exportHwpBtn: document.getElementById('exportHwpBtn'),
            previewTitle: document.getElementById('previewTitle'),
            previewPlaceholder: document.getElementById('previewPlaceholder'),
            previewIframe: document.getElementById('previewIframe'),
            editContainer: document.getElementById('editContainer'),
            editContent: document.getElementById('editContent'),
            editBtn: document.getElementById('editBtn'),
            saveEditBtn: document.getElementById('saveEditBtn'),
            cancelEditBtn: document.getElementById('cancelEditBtn'),
            markReviewedBtn: document.getElementById('markReviewedBtn'),
            contactInfoModal: document.getElementById('contactInfoModal'),
            loadingOverlay: document.getElementById('loadingOverlay'),
            loadingTitle: document.getElementById('loadingTitle'),
            loadingSubtitle: document.getElementById('loadingSubtitle'),
            loadingIcon: document.getElementById('loadingIcon'),
            loadingProgressFill: document.getElementById('loadingProgressFill'),
            loadingProgressText: document.getElementById('loadingProgressText'),
            loadingProgressPercent: document.getElementById('loadingProgressPercent'),
            loadingCurrentIcon: document.getElementById('loadingCurrentIcon'),
            loadingCurrentText: document.getElementById('loadingCurrentText'),
            elapsedTime: document.getElementById('elapsedTime'),
            generationStatus: document.getElementById('generationStatus'),
            generationStatusCount: document.getElementById('generationStatusCount'),
            generationMiniFill: document.getElementById('generationMiniFill'),
            toastContainer: document.getElementById('toastContainer')
        };

        let timerInterval = null;
        let isEditMode = false;
        let originalHtmlBeforeEdit = null;
        let currentEditingReport = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', initApp);

        function initApp() {
            setupEventListeners();
            loadReportList();
        }

        function setupEventListeners() {
            // File upload
            elements.uploadZone.addEventListener('click', () => elements.fileInput.click());
            elements.fileInput.addEventListener('change', handleFileSelect);
            elements.uploadZone.addEventListener('dragover', handleDragOver);
            elements.uploadZone.addEventListener('dragleave', handleDragLeave);
            elements.uploadZone.addEventListener('drop', handleDrop);

            // Navigation
            elements.prevBtn.addEventListener('click', () => navigateReport(-1));
            elements.nextBtn.addEventListener('click', () => navigateReport(1));

            // Actions
            elements.markReviewedBtn.addEventListener('click', markCurrentAsReviewed);
            elements.exportBtn.addEventListener('click', exportFinalDocument);
            elements.exportHwpBtn.addEventListener('click', exportHwpReadyDocument);
            
            // Edit actions
            elements.editBtn.addEventListener('click', enterEditMode);
            elements.saveEditBtn.addEventListener('click', saveEditedContent);
            elements.cancelEditBtn.addEventListener('click', cancelEditMode);
        }

        function loadReportList() {
            fetch('/api/report-order')
                .then(res => res.json())
                .then(data => {
                    state.reports = data.reports;
                    state.summaryReports = data.reports.filter(r => r.category === 'summary');
                    state.sectoralReports = data.reports.filter(r => r.category !== 'summary');
                    state.regionalReports = data.regional_reports || [];
                    
                    // ì´ ë³´ê³ ì„œ ìˆ˜ ê³„ì‚°
                    state.generationStats.total = 
                        state.summaryReports.length + 
                        state.sectoralReports.length + 
                        state.regionalReports.length + 
                        state.statisticsReports.length;
                    
                    // ì „ì²´ ë³´ê³ ì„œ ë°°ì—´ ì´ˆê¸°í™” ë° ë Œë”ë§
                    initializeAllReports();
                    renderAllReportsList();
                })
                .catch(err => {
                    console.error('ë³´ê³ ì„œ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', err);
                    showToast('ë³´ê³ ì„œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                });
        }

        // ===== ë‹´ë‹¹ì ì •ë³´ ëª¨ë‹¬ í•¨ìˆ˜ =====
        function openContactModal() {
            document.getElementById('releaseDateTime').value = state.contactInfo.release_datetime;
            document.getElementById('distributionDateTime').value = state.contactInfo.distribution_datetime;
            document.getElementById('department').value = state.contactInfo.department;
            document.getElementById('division').value = state.contactInfo.division;
            document.getElementById('managerTitle').value = state.contactInfo.manager_title;
            document.getElementById('managerName').value = state.contactInfo.manager_name;
            document.getElementById('managerPhone').value = state.contactInfo.manager_phone;
            document.getElementById('staffTitle').value = state.contactInfo.staff_title;
            document.getElementById('staffName').value = state.contactInfo.staff_name;
            document.getElementById('staffPhone').value = state.contactInfo.staff_phone;
            document.getElementById('customsDepartment').value = state.contactInfo.customs_department || 'ê´€ì„¸ì²­ ì •ë³´ë°ì´í„°ê¸°íšë‹´ë‹¹ê´€';
            document.getElementById('customsPhone').value = state.contactInfo.customs_phone || '042-481-7845';
            
            elements.contactInfoModal.classList.add('active');
        }

        function closeContactModal() {
            elements.contactInfoModal.classList.remove('active');
        }

        function saveContactInfo() {
            state.contactInfo = {
                release_datetime: document.getElementById('releaseDateTime').value,
                distribution_datetime: document.getElementById('distributionDateTime').value,
                department: document.getElementById('department').value,
                division: document.getElementById('division').value,
                manager_title: document.getElementById('managerTitle').value,
                manager_name: document.getElementById('managerName').value,
                manager_phone: document.getElementById('managerPhone').value,
                staff_title: document.getElementById('staffTitle').value,
                staff_name: document.getElementById('staffName').value,
                staff_phone: document.getElementById('staffPhone').value,
                customs_department: document.getElementById('customsDepartment').value,
                customs_phone: document.getElementById('customsPhone').value
            };
            
            closeContactModal();
            showToast('ë‹´ë‹¹ì ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // ===== ê°€ì¤‘ì¹˜ ì„¤ì • ëª¨ë‹¬ í•¨ìˆ˜ =====
        function openWeightSettingsModal() {
            // í˜„ì¬ ì„¤ì •ê°’ ë¡œë“œ
            document.getElementById('miningWeightMode').value = state.weightSettings.mining.mode;
            document.getElementById('serviceWeightMode').value = state.weightSettings.service.mode;
            
            // ê¸°ë³¸ê°’ ë¡œë“œ
            document.getElementById('miningDefaultWeight').value = state.weightSettings.mining.default_value || 1;
            document.getElementById('serviceDefaultWeight').value = state.weightSettings.service.default_value || 1;
            
            // í–‰ë³„ ì…ë ¥ ì˜ì—­ ì´ˆê¸°í™” ë° ë Œë”ë§
            renderWeightRows('mining');
            renderWeightRows('service');
            
            // ìˆ˜ë™ ì…ë ¥ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
            toggleWeightInput('mining');
            toggleWeightInput('service');
            
            document.getElementById('weightSettingsModal').classList.add('active');
        }
        
        function closeWeightSettingsModal() {
            document.getElementById('weightSettingsModal').classList.remove('active');
        }
        
        function toggleWeightInput(type) {
            const mode = document.getElementById(`${type}WeightMode`).value;
            const container = document.getElementById(`${type}WeightInputContainer`);
            
            if (mode === 'manual') {
                container.style.display = 'block';
                // ì•„ì§ í–‰ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ í–‰ ì¶”ê°€
                const rowsContainer = document.getElementById(`${type}WeightRows`);
                if (rowsContainer.querySelectorAll('.weight-row').length === 0) {
                    addWeightRows(type, 10); // ê¸°ë³¸ 10í–‰ ì¶”ê°€
                }
            } else {
                container.style.display = 'none';
            }
        }
        
        function renderWeightRows(type) {
            const container = document.getElementById(`${type}WeightRows`);
            const rows = state.weightSettings[type].rows || [];
            
            // í—¤ë” ìœ ì§€, ê¸°ì¡´ í–‰ ì œê±°
            const header = container.querySelector('div:first-child');
            container.innerHTML = '';
            container.appendChild(header);
            
            if (rows.length > 0) {
                rows.forEach((row, index) => {
                    addWeightRowElement(container, index + 1, row.name || '', row.weight || '');
                });
            }
        }
        
        function addWeightRowElement(container, rowNum, industryName, weight) {
            const row = document.createElement('div');
            row.className = 'weight-row';
            row.style.cssText = 'display: grid; grid-template-columns: 80px 1fr 100px; gap: 0.5rem; padding: 0.4rem 0.75rem; border-bottom: 1px solid var(--border); align-items: center;';
            row.innerHTML = `
                <span style="font-size: 0.8rem; color: var(--text-muted);">${rowNum}</span>
                <input type="text" class="weight-industry-name" value="${industryName}" 
                       style="padding: 0.3rem 0.5rem; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-size: 0.8rem;"
                       placeholder="ì—…ì¢…ëª…">
                <input type="number" step="0.1" class="weight-value" value="${weight}" 
                       style="padding: 0.3rem 0.5rem; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-size: 0.8rem; text-align: right;"
                       placeholder="ê°€ì¤‘ì¹˜">
            `;
            container.appendChild(row);
        }
        
        function addWeightRows(type, count = 5) {
            const container = document.getElementById(`${type}WeightRows`);
            const existingRows = container.querySelectorAll('.weight-row').length;
            
            for (let i = 0; i < count; i++) {
                addWeightRowElement(container, existingRows + i + 1, '', '');
            }
        }
        
        async function loadMiningIndustries() {
            await loadIndustriesFromExcel('mining', 'ê´‘ê³µì—…ìƒì‚°');
        }
        
        async function loadServiceIndustries() {
            await loadIndustriesFromExcel('service', 'ì„œë¹„ìŠ¤ì—…ìƒì‚°');
        }
        
        async function loadIndustriesFromExcel(type, sheetType) {
            try {
                const response = await fetch(`/api/get-industry-weights?sheet_type=${sheetType}`);
                const result = await response.json();
                
                if (result.success && result.industries) {
                    const container = document.getElementById(`${type}WeightRows`);
                    const header = container.querySelector('div:first-child');
                    container.innerHTML = '';
                    container.appendChild(header);
                    
                    result.industries.forEach((item, index) => {
                        addWeightRowElement(container, index + 1, item.name || '', item.weight || '');
                    });
                    
                    showToast(`${result.industries.length}ê°œ ì—…ì¢… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
                } else {
                    showToast(result.error || 'ì—…ì¢… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    // ê¸°ë³¸ í–‰ ì¶”ê°€
                    addWeightRows(type, 10);
                }
            } catch (err) {
                console.error('ì—…ì¢… ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', err);
                showToast('ì—…ì¢… ì •ë³´ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                addWeightRows(type, 10);
            }
        }
        
        function collectWeightRows(type) {
            const container = document.getElementById(`${type}WeightRows`);
            const rows = container.querySelectorAll('.weight-row');
            const result = [];
            
            rows.forEach((row, index) => {
                const nameInput = row.querySelector('.weight-industry-name');
                const weightInput = row.querySelector('.weight-value');
                
                if (nameInput && weightInput) {
                    const name = nameInput.value.trim();
                    const weight = weightInput.value.trim();
                    result.push({
                        row: index + 1,
                        name: name,
                        weight: weight ? parseFloat(weight) : null
                    });
                }
            });
            
            return result;
        }
        
        function saveWeightSettings() {
            // ê´‘ê³µì—…ìƒì‚° ì„¤ì •
            const miningMode = document.getElementById('miningWeightMode').value;
            const miningRows = miningMode === 'manual' ? collectWeightRows('mining') : [];
            const miningDefaultValue = parseFloat(document.getElementById('miningDefaultWeight').value) || 1;
            
            // ì„œë¹„ìŠ¤ì—…ìƒì‚° ì„¤ì •
            const serviceMode = document.getElementById('serviceWeightMode').value;
            const serviceRows = serviceMode === 'manual' ? collectWeightRows('service') : [];
            const serviceDefaultValue = parseFloat(document.getElementById('serviceDefaultWeight').value) || 1;
            
            state.weightSettings = {
                mining: {
                    mode: miningMode,
                    rows: miningRows,
                    values: miningRows.filter(r => r.weight !== null).map(r => r.weight),
                    default_value: miningDefaultValue
                },
                service: {
                    mode: serviceMode,
                    rows: serviceRows,
                    values: serviceRows.filter(r => r.weight !== null).map(r => r.weight),
                    default_value: serviceDefaultValue
                }
            };
            
            closeWeightSettingsModal();
            showToast('ê°€ì¤‘ì¹˜ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // Tab switching
        function switchTab(tab) {
            state.currentTab = tab;
            
            elements.tabSummary.classList.toggle('active', tab === 'summary');
            elements.tabSectoral.classList.toggle('active', tab === 'sectoral');
            elements.tabRegional.classList.toggle('active', tab === 'regional');
            elements.tabStatistics.classList.toggle('active', tab === 'statistics');
            
            elements.summaryReportList.style.display = tab === 'summary' ? 'flex' : 'none';
            elements.reportList.style.display = tab === 'sectoral' ? 'flex' : 'none';
            elements.regionalReportList.style.display = tab === 'regional' ? 'flex' : 'none';
            elements.statisticsReportList.style.display = tab === 'statistics' ? 'flex' : 'none';
            
            updatePageIndicator();
            updateNavigationButtons();
        }

        // ===== ë¯¸ë¦¬ë³´ê¸° ìƒì„± =====
        async function generateAllReports() {
            if (!state.fileUploaded) {
                showToast('ë¨¼ì € ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.', 'warning');
                return;
            }

            // ì´ˆê¸°í™”
            state.generationStats.completed = 0;
            state.generationStats.startTime = Date.now();
            
            showLoadingProgress();
            startTimer();

            const allItems = [
                ...state.summaryReports.map(r => ({ type: 'summary', report: r })),
                ...state.sectoralReports.map(r => ({ type: 'sectoral', report: r })),
                ...state.regionalReports.map(r => ({ type: 'regional', report: r })),
                ...state.statisticsReports.map(r => ({ type: 'statistics', report: r }))
            ];

            for (let i = 0; i < allItems.length; i++) {
                const item = allItems[i];
                const progress = ((i + 1) / allItems.length) * 100;
                
                // í˜„ì¬ í•­ëª© í‘œì‹œ
                updateLoadingProgress(i + 1, allItems.length, item.report.icon || 'ğŸ“„', item.report.name);
                
                try {
                    await generateSingleReport(item.type, item.report);
                    state.generationStats.completed++;
                } catch (err) {
                    console.error(`${item.report.name} ìƒì„± ì˜¤ë¥˜:`, err);
                }
            }

            stopTimer();
            hideLoading();
            
            // ìƒì„± ì™„ë£Œ ìƒíƒœ í‘œì‹œ
            state.allGenerated = true;
            showGenerationStatus();
            
            // ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ í‘œì‹œ
            elements.exportBtn.style.display = 'inline-flex';
            elements.exportHwpBtn.style.display = 'inline-flex';
            
            // ì „ì²´ ë³´ê³ ì„œ ë°°ì—´ ì´ˆê¸°í™” ë° ë Œë”ë§
            initializeAllReports();
            renderAllReportsList();
            
            // ì²« ë²ˆì§¸ ë³´ê³ ì„œ ìë™ ì„ íƒ
            if (state.allReports.length > 0) {
                selectGlobalReport(0);
            }
            
            showToast(`âœ… ì „ì²´ ${state.generationStats.completed}ê°œ ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ!`, 'success');
        }

        async function generateSingleReport(type, report) {
            const year = parseInt(elements.yearSelect.value);
            const quarter = parseInt(elements.quarterSelect.value);
            
            let endpoint, body;
            
            switch (type) {
                case 'summary':
                    endpoint = '/api/generate-summary-preview';
                    body = {
                        report_id: report.id,
                        year, quarter,
                        contact_info: state.contactInfo
                    };
                    break;
                case 'sectoral':
                    endpoint = '/api/generate-preview';
                    body = { report_id: report.id, year, quarter };
                    break;
                case 'regional':
                    endpoint = '/api/generate-regional-preview';
                    body = { region_id: report.id };
                    break;
                case 'statistics':
                    endpoint = '/api/generate-statistics-preview';
                    body = { stat_id: report.id, year, quarter };
                    break;
            }

            const response = await fetch(endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });

            const data = await response.json();

            if (data.success) {
                // HTML ìºì‹±
                state.cachedHtml[type][report.id] = data.html;
                state.htmlCache[`${type}_${report.id}`] = data.html;  // ìµœì¢… ë¬¸ì„œìš© ìºì‹œ
                state.generatedReports[type].add(report.id);
            }
            
            return data;
        }

        // ===== ë¡œë”© ì§„í–‰ë¥  í‘œì‹œ =====
        function showLoadingProgress() {
            elements.loadingOverlay.classList.add('active');
        }

        function updateLoadingProgress(current, total, icon, name) {
            const percent = Math.round((current / total) * 100);
            
            elements.loadingProgressFill.style.width = `${percent}%`;
            elements.loadingProgressText.textContent = `${current} / ${total}`;
            elements.loadingProgressPercent.textContent = `${percent}%`;
            elements.loadingCurrentIcon.textContent = icon;
            elements.loadingCurrentText.textContent = name;
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - state.generationStats.startTime;
                const elapsedSec = Math.floor(elapsed / 1000);
                const elapsedMin = Math.floor(elapsedSec / 60);
                const elapsedSecRemainder = elapsedSec % 60;
                
                elements.elapsedTime.textContent = 
                    `${String(elapsedMin).padStart(2, '0')}:${String(elapsedSecRemainder).padStart(2, '0')}`;
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function hideLoading() {
            elements.loadingOverlay.classList.remove('active');
        }

        function showGenerationStatus() {
            const total = state.generationStats.total;
            const completed = state.generationStats.completed;
            
            elements.generationStatus.classList.add('active');
            elements.generationStatusCount.textContent = `${completed}/${total}`;
            elements.generationMiniFill.style.width = `${(completed / total) * 100}%`;
        }

        // ===== ë³´ê³ ì„œ ì„ íƒ (ìºì‹œì—ì„œ í‘œì‹œ) =====
        function selectSummaryReport(index) {
            // globalIndexë¡œ ë³€í™˜í•˜ì—¬ í˜¸ì¶œ
            const globalIndex = state.allReports.findIndex(r => r.type === 'summary' && r.originalIndex === index);
            if (globalIndex >= 0) {
                selectGlobalReport(globalIndex);
            }
        }

        function selectReport(index) {
            // globalIndexë¡œ ë³€í™˜í•˜ì—¬ í˜¸ì¶œ
            const globalIndex = state.allReports.findIndex(r => r.type === 'sectoral' && r.originalIndex === index);
            if (globalIndex >= 0) {
                selectGlobalReport(globalIndex);
            }
        }

        function selectRegionalReport(index) {
            // globalIndexë¡œ ë³€í™˜í•˜ì—¬ í˜¸ì¶œ
            const globalIndex = state.allReports.findIndex(r => r.type === 'regional' && r.originalIndex === index);
            if (globalIndex >= 0) {
                selectGlobalReport(globalIndex);
            }
        }

        function selectStatisticsReport(index) {
            // globalIndexë¡œ ë³€í™˜í•˜ì—¬ í˜¸ì¶œ
            const globalIndex = state.allReports.findIndex(r => r.type === 'statistics' && r.originalIndex === index);
            if (globalIndex >= 0) {
                selectGlobalReport(globalIndex);
            }
        }

        function displayCachedReport(type, report) {
            const html = state.cachedHtml[type][report.id];
            
            if (html) {
                // í¸ì§‘ ëª¨ë“œ ì¢…ë£Œ
                if (isEditMode) {
                    exitEditMode();
                }
                
                elements.previewPlaceholder.style.display = 'none';
                elements.editContainer.style.display = 'none';
                elements.previewIframe.style.display = 'block';
                elements.previewIframe.srcdoc = html;
                elements.previewTitle.innerHTML = `<span>${report.icon || 'ğŸ“„'}</span><span>${report.name}</span>`;
                
                // í¸ì§‘/ê²€í†  ë²„íŠ¼ í‘œì‹œ
                elements.editBtn.style.display = 'inline-flex';
                elements.saveEditBtn.style.display = 'none';
                elements.cancelEditBtn.style.display = 'none';
                elements.markReviewedBtn.style.display = 'block';
            } else {
                showToast('ë³´ê³ ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ===== ë Œë”ë§ í•¨ìˆ˜ë“¤ =====
        // ì „ì²´ ë³´ê³ ì„œ í†µí•© ë°°ì—´ ì´ˆê¸°í™”
        function initializeAllReports() {
            state.allReports = [
                ...state.summaryReports.map((r, idx) => ({ ...r, type: 'summary', originalIndex: idx })),
                ...state.sectoralReports.map((r, idx) => ({ ...r, type: 'sectoral', originalIndex: idx })),
                ...state.regionalReports.map((r, idx) => ({ ...r, type: 'regional', originalIndex: idx, name: `${r.index}. ${r.name}`, sheet: r.full_name })),
                ...state.statisticsReports.map((r, idx) => ({ ...r, type: 'statistics', originalIndex: idx, sheet: r.description }))
            ];
            if (elements.reportCountBadge) {
                elements.reportCountBadge.textContent = `(ì´ ${state.allReports.length}ê°œ)`;
            }
        }

        // ì „ì²´ ë³´ê³ ì„œ í†µí•© ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderAllReportsList() {
            if (!elements.allReportsList) return;
            
            let currentSection = '';
            let html = '';
            
            state.allReports.forEach((report, globalIdx) => {
                // ì„¹ì…˜ í—¤ë” ì¶”ê°€
                const sectionNames = { summary: 'ğŸ“‹ ìš”ì•½', sectoral: 'ğŸ“Š ë¶€ë¬¸ë³„', regional: 'ğŸ—ºï¸ ì‹œë„ë³„', statistics: 'ğŸ“ˆ í†µê³„í‘œ' };
                if (report.type !== currentSection) {
                    currentSection = report.type;
                    html += `<div style="font-size: 0.75rem; color: var(--accent-primary); padding: 0.5rem 0.75rem; margin-top: ${globalIdx > 0 ? '0.5rem' : '0'}; background: rgba(99, 102, 241, 0.1); border-radius: 4px;">${sectionNames[report.type]}</div>`;
                }
                
                const isActive = globalIdx === state.currentGlobalIndex;
                const isGenerated = state.generatedReports[report.type].has(report.id);
                const isReviewed = state.reviewedReports[report.type].has(report.id);
                const isEdited = state.editedReports[report.type].has(report.id);
                
                let statusClass = 'pending';
                let statusIcon = 'â—‹';
                if (isReviewed) {
                    statusClass = 'reviewed';
                    statusIcon = 'âœ“';
                } else if (isEdited) {
                    statusClass = 'edited';
                    statusIcon = 'âœï¸';
                } else if (isGenerated) {
                    statusClass = 'generated';
                    statusIcon = 'â—';
                }

                html += `
                    <div class="report-item ${isActive ? 'active' : ''} ${isGenerated ? 'generated' : ''} ${isReviewed ? 'reviewed' : ''} ${isEdited ? 'edited' : ''}"
                         onclick="selectGlobalReport(${globalIdx})"
                         data-report-id="${report.id}"
                         data-global-index="${globalIdx}">
                        <div class="report-icon">${report.icon}</div>
                        <div class="report-info">
                            <div class="report-name">${report.name}</div>
                            <div class="report-sheet">${report.sheet || 'ìš”ì•½ í˜ì´ì§€'}</div>
                        </div>
                        <div class="report-status ${statusClass}">${statusIcon}</div>
                    </div>
                `;
            });
            
            elements.allReportsList.innerHTML = html;
            
            // í˜„ì¬ ì„ íƒëœ í•­ëª©ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            if (state.currentGlobalIndex >= 0) {
                const activeItem = elements.allReportsList.querySelector(`[data-global-index="${state.currentGlobalIndex}"]`);
                if (activeItem) {
                    activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }

        // ì „ì²´ ë³´ê³ ì„œ ì„ íƒ í•¨ìˆ˜
        function selectGlobalReport(globalIndex) {
            if (!state.allGenerated) {
                showToast('ë³´ê³ ì„œ ìƒì„± ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.', 'info');
                return;
            }
            
            if (globalIndex < 0 || globalIndex >= state.allReports.length) return;
            
            state.currentGlobalIndex = globalIndex;
            const report = state.allReports[globalIndex];
            
            // ê¸°ì¡´ ì¸ë±ìŠ¤ë„ ë™ê¸°í™”
            state.currentSummaryIndex = report.type === 'summary' ? report.originalIndex : -1;
            state.currentReportIndex = report.type === 'sectoral' ? report.originalIndex : -1;
            state.currentRegionalIndex = report.type === 'regional' ? report.originalIndex : -1;
            state.currentStatisticsIndex = report.type === 'statistics' ? report.originalIndex : -1;
            state.currentTab = report.type;
            
            displayCachedReport(report.type, report);
            renderAllReportsList();
            updateNavigationButtons();
            updatePageIndicator();
        }

        // ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•œ í•¨ìˆ˜ë“¤ (ë‚´ë¶€ì ìœ¼ë¡œ globalIndex ì‚¬ìš©)
        function renderSummaryReportList() { renderAllReportsList(); }
        function renderReportList() { renderAllReportsList(); }
        function renderRegionalReportList() { renderAllReportsList(); }
        function renderStatisticsReportList() { renderAllReportsList(); }

        // ===== ë„¤ë¹„ê²Œì´ì…˜ =====
        function navigateReport(direction) {
            const newIndex = state.currentGlobalIndex + direction;
            if (newIndex >= 0 && newIndex < state.allReports.length) {
                selectGlobalReport(newIndex);
            }
        }

        function updateNavigationButtons() {
            elements.prevBtn.disabled = state.currentGlobalIndex <= 0;
            elements.nextBtn.disabled = state.currentGlobalIndex >= state.allReports.length - 1;
        }

        function updatePageIndicator() {
            const current = state.currentGlobalIndex + 1;
            const total = state.allReports.length;
            elements.pageIndicator.textContent = `${current > 0 ? current : 0} / ${total}`;
        }

        // ===== ê²€í†  ì™„ë£Œ =====
        function markCurrentAsReviewed() {
            if (state.currentGlobalIndex < 0 || state.currentGlobalIndex >= state.allReports.length) {
                return;
            }
            
            const report = state.allReports[state.currentGlobalIndex];
            state.reviewedReports[report.type].add(report.id);
            renderAllReportsList();
            
            showToast(`${report.name} ê²€í†  ì™„ë£Œ`, 'success');
            navigateReport(1); // ë‹¤ìŒìœ¼ë¡œ ìë™ ì´ë™
        }

        // ===== íŒŒì¼ ì—…ë¡œë“œ =====
        function handleDragOver(e) {
            e.preventDefault();
            elements.uploadZone.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            elements.uploadZone.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            elements.uploadZone.classList.remove('dragover');
            
            const file = e.dataTransfer.files[0];
            if (file) uploadFile(file);
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) uploadFile(file);
        }

        // ì—…ë¡œë“œ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜
        function showUploadModal() {
            const modal = document.getElementById('uploadModal');
            modal.classList.add('active');
            
            // ì´ˆê¸°í™”
            document.getElementById('uploadModalIcon').textContent = 'ğŸ“¤';
            document.getElementById('uploadModalTitle').textContent = 'íŒŒì¼ ì—…ë¡œë“œ ì¤‘';
            document.getElementById('uploadModalSubtitle').textContent = 'íŒŒì¼ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
            document.getElementById('uploadProgressFill').style.width = '0%';
            document.getElementById('uploadResult').style.display = 'none';
            
            // ëª¨ë“  ìŠ¤í… ì´ˆê¸°í™”
            ['uploadStep1', 'uploadStep2', 'uploadStep3', 'uploadStep4'].forEach(id => {
                const step = document.getElementById(id);
                step.className = 'upload-step';
                step.querySelector('.step-icon').textContent = 'â³';
                step.querySelector('.step-status').textContent = '';
            });
        }
        
        function updateUploadStep(stepNum, status, statusText = '') {
            const step = document.getElementById(`uploadStep${stepNum}`);
            const icon = step.querySelector('.step-icon');
            const statusEl = step.querySelector('.step-status');
            
            step.className = 'upload-step';
            
            if (status === 'active') {
                step.classList.add('active');
                icon.textContent = 'ğŸ”„';
                statusEl.textContent = 'ì§„í–‰ ì¤‘...';
            } else if (status === 'completed') {
                step.classList.add('completed');
                icon.textContent = 'âœ…';
                statusEl.textContent = statusText || 'ì™„ë£Œ';
            } else if (status === 'skipped') {
                step.classList.add('skipped');
                icon.textContent = 'â­ï¸';
                statusEl.textContent = 'ê±´ë„ˆëœ€';
            } else if (status === 'error') {
                step.classList.add('error');
                icon.textContent = 'âŒ';
                statusEl.textContent = statusText || 'ì‹¤íŒ¨';
            }
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            const progress = (stepNum / 4) * 100;
            document.getElementById('uploadProgressFill').style.width = `${progress}%`;
        }
        
        function hideUploadModal(delay = 0) {
            setTimeout(() => {
                document.getElementById('uploadModal').classList.remove('active');
            }, delay);
        }

        async function uploadFile(file) {
            if (!file.name.endsWith('.xlsx') && !file.name.endsWith('.xls')) {
                showToast('ì—‘ì…€ íŒŒì¼(.xlsx, .xls)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            // ì—…ë¡œë“œ ëª¨ë‹¬ í‘œì‹œ
            showUploadModal();
            
            // Step 1: íŒŒì¼ ì—…ë¡œë“œ
            updateUploadStep(1, 'active');
            
            const formData = new FormData();
            formData.append('file', file);

            try {
                // Step 1 ì™„ë£Œ
                await new Promise(r => setTimeout(r, 300));
                updateUploadStep(1, 'completed', file.name);
                
                // Step 2: íŒŒì¼ ìœ í˜• ë¶„ì„
                updateUploadStep(2, 'active');
                document.getElementById('uploadModalSubtitle').textContent = 'íŒŒì¼ ìœ í˜•ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
                
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    // Step 2 ì™„ë£Œ
                    const fileTypeText = 'ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œ';
                    updateUploadStep(2, 'completed', fileTypeText);
                    
                    // Step 3: ë¶„ì„í‘œ ë³€í™˜
                    if (data.file_type === 'raw' && data.conversion_info) {
                        updateUploadStep(3, 'active');
                        document.getElementById('uploadModalSubtitle').textContent = 'ë¶„ì„í‘œë¡œ ë³€í™˜í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
                        await new Promise(r => setTimeout(r, 500));
                        updateUploadStep(3, 'completed', data.conversion_info.analysis_file);
                        
                        // Step 4: GRDP ì¶”ì¶œ
                        if (data.conversion_info.grdp_extracted) {
                            updateUploadStep(4, 'active');
                            document.getElementById('uploadModalSubtitle').textContent = 'GRDP ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤...';
                            await new Promise(r => setTimeout(r, 500));
                            updateUploadStep(4, 'completed', `ì „êµ­ ${data.conversion_info.national_growth_rate}%`);
                        } else {
                            updateUploadStep(4, 'skipped');
                        }
                    } else {
                        // ë¶„ì„í‘œì¸ ê²½ìš° Step 3, 4 ê±´ë„ˆëœ€
                        updateUploadStep(3, 'skipped');
                        updateUploadStep(4, 'skipped');
                    }
                    
                    // ì™„ë£Œ ìƒíƒœ í‘œì‹œ
                    document.getElementById('uploadModalIcon').textContent = 'âœ…';
                    document.getElementById('uploadModalTitle').textContent = 'ì—…ë¡œë“œ ì™„ë£Œ!';
                    document.getElementById('uploadModalSubtitle').textContent = 'íŒŒì¼ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
                    document.getElementById('uploadProgressFill').style.width = '100%';
                    
                    // ê²°ê³¼ í‘œì‹œ
                    const resultDiv = document.getElementById('uploadResult');
                    resultDiv.style.display = 'block';
                    document.getElementById('resultPeriod').textContent = `${data.year}ë…„ ${data.quarter}ë¶„ê¸°`;
                    
                    if (data.conversion_info && data.conversion_info.grdp_extracted) {
                        document.getElementById('resultGrdp').textContent = 
                            `${data.conversion_info.national_growth_rate}% (1ìœ„: ${data.conversion_info.top_region})`;
                    } else {
                        document.getElementById('resultGrdp').textContent = '-';
                    }
                    
                    // ê¸°ì¡´ UI ì—…ë°ì´íŠ¸
                    state.fileUploaded = true;
                    state.fileType = data.file_type;
                    
                    elements.uploadZone.classList.add('uploaded');
                    elements.uploadFilename.textContent = `âœ“ ${data.filename}`;
                    elements.uploadFilename.style.display = 'block';
                    elements.uploadZone.querySelector('.upload-icon').textContent = 'âœ…';
                    
                    if (data.file_type === 'raw') {
                        elements.uploadZone.querySelector('.upload-text').textContent = 'ê¸°ì´ˆìë£Œ â†’ ë¶„ì„í‘œ ë³€í™˜ ì™„ë£Œ!';
                    } else {
                        elements.uploadZone.querySelector('.upload-text').textContent = 'ë¶„ì„í‘œ ì—…ë¡œë“œ ì™„ë£Œ!';
                    }

                    elements.yearSelect.value = data.year;
                    elements.quarterSelect.value = data.quarter;
                    
                    const periodValue = document.getElementById('periodValue');
                    periodValue.textContent = `${data.year}ë…„ ${data.quarter}ë¶„ê¸°`;
                    periodValue.classList.remove('waiting');
                    
                    // ë³€í™˜ ì •ë³´ í‘œì‹œ
                    const conversionInfo = document.getElementById('conversionInfo');
                    const conversionDetails = document.getElementById('conversionDetails');
                    const grdpInfo = document.getElementById('grdpInfo');
                    
                    const grdpMissing = document.getElementById('grdpMissing');
                    
                    if (data.conversion_info) {
                        conversionInfo.style.display = 'block';
                        conversionDetails.textContent = `ì›ë³¸: ${data.conversion_info.original_file} â†’ ${data.conversion_info.analysis_file}`;
                        
                        if (data.conversion_info.grdp_extracted) {
                            grdpInfo.style.display = 'block';
                            grdpMissing.style.display = 'none';
                            document.getElementById('grdpNational').textContent = `${data.conversion_info.national_growth_rate}%`;
                            document.getElementById('grdpTopRegion').textContent = `${data.conversion_info.top_region} (${data.conversion_info.top_region_growth}%)`;
                            // ëª¨ë‹¬ ë‹«ê¸° (2ì´ˆ í›„) í›„ ìë™ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
                            hideUploadModal(2000);
                            setTimeout(() => {
                                generateAllReports();
                            }, 2100);
                        } else {
                            // GRDP ì¶”ì¶œ ì‹¤íŒ¨ ì‹œ ëª¨ë‹¬ ë‹«ê³  GRDP ëª¨ë‹¬ í‘œì‹œ
                            // GRDP ëª¨ë‹¬ ë‹«íŒ í›„ ìë™ ìƒì„± (saveGrdpDataì—ì„œ ì²˜ë¦¬)
                            grdpInfo.style.display = 'none';
                            grdpMissing.style.display = 'none';
                            hideUploadModal(500);
                            setTimeout(() => {
                                showGrdpModal();
                            }, 600);
                        }
                    } else {
                        conversionInfo.style.display = 'none';
                        grdpMissing.style.display = 'none';
                        // ëª¨ë‹¬ ë‹«ê¸° (2ì´ˆ í›„) í›„ ìë™ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
                        hideUploadModal(2000);
                        setTimeout(() => {
                            generateAllReports();
                        }, 2100);
                    }
                    
                    // ë¶„ì„í‘œ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì— íŒŒì¼ëª… ì €ì¥
                    if (data.conversion_info) {
                        state.analysisFilename = data.conversion_info.analysis_file;
                    }
                } else {
                    // ì˜¤ë¥˜ ë°œìƒ
                    document.getElementById('uploadModalIcon').textContent = 'âŒ';
                    document.getElementById('uploadModalTitle').textContent = 'ì—…ë¡œë“œ ì‹¤íŒ¨';
                    document.getElementById('uploadModalSubtitle').textContent = data.error || 'íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    hideUploadModal(3000);
                    showToast(data.error || 'ì—…ë¡œë“œ ì‹¤íŒ¨', 'error');
                }
            } catch (err) {
                console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', err);
                showToast('íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ===== í¸ì§‘ ëª¨ë“œ í•¨ìˆ˜ë“¤ =====
        function getCurrentReportInfo() {
            // í˜„ì¬ ì„ íƒëœ ë³´ê³ ì„œ ì •ë³´ ë°˜í™˜
            if (state.currentSummaryIndex >= 0) {
                return { type: 'summary', report: state.summaryReports[state.currentSummaryIndex] };
            } else if (state.currentReportIndex >= 0) {
                return { type: 'sectoral', report: state.sectoralReports[state.currentReportIndex] };
            } else if (state.currentRegionalIndex >= 0) {
                return { type: 'regional', report: state.regionalReports[state.currentRegionalIndex] };
            } else if (state.currentStatisticsIndex >= 0) {
                return { type: 'statistics', report: state.statisticsReports[state.currentStatisticsIndex] };
            }
            return null;
        }

        function enterEditMode() {
            const reportInfo = getCurrentReportInfo();
            if (!reportInfo) {
                showToast('í¸ì§‘í•  ë³´ê³ ì„œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.', 'warning');
                return;
            }

            isEditMode = true;
            currentEditingReport = reportInfo;
            
            // í˜„ì¬ iframeì˜ HTML ê°€ì ¸ì˜¤ê¸°
            const iframeDoc = elements.previewIframe.contentDocument || elements.previewIframe.contentWindow.document;
            const bodyContent = iframeDoc.body.innerHTML;
            const headContent = iframeDoc.head.innerHTML;
            
            // ì›ë³¸ ì €ì¥
            originalHtmlBeforeEdit = state.cachedHtml[reportInfo.type][reportInfo.report.id];
            
            // í¸ì§‘ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê¸°
            const editableHtml = makeEditable(bodyContent);
            
            // ìŠ¤íƒ€ì¼ í¬í•¨í•œ ì „ì²´ HTML êµ¬ì„±
            elements.editContent.innerHTML = `
                <style>${extractStyles(headContent)}</style>
                ${editableHtml}
            `;
            
            // UI ì „í™˜
            elements.previewIframe.style.display = 'none';
            elements.editContainer.style.display = 'flex';
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            elements.editBtn.style.display = 'none';
            elements.saveEditBtn.style.display = 'inline-flex';
            elements.cancelEditBtn.style.display = 'inline-flex';
            elements.markReviewedBtn.style.display = 'none';
            
            showToast('í¸ì§‘ ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. í…ìŠ¤íŠ¸ë¥¼ í´ë¦­í•˜ì—¬ ìˆ˜ì •í•˜ì„¸ìš”.', 'info');
        }

        function extractStyles(headHtml) {
            // headì—ì„œ style íƒœê·¸ ì¶”ì¶œ
            const styleMatch = headHtml.match(/<style[^>]*>([\s\S]*?)<\/style>/gi);
            if (styleMatch) {
                return styleMatch.map(s => s.replace(/<\/?style[^>]*>/gi, '')).join('\n');
            }
            return '';
        }

        function makeEditable(html) {
            // DOM íŒŒì‹±
            const parser = new DOMParser();
            const doc = parser.parseFromString(`<div>${html}</div>`, 'text/html');
            const container = doc.body.firstChild;
            
            // í…ìŠ¤íŠ¸ ë…¸ë“œë¥¼ í¬í•¨í•œ ëª¨ë“  ìš”ì†Œì— contenteditable ì¶”ê°€
            const editableSelectors = [
                'p', 'span', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
                'td', 'th', 'li', 'div.value', 'div.text', 'div.title',
                '.summary-text', '.description', '.content', '.data-value',
                '.region-name', '.change-value', '.percent'
            ];
            
            // ëª¨ë“  í…ìŠ¤íŠ¸ í¬í•¨ ìš”ì†Œ ì²˜ë¦¬
            container.querySelectorAll('*').forEach(el => {
                // ì´ë¯¸ì§€, SVG, í…Œì´ë¸” êµ¬ì¡° ë“±ì€ ì œì™¸
                const tagName = el.tagName.toLowerCase();
                if (['img', 'svg', 'path', 'table', 'tr', 'thead', 'tbody', 'script', 'style', 'br', 'hr'].includes(tagName)) {
                    return;
                }
                
                // ì§ì ‘ í…ìŠ¤íŠ¸ë¥¼ í¬í•¨í•˜ëŠ” ê²½ìš°ë§Œ í¸ì§‘ ê°€ëŠ¥
                const hasDirectText = Array.from(el.childNodes).some(node => 
                    node.nodeType === Node.TEXT_NODE && node.textContent.trim().length > 0
                );
                
                if (hasDirectText || editableSelectors.some(sel => el.matches(sel))) {
                    el.setAttribute('contenteditable', 'true');
                }
            });
            
            return container.innerHTML;
        }

        function saveEditedContent() {
            if (!currentEditingReport) {
                showToast('ì €ì¥í•  ë³´ê³ ì„œê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            // í¸ì§‘ëœ ë‚´ìš© ì¶”ì¶œ (contenteditable ì†ì„± ì œê±°)
            const editedContent = elements.editContent.cloneNode(true);
            editedContent.querySelectorAll('[contenteditable]').forEach(el => {
                el.removeAttribute('contenteditable');
            });
            
            // style íƒœê·¸ ë¶„ë¦¬
            const styleTag = editedContent.querySelector('style');
            const styleContent = styleTag ? styleTag.outerHTML : '';
            if (styleTag) styleTag.remove();
            
            // ìƒˆ HTML ìƒì„±
            const newHtml = `
                <!DOCTYPE html>
                <html lang="ko">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    ${styleContent}
                </head>
                <body>
                    ${editedContent.innerHTML}
                </body>
                </html>
            `;
            
            // ìºì‹œ ì—…ë°ì´íŠ¸
            const { type, report } = currentEditingReport;
            state.cachedHtml[type][report.id] = newHtml;
            
            // htmlCacheë„ ì—…ë°ì´íŠ¸ (ìµœì¢… ë¬¸ì„œ ìƒì„±ìš©)
            const cacheKey = `${type}_${report.id}`;
            state.htmlCache[cacheKey] = newHtml;
            
            // í¸ì§‘ ëª¨ë“œ ì¢…ë£Œ
            exitEditMode();
            
            // iframeì— ë³€ê²½ëœ ë‚´ìš© í‘œì‹œ
            elements.previewIframe.srcdoc = newHtml;
            
            // ìˆ˜ì •ë¨ í‘œì‹œ
            markReportAsEdited(type, report.id);
            
            showToast('âœ… ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        function cancelEditMode() {
            if (originalHtmlBeforeEdit && currentEditingReport) {
                // ì›ë³¸ ë³µì›
                const { type, report } = currentEditingReport;
                state.cachedHtml[type][report.id] = originalHtmlBeforeEdit;
            }
            
            exitEditMode();
            
            // iframe ë‹¤ì‹œ í‘œì‹œ
            if (currentEditingReport) {
                elements.previewIframe.srcdoc = originalHtmlBeforeEdit;
            }
            
            showToast('í¸ì§‘ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        function exitEditMode() {
            isEditMode = false;
            originalHtmlBeforeEdit = null;
            currentEditingReport = null;
            
            // UI ë³µì›
            elements.editContainer.style.display = 'none';
            elements.previewIframe.style.display = 'block';
            
            // ë²„íŠ¼ ìƒíƒœ ë³µì›
            elements.editBtn.style.display = 'inline-flex';
            elements.saveEditBtn.style.display = 'none';
            elements.cancelEditBtn.style.display = 'none';
            elements.markReviewedBtn.style.display = 'block';
        }

        function markReportAsEdited(type, reportId) {
            // í¸ì§‘ëœ ë³´ê³ ì„œ í‘œì‹œ (ì˜µì…˜: ë¦¬ìŠ¤íŠ¸ì— í‘œì‹œ ì¶”ê°€)
            if (!state.editedReports) {
                state.editedReports = { summary: new Set(), sectoral: new Set(), regional: new Set(), statistics: new Set() };
            }
            state.editedReports[type].add(reportId);
            
            // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            renderSummaryReportList();
            renderReportList();
            renderRegionalReportList();
            renderStatisticsReportList();
        }

        // ===== ìµœì¢… ë¬¸ì„œ ë‚´ë³´ë‚´ê¸° =====
        async function exportFinalDocument() {
            if (!state.allGenerated) {
                showToast('ë¨¼ì € ëª¨ë“  ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ì„¸ìš”.', 'warning');
                return;
            }
            
            // ë¡œë”© í‘œì‹œ
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingTitle = document.getElementById('loadingTitle');
            const loadingProgress = document.getElementById('loadingProgress');
            const loadingPercent = document.getElementById('loadingPercent');
            const loadingCurrent = document.getElementById('loadingCurrent');
            
            loadingOverlay.style.display = 'flex';
            loadingTitle.textContent = 'ğŸ“„ ìµœì¢… ë¬¸ì„œ ìƒì„± ì¤‘...';
            loadingCurrent.textContent = 'í˜ì´ì§€ ìˆ˜ì§‘ ì¤‘';
            loadingProgress.style.width = '0%';
            loadingPercent.textContent = '0%';
            
            try {
                // ëª¨ë“  ìºì‹œëœ HTML ìˆ˜ì§‘ (ìˆœì„œëŒ€ë¡œ)
                const pages = [];
                
                // 1. ìš”ì•½ ë³´ê³ ì„œ
                for (const report of state.summaryReports) {
                    const key = `summary_${report.id}`;
                    if (state.htmlCache[key]) {
                        pages.push({
                            html: state.htmlCache[key],
                            title: report.name,
                            category: 'summary'
                        });
                    }
                }
                
                // 2. ë¶€ë¬¸ë³„ ë³´ê³ ì„œ
                for (const report of state.sectoralReports) {
                    const key = `sectoral_${report.id}`;
                    if (state.htmlCache[key]) {
                        pages.push({
                            html: state.htmlCache[key],
                            title: report.name,
                            category: 'sectoral'
                        });
                    }
                }
                
                // 3. ì‹œë„ë³„ ë³´ê³ ì„œ
                for (const region of state.regionalReports) {
                    const key = `regional_${region.id}`;
                    if (state.htmlCache[key]) {
                        pages.push({
                            html: state.htmlCache[key],
                            title: region.name,
                            category: 'regional'
                        });
                    }
                }
                
                // 4. í†µê³„í‘œ
                for (const stat of state.statisticsReports) {
                    const key = `statistics_${stat.id}`;
                    if (state.htmlCache[key]) {
                        pages.push({
                            html: state.htmlCache[key],
                            title: stat.name,
                            category: 'statistics'
                        });
                    }
                }
                
                loadingCurrent.textContent = `${pages.length}ê°œ í˜ì´ì§€ ìˆ˜ì§‘ ì™„ë£Œ`;
                loadingProgress.style.width = '50%';
                loadingPercent.textContent = '50%';
                
                // API í˜¸ì¶œ
                const response = await fetch('/api/export-final', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        pages: pages,
                        year: state.year,
                        quarter: state.quarter
                    })
                });
                
                const result = await response.json();
                
                loadingProgress.style.width = '100%';
                loadingPercent.textContent = '100%';
                
                if (result.success) {
                    loadingCurrent.textContent = 'ë¬¸ì„œ ìƒì„± ì™„ë£Œ!';
                    
                    // ë‹¤ìš´ë¡œë“œ ë˜ëŠ” ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
                    setTimeout(() => {
                        loadingOverlay.style.display = 'none';
                        
                        // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                        const blob = new Blob([result.html], { type: 'text/html; charset=utf-8' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = result.filename;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        
                        showToast(`âœ… ${result.total_pages}í˜ì´ì§€ ë¬¸ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                    }, 500);
                } else {
                    loadingOverlay.style.display = 'none';
                    showToast(result.error || 'ë¬¸ì„œ ìƒì„± ì‹¤íŒ¨', 'error');
                }
            } catch (err) {
                console.error('ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:', err);
                loadingOverlay.style.display = 'none';
                showToast('ë¬¸ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ===== í•œê¸€ ë³µë¶™ìš© ë¬¸ì„œ ë‚´ë³´ë‚´ê¸° =====
        async function exportHwpReadyDocument() {
            if (!state.allGenerated) {
                showToast('ë¨¼ì € ëª¨ë“  ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ì„¸ìš”.', 'warning');
                return;
            }
            
            // ë¡œë”© í‘œì‹œ
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingTitle = document.getElementById('loadingTitle');
            const loadingProgress = document.getElementById('loadingProgress');
            const loadingPercent = document.getElementById('loadingPercent');
            const loadingCurrent = document.getElementById('loadingCurrent');
            
            loadingOverlay.style.display = 'flex';
            loadingTitle.textContent = 'ğŸ“‹ í•œê¸€ ë³µë¶™ìš© ë¬¸ì„œ ìƒì„± ì¤‘...';
            loadingCurrent.textContent = 'í˜ì´ì§€ ë³€í™˜ ì¤‘';
            loadingProgress.style.width = '0%';
            loadingPercent.textContent = '0%';
            
            try {
                // ëª¨ë“  ìºì‹œëœ HTML ìˆ˜ì§‘ (ìˆœì„œëŒ€ë¡œ)
                const pages = [];
                
                // 1. ìš”ì•½ ë³´ê³ ì„œ
                for (const report of state.summaryReports) {
                    const key = `summary_${report.id}`;
                    if (state.htmlCache[key]) {
                        pages.push({
                            html: state.htmlCache[key],
                            title: report.name,
                            category: 'summary'
                        });
                    }
                }
                
                // 2. ë¶€ë¬¸ë³„ ë³´ê³ ì„œ
                for (const report of state.sectoralReports) {
                    const key = `sectoral_${report.id}`;
                    if (state.htmlCache[key]) {
                        pages.push({
                            html: state.htmlCache[key],
                            title: report.name,
                            category: 'sectoral'
                        });
                    }
                }
                
                // 3. ì‹œë„ë³„ ë³´ê³ ì„œ
                for (const region of state.regionalReports) {
                    const key = `regional_${region.id}`;
                    if (state.htmlCache[key]) {
                        pages.push({
                            html: state.htmlCache[key],
                            title: region.name,
                            category: 'regional'
                        });
                    }
                }
                
                // 4. í†µê³„í‘œ
                for (const stat of state.statisticsReports) {
                    const key = `statistics_${stat.id}`;
                    if (state.htmlCache[key]) {
                        pages.push({
                            html: state.htmlCache[key],
                            title: stat.name,
                            category: 'statistics'
                        });
                    }
                }
                
                loadingCurrent.textContent = `${pages.length}ê°œ í˜ì´ì§€ ë³€í™˜ ì¤‘`;
                loadingProgress.style.width = '30%';
                loadingPercent.textContent = '30%';
                
                // API í˜¸ì¶œ - í•œê¸€ ë³µë¶™ìš©
                const response = await fetch('/api/export-hwp-ready', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        pages: pages,
                        year: state.year,
                        quarter: state.quarter,
                        mode: 'single'
                    })
                });
                
                const result = await response.json();
                
                loadingProgress.style.width = '100%';
                loadingPercent.textContent = '100%';
                
                if (result.success) {
                    loadingCurrent.textContent = 'í•œê¸€ ë³µë¶™ìš© ë¬¸ì„œ ìƒì„± ì™„ë£Œ!';
                    
                    setTimeout(() => {
                        loadingOverlay.style.display = 'none';
                        
                        // ìƒˆ íƒ­ì—ì„œ ì—´ê¸° (ë³µë¶™í•˜ê¸° í¸í•˜ê²Œ)
                        window.open(result.view_url, '_blank');
                        
                        showToast(`âœ… ${result.total_pages}í˜ì´ì§€ í•œê¸€ ë³µë¶™ìš© ë¬¸ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\nìƒˆ íƒ­ì—ì„œ ì—´ë¦½ë‹ˆë‹¤. ë³µì‚¬í•  ì˜ì—­ì„ ì„ íƒ í›„ Ctrl+C â†’ í•œê¸€ì—ì„œ Ctrl+V`, 'success');
                    }, 500);
                } else {
                    loadingOverlay.style.display = 'none';
                    showToast(result.error || 'ë¬¸ì„œ ìƒì„± ì‹¤íŒ¨', 'error');
                }
            } catch (err) {
                console.error('í•œê¸€ ë³µë¶™ìš© ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:', err);
                loadingOverlay.style.display = 'none';
                showToast('ë¬¸ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ===== GRDP ëª¨ë‹¬ í•¨ìˆ˜ =====
        function showGrdpModal() {
            const modal = document.getElementById('grdpModal');
            modal.classList.add('active');
            
            // ì´ˆê¸°í™”
            document.getElementById('grdpUploadProgress').style.display = 'none';
            document.getElementById('grdpModalFileInput').value = '';
        }
        
        function closeGrdpModal() {
            document.getElementById('grdpModal').classList.remove('active');
            // GRDP ëª¨ë‹¬ ë‹«íŒ í›„ ìë™ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
            if (!state.allGenerated) {
                setTimeout(() => {
                    generateAllReports();
                }, 500);
            }
        }
        
        function openKosisGrdpPage() {
            // KOSIS ì‹¤í—˜ì í†µê³„ í˜ì´ì§€ ì—´ê¸°
            window.open('https://kosis.kr/statisticsList/experimentStatistical.do#down23', '_blank');
            showToast('KOSIS í˜ì´ì§€ê°€ ìƒˆ íƒ­ì—ì„œ ì—´ë ¸ìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œ í›„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'info');
        }
        
        async function handleGrdpModalUpload(input) {
            if (!input.files || input.files.length === 0) return;
            
            const file = input.files[0];
            const formData = new FormData();
            formData.append('file', file);
            
            // ì§„í–‰ ìƒíƒœ í‘œì‹œ
            document.getElementById('grdpUploadProgress').style.display = 'block';
            document.getElementById('grdpUploadStatus').textContent = 'íŒŒì¼ ë¶„ì„ ì¤‘...';
            
            try {
                const response = await fetch('/api/upload-grdp', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('grdpUploadStatus').textContent = 'âœ… GRDP ì¶”ì¶œ ì™„ë£Œ!';
                    
                    // GRDP ì •ë³´ ì—…ë°ì´íŠ¸
                    document.getElementById('grdpMissing').style.display = 'none';
                    document.getElementById('grdpInfo').style.display = 'block';
                    document.getElementById('grdpNational').textContent = `${data.national_growth_rate}%`;
                    document.getElementById('grdpTopRegion').textContent = data.top_region;
                    
                    showToast('GRDP ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ì¶œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    
                    // 1.5ì´ˆ í›„ ëª¨ë‹¬ ë‹«ê¸°
                    setTimeout(() => {
                        closeGrdpModal();
                    }, 1500);
                } else {
                    document.getElementById('grdpUploadStatus').textContent = 'âŒ ì¶”ì¶œ ì‹¤íŒ¨';
                    showToast(data.error || 'GRDP íŒŒì¼ íŒŒì‹± ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                document.getElementById('grdpUploadStatus').textContent = 'âŒ ì˜¤ë¥˜ ë°œìƒ';
                showToast('GRDP ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                console.error('GRDP upload error:', error);
            }
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            input.value = '';
        }
        
        // ì‚¬ì´ë“œë°” GRDP ì—…ë¡œë“œ (ê¸°ì¡´ í˜¸í™˜)
        async function uploadGrdpFile(input) {
            await handleGrdpModalUpload(input);
        }
        
        // GRDP ëª¨ë‹¬ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            const grdpUploadArea = document.querySelector('.grdp-upload-area');
            if (grdpUploadArea) {
                grdpUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    grdpUploadArea.classList.add('dragover');
                });
                
                grdpUploadArea.addEventListener('dragleave', () => {
                    grdpUploadArea.classList.remove('dragover');
                });
                
                grdpUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    grdpUploadArea.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const input = document.getElementById('grdpModalFileInput');
                        input.files = files;
                        handleGrdpModalUpload(input);
                    }
                });
            }
        });

        // ===== Toast =====
        // ë¶„ì„í‘œ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
        async function downloadAnalysisFile() {
            if (!state.analysisFilename) {
                showToast('ë‹¤ìš´ë¡œë“œí•  ë¶„ì„í‘œê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }
            
            // ì €ì¥ëœ ê°€ì¤‘ì¹˜ ì„¤ì • ì‚¬ìš©
            const weightSettings = state.weightSettings;
            
            try {
                showToast('ë¶„ì„í‘œ ìƒì„± ì¤‘...', 'info');
                
                // ê°€ì¤‘ì¹˜ ì„¤ì •ì„ í¬í•¨í•˜ì—¬ ë¶„ì„í‘œ ì¬ìƒì„±
                const response = await fetch('/api/generate-analysis-with-weights', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ weight_settings: weightSettings })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // ë‹¤ìš´ë¡œë“œ ì‹œì‘
                    const downloadLink = document.createElement('a');
                    downloadLink.href = '/api/download-analysis';
                    downloadLink.download = result.filename || state.analysisFilename;
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);
                    
                    showToast('ë¶„ì„í‘œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë©ë‹ˆë‹¤.', 'success');
                } else {
                    showToast(result.error || 'ë¶„ì„í‘œ ìƒì„± ì‹¤íŒ¨', 'error');
                }
            } catch (err) {
                console.error('ë¶„ì„í‘œ ìƒì„± ì˜¤ë¥˜:', err);
                showToast('ë¶„ì„í‘œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'âœ“',
                error: 'âœ•',
                warning: 'âš ',
                info: 'â„¹'
            };

            toast.innerHTML = `
                <span style="font-size: 1.2rem;">${icons[type] || icons.info}</span>
                <span>${message}</span>
            `;

            elements.toastContainer.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }
    </script>
</body>
</html>
