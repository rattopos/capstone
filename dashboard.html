<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€ì—­ê²½ì œë™í–¥ ë³´ë„ìë£Œ ìƒì„± ì‹œìŠ¤í…œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --bg-card: #1e1e2a;
            --bg-card-hover: #252535;
            --accent-primary: #6366f1;
            --accent-secondary: #818cf8;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --success: #22c55e;
            --success-glow: rgba(34, 197, 94, 0.3);
            --warning: #f59e0b;
            --warning-glow: rgba(245, 158, 11, 0.3);
            --danger: #ef4444;
            --danger-glow: rgba(239, 68, 68, 0.3);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #2e2e3e;
            --border-hover: #3e3e50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow: auto;
        }

        /* Animated background */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, var(--accent-glow) 0%, transparent 40%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        /* Header */
        .header {
            position: relative;
            z-index: 10;
            background: linear-gradient(180deg, var(--bg-secondary) 0%, transparent 100%);
            border-bottom: 1px solid var(--border);
            padding: 0.75rem 1.5rem;
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, #8b5cf6 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 4px 20px var(--accent-glow);
        }

        .logo-text h1 {
            font-size: 1rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-text p {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .select-group {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            background: var(--bg-tertiary);
            padding: 0.4rem 0.75rem;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .select-group label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .select-group select {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.3rem 0.5rem;
            border-radius: 5px;
            font-family: inherit;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .select-group select:hover {
            border-color: var(--accent-primary);
        }

        .select-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        /* Period Display (ìë™ê°ì§€) */
        .period-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-card));
            padding: 0.4rem 0.75rem;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .period-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .period-value {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--accent-primary);
            padding: 0.2rem 0.5rem;
            background: var(--accent-glow);
            border-radius: 6px;
        }

        .period-value.waiting {
            color: var(--text-secondary);
            background: transparent;
            font-weight: 400;
        }

        /* Main Layout */
        .main-container {
            position: relative;
            z-index: 10;
            max-width: 1800px;
            margin: 0 auto;
            padding: 0.75rem 1rem;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 1rem;
            height: calc(100vh - 60px);
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            overflow-y: auto;
            max-height: 100%;
        }

        .upload-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.75rem;
            transition: all 0.3s;
        }

        .upload-section:hover {
            border-color: var(--border-hover);
        }

        .section-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--bg-tertiary);
        }

        .upload-zone:hover {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .upload-zone.dragover {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
            transform: scale(1.02);
        }

        .upload-zone.uploaded {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.05);
        }

        .upload-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            opacity: 0.8;
        }

        .upload-text {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
        }

        .upload-hint {
            color: var(--text-muted);
            font-size: 0.65rem;
        }

        .upload-filename {
            color: var(--success);
            font-size: 0.75rem;
            font-weight: 500;
            margin-top: 0.25rem;
            word-break: break-all;
        }

        /* Report List - ì œê±°ë¨ */

        .report-item.has-missing {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--warning);
        }

        .report-item.generated {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--accent-secondary);
        }

        .report-icon {
            width: 28px;
            height: 28px;
            background: var(--bg-card);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .report-info {
            flex: 1;
            min-width: 0;
        }

        .report-name {
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .report-sheet {
            font-size: 0.65rem;
            color: var(--text-muted);
            display: none;
        }

        .report-status {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            flex-shrink: 0;
        }

        .report-status.pending {
            color: var(--text-muted);
        }

        .report-status.generated {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .report-status.reviewed {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .report-status.edited {
            background: #f59e0b;
            border-color: #f59e0b;
            color: white;
        }

        .report-item.edited {
            border-left: 3px solid #f59e0b;
        }

        .report-status.has-missing {
            background: var(--warning);
            border-color: var(--warning);
            color: white;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-height: 0;
            overflow: hidden;
        }

        /* Control Bar - í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ì œê±°ë¨ */

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary) 0%, #8b5cf6 100%);
            border: none;
            color: white;
            box-shadow: 0 4px 15px var(--accent-glow);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px var(--accent-glow);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
        }

        .btn-success {
            background: var(--success);
            border: none;
            color: white;
            box-shadow: 0 4px 15px var(--success-glow);
        }

        .btn-edit {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        .btn-edit:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-save {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        .btn-save:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-cancel {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        .btn-cancel:hover:not(:disabled) {
            background: var(--bg-card-hover);
            color: var(--error);
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px var(--success-glow);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Preview Area */
        .preview-area {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .preview-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .preview-content {
            background: white;
            flex: 1;
            overflow: hidden;
            min-height: 0;
        }

        .preview-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            overflow: auto;
        }

        .preview-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-muted);
            background: var(--bg-tertiary);
        }

        .preview-placeholder-icon {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
            opacity: 0.5;
        }

        .preview-placeholder h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .preview-placeholder p {
            font-size: 0.8rem;
            max-width: 350px;
            text-align: center;
            line-height: 1.5;
        }

        /* Preview Actions */
        .preview-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Edit Mode Styles */
        .edit-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
        }

        .edit-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-bottom: 2px solid #f59e0b;
        }

        .edit-mode-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: #92400e;
            font-size: 0.9rem;
        }

        .edit-hint {
            font-size: 0.8rem;
            color: #b45309;
        }

        .edit-content {
            flex: 1;
            overflow: auto;
            padding: 1rem;
            background: white;
        }

        .edit-content [contenteditable="true"] {
            outline: none;
            min-height: 1em;
            transition: background-color 0.2s;
        }

        .edit-content [contenteditable="true"]:hover {
            background-color: rgba(245, 158, 11, 0.1);
        }

        .edit-content [contenteditable="true"]:focus {
            background-color: rgba(245, 158, 11, 0.2);
            box-shadow: inset 0 0 0 2px #f59e0b;
        }

        /* í¸ì§‘ ë¶ˆê°€ ìš”ì†Œ í‘œì‹œ */
        .edit-content .no-edit {
            pointer-events: none;
            opacity: 0.7;
        }

        .edit-content img,
        .edit-content svg,
        .edit-content canvas {
            pointer-events: none;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: all 0.3s;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--danger);
            border-color: var(--danger);
        }

        .missing-field-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .missing-field-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
        }

        .missing-field-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .missing-field-input {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .missing-field-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        /* Progress */
        .progress-bar {
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary) 0%, #8b5cf6 100%);
            border-radius: 2px;
            transition: width 0.5s ease;
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .toast {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 300px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            border-color: var(--success);
        }

        .toast.error {
            border-color: var(--danger);
        }

        .toast.warning {
            border-color: var(--warning);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Upload Modal */
        .upload-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1003;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .upload-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .upload-modal-content {
            width: 90%;
            max-width: 450px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
        }

        .upload-modal-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .upload-modal-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .upload-modal-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .upload-steps {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .upload-step {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .upload-step.active {
            border-color: var(--accent-primary);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), transparent);
        }

        .upload-step.completed {
            border-color: var(--success);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), transparent);
        }

        .upload-step.skipped {
            opacity: 0.5;
        }

        .upload-step .step-icon {
            font-size: 1.2rem;
            width: 28px;
            text-align: center;
        }

        .upload-step .step-text {
            flex: 1;
            text-align: left;
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        .upload-step .step-status {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .upload-progress-bar {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .upload-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            width: 0%;
            transition: width 0.3s;
        }

        .upload-result {
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border: 1px solid var(--success);
        }

        .upload-result .result-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
        }

        .upload-result .result-item:not(:last-child) {
            border-bottom: 1px solid var(--border);
        }

        .upload-result .result-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .upload-result .result-value {
            color: var(--accent-primary);
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Loading - í° ì§„í–‰ë¥  í‘œì‹œ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-content {
            width: 90%;
            max-width: 600px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2.5rem;
            text-align: center;
        }

        .loading-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .loading-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .loading-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 2rem;
        }

        .loading-progress-container {
            margin-bottom: 1.5rem;
        }

        .loading-progress-bar {
            height: 12px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .loading-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary) 0%, #8b5cf6 50%, var(--success) 100%);
            border-radius: 6px;
            transition: width 0.3s ease;
            box-shadow: 0 0 20px var(--accent-glow);
        }

        .loading-stats {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .loading-current-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin-bottom: 1.5rem;
        }

        .loading-current-icon {
            font-size: 1.5rem;
        }

        .loading-current-text {
            color: var(--text-primary);
            font-weight: 500;
        }

        .loading-time-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .loading-time-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .loading-time-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-secondary);
            font-variant-numeric: tabular-nums;
        }

        .loading-time-label {
            font-size: 0.75rem;
        }

        /* ìƒì„± ì™„ë£Œ ìƒíƒœ */
        .generation-status {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            display: none;
        }

        .generation-status.active {
            display: block;
        }

        .generation-status-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .generation-status-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: var(--success);
        }

        .generation-status-count {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .generation-mini-progress {
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            overflow: hidden;
        }

        .generation-mini-fill {
            height: 100%;
            background: var(--success);
            border-radius: 2px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 300px 1fr;
            }
        }

        @media (max-width: 900px) {
            .main-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                max-height: 300px;
            }

            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">ğŸ“Š</div>
                <div class="logo-text">
                    <h1>ì§€ì—­ê²½ì œë™í–¥ ë³´ë„ìë£Œ ì‹œìŠ¤í…œ</h1>
                    <p>Regional Economic Report Generator</p>
                </div>
            </div>
            <div class="header-controls">
                <div class="period-display" id="periodDisplay">
                    <span class="period-label">ğŸ“… ê¸°ì¤€ì‹œì </span>
                    <span class="period-value waiting" id="periodValue">íŒŒì¼ ì—…ë¡œë“œ ëŒ€ê¸°ì¤‘...</span>
                    <input type="hidden" id="yearSelect" value="2025">
                    <input type="hidden" id="quarterSelect" value="2">
                </div>
                <button class="btn btn-secondary" id="weightInfoBtn" onclick="openWeightSettingsModal()" title="ê°€ì¤‘ì¹˜ ì„¤ì •">
                    âš–ï¸ ê°€ì¤‘ì¹˜ ì„¤ì •
                </button>
                <button class="btn btn-secondary" id="contactInfoBtn" onclick="openContactModal()" title="ë‹´ë‹¹ë¶€ì„œ/ë‹´ë‹¹ì ì„¤ì •">
                    âš™ï¸ ë‹´ë‹¹ì ì„¤ì •
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Upload Section -->
            <div class="upload-section">
                <div class="section-title">ğŸ“ ë°ì´í„° ì—…ë¡œë“œ</div>
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">ğŸ“„</div>
                    <p class="upload-text">ì—‘ì…€ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</p>
                    <p class="upload-hint" style="line-height: 1.4;">
                        <span style="color: var(--success);">ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œ</span> â†’ ë³´ë„ìë£Œ ì§ì ‘ ìƒì„±<br>
                        <span style="color: var(--text-muted);">(ì°¨íŠ¸/ì¸í¬ê·¸ë˜í”½ ì œì™¸, í‘œ ê¸°ë°˜)</span>
                    </p>
                    <p class="upload-filename" id="uploadFilename" style="display: none;"></p>
                </div>
                <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;">
                <div class="progress-bar" id="progressBar" style="display: none;">
                    <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                </div>
                
                <!-- Conversion Info (ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œ ì—…ë¡œë“œ ì‹œ í‘œì‹œ) -->
                <div class="conversion-info" id="conversionInfo" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 10px; border: 1px solid var(--border);">
                    <div style="font-size: 0.85rem; font-weight: 600; color: var(--success); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                        <span>âœ¨</span>
                        <span>ê¸°ì´ˆìë£Œ ì—…ë¡œë“œ ì™„ë£Œ</span>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.75rem;" id="conversionDetails">ë³´ë„ìë£Œ ìƒì„± ì¤€ë¹„ ì™„ë£Œ</div>
                    
                    <!-- GRDP ì¶”ì¶œ ê²°ê³¼ -->
                    <div class="grdp-info" id="grdpInfo" style="display: none; padding: 0.75rem; background: var(--bg-card); border-radius: 8px; border-left: 3px solid var(--accent-primary);">
                        <div style="font-size: 0.8rem; font-weight: 600; color: var(--accent-secondary); margin-bottom: 0.5rem;">ğŸ“Š GRDP ì¶”ì¶œ ì™„ë£Œ</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.75rem;">
                            <div>
                                <span style="color: var(--text-muted);">ì „êµ­ ì„±ì¥ë¥ :</span>
                                <span id="grdpNational" style="color: var(--text-primary); font-weight: 600;"></span>
                            </div>
                            <div>
                                <span style="color: var(--text-muted);">1ìœ„ ì§€ì—­:</span>
                                <span id="grdpTopRegion" style="color: var(--text-primary); font-weight: 600;"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- GRDP ëˆ„ë½ ì•ˆë‚´ (ê°„ì†Œí™”) -->
                    <div class="grdp-missing" id="grdpMissing" style="display: none; padding: 0.75rem; background: var(--bg-card); border-radius: 8px; border-left: 3px solid #f59e0b;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <div style="font-size: 0.8rem; font-weight: 600; color: #f59e0b;">âš ï¸ GRDP ë°ì´í„° ëˆ„ë½</div>
                                <div style="font-size: 0.7rem; color: var(--text-muted);">ì°¸ê³ _GRDP ë³´ë„ìë£Œì— ì˜í–¥</div>
                            </div>
                            <button onclick="showGrdpModal()" style="
                                padding: 0.4rem 0.75rem;
                                background: #f59e0b;
                                color: white;
                                border: none;
                                border-radius: 6px;
                                font-size: 0.75rem;
                                cursor: pointer;
                            ">ì¶”ê°€</button>
                        </div>
                    </div>
                    
                    <!-- ë³´ë„ìë£Œ ìƒì„± ì•ˆë‚´ -->
                    <div id="reportGenerationHint" style="margin-top: 0.75rem; padding: 0.75rem; background: var(--bg-card); border-radius: 8px; border-left: 3px solid var(--success);">
                        <div style="font-size: 0.75rem; color: var(--text-muted); line-height: 1.5;">
                            <strong style="color: var(--success);">ğŸ‰ ë³´ë„ìë£Œ ìƒì„± ì¤€ë¹„ ì™„ë£Œ</strong><br>
                            ìš°ì¸¡ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ë³´ë„ìë£Œë¥¼ í™•ì¸í•˜ê³  í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                            <span style="color: var(--text-muted); font-size: 0.7rem;">â€» ì°¨íŠ¸/ì¸í¬ê·¸ë˜í”½ ì œì™¸, í‘œ ê¸°ë°˜ ë³´ë„ìë£Œ</span>
                        </div>
                    </div>
                    
                    <!-- ë¶„ì„í‘œ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì œê±°ë¨ - ê¸°ì´ˆìë£Œì—ì„œ ì§ì ‘ ë³´ë„ìë£Œ ìƒì„± -->
                </div>
            </div>

            <!-- Report List - ì œê±°ë¨ -->
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Generation Status -->
            <div class="generation-status" id="generationStatus">
                <div class="generation-status-header">
                    <span class="generation-status-title">
                        <span>âœ…</span>
                        <span>ë¯¸ë¦¬ë³´ê¸° ìƒì„± ì™„ë£Œ</span>
                    </span>
                    <span class="generation-status-count" id="generationStatusCount">50/50</span>
                </div>
                <div class="generation-mini-progress">
                    <div class="generation-mini-fill" id="generationMiniFill" style="width: 100%;"></div>
                </div>
            </div>

            <!-- Control Bar - í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ì œê±°ë¨ -->

            <!-- Preview Area -->
            <div class="preview-area">
                <div class="preview-header">
                    <div class="preview-title" id="previewTitle">
                        <span>ğŸ“„</span>
                        <span>ë¯¸ë¦¬ë³´ê¸°</span>
                    </div>
                    <div class="preview-actions">
                        <!-- í¸ì§‘/ê²€í†  ë²„íŠ¼ë“¤ - ì¶”í›„ ì¬êµ¬í˜„ ì˜ˆì • -->
                    </div>
                </div>
                <div class="preview-content" id="previewContent">
                    <div class="preview-placeholder" id="previewPlaceholder">
                        <div class="preview-placeholder-icon">ğŸ“Š</div>
                        <h3>ë³´ë„ìë£Œë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
                        <p>ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ìë™ìœ¼ë¡œ ë³´ë„ìë£Œê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>
                    </div>
                    <iframe class="preview-iframe" id="previewIframe" style="display: none;"></iframe>
                    <!-- í¸ì§‘ ëª¨ë“œìš© ì—ë””í„° -->
                    <div class="edit-container" id="editContainer" style="display: none;">
                        <div class="edit-toolbar">
                            <span class="edit-mode-badge">ğŸ“ í¸ì§‘ ëª¨ë“œ</span>
                            <span class="edit-hint">í…ìŠ¤íŠ¸ë¥¼ í´ë¦­í•˜ì—¬ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”. ë ˆì´ì•„ì›ƒì€ ìœ ì§€ë©ë‹ˆë‹¤.</span>
                        </div>
                        <div class="edit-content" id="editContent"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Contact Info Modal (ë‹´ë‹¹ë¶€ì„œ/ë‹´ë‹¹ì ì •ë³´ ì…ë ¥) -->
    <div class="modal-overlay" id="contactInfoModal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <span>ğŸ“</span>
                    <span>ë‹´ë‹¹ë¶€ì„œ ë° ë‹´ë‹¹ì ì •ë³´</span>
                </h2>
                <button class="modal-close" onclick="closeContactModal()">Ã—</button>
            </div>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                ë³´ë„ìë£Œ í‘œì§€ì— í‘œì‹œë  ë‹´ë‹¹ë¶€ì„œ ë° ë‹´ë‹¹ì ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
            </p>
            
            <!-- ë³´ë„ìë£Œ ì •ë³´ -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 0.95rem; color: var(--accent-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ“…</span> ë³´ë„ìë£Œ ì •ë³´
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="missing-field-item">
                        <label class="missing-field-label">ë³´ë„ì‹œì </label>
                        <input type="text" class="missing-field-input" id="releaseDateTime" 
                               placeholder="ì˜ˆ: 2025. 8. 12.(í™”) 12:00" value="2025. 8. 12.(í™”) 12:00">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ë°°í¬ì¼ì‹œ</label>
                        <input type="text" class="missing-field-input" id="distributionDateTime" 
                               placeholder="ì˜ˆ: 2025. 8. 12.(í™”) 08:30" value="2025. 8. 12.(í™”) 08:30">
                    </div>
                </div>
            </div>
            
            <!-- ë‹´ë‹¹ë¶€ì„œ ì •ë³´ -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 0.95rem; color: var(--accent-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ›ï¸</span> ë‹´ë‹¹ë¶€ì„œ
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="missing-field-item">
                        <label class="missing-field-label">ë¶€ì„œëª…</label>
                        <input type="text" class="missing-field-input" id="department" 
                               placeholder="ì˜ˆ: êµ­ê°€ë°ì´í„°ì²˜ ê²½ì œí†µê³„êµ­" value="êµ­ê°€ë°ì´í„°ì²˜ ê²½ì œí†µê³„êµ­">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ê³¼ëª…</label>
                        <input type="text" class="missing-field-input" id="division" 
                               placeholder="ì˜ˆ: ì†Œë“í†µê³„ê³¼" value="ì†Œë“í†µê³„ê³¼">
                    </div>
                </div>
            </div>
            
            <!-- ì±…ì„ì ì •ë³´ -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 0.95rem; color: var(--accent-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ‘”</span> ì±…ì„ì ì •ë³´
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì§ì±…</label>
                        <input type="text" class="missing-field-input" id="managerTitle" 
                               placeholder="ì˜ˆ: ê³¼ ì¥" value="ê³¼ ì¥">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì´ë¦„</label>
                        <input type="text" class="missing-field-input" id="managerName" 
                               placeholder="ì˜ˆ: í™ê¸¸ë™" value="ì •ì„ ê²½">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì „í™”ë²ˆí˜¸</label>
                        <input type="text" class="missing-field-input" id="managerPhone" 
                               placeholder="ì˜ˆ: 042-481-2206" value="042-481-2206">
                    </div>
                </div>
            </div>
            
            <!-- ë‹´ë‹¹ì ì •ë³´ -->
            <div style="margin-bottom: 1.5rem;">
                <h3 style="font-size: 0.95rem; color: var(--accent-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ‘¤</span> ë‹´ë‹¹ì ì •ë³´
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì§ì±…</label>
                        <input type="text" class="missing-field-input" id="staffTitle" 
                               placeholder="ì˜ˆ: ì‚¬ë¬´ê´€" value="ì‚¬ë¬´ê´€">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì´ë¦„</label>
                        <input type="text" class="missing-field-input" id="staffName" 
                               placeholder="ì˜ˆ: ê¹€ì² ìˆ˜" value="ìœ¤ë¯¼í¬">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì „í™”ë²ˆí˜¸</label>
                        <input type="text" class="missing-field-input" id="staffPhone" 
                               placeholder="ì˜ˆ: 042-481-2226" value="042-481-2226">
                    </div>
                </div>
            </div>
            
            <!-- ê´€ì„¸ì²­ ë‹´ë‹¹ ì •ë³´ -->
            <div style="margin-bottom: 1rem;">
                <h3 style="font-size: 0.95rem; color: var(--accent-secondary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸš¢</span> ê´€ì„¸ì²­ ë‹´ë‹¹ (ìˆ˜ì¶œì… í†µê³„)
                </h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="missing-field-item">
                        <label class="missing-field-label">ë‹´ë‹¹ë¶€ì„œ</label>
                        <input type="text" class="missing-field-input" id="customsDepartment" 
                               placeholder="ì˜ˆ: ê´€ì„¸ì²­ ì •ë³´ë°ì´í„°ê¸°íšë‹´ë‹¹ê´€" value="ê´€ì„¸ì²­ ì •ë³´ë°ì´í„°ê¸°íšë‹´ë‹¹ê´€">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ì „í™”ë²ˆí˜¸</label>
                        <input type="text" class="missing-field-input" id="customsPhone" 
                               placeholder="ì˜ˆ: 042-481-7845" value="042-481-7845">
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeContactModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveContactInfo()">ğŸ’¾ ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- Weight Settings Modal (ê°€ì¤‘ì¹˜ ì„¤ì •) - ë‹¨ìˆœí™” ë²„ì „ -->
    <div class="modal-overlay" id="weightSettingsModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <span>âš–ï¸</span>
                    <span>ê°€ì¤‘ì¹˜ ê²°ì¸¡ì¹˜ ì„¤ì •</span>
                </h2>
                <button class="modal-close" onclick="closeWeightSettingsModal()">Ã—</button>
            </div>
            
            <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
            <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: 10px; margin-bottom: 1.5rem; border-left: 3px solid var(--accent-primary);">
                <div style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6;">
                    <strong style="color: var(--text-primary);">ğŸ’¡ ê°€ì¤‘ì¹˜ ì²˜ë¦¬ ë°©ì‹</strong><br>
                    â€¢ ê°€ì¤‘ì¹˜ëŠ” <strong>ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œ</strong>ì—ì„œ ì…ë ¥í•©ë‹ˆë‹¤.<br>
                    â€¢ ê°€ì¤‘ì¹˜ê°€ <strong>ê³µë€ ë˜ëŠ” 0</strong>ì¸ ê²½ìš° ì•„ë˜ ê¸°ë³¸ê°’ìœ¼ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.<br>
                    â€¢ ê³ ìš©ë¥ , ì‹¤ì—…, ê±´ì„¤, ìˆ˜ì¶œ, ìˆ˜ì…, ì¸êµ¬ì´ë™ì€ ê°€ì¤‘ì¹˜ ì—†ìŒ
                </div>
            </div>
            
            <!-- ê²°ì¸¡ì¹˜ ê¸°ë³¸ê°’ ì„¤ì • -->
            <div style="padding: 1.25rem; background: var(--bg-card); border-radius: 10px; margin-bottom: 1.5rem; border: 1px solid var(--accent-secondary);">
                <h3 style="font-size: 0.95rem; color: var(--accent-secondary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ğŸ”§</span> ê²°ì¸¡ì¹˜(ê³µë€/0) ëŒ€ì²´ê°’
                </h3>
                <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1rem;">
                    ê¸°ì´ˆìë£Œì—ì„œ ê°€ì¤‘ì¹˜ê°€ ë¹„ì–´ìˆê±°ë‚˜ 0ì¸ ê²½ìš° ì•„ë˜ ê°’ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.
                </p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="missing-field-item">
                        <label class="missing-field-label">ğŸ­ ê´‘ê³µì—…ìƒì‚°</label>
                        <input type="number" class="missing-field-input" id="miningDefaultWeight" value="1" min="0" step="0.1" placeholder="1">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ğŸ¢ ì„œë¹„ìŠ¤ì—…ìƒì‚°</label>
                        <input type="number" class="missing-field-input" id="serviceDefaultWeight" value="1" min="0" step="0.1" placeholder="1">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ğŸ›’ ì†Œë¹„(ì†Œë§¤)</label>
                        <input type="number" class="missing-field-input" id="consumptionDefaultWeight" value="1" min="0" step="0.1" placeholder="1">
                    </div>
                    <div class="missing-field-item">
                        <label class="missing-field-label">ğŸ’° ë¬¼ê°€</label>
                        <input type="number" class="missing-field-input" id="priceDefaultWeight" value="1" min="0" step="0.1" placeholder="1">
                    </div>
                </div>
            </div>
            
            <!-- ì•ˆë‚´ -->
            <div style="padding: 0.75rem 1rem; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 1rem;">
                <div style="font-size: 0.8rem; color: var(--text-muted);">
                    <strong style="color: var(--text-secondary);">ğŸ“ ì°¸ê³ </strong><br>
                    ê°€ì¤‘ì¹˜ ê°’ì„ ì§ì ‘ ìˆ˜ì •í•˜ë ¤ë©´ <strong>ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œ</strong>ì˜ í•´ë‹¹ ì‹œíŠ¸ì—ì„œ ì…ë ¥í•˜ì„¸ìš”.
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeWeightSettingsModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveWeightSettings()">ğŸ’¾ ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- Upload Progress Modal -->
    <div class="upload-modal-overlay" id="uploadModal">
        <div class="upload-modal-content">
            <div class="upload-modal-icon" id="uploadModalIcon">ğŸ“¤</div>
            <h2 class="upload-modal-title" id="uploadModalTitle">íŒŒì¼ ì—…ë¡œë“œ ì¤‘</h2>
            <p class="upload-modal-subtitle" id="uploadModalSubtitle">íŒŒì¼ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
            
            <div class="upload-steps">
                <div class="upload-step" id="uploadStep1">
                    <span class="step-icon">â³</span>
                    <span class="step-text">íŒŒì¼ ì—…ë¡œë“œ</span>
                    <span class="step-status"></span>
                </div>
                <div class="upload-step" id="uploadStep2">
                    <span class="step-icon">â³</span>
                    <span class="step-text">íŒŒì¼ ìœ í˜• ë¶„ì„</span>
                    <span class="step-status"></span>
                </div>
                <div class="upload-step" id="uploadStep3">
                    <span class="step-icon">â³</span>
                    <span class="step-text">ë¶„ì„í‘œ ë³€í™˜</span>
                    <span class="step-status"></span>
                </div>
                <div class="upload-step" id="uploadStep4">
                    <span class="step-icon">â³</span>
                    <span class="step-text">GRDP ë°ì´í„° ì¶”ì¶œ</span>
                    <span class="step-status"></span>
                </div>
            </div>
            
            <div class="upload-progress-bar">
                <div class="upload-progress-fill" id="uploadProgressFill"></div>
            </div>
            
            <div class="upload-result" id="uploadResult" style="display: none;">
                <div class="result-item">
                    <span class="result-label">ê¸°ì¤€ì‹œì :</span>
                    <span class="result-value" id="resultPeriod"></span>
                </div>
                <div class="result-item">
                    <span class="result-label">ì „êµ­ GRDP:</span>
                    <span class="result-value" id="resultGrdp"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay with Progress -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-icon" id="loadingIcon">ğŸ“Š</div>
            <h2 class="loading-title" id="loadingTitle">ë³´ë„ìë£Œ ìƒì„± ì¤‘</h2>
            <p class="loading-subtitle" id="loadingSubtitle">ëª¨ë“  ë³´ë„ìë£Œë¥¼ ë¯¸ë¦¬ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
            
            <div class="loading-progress-container">
                <div class="loading-progress-bar">
                    <div class="loading-progress-fill" id="loadingProgressFill" style="width: 0%;"></div>
                </div>
                <div class="loading-stats">
                    <span id="loadingProgressText">0 / 50</span>
                    <span id="loadingProgressPercent">0%</span>
                </div>
            </div>
            
            <div class="loading-current-item" id="loadingCurrentItem">
                <span class="loading-current-icon" id="loadingCurrentIcon">ğŸ“„</span>
                <span class="loading-current-text" id="loadingCurrentText">ì¤€ë¹„ ì¤‘...</span>
            </div>
            
            <div class="loading-time-container">
                <div class="loading-time-item">
                    <span class="loading-time-value" id="elapsedTime">00:00</span>
                    <span class="loading-time-label">ê²½ê³¼ ì‹œê°„</span>
                </div>
                <div class="loading-time-item" id="remainingTimeContainer" style="display: none;">
                    <span class="loading-time-value" id="remainingTime">--:--</span>
                    <span class="loading-time-label">ë‚¨ì€ ì‹œê°„</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ê°€ì¤‘ì¹˜ ëˆ„ë½ ê²½ê³  ëª¨ë‹¬ -->
    <div class="upload-modal-overlay" id="weightWarningModal" style="z-index: 1005;">
        <div class="upload-modal-content" style="max-width: 520px;">
            <div class="upload-modal-icon" style="font-size: 3rem; margin-bottom: 1rem;">âš ï¸</div>
            <h2 class="upload-modal-title" style="color: #f59e0b;">ê°€ì¤‘ì¹˜ ì •ë³´ ëˆ„ë½ ê°ì§€</h2>
            <p class="upload-modal-subtitle" style="margin-bottom: 1rem;">
                ì—…ë¡œë“œí•œ ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œì— ì¼ë¶€ <strong>ê°€ì¤‘ì¹˜ ì •ë³´ê°€ ëˆ„ë½</strong>ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<br>
                ì´ë¡œ ì¸í•´ ì¼ë¶€ ë³´ë„ìë£Œ ë‚´ìš©ì´ ì œëŒ€ë¡œ ìƒì„±ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
            
            <!-- ëˆ„ë½ ìƒì„¸ ì •ë³´ -->
            <div id="weightMissingDetails" style="
                background: var(--bg-secondary);
                border-radius: 8px;
                padding: 1rem;
                margin-bottom: 1.5rem;
                max-height: 150px;
                overflow-y: auto;
                text-align: left;
                font-size: 0.8rem;
                color: var(--text-secondary);
            ">
                <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
            </div>
            
            <!-- ì„ íƒ ì˜µì…˜ -->
            <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 1rem;">
                <button id="btnContinueWithMissing" style="
                    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                    color: white;
                    border: none;
                    padding: 0.875rem 1.5rem;
                    border-radius: 8px;
                    font-size: 0.9rem;
                    font-weight: 600;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0.5rem;
                    transition: all 0.2s;
                ">
                    <span>âœ“</span>
                    <span>ê²°ì¸¡ì¹˜ëŠ” N/Aë¡œ ë‘ê³  ì§„í–‰í•˜ê¸°</span>
                </button>
                <p style="font-size: 0.7rem; color: var(--text-muted); margin: 0; padding-left: 0.5rem;">
                    â†’ ëˆ„ë½ëœ ë°ì´í„°ëŠ” "N/A" ë˜ëŠ” ê³µë€ìœ¼ë¡œ í‘œì‹œë˜ë©°, ë‚˜ì¤‘ì— í•œê¸€ì—ì„œ ì§ì ‘ í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                
                <div style="height: 1px; background: var(--border); margin: 0.5rem 0;"></div>
                
                <button id="btnCancelAndReupload" style="
                    background: var(--bg-tertiary);
                    color: var(--text-primary);
                    border: 1px solid var(--border);
                    padding: 0.875rem 1.5rem;
                    border-radius: 8px;
                    font-size: 0.9rem;
                    font-weight: 500;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0.5rem;
                    transition: all 0.2s;
                ">
                    <span>â†©</span>
                    <span>ì‘ì—… ì·¨ì†Œ í›„ ìˆ˜ì§‘í‘œ ìˆ˜ì •í•˜ê¸°</span>
                </button>
                <p style="font-size: 0.7rem; color: var(--text-muted); margin: 0; padding-left: 0.5rem;">
                    â†’ ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œ ì—‘ì…€ íŒŒì¼ì—ì„œ ë¹ˆ ê°€ì¤‘ì¹˜ë¥¼ ì±„ìš´ í›„ ë‹¤ì‹œ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
                </p>
            </div>
            
            <!-- ì•ˆë‚´ ë¬¸êµ¬ -->
            <div style="
                background: rgba(251, 191, 36, 0.1);
                border: 1px solid rgba(251, 191, 36, 0.3);
                border-radius: 6px;
                padding: 0.75rem;
                font-size: 0.75rem;
                color: #b45309;
                text-align: left;
            ">
                <strong>ğŸ’¡ ì°¸ê³ :</strong> ê°€ì¤‘ì¹˜ëŠ” ë¹„ê³µê°œ í†µê³„ ìë£Œë¡œ, ì‹¤ë¬´ìê°€ ì§ì ‘ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.<br>
                ê°€ì¤‘ì¹˜ê°€ ëˆ„ë½ë˜ë©´ ê¸°ì—¬ìœ¨ ê³„ì‚° ë° ì¼ë¶€ ë¶„ì„ ê²°ê³¼ì— ì˜í–¥ì´ ìˆìŠµë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <!-- GRDP Upload Modal -->
    <div class="upload-modal-overlay" id="grdpModal" style="z-index: 1004;">
        <div class="upload-modal-content" style="max-width: 450px;">
            <div class="upload-modal-icon" style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“Š</div>
            <h2 class="upload-modal-title" style="color: #f59e0b;">GRDP ë°ì´í„° í•„ìš”</h2>
            <p class="upload-modal-subtitle" style="margin-bottom: 1.5rem;">
                ê¸°ì´ˆìë£Œì— GRDP ë°ì´í„°ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
                GRDP íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.
            </p>
            
            <!-- GRDP íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
            <div class="grdp-upload-area" style="
                border: 2px dashed var(--border);
                border-radius: 12px;
                padding: 1.5rem;
                margin-bottom: 1rem;
                cursor: pointer;
                transition: all 0.3s;
            " onclick="document.getElementById('grdpModalFileInput').click()">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“</div>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">GRDP ì—‘ì…€ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</p>
                <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: 0.5rem;">ë¶„ê¸° ì§€ì—­ë‚´ì´ìƒì‚° (*.xlsx)</p>
                <input type="file" id="grdpModalFileInput" accept=".xlsx,.xls" style="display: none;" onchange="handleGrdpModalUpload(this)">
            </div>
            
            <!-- ì—…ë¡œë“œ ì§„í–‰ ìƒíƒœ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
            <div id="grdpUploadProgress" style="display: none; margin-bottom: 1rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--accent-secondary);">
                    <span class="spinner" style="
                        width: 16px;
                        height: 16px;
                        border: 2px solid var(--border);
                        border-top-color: var(--accent-primary);
                        border-radius: 50%;
                        animation: spin 1s linear infinite;
                    "></span>
                    <span id="grdpUploadStatus">ì—…ë¡œë“œ ì¤‘...</span>
                </div>
            </div>
            
            <!-- ë²„íŠ¼ ì˜ì—­ -->
            <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1rem;">
                <button onclick="useDefaultGrdp()" style="
                    width: 100%;
                    padding: 0.75rem 1rem;
                    background: linear-gradient(135deg, var(--accent-primary), #8b5cf6);
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 0.85rem;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0.5rem;
                ">
                    <span>â­ï¸</span> GRDP ì—†ì´ ì§„í–‰ (N/Aë¡œ í‘œì‹œ)
                </button>
                <div style="display: flex; gap: 0.75rem;">
                    <button onclick="openKosisGrdpPage()" style="
                        flex: 1;
                        padding: 0.6rem 0.75rem;
                        background: transparent;
                        color: var(--text-secondary);
                        border: 1px solid var(--border);
                        border-radius: 8px;
                        font-size: 0.8rem;
                        cursor: pointer;
                        transition: all 0.3s;
                    ">
                        ğŸ“¥ KOSISì—ì„œ ë‹¤ìš´ë¡œë“œ
                    </button>
                    <button onclick="closeGrdpModalWithoutGenerate()" style="
                        flex: 1;
                        padding: 0.6rem 0.75rem;
                        background: var(--bg-tertiary);
                        color: var(--text-primary);
                        border: 1px solid var(--border);
                        border-radius: 8px;
                        font-size: 0.8rem;
                        cursor: pointer;
                        transition: all 0.3s;
                    ">
                        âœ• ë‚˜ì¤‘ì— ì¶”ê°€
                    </button>
                </div>
            </div>
            
            <!-- ì•ˆë‚´ ë¬¸êµ¬ -->
            <p style="color: var(--text-muted); font-size: 0.7rem; margin-top: 1rem; text-align: center;">
                * GRDP ì—†ì´ë„ ë‹¤ë¥¸ ë³´ë„ìë£ŒëŠ” ì •ìƒì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤<br>
                * ê¸°ë³¸ê°’ ì‚¬ìš© ì‹œ GRDP ê´€ë ¨ ì°¨íŠ¸ëŠ” 0ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤
            </p>
        </div>
    </div>
    
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .grdp-upload-area:hover {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.05);
        }
        
        .grdp-upload-area.dragover {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }
    </style>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // State
        const state = {
            fileUploaded: false,
            allGenerated: false,
            currentReportIndex: -1,
            currentGlobalIndex: -1,  // ì „ì²´ ë³´ë„ìë£Œ í†µí•© ì¸ë±ìŠ¤
            currentPageInReport: 0,  // í˜„ì¬ ë³´ë„ìë£Œ ë‚´ í˜ì´ì§€ ì¸ë±ìŠ¤
            totalPagesInReport: 1,   // í˜„ì¬ ë³´ë„ìë£Œì˜ ì´ í˜ì´ì§€ ìˆ˜
            allReports: [],  // ëª¨ë“  ë³´ë„ìë£Œ í†µí•© ë°°ì—´
            fileType: null,  // 'raw' (ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œ)
            analysisFilename: null,  // ìƒì„±ëœ ë¶„ì„í‘œ íŒŒì¼ëª…
            analysisReady: false,  // ë¶„ì„í‘œ ìƒì„± ì™„ë£Œ ì—¬ë¶€
            reports: [],
            summaryReports: [],
            sectoralReports: [],
            regionalReports: [],
            statisticsReports: [
                { id: 'stat_toc', name: 'í†µê³„í‘œ-ëª©ì°¨', icon: 'ğŸ“‹', description: 'í†µê³„í‘œ ëª©ì°¨' },
                { id: 'stat_mining', name: 'í†µê³„í‘œ-ê´‘ê³µì—…ìƒì‚°ì§€ìˆ˜', icon: 'ğŸ­', description: 'ê´‘ê³µì—…ìƒì‚°ì§€ìˆ˜' },
                { id: 'stat_service', name: 'í†µê³„í‘œ-ì„œë¹„ìŠ¤ì—…ìƒì‚°ì§€ìˆ˜', icon: 'ğŸ¢', description: 'ì„œë¹„ìŠ¤ì—…ìƒì‚°ì§€ìˆ˜' },
                { id: 'stat_retail', name: 'í†µê³„í‘œ-ì†Œë§¤íŒë§¤ì•¡ì§€ìˆ˜', icon: 'ğŸ›’', description: 'ì†Œë§¤íŒë§¤ì•¡ì§€ìˆ˜' },
                { id: 'stat_construction', name: 'í†µê³„í‘œ-ê±´ì„¤ìˆ˜ì£¼ì•¡', icon: 'ğŸ—ï¸', description: 'ê±´ì„¤ìˆ˜ì£¼ì•¡' },
                { id: 'stat_employment', name: 'í†µê³„í‘œ-ê³ ìš©ë¥ ', icon: 'ğŸ‘”', description: 'ê³ ìš©ë¥ ' },
                { id: 'stat_unemployment', name: 'í†µê³„í‘œ-ì‹¤ì—…ë¥ ', icon: 'ğŸ“‰', description: 'ì‹¤ì—…ë¥ ' },
                { id: 'stat_population', name: 'í†µê³„í‘œ-êµ­ë‚´ì¸êµ¬ì´ë™', icon: 'ğŸ‘¥', description: 'êµ­ë‚´ì¸êµ¬ì´ë™' },
                { id: 'stat_export', name: 'í†µê³„í‘œ-ìˆ˜ì¶œì•¡', icon: 'ğŸ“¦', description: 'ìˆ˜ì¶œì•¡' },
                { id: 'stat_import', name: 'í†µê³„í‘œ-ìˆ˜ì…ì•¡', icon: 'ğŸš¢', description: 'ìˆ˜ì…ì•¡' },
                { id: 'stat_price', name: 'í†µê³„í‘œ-ì†Œë¹„ìë¬¼ê°€ì§€ìˆ˜', icon: 'ğŸ’°', description: 'ì†Œë¹„ìë¬¼ê°€ì§€ìˆ˜' },
                { id: 'stat_grdp', name: 'í†µê³„í‘œ-ì°¸ê³ -GRDP', icon: 'ğŸ“Š', description: 'GRDP ì°¸ê³ ' },
                { id: 'stat_appendix', name: 'ë¶€ë¡-ì£¼ìš”ìš©ì–´ì •ì˜', icon: 'ğŸ“–', description: 'ì£¼ìš” ìš©ì–´ ì •ì˜' }
            ],
            // ìºì‹œëœ HTML
            cachedHtml: {
                summary: {},
                sectoral: {},
                regional: {},
                statistics: {}
            },
            generatedReports: {
                summary: new Set(),
                sectoral: new Set(),
                regional: new Set(),
                statistics: new Set()
            },
            reviewedReports: {
                summary: new Set(),
                sectoral: new Set(),
                regional: new Set(),
                statistics: new Set()
            },
            editedReports: {
                summary: new Set(),
                sectoral: new Set(),
                regional: new Set(),
                statistics: new Set()
            },
            htmlCache: {},  // ìµœì¢… ë¬¸ì„œ ìƒì„±ìš© ìºì‹œ
            currentTab: 'summary',
            currentSummaryIndex: -1,
            currentRegionalIndex: -1,
            currentStatisticsIndex: -1,
            // ìƒì„± í†µê³„
            generationStats: {
                total: 0,
                completed: 0,
                startTime: null
            },
            // ë‹´ë‹¹ì ì •ë³´
            contactInfo: {
                release_datetime: '2025. 8. 12.(í™”) 12:00',
                distribution_datetime: '2025. 8. 12.(í™”) 08:30',
                department: 'êµ­ê°€ë°ì´í„°ì²˜ ê²½ì œí†µê³„êµ­',
                division: 'ì†Œë“í†µê³„ê³¼',
                manager_title: 'ê³¼ ì¥',
                manager_name: 'ì •ì„ ê²½',
                manager_phone: '042-481-2206',
                staff_title: 'ì‚¬ë¬´ê´€',
                staff_name: 'ìœ¤ë¯¼í¬',
                staff_phone: '042-481-2226',
                customs_department: 'ê´€ì„¸ì²­ ì •ë³´ë°ì´í„°ê¸°íšë‹´ë‹¹ê´€',
                customs_phone: '042-481-7845'
            },
            // ê°€ì¤‘ì¹˜ ì„¤ì • (ê²°ì¸¡ì¹˜ ëŒ€ì²´ê°’ë§Œ)
            weightSettings: {
                mining: { mode: 'auto', default_value: 1 },      // ê´‘ê³µì—…ìƒì‚°
                service: { mode: 'auto', default_value: 1 },     // ì„œë¹„ìŠ¤ì—…ìƒì‚°
                consumption: { mode: 'auto', default_value: 1 }, // ì†Œë¹„(ì†Œë§¤)
                price: { mode: 'auto', default_value: 1 }        // ë¬¼ê°€
            },
            // ê°€ì¤‘ì¹˜ ëˆ„ë½ ê²€ì¦ ê²°ê³¼
            weightValidation: null,
            // ê°€ì¤‘ì¹˜ ëˆ„ë½ ì‹œ ì§„í–‰ ì—¬ë¶€ (ì‚¬ìš©ì ì„ íƒ)
            continueWithMissingWeights: false
        };

        // DOM Elements
        const elements = {
            uploadZone: document.getElementById('uploadZone'),
            fileInput: document.getElementById('fileInput'),
            uploadFilename: document.getElementById('uploadFilename'),
            // ë³´ë„ìë£Œ ëª©ë¡ ì œê±°ë¨ - ë”ë¯¸ ê°ì²´ë¡œ ëŒ€ì²´
            allReportsList: { innerHTML: '', querySelectorAll: () => [], querySelector: () => null },
            reportCountBadge: { textContent: '' },
            // ê¸°ì¡´ í˜¸í™˜ì„± ìœ ì§€ (ë”ë¯¸)
            summaryReportList: { innerHTML: '', style: { display: 'flex' } },
            reportList: { innerHTML: '', style: { display: 'flex' } },
            regionalReportList: { innerHTML: '', style: { display: 'flex' } },
            statisticsReportList: { innerHTML: '', style: { display: 'flex' } },
            tabSummary: null,
            tabSectoral: null,
            tabRegional: null,
            tabStatistics: null,
            yearSelect: document.getElementById('yearSelect'),
            quarterSelect: document.getElementById('quarterSelect'),
            // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ì œê±°ë¨
            exportBtn: document.getElementById('exportBtn'),
            // ì œê±°ëœ ë²„íŠ¼ë“¤ (ì¶”í›„ ì¬êµ¬í˜„ ì˜ˆì •)
            // exportXlsxBtn, exportHwpImportBtn, exportHwpCopyBtn, saveHtmlToProjectBtn
            // editBtn, saveEditBtn, cancelEditBtn, markReviewedBtn
            previewTitle: document.getElementById('previewTitle'),
            previewPlaceholder: document.getElementById('previewPlaceholder'),
            previewIframe: document.getElementById('previewIframe'),
            editContainer: document.getElementById('editContainer'),
            editContent: document.getElementById('editContent'),
            contactInfoModal: document.getElementById('contactInfoModal'),
            loadingOverlay: document.getElementById('loadingOverlay'),
            loadingTitle: document.getElementById('loadingTitle'),
            loadingSubtitle: document.getElementById('loadingSubtitle'),
            loadingIcon: document.getElementById('loadingIcon'),
            loadingProgressFill: document.getElementById('loadingProgressFill'),
            loadingProgressText: document.getElementById('loadingProgressText'),
            loadingProgressPercent: document.getElementById('loadingProgressPercent'),
            loadingCurrentIcon: document.getElementById('loadingCurrentIcon'),
            loadingCurrentText: document.getElementById('loadingCurrentText'),
            elapsedTime: document.getElementById('elapsedTime'),
            remainingTimeContainer: document.getElementById('remainingTimeContainer'),
            remainingTime: document.getElementById('remainingTime'),
            generationStatus: document.getElementById('generationStatus'),
            generationStatusCount: document.getElementById('generationStatusCount'),
            generationMiniFill: document.getElementById('generationMiniFill'),
            toastContainer: document.getElementById('toastContainer')
        };

        let timerInterval = null;
        let isEditMode = false;
        let originalHtmlBeforeEdit = null;
        let currentEditingReport = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', initApp);

        function initApp() {
            setupEventListeners();
            loadReportList();
            
            // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ (ë¶„ì„ ì™„ë£Œ ì‹œ ì•Œë¦¼ìš©)
            requestNotificationPermission();
        }

        function setupEventListeners() {
            // File upload
            elements.uploadZone.addEventListener('click', () => elements.fileInput.click());
            elements.fileInput.addEventListener('change', handleFileSelect);
            elements.uploadZone.addEventListener('dragover', handleDragOver);
            elements.uploadZone.addEventListener('dragleave', handleDragLeave);
            elements.uploadZone.addEventListener('drop', handleDrop);

            // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°ë¨

            // Actions (ì¡´ì¬í•˜ëŠ” ìš”ì†Œë§Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€)
            if (elements.exportBtn) {
                elements.exportBtn.addEventListener('click', exportFinalDocument);
            }
            // ì œê±°ëœ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤ (ì¶”í›„ ì¬êµ¬í˜„ ì˜ˆì •)
        }

        function loadReportList() {
            fetch('/api/report-order')
                .then(res => res.json())
                .then(data => {
                    state.reports = data.reports;
                    state.summaryReports = data.reports.filter(r => r.category === 'summary');
                    state.sectoralReports = data.reports.filter(r => r.category !== 'summary');
                    state.regionalReports = data.regional_reports || [];
                    
                    // ì´ ë³´ë„ìë£Œ ìˆ˜ ê³„ì‚°
                    state.generationStats.total = 
                        state.summaryReports.length + 
                        state.sectoralReports.length + 
                        state.regionalReports.length + 
                        state.statisticsReports.length;
                    
                    // ì „ì²´ ë³´ë„ìë£Œ ë°°ì—´ ì´ˆê¸°í™” ë° ë Œë”ë§
                    initializeAllReports();
                    renderAllReportsList();
                })
                .catch(err => {
                    console.error('ë³´ë„ìë£Œ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', err);
                    showToast('ë³´ë„ìë£Œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                });
        }

        // ===== ë‹´ë‹¹ì ì •ë³´ ëª¨ë‹¬ í•¨ìˆ˜ =====
        function openContactModal() {
            document.getElementById('releaseDateTime').value = state.contactInfo.release_datetime;
            document.getElementById('distributionDateTime').value = state.contactInfo.distribution_datetime;
            document.getElementById('department').value = state.contactInfo.department;
            document.getElementById('division').value = state.contactInfo.division;
            document.getElementById('managerTitle').value = state.contactInfo.manager_title;
            document.getElementById('managerName').value = state.contactInfo.manager_name;
            document.getElementById('managerPhone').value = state.contactInfo.manager_phone;
            document.getElementById('staffTitle').value = state.contactInfo.staff_title;
            document.getElementById('staffName').value = state.contactInfo.staff_name;
            document.getElementById('staffPhone').value = state.contactInfo.staff_phone;
            document.getElementById('customsDepartment').value = state.contactInfo.customs_department || 'ê´€ì„¸ì²­ ì •ë³´ë°ì´í„°ê¸°íšë‹´ë‹¹ê´€';
            document.getElementById('customsPhone').value = state.contactInfo.customs_phone || '042-481-7845';
            
            elements.contactInfoModal.classList.add('active');
        }

        function closeContactModal() {
            elements.contactInfoModal.classList.remove('active');
        }

        function saveContactInfo() {
            state.contactInfo = {
                release_datetime: document.getElementById('releaseDateTime').value,
                distribution_datetime: document.getElementById('distributionDateTime').value,
                department: document.getElementById('department').value,
                division: document.getElementById('division').value,
                manager_title: document.getElementById('managerTitle').value,
                manager_name: document.getElementById('managerName').value,
                manager_phone: document.getElementById('managerPhone').value,
                staff_title: document.getElementById('staffTitle').value,
                staff_name: document.getElementById('staffName').value,
                staff_phone: document.getElementById('staffPhone').value,
                customs_department: document.getElementById('customsDepartment').value,
                customs_phone: document.getElementById('customsPhone').value
            };
            
            closeContactModal();
            showToast('ë‹´ë‹¹ì ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // ===== ê°€ì¤‘ì¹˜ ì„¤ì • ëª¨ë‹¬ í•¨ìˆ˜ (ë‹¨ìˆœí™” ë²„ì „) =====
        function openWeightSettingsModal() {
            // í˜„ì¬ ê¸°ë³¸ê°’ ë¡œë“œ
            document.getElementById('miningDefaultWeight').value = state.weightSettings.mining.default_value || 1;
            document.getElementById('serviceDefaultWeight').value = state.weightSettings.service.default_value || 1;
            document.getElementById('consumptionDefaultWeight').value = state.weightSettings.consumption?.default_value || 1;
            document.getElementById('priceDefaultWeight').value = state.weightSettings.price?.default_value || 1;
            
            document.getElementById('weightSettingsModal').classList.add('active');
        }
        
        function closeWeightSettingsModal() {
            document.getElementById('weightSettingsModal').classList.remove('active');
        }
        
        function saveWeightSettings() {
            // ê²°ì¸¡ì¹˜ ëŒ€ì²´ê°’ ì €ì¥
            const miningDefault = parseFloat(document.getElementById('miningDefaultWeight').value) || 1;
            const serviceDefault = parseFloat(document.getElementById('serviceDefaultWeight').value) || 1;
            const consumptionDefault = parseFloat(document.getElementById('consumptionDefaultWeight').value) || 1;
            const priceDefault = parseFloat(document.getElementById('priceDefaultWeight').value) || 1;
            
            state.weightSettings = {
                mining: {
                    mode: 'auto',  // í•­ìƒ ê¸°ì´ˆìë£Œì—ì„œ ì¶”ì¶œ
                    default_value: miningDefault  // ê²°ì¸¡ì¹˜ ëŒ€ì²´ê°’
                },
                service: {
                    mode: 'auto',
                    default_value: serviceDefault
                },
                consumption: {
                    mode: 'auto',
                    default_value: consumptionDefault
                },
                price: {
                    mode: 'auto',
                    default_value: priceDefault
                }
            };
            
            closeWeightSettingsModal();
            showToast('ê°€ì¤‘ì¹˜ ê²°ì¸¡ì¹˜ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // Tab switching
        function switchTab(tab) {
            state.currentTab = tab;
            
            elements.tabSummary.classList.toggle('active', tab === 'summary');
            elements.tabSectoral.classList.toggle('active', tab === 'sectoral');
            elements.tabRegional.classList.toggle('active', tab === 'regional');
            elements.tabStatistics.classList.toggle('active', tab === 'statistics');
            
            elements.summaryReportList.style.display = tab === 'summary' ? 'flex' : 'none';
            elements.reportList.style.display = tab === 'sectoral' ? 'flex' : 'none';
            elements.regionalReportList.style.display = tab === 'regional' ? 'flex' : 'none';
            elements.statisticsReportList.style.display = tab === 'statistics' ? 'flex' : 'none';
        }

        // ===== ë¯¸ë¦¬ë³´ê¸° ìƒì„± =====
        async function generateAllReports() {
            if (!state.fileUploaded) {
                showToast('ë¨¼ì € ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.', 'warning');
                return;
            }

            // ì´ˆê¸°í™”
            state.generationStats.completed = 0;
            state.generationStats.startTime = Date.now();
            
            showLoadingProgress();
            startTimer();

            const allItems = [
                ...state.summaryReports.map(r => ({ type: 'summary', report: r })),
                ...state.sectoralReports.map(r => ({ type: 'sectoral', report: r })),
                ...state.regionalReports.map(r => ({ type: 'regional', report: r })),
                ...state.statisticsReports.map(r => ({ type: 'statistics', report: r }))
            ];

            for (let i = 0; i < allItems.length; i++) {
                const item = allItems[i];
                const progress = ((i + 1) / allItems.length) * 100;
                
                // í˜„ì¬ í•­ëª© í‘œì‹œ
                updateLoadingProgress(i + 1, allItems.length, item.report.icon || 'ğŸ“„', item.report.name);
                
                try {
                    await generateSingleReport(item.type, item.report);
                    state.generationStats.completed++;
                } catch (err) {
                    console.error(`${item.report.name} ìƒì„± ì˜¤ë¥˜:`, err);
                }
            }

            stopTimer();
            hideLoading();
            
            // ìƒì„± ì™„ë£Œ ìƒíƒœ í‘œì‹œ
            state.allGenerated = true;
            showGenerationStatus();
            
            // ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ - ì¶”í›„ ì¬êµ¬í˜„ ì˜ˆì •
            console.log('[ì¶œë ¥] ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ ê¸°ëŠ¥ ì¶”í›„ ì¬êµ¬í˜„ ì˜ˆì •');
            
            // ì „ì²´ ë³´ë„ìë£Œ ë°°ì—´ ì´ˆê¸°í™” ë° ë Œë”ë§
            initializeAllReports();
            renderAllReportsList();
            
            // ì²« ë²ˆì§¸ ë³´ë„ìë£Œ ìë™ ì„ íƒ
            if (state.allReports.length > 0) {
                selectGlobalReport(0);
            }
            
            showToast(`âœ… ì „ì²´ ${state.generationStats.completed}ê°œ ë³´ë„ìë£Œ ìƒì„± ì™„ë£Œ!`, 'success');
            
            // ì‹œìŠ¤í…œ ì•Œë¦¼: ë¯¸ë¦¬ë³´ê¸° ìƒì„± ì™„ë£Œ
            sendSystemNotification('ğŸ“‹ ë¯¸ë¦¬ë³´ê¸° ìƒì„± ì™„ë£Œ', `${state.generationStats.completed}ê°œ ë³´ë„ìë£Œ ë¯¸ë¦¬ë³´ê¸° ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ì‹œìŠ¤í…œ ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ ë° ì•Œë¦¼ ë³´ë‚´ê¸°
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }
        
        function sendSystemNotification(title, body) {
            // ë¸Œë¼ìš°ì € ì•Œë¦¼ API ì§€ì› í™•ì¸
            if (!('Notification' in window)) {
                console.log('ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì•Œë¦¼ ê¶Œí•œì´ í—ˆìš©ëœ ê²½ìš°
            if (Notification.permission === 'granted') {
                const notification = new Notification(title, {
                    body: body,
                    icon: 'ğŸ“Š',
                    badge: 'ğŸ“Š',
                    tag: 'analysis-complete',
                    requireInteraction: false
                });
                
                // 3ì´ˆ í›„ ìë™ ë‹«ê¸°
                setTimeout(() => notification.close(), 5000);
                
                // ì•Œë¦¼ í´ë¦­ ì‹œ ì°½ í¬ì»¤ìŠ¤
                notification.onclick = function() {
                    window.focus();
                    notification.close();
                };
            } 
            // ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì§€ ì•Šì€ ê²½ìš° ê¶Œí•œ ìš”ì²­
            else if (Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        sendSystemNotification(title, body);
                    }
                });
            }
            
            // ì‚¬ìš´ë“œ ì•Œë¦¼ (ì„ íƒì )
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleAAAJofI4PKuahEEOnLY8PnLeBMAAFrQ9//tjhAAAD7l//+9cwAAAEDz//+uZgAAOPz//6dbAAAs////nVEAACP///+TRwAAHv///4s9AAAb////hDQAABn///9+LAAA');
                audio.volume = 0.3;
                audio.play().catch(() => {});
            } catch (e) {}
        }

        async function generateSingleReport(type, report) {
            const year = parseInt(elements.yearSelect.value);
            const quarter = parseInt(elements.quarterSelect.value);
            
            let endpoint, body;
            
            switch (type) {
                case 'summary':
                    endpoint = '/api/generate-summary-preview';
                    body = {
                        report_id: report.id,
                        year, quarter,
                        contact_info: state.contactInfo
                    };
                    break;
                case 'sectoral':
                    endpoint = '/api/generate-preview';
                    body = { report_id: report.id, year, quarter };
                    break;
                case 'regional':
                    endpoint = '/api/generate-regional-preview';
                    body = { region_id: report.id };
                    break;
                case 'statistics':
                    endpoint = '/api/generate-statistics-preview';
                    body = { stat_id: report.id, year, quarter };
                    break;
            }

            const response = await fetch(endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });

            const data = await response.json();

            if (data.success) {
                // HTML ìºì‹±
                state.cachedHtml[type][report.id] = data.html;
                state.htmlCache[`${type}_${report.id}`] = data.html;  // ìµœì¢… ë¬¸ì„œìš© ìºì‹œ
                state.generatedReports[type].add(report.id);
            }
            
            return data;
        }

        // ===== ë¡œë”© ì§„í–‰ë¥  í‘œì‹œ =====
        function showLoadingProgress() {
            elements.loadingOverlay.classList.add('active');
        }

        function updateLoadingProgress(current, total, icon, name) {
            const percent = Math.round((current / total) * 100);
            
            elements.loadingProgressFill.style.width = `${percent}%`;
            elements.loadingProgressText.textContent = `${current} / ${total}`;
            elements.loadingProgressPercent.textContent = `${percent}%`;
            elements.loadingCurrentIcon.textContent = icon;
            elements.loadingCurrentText.textContent = name;
        }

        // ===== ì²˜ë¦¬ ì‹œê°„ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° (localStorage) =====
        const PROCESSING_TIME_KEY = 'reportGenerationTime';
        
        function saveProcessingTime(durationMs) {
            const record = {
                duration: durationMs,
                reportCount: state.generationStats.total,
                timestamp: Date.now()
            };
            localStorage.setItem(PROCESSING_TIME_KEY, JSON.stringify(record));
        }
        
        function getEstimatedTime() {
            try {
                const saved = localStorage.getItem(PROCESSING_TIME_KEY);
                if (saved) {
                    const record = JSON.parse(saved);
                    return record;
                }
            } catch (e) {
                console.warn('ì²˜ë¦¬ ì‹œê°„ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
            }
            return null;
        }
        
        function formatTime(ms) {
            const totalSec = Math.floor(ms / 1000);
            const min = Math.floor(totalSec / 60);
            const sec = totalSec % 60;
            return `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
        }

        function startTimer() {
            // ë‚¨ì€ ì‹œê°„ ê³„ì‚°ìš© ì˜ˆìƒ ì‹œê°„ ì„¤ì •
            const estimated = getEstimatedTime();
            if (estimated && estimated.duration) {
                elements.remainingTimeContainer.style.display = 'flex';
                state.estimatedDuration = estimated.duration;
            } else {
                elements.remainingTimeContainer.style.display = 'none';
                state.estimatedDuration = null;
            }
            
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - state.generationStats.startTime;
                elements.elapsedTime.textContent = formatTime(elapsed);
                
                // ë‚¨ì€ ì‹œê°„ ê³„ì‚° (ì˜ˆìƒ ì‹œê°„ì´ ìˆëŠ” ê²½ìš°)
                if (state.estimatedDuration) {
                    const remaining = Math.max(0, state.estimatedDuration - elapsed);
                    elements.remainingTime.textContent = formatTime(remaining);
                    
                    // ì‹œê°„ ì´ˆê³¼ ì‹œ ìŠ¤íƒ€ì¼ ë³€ê²½
                    if (remaining === 0) {
                        elements.remainingTime.style.color = 'var(--warning)';
                        elements.remainingTime.textContent = '+' + formatTime(elapsed - state.estimatedDuration);
                    } else {
                        elements.remainingTime.style.color = '';
                    }
                }
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // ì²˜ë¦¬ ì‹œê°„ ì €ì¥
            if (state.generationStats.startTime) {
                const duration = Date.now() - state.generationStats.startTime;
                saveProcessingTime(duration);
            }
        }

        function hideLoading() {
            elements.loadingOverlay.classList.remove('active');
        }

        function showGenerationStatus() {
            const total = state.generationStats.total;
            const completed = state.generationStats.completed;
            
            elements.generationStatus.classList.add('active');
            elements.generationStatusCount.textContent = `${completed}/${total}`;
            elements.generationMiniFill.style.width = `${(completed / total) * 100}%`;
        }

        // ===== ë³´ë„ìë£Œ ì„ íƒ (ìºì‹œì—ì„œ í‘œì‹œ) =====
        function selectSummaryReport(index) {
            // globalIndexë¡œ ë³€í™˜í•˜ì—¬ í˜¸ì¶œ
            const globalIndex = state.allReports.findIndex(r => r.type === 'summary' && r.originalIndex === index);
            if (globalIndex >= 0) {
                selectGlobalReport(globalIndex);
            }
        }

        function selectReport(index) {
            // globalIndexë¡œ ë³€í™˜í•˜ì—¬ í˜¸ì¶œ
            const globalIndex = state.allReports.findIndex(r => r.type === 'sectoral' && r.originalIndex === index);
            if (globalIndex >= 0) {
                selectGlobalReport(globalIndex);
            }
        }

        function selectRegionalReport(index) {
            // globalIndexë¡œ ë³€í™˜í•˜ì—¬ í˜¸ì¶œ
            const globalIndex = state.allReports.findIndex(r => r.type === 'regional' && r.originalIndex === index);
            if (globalIndex >= 0) {
                selectGlobalReport(globalIndex);
            }
        }

        function selectStatisticsReport(index) {
            // globalIndexë¡œ ë³€í™˜í•˜ì—¬ í˜¸ì¶œ
            const globalIndex = state.allReports.findIndex(r => r.type === 'statistics' && r.originalIndex === index);
            if (globalIndex >= 0) {
                selectGlobalReport(globalIndex);
            }
        }

        function displayCachedReport(type, report, pageIndex = 0) {
            const html = state.cachedHtml[type][report.id];
            
            if (html) {
                // í¸ì§‘ ëª¨ë“œ ì¢…ë£Œ
                if (isEditMode) {
                    exitEditMode();
                }
                
                // HTMLì—ì„œ í˜ì´ì§€(.page) ìš”ì†Œë“¤ ì¶”ì¶œ
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const pages = doc.querySelectorAll('.page');
                
                state.totalPagesInReport = Math.max(1, pages.length);
                state.currentPageInReport = Math.min(pageIndex, state.totalPagesInReport - 1);
                
                let displayHtml = html;
                
                // í˜ì´ì§€ê°€ ì—¬ëŸ¬ ê°œì¸ ê²½ìš° í˜„ì¬ í˜ì´ì§€ë§Œ í‘œì‹œ
                if (pages.length > 1) {
                    const currentPage = pages[state.currentPageInReport];
                    if (currentPage) {
                        // ì›ë³¸ HTMLì˜ head ìœ ì§€í•˜ê³  bodyëŠ” í˜„ì¬ í˜ì´ì§€ë§Œ
                        const headContent = doc.head.innerHTML;
                        displayHtml = `<!DOCTYPE html>
<html lang="ko">
<head>${headContent}</head>
<body style="margin: 0; padding: 0; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; background: #f5f5f5;">
${currentPage.outerHTML}
</body>
</html>`;
                    }
                }
                
                elements.previewPlaceholder.style.display = 'none';
                elements.editContainer.style.display = 'none';
                elements.previewIframe.style.display = 'block';
                elements.previewIframe.srcdoc = displayHtml;
                
                // ì œëª©ì— í˜ì´ì§€ ì •ë³´ í‘œì‹œ
                const pageInfo = state.totalPagesInReport > 1 ? ` (${state.currentPageInReport + 1}/${state.totalPagesInReport})` : '';
                elements.previewTitle.innerHTML = `<span>${report.icon || 'ğŸ“„'}</span><span>${report.name}${pageInfo}</span>`;
                
                // í¸ì§‘/ê²€í†  ë²„íŠ¼ - ì¶”í›„ ì¬êµ¬í˜„ ì˜ˆì •
            } else {
                showToast('ë³´ë„ìë£Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ===== ë Œë”ë§ í•¨ìˆ˜ë“¤ =====
        // ì „ì²´ ë³´ë„ìë£Œ í†µí•© ë°°ì—´ ì´ˆê¸°í™”
        function initializeAllReports() {
            state.allReports = [
                ...state.summaryReports.map((r, idx) => ({ ...r, type: 'summary', originalIndex: idx })),
                ...state.sectoralReports.map((r, idx) => ({ ...r, type: 'sectoral', originalIndex: idx })),
                ...state.regionalReports.map((r, idx) => ({ ...r, type: 'regional', originalIndex: idx, name: `${r.index}. ${r.name}`, sheet: r.full_name })),
                ...state.statisticsReports.map((r, idx) => ({ ...r, type: 'statistics', originalIndex: idx, sheet: r.description }))
            ];
            if (elements.reportCountBadge) {
                elements.reportCountBadge.textContent = `(ì´ ${state.allReports.length}ê°œ)`;
            }
        }

        // ì „ì²´ ë³´ë„ìë£Œ í†µí•© ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderAllReportsList() {
            if (!elements.allReportsList) return;
            
            // íŒŒì¼ì´ ì—…ë¡œë“œë˜ì§€ ì•Šì•˜ê±°ë‚˜ ê¸°ì´ˆìë£Œì¸ ê²½ìš° ì´ˆê¸° ì•ˆë‚´ í‘œì‹œ
            if (!state.fileUploaded) {
                elements.allReportsList.innerHTML = `
                    <div style="padding: 1.5rem; text-align: center; color: var(--text-secondary);">
                        <div style="font-size: 2rem; margin-bottom: 0.75rem;">ğŸ“</div>
                        <div style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem;">íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                        <div style="font-size: 0.75rem; line-height: 1.5; color: var(--text-muted);">
                            â€¢ <strong style="color: var(--warning);">ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œ</strong>: ë¶„ì„í‘œ ìƒì„±<br>
                            â€¢ <strong style="color: var(--success);">ë¶„ì„í‘œ</strong>: ë³´ë„ìë£Œ ìƒì„±
                        </div>
                    </div>
                `;
                return;
            }
            
            // ê¸°ì´ˆìë£Œ ì—…ë¡œë“œ ì‹œ - ë°”ë¡œ ë³´ë„ìë£Œ ìƒì„± ê°€ëŠ¥ (ë¶„ì„í‘œ ë‹¤ìš´ë¡œë“œ ì œê±°ë¨)
            
            let currentSection = '';
            let html = '';
            
            state.allReports.forEach((report, globalIdx) => {
                // ì„¹ì…˜ í—¤ë” ì¶”ê°€
                const sectionNames = { summary: 'ğŸ“‹ ìš”ì•½', sectoral: 'ğŸ“Š ë¶€ë¬¸ë³„', regional: 'ğŸ—ºï¸ ì‹œë„ë³„', statistics: 'ğŸ“ˆ í†µê³„í‘œ' };
                if (report.type !== currentSection) {
                    currentSection = report.type;
                    html += `<div style="font-size: 0.75rem; color: var(--accent-primary); padding: 0.5rem 0.75rem; margin-top: ${globalIdx > 0 ? '0.5rem' : '0'}; background: rgba(99, 102, 241, 0.1); border-radius: 4px;">${sectionNames[report.type]}</div>`;
                }
                
                const isActive = globalIdx === state.currentGlobalIndex;
                const isGenerated = state.generatedReports[report.type].has(report.id);
                const isReviewed = state.reviewedReports[report.type].has(report.id);
                const isEdited = state.editedReports[report.type].has(report.id);
                
                let statusClass = 'pending';
                let statusIcon = 'â—‹';
                if (isReviewed) {
                    statusClass = 'reviewed';
                    statusIcon = 'âœ“';
                } else if (isEdited) {
                    statusClass = 'edited';
                    statusIcon = 'âœï¸';
                } else if (isGenerated) {
                    statusClass = 'generated';
                    statusIcon = 'â—';
                }

                html += `
                    <div class="report-item ${isActive ? 'active' : ''} ${isGenerated ? 'generated' : ''} ${isReviewed ? 'reviewed' : ''} ${isEdited ? 'edited' : ''}"
                         onclick="selectGlobalReport(${globalIdx})"
                         data-report-id="${report.id}"
                         data-global-index="${globalIdx}">
                        <div class="report-icon">${report.icon}</div>
                        <div class="report-info">
                            <div class="report-name">${report.name}</div>
                            <div class="report-sheet">${report.sheet || 'ìš”ì•½ í˜ì´ì§€'}</div>
                        </div>
                        <div class="report-status ${statusClass}">${statusIcon}</div>
                    </div>
                `;
            });
            
            elements.allReportsList.innerHTML = html;
            
            // í˜„ì¬ ì„ íƒëœ í•­ëª©ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            if (state.currentGlobalIndex >= 0) {
                const activeItem = elements.allReportsList.querySelector(`[data-global-index="${state.currentGlobalIndex}"]`);
                if (activeItem) {
                    activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
        }

        // ì „ì²´ ë³´ë„ìë£Œ ì„ íƒ í•¨ìˆ˜
        function selectGlobalReport(globalIndex, pageIndex = 0) {
            if (!state.allGenerated) {
                showToast('ë³´ë„ìë£Œ ìƒì„± ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.', 'info');
                return;
            }
            
            if (globalIndex < 0 || globalIndex >= state.allReports.length) return;
            
            state.currentGlobalIndex = globalIndex;
            const report = state.allReports[globalIndex];
            
            // ê¸°ì¡´ ì¸ë±ìŠ¤ë„ ë™ê¸°í™”
            state.currentSummaryIndex = report.type === 'summary' ? report.originalIndex : -1;
            state.currentReportIndex = report.type === 'sectoral' ? report.originalIndex : -1;
            state.currentRegionalIndex = report.type === 'regional' ? report.originalIndex : -1;
            state.currentStatisticsIndex = report.type === 'statistics' ? report.originalIndex : -1;
            state.currentTab = report.type;
            
            // pageIndexê°€ -1ì´ë©´ ë§ˆì§€ë§‰ í˜ì´ì§€ë¡œ ì´ë™
            let targetPage = pageIndex;
            if (pageIndex === -1) {
                const html = state.cachedHtml[report.type] && state.cachedHtml[report.type][report.id];
                if (html) {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    targetPage = Math.max(0, doc.querySelectorAll('.page').length - 1);
                } else {
                    targetPage = 0;
                }
            }
            
            displayCachedReport(report.type, report, targetPage);
            renderAllReportsList();
        }

        // ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•œ í•¨ìˆ˜ë“¤ (ë‚´ë¶€ì ìœ¼ë¡œ globalIndex ì‚¬ìš©)
        function renderSummaryReportList() { renderAllReportsList(); }
        function renderReportList() { renderAllReportsList(); }
        function renderRegionalReportList() { renderAllReportsList(); }
        function renderStatisticsReportList() { renderAllReportsList(); }

        // ===== ë„¤ë¹„ê²Œì´ì…˜ - ì œê±°ë¨ =====

        // ===== ê²€í†  ì™„ë£Œ - ì œê±°ë¨ (ì¶”í›„ ì¬êµ¬í˜„ ì˜ˆì •) =====

        // ===== íŒŒì¼ ì—…ë¡œë“œ =====
        function handleDragOver(e) {
            e.preventDefault();
            elements.uploadZone.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            elements.uploadZone.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            elements.uploadZone.classList.remove('dragover');
            
            const file = e.dataTransfer.files[0];
            if (file) uploadFile(file);
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) uploadFile(file);
        }

        // ì—…ë¡œë“œ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜
        function showUploadModal() {
            const modal = document.getElementById('uploadModal');
            modal.classList.add('active');
            
            // ì´ˆê¸°í™”
            document.getElementById('uploadModalIcon').textContent = 'ğŸ“¤';
            document.getElementById('uploadModalTitle').textContent = 'íŒŒì¼ ì—…ë¡œë“œ ì¤‘';
            document.getElementById('uploadModalSubtitle').textContent = 'íŒŒì¼ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
            document.getElementById('uploadProgressFill').style.width = '0%';
            document.getElementById('uploadResult').style.display = 'none';
            
            // ëª¨ë“  ìŠ¤í… ì´ˆê¸°í™”
            ['uploadStep1', 'uploadStep2', 'uploadStep3', 'uploadStep4'].forEach(id => {
                const step = document.getElementById(id);
                step.className = 'upload-step';
                step.querySelector('.step-icon').textContent = 'â³';
                step.querySelector('.step-status').textContent = '';
            });
        }
        
        function updateUploadStep(stepNum, status, statusText = '') {
            const step = document.getElementById(`uploadStep${stepNum}`);
            const icon = step.querySelector('.step-icon');
            const statusEl = step.querySelector('.step-status');
            
            step.className = 'upload-step';
            
            if (status === 'active') {
                step.classList.add('active');
                icon.textContent = 'ğŸ”„';
                statusEl.textContent = 'ì§„í–‰ ì¤‘...';
            } else if (status === 'completed') {
                step.classList.add('completed');
                icon.textContent = 'âœ…';
                statusEl.textContent = statusText || 'ì™„ë£Œ';
            } else if (status === 'skipped') {
                step.classList.add('skipped');
                icon.textContent = 'â­ï¸';
                statusEl.textContent = 'ê±´ë„ˆëœ€';
            } else if (status === 'error') {
                step.classList.add('error');
                icon.textContent = 'âŒ';
                statusEl.textContent = statusText || 'ì‹¤íŒ¨';
            }
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            const progress = (stepNum / 4) * 100;
            document.getElementById('uploadProgressFill').style.width = `${progress}%`;
        }
        
        function hideUploadModal(delay = 0) {
            setTimeout(() => {
                document.getElementById('uploadModal').classList.remove('active');
            }, delay);
        }

        async function uploadFile(file) {
            if (!file.name.endsWith('.xlsx') && !file.name.endsWith('.xls')) {
                showToast('ì—‘ì…€ íŒŒì¼(.xlsx, .xls)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            // ì—…ë¡œë“œ ëª¨ë‹¬ í‘œì‹œ
            showUploadModal();
            
            // Step 1: íŒŒì¼ ì—…ë¡œë“œ
            updateUploadStep(1, 'active');
            
            const formData = new FormData();
            formData.append('file', file);

            try {
                // Step 1 ì™„ë£Œ
                await new Promise(r => setTimeout(r, 300));
                updateUploadStep(1, 'completed', file.name);
                
                // Step 2: íŒŒì¼ ìœ í˜• ë¶„ì„
                updateUploadStep(2, 'active');
                document.getElementById('uploadModalSubtitle').textContent = 'íŒŒì¼ ìœ í˜•ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
                
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    // Step 2 ì™„ë£Œ
                    const fileTypeText = data.file_type === 'analysis' ? 'ë¶„ì„í‘œ' : 'ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œ';
                    updateUploadStep(2, 'completed', fileTypeText);
                    
                    // ===== íŠ¸ë™ë³„ ì²˜ë¦¬ =====
                    if (data.file_type === 'raw_direct' || data.file_type === 'raw_with_analysis' || data.file_type === 'raw') {
                        // [íŠ¸ë™ 1] ê¸°ì´ˆìë£Œ â†’ ë°”ë¡œ ë³´ë„ìë£Œ ìƒì„±
                        updateUploadStep(3, 'completed', 'ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ');
                        document.getElementById('uploadModalSubtitle').textContent = 'ë³´ë„ìë£Œ ìƒì„± ì¤€ë¹„ ì¤‘...';
                        await new Promise(r => setTimeout(r, 300));
                        
                        if (data.has_grdp) {
                            updateUploadStep(4, 'completed', 'GRDP í¬í•¨ë¨');
                        } else {
                            updateUploadStep(4, 'warning', 'GRDP: N/A (ë¯¸ì—…ë¡œë“œ)');
                        }
                        
                    } else if (data.file_type === 'analysis') {
                        // [íŠ¸ë™ 2] ë¶„ì„í‘œ ì—…ë¡œë“œ â†’ ë³´ë„ìë£Œ ìƒì„± (ë ˆê±°ì‹œ)
                        updateUploadStep(3, 'skipped', 'ë¶„ì„í‘œ ì§ì ‘ ì—…ë¡œë“œ');
                        
                        if (data.has_grdp) {
                            updateUploadStep(4, 'completed', `GRDP ì‹œíŠ¸: ${data.grdp_sheet || 'ë°œê²¬ë¨'}`);
                        } else {
                            updateUploadStep(4, 'active', 'GRDP ì¶”ê°€ í•„ìš”');
                        }
                    } else {
                        updateUploadStep(3, 'skipped');
                        updateUploadStep(4, 'skipped');
                    }
                    
                    // ì™„ë£Œ ìƒíƒœ í‘œì‹œ
                    document.getElementById('uploadModalIcon').textContent = 'âœ…';
                    document.getElementById('uploadModalTitle').textContent = 'ì—…ë¡œë“œ ì™„ë£Œ!';
                    document.getElementById('uploadModalSubtitle').textContent = 'íŒŒì¼ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
                    document.getElementById('uploadProgressFill').style.width = '100%';
                    
                    // ê²°ê³¼ í‘œì‹œ
                    const resultDiv = document.getElementById('uploadResult');
                    resultDiv.style.display = 'block';
                    document.getElementById('resultPeriod').textContent = `${data.year}ë…„ ${data.quarter}ë¶„ê¸°`;
                    
                    if (data.conversion_info && data.conversion_info.grdp_extracted) {
                        document.getElementById('resultGrdp').textContent = 
                            `${data.conversion_info.national_growth_rate}% (1ìœ„: ${data.conversion_info.top_region})`;
                    } else {
                        document.getElementById('resultGrdp').textContent = '-';
                    }
                    
                    // ê¸°ì¡´ UI ì—…ë°ì´íŠ¸
                    state.fileUploaded = true;
                    state.fileType = data.file_type;
                    
                    elements.uploadZone.classList.add('uploaded');
                    elements.uploadFilename.textContent = `âœ“ ${data.filename}`;
                    elements.uploadFilename.style.display = 'block';
                    elements.uploadZone.querySelector('.upload-icon').textContent = 'âœ…';
                    
                    if (data.file_type === 'raw_direct' || data.file_type === 'raw_with_analysis' || data.file_type === 'raw') {
                        // íŠ¸ë™ 1: ê¸°ì´ˆìë£Œ ì§ì ‘ ì²˜ë¦¬
                        elements.uploadZone.querySelector('.upload-text').textContent = 'ê¸°ì´ˆìë£Œ â†’ ë³´ë„ìë£Œ ìƒì„± ì¤€ë¹„ ì™„ë£Œ!';
                    } else {
                        // íŠ¸ë™ 2: ë¶„ì„í‘œ ì—…ë¡œë“œ (ë ˆê±°ì‹œ)
                        elements.uploadZone.querySelector('.upload-text').textContent = 'ë¶„ì„í‘œ ì—…ë¡œë“œ ì™„ë£Œ! (ë ˆê±°ì‹œ ëª¨ë“œ)';
                    }

                    elements.yearSelect.value = data.year;
                    elements.quarterSelect.value = data.quarter;
                    
                    const periodValue = document.getElementById('periodValue');
                    periodValue.textContent = `${data.year}ë…„ ${data.quarter}ë¶„ê¸°`;
                    periodValue.classList.remove('waiting');
                    
                    // ë³€í™˜ ì •ë³´ í‘œì‹œ
                    const conversionInfo = document.getElementById('conversionInfo');
                    const conversionDetails = document.getElementById('conversionDetails');
                    const grdpInfo = document.getElementById('grdpInfo');
                    
                    const grdpMissing = document.getElementById('grdpMissing');
                    
                    // ===== í”„ë¡œì„¸ìŠ¤ 1: ê¸°ì´ˆìë£Œ â†’ ë³´ë„ìë£Œ ë°”ë¡œ ìƒì„± (ìƒˆë¡œìš´ ì›Œí¬í”Œë¡œìš°) =====
                    if ((data.file_type === 'raw_with_analysis' || data.file_type === 'raw') && data.conversion_info) {
                        conversionInfo.style.display = 'block';
                        conversionDetails.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span style="color: var(--success);">âœ…</span>
                                <span>ê¸°ì´ˆìë£Œ ì²˜ë¦¬ ì™„ë£Œ: ${data.conversion_info.original_file || data.filename}</span>
                            </div>
                        `;
                        
                        // UI ìƒíƒœ ì—…ë°ì´íŠ¸ (ë³´ë„ìë£Œ ìƒì„± ëª¨ë“œë¡œ ë°”ë¡œ ì „í™˜)
                        updateUIForFileType('raw_direct');
                        
                        // GRDP ì •ë³´ í‘œì‹œ (ìˆìœ¼ë©´)
                        if (data.has_grdp && data.conversion_info.grdp_extracted) {
                            grdpInfo.style.display = 'block';
                            const grdpInfoHtml = `
                                <div style="font-size: 0.75rem; font-weight: 600; color: var(--accent-primary); margin-bottom: 0.25rem;">
                                    ğŸ“Š GRDP ë°ì´í„° í¬í•¨
                                </div>
                                <div style="font-size: 0.7rem; color: var(--text-muted);">
                                    ì „êµ­ ì„±ì¥ë¥ : ${data.conversion_info.national_growth_rate || '-'}%
                                </div>
                            `;
                            grdpInfo.innerHTML = grdpInfoHtml;
                            grdpMissing.style.display = 'none';
                        } else if (data.needs_review) {
                            grdpInfo.style.display = 'none';
                            grdpMissing.style.display = 'block';
                            grdpMissing.innerHTML = `
                                <div style="font-size: 0.75rem; font-weight: 600; color: #f59e0b; margin-bottom: 0.25rem;">
                                    âš ï¸ GRDP ë°ì´í„° í™•ì¸ í•„ìš”
                                </div>
                                <div style="font-size: 0.7rem; color: var(--text-muted);">
                                    ê¸°ë³¸ê°’ì´ ì ìš©ë©ë‹ˆë‹¤. ì •í™•í•œ ë°ì´í„°ëŠ” GRDP íŒŒì¼ì„ ë³„ë„ ì—…ë¡œë“œí•˜ì„¸ìš”.
                                </div>
                            `;
                        } else {
                            grdpInfo.style.display = 'none';
                            grdpMissing.style.display = 'none';
                        }
                        
                        // ì•ˆë‚´ ë©”ì‹œì§€
                        document.getElementById('uploadModalSubtitle').textContent = 
                            'ë³´ë„ìë£Œë¥¼ ë°”ë¡œ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!';
                        
                        // ëª¨ë‹¬ ë‹«ê¸° (2ì´ˆ í›„)
                        hideUploadModal(2000);
                        
                        // í† ìŠ¤íŠ¸ ì•ˆë‚´
                        showToast('ğŸ‰ ë³´ë„ìë£Œ ìƒì„± ì¤€ë¹„ ì™„ë£Œ! ë¯¸ë¦¬ë³´ê¸°ì—ì„œ í™•ì¸í•˜ì„¸ìš”.', 'success', 3000);
                        
                        // ë³´ë„ìë£Œ ëª©ë¡ í™œì„±í™” ë° ë¯¸ë¦¬ë³´ê¸° ìƒì„±
                        setTimeout(async () => {
                            // ë³´ë„ìë£Œ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
                            await generateAllReports();
                        }, 500);
                        
                    // ===== raw_direct: ê¸°ì´ˆìë£Œ ì§ì ‘ ì‚¬ìš© (ê°€ì¤‘ì¹˜ ê²€ì¦ í¬í•¨) =====
                    } else if (data.file_type === 'raw_direct') {
                        conversionInfo.style.display = 'block';
                        conversionDetails.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span style="color: var(--success);">âœ…</span>
                                <span>ê¸°ì´ˆìë£Œ ì§ì ‘ ì‚¬ìš©: ${data.filename}</span>
                            </div>
                        `;
                        
                        // UI ìƒíƒœ ì—…ë°ì´íŠ¸
                        updateUIForFileType('raw_direct');
                        
                        // GRDP ì •ë³´ í‘œì‹œ
                        if (data.has_grdp) {
                            grdpInfo.style.display = 'block';
                            grdpMissing.style.display = 'none';
                        } else if (data.needs_review) {
                            grdpInfo.style.display = 'none';
                            grdpMissing.style.display = 'block';
                            grdpMissing.innerHTML = `
                                <div style="font-size: 0.75rem; font-weight: 600; color: #f59e0b; margin-bottom: 0.25rem;">
                                    âš ï¸ GRDP ë°ì´í„° í™•ì¸ í•„ìš”
                                </div>
                                <div style="font-size: 0.7rem; color: var(--text-muted);">
                                    ê¸°ë³¸ê°’ì´ ì ìš©ë©ë‹ˆë‹¤. ì •í™•í•œ ë°ì´í„°ëŠ” GRDP íŒŒì¼ì„ ë³„ë„ ì—…ë¡œë“œí•˜ì„¸ìš”.
                                </div>
                            `;
                        } else {
                            grdpInfo.style.display = 'none';
                            grdpMissing.style.display = 'none';
                        }
                        
                        // ê°€ì¤‘ì¹˜ ê²€ì¦ ê²°ê³¼ ì €ì¥
                        state.weightValidation = data.weight_validation;
                        
                        // ëª¨ë‹¬ ë‹«ê¸°
                        hideUploadModal(1500);
                        
                        // ê°€ì¤‘ì¹˜ ëˆ„ë½ í™•ì¸ í›„ ê²½ê³  ëª¨ë‹¬ ë˜ëŠ” ë°”ë¡œ ì§„í–‰
                        setTimeout(() => {
                            if (data.weight_validation && data.weight_validation.has_missing_weights) {
                                // ê°€ì¤‘ì¹˜ ëˆ„ë½ ê²½ê³  ëª¨ë‹¬ í‘œì‹œ
                                showWeightWarningModal(data.weight_validation);
                            } else {
                                // ê°€ì¤‘ì¹˜ ë¬¸ì œ ì—†ìŒ - ë°”ë¡œ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
                                showToast('ğŸ‰ ë³´ë„ìë£Œ ìƒì„± ì‹œì‘!', 'success', 3000);
                                generateAllReports();
                            }
                        }, 1800);
                        
                    // ===== í”„ë¡œì„¸ìŠ¤ 2: ë¶„ì„í‘œ â†’ GRDP ê²°í•© â†’ ì§€ì—­ê²½ì œë™í–¥ ìƒì„± =====
                    } else if (data.file_type === 'analysis') {
                        // ë¶„ì„í‘œ ì§ì ‘ ì—…ë¡œë“œ
                        conversionInfo.style.display = 'block';
                        conversionDetails.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span style="color: var(--success);">âœ…</span>
                                <span>ë¶„ì„í‘œ ì—…ë¡œë“œ ì™„ë£Œ: ${data.filename}</span>
                            </div>
                        `;
                        
                        // UI ìƒíƒœ ì—…ë°ì´íŠ¸ (ë¶„ì„í‘œ ëª¨ë“œ)
                        updateUIForFileType('analysis');
                        
                        // ë¶„ì„í‘œ ì§ì ‘ ì—…ë¡œë“œ ì‹œ ìƒíƒœ ì´ˆê¸°í™”
                        state.analysisFilename = null;
                        state.analysisReady = false;
                        
                        if (data.needs_grdp) {
                            // GRDPê°€ ì—†ëŠ” ê²½ìš° â†’ GRDP ëª¨ë‹¬ í‘œì‹œ
                            grdpInfo.style.display = 'none';
                            grdpMissing.style.display = 'none';
                            
                            document.getElementById('uploadModalIcon').textContent = 'âœ…';
                            document.getElementById('uploadModalTitle').textContent = 'ë¶„ì„í‘œ ì—…ë¡œë“œ ì™„ë£Œ!';
                            document.getElementById('uploadModalSubtitle').textContent = 'GRDP ë°ì´í„°ë¥¼ ì¶”ê°€ë¡œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.';
                            document.getElementById('uploadProgressFill').style.width = '75%';
                            
                            updateUploadStep(4, 'active', 'GRDP ì¶”ê°€ í•„ìš”');
                            
                            hideUploadModal(1500);
                            setTimeout(() => {
                                showGrdpModal();
                            }, 1600);
                        } else {
                            // GRDPê°€ ìˆëŠ” ê²½ìš° â†’ ë°”ë¡œ ë³´ë„ìë£Œ ìƒì„±
                            grdpInfo.style.display = 'block';
                            grdpMissing.style.display = 'none';
                            
                            document.getElementById('uploadModalIcon').textContent = 'âœ…';
                            document.getElementById('uploadModalTitle').textContent = 'ë¶„ì„í‘œ ì—…ë¡œë“œ ì™„ë£Œ!';
                            document.getElementById('uploadModalSubtitle').textContent = 'GRDP ì‹œíŠ¸ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.';
                            document.getElementById('uploadProgressFill').style.width = '100%';
                            
                            updateUploadStep(3, 'skipped', 'ë¶„ì„í‘œ ì§ì ‘ ì—…ë¡œë“œ');
                            updateUploadStep(4, 'completed', 'GRDP í¬í•¨');
                            
                            hideUploadModal(2000);
                            setTimeout(() => {
                                generateAllReports();
                            }, 2100);
                        }
                    } else {
                        conversionInfo.style.display = 'none';
                        grdpMissing.style.display = 'none';
                        // ëª¨ë‹¬ ë‹«ê¸° (2ì´ˆ í›„) í›„ ìë™ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
                        hideUploadModal(2000);
                        setTimeout(() => {
                            generateAllReports();
                        }, 2100);
                    }
                    
                    // ì‹œìŠ¤í…œ ì•Œë¦¼: ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ
                    sendSystemNotification('ğŸ“ íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ', `${data.filename || 'íŒŒì¼'}ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                } else {
                    // ì˜¤ë¥˜ ë°œìƒ
                    document.getElementById('uploadModalIcon').textContent = 'âŒ';
                    document.getElementById('uploadModalTitle').textContent = 'ì—…ë¡œë“œ ì‹¤íŒ¨';
                    document.getElementById('uploadModalSubtitle').textContent = data.error || 'íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    hideUploadModal(3000);
                    showToast(data.error || 'ì—…ë¡œë“œ ì‹¤íŒ¨', 'error');
                }
            } catch (err) {
                console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', err);
                showToast('íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ===== í¸ì§‘ ëª¨ë“œ í•¨ìˆ˜ë“¤ =====
        function getCurrentReportInfo() {
            // í˜„ì¬ ì„ íƒëœ ë³´ë„ìë£Œ ì •ë³´ ë°˜í™˜
            if (state.currentSummaryIndex >= 0) {
                return { type: 'summary', report: state.summaryReports[state.currentSummaryIndex] };
            } else if (state.currentReportIndex >= 0) {
                return { type: 'sectoral', report: state.sectoralReports[state.currentReportIndex] };
            } else if (state.currentRegionalIndex >= 0) {
                return { type: 'regional', report: state.regionalReports[state.currentRegionalIndex] };
            } else if (state.currentStatisticsIndex >= 0) {
                return { type: 'statistics', report: state.statisticsReports[state.currentStatisticsIndex] };
            }
            return null;
        }

        // ===== í¸ì§‘ ëª¨ë“œ í•¨ìˆ˜ë“¤ - ì œê±°ë¨ (ì¶”í›„ ì¬êµ¬í˜„ ì˜ˆì •) =====


        // ===== í˜„ì¬ ë¯¸ë¦¬ë³´ê¸° iframe ë‚´ìš©ì„ ìºì‹œì— ë™ê¸°í™” =====
        function syncCurrentPreviewToCache() {
            try {
                if (state.currentGlobalIndex < 0 || state.currentGlobalIndex >= state.allReports.length) {
                    console.log('[ìºì‹œ ë™ê¸°í™”] í˜„ì¬ ë³´ê³  ìˆëŠ” ë³´ë„ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const report = state.allReports[state.currentGlobalIndex];
                if (!report) {
                    console.warn('[ìºì‹œ ë™ê¸°í™”] ë³´ê³  ìˆëŠ” ë³´ë„ìë£Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const iframe = elements.previewIframe;
                if (!iframe) {
                    console.warn('[ìºì‹œ ë™ê¸°í™”] previewIframeì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // iframe ì ‘ê·¼ ì‹œë„ (í¬ë¡œìŠ¤ ì˜¤ë¦¬ì§„ ë¬¸ì œ ë°©ì§€)
                let iframeDoc = null;
                try {
                    iframeDoc = iframe.contentDocument || iframe.contentWindow?.document;
                } catch (e) {
                    console.warn('[ìºì‹œ ë™ê¸°í™”] iframe ì ‘ê·¼ ì‹¤íŒ¨ (í¬ë¡œìŠ¤ ì˜¤ë¦¬ì§„):', e);
                    // srcdocë¡œ ì„¤ì •ëœ ê²½ìš° ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥
                    if (iframe.srcdoc) {
                        // srcdocì—ì„œ ì§ì ‘ ì¶”ì¶œ
                        const cacheKey = `${report.type}_${report.id}`;
                        if (state.cachedHtml[report.type] && state.cachedHtml[report.type][report.id]) {
                            state.htmlCache[cacheKey] = state.cachedHtml[report.type][report.id];
                            console.log(`[ìºì‹œ ë™ê¸°í™”] srcdocì—ì„œ ìºì‹œ ë³µì‚¬: ${cacheKey}`);
                        }
                    }
                    return;
                }
                
                if (iframeDoc && iframeDoc.documentElement) {
                    // í˜„ì¬ iframeì˜ HTML ë‚´ìš©ì„ ìºì‹œì— ì €ì¥
                    const currentHtml = iframeDoc.documentElement.outerHTML;
                    const cacheKey = `${report.type}_${report.id}`;
                    state.htmlCache[cacheKey] = currentHtml;
                    if (!state.cachedHtml[report.type]) {
                        state.cachedHtml[report.type] = {};
                    }
                    state.cachedHtml[report.type][report.id] = currentHtml;
                    console.log(`[ìºì‹œ ë™ê¸°í™”] ì„±ê³µ: ${cacheKey} (${currentHtml.length} bytes)`);
                } else {
                    console.warn('[ìºì‹œ ë™ê¸°í™”] iframe ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    // í´ë°±: ê¸°ì¡´ ìºì‹œ ì‚¬ìš©
                    const cacheKey = `${report.type}_${report.id}`;
                    if (state.cachedHtml[report.type] && state.cachedHtml[report.type][report.id]) {
                        state.htmlCache[cacheKey] = state.cachedHtml[report.type][report.id];
                        console.log(`[ìºì‹œ ë™ê¸°í™”] í´ë°±: ê¸°ì¡´ ìºì‹œ ì‚¬ìš© ${cacheKey}`);
                    }
                }
            } catch (e) {
                console.warn('[ìºì‹œ ë™ê¸°í™”] ì˜ˆì™¸ ë°œìƒ:', e);
                // í´ë°±: ëª¨ë“  ìƒì„±ëœ ë³´ë„ìë£Œì˜ ìºì‹œë¥¼ htmlCacheì— ë³µì‚¬
                for (const type of ['summary', 'sectoral', 'regional', 'statistics']) {
                    if (state.cachedHtml[type]) {
                        for (const [id, html] of Object.entries(state.cachedHtml[type])) {
                            const cacheKey = `${type}_${id}`;
                            if (!state.htmlCache[cacheKey]) {
                                state.htmlCache[cacheKey] = html;
                            }
                        }
                    }
                }
                console.log('[ìºì‹œ ë™ê¸°í™”] í´ë°±: ëª¨ë“  ìºì‹œë¥¼ htmlCacheì— ë³µì‚¬ ì™„ë£Œ');
            }
        }
        
        // ===== íŒŒì¼ ì €ì¥ (ì €ì¥ ìœ„ì¹˜ ì„ íƒ ì§€ì›) =====
        async function saveFileWithPicker(blob, filename) {
            // File System Access API ì§€ì› í™•ì¸
            if ('showSaveFilePicker' in window) {
                try {
                    const handle = await window.showSaveFilePicker({
                        suggestedName: filename,
                        types: [{
                            description: 'HTML íŒŒì¼',
                            accept: { 'text/html': ['.html'] }
                        }]
                    });
                    
                    const writable = await handle.createWritable();
                    await writable.write(blob);
                    await writable.close();
                    return true;
                } catch (err) {
                    if (err.name === 'AbortError') {
                        // ì‚¬ìš©ìê°€ ì·¨ì†Œí•¨
                        return false;
                    }
                    console.warn('File System Access API ì˜¤ë¥˜, ê¸°ë³¸ ë‹¤ìš´ë¡œë“œë¡œ ì „í™˜:', err);
                }
            }
            
            // í´ë°±: ê¸°ë³¸ ë‹¤ìš´ë¡œë“œ (ë¸Œë¼ìš°ì € ì„¤ì •ì— ë”°ë¼ ì €ì¥ ìœ„ì¹˜ ë¬»ê¸°)
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            return true;
        }
        
        // ===== A4 í¬ê¸°ì— ë§ê²Œ HTML ìµœì í™” =====
        function optimizeForA4(html) {
            // A4 ì‚¬ì´ì¦ˆ: 210mm x 297mm (ì½˜í…ì¸  ì˜ì—­: 180mm x 265mm)
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // ì´ë¯¸ì§€ ìµœì í™”
            doc.querySelectorAll('img').forEach(img => {
                img.style.maxWidth = '100%';
                img.style.height = 'auto';
                img.style.objectFit = 'contain';
            });
            
            // í‘œ ìµœì í™”
            doc.querySelectorAll('table').forEach(table => {
                table.style.width = '100%';
                table.style.tableLayout = 'fixed';
                table.style.fontSize = '9pt';
                table.style.borderCollapse = 'collapse';
            });
            
            // SVG ìµœì í™”
            doc.querySelectorAll('svg').forEach(svg => {
                svg.style.maxWidth = '100%';
                svg.style.height = 'auto';
            });
            
            // ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ìµœì í™”
            doc.querySelectorAll('.chart-container, .chart-wrapper, .chart-area').forEach(container => {
                container.style.maxWidth = '100%';
                container.style.overflow = 'hidden';
            });
            
            return doc.documentElement.outerHTML;
        }
        
        // ===== Canvasë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜ =====
        function convertCanvasToImageInHtml(html) {
            return new Promise((resolve) => {
                // ì„ì‹œ iframe ìƒì„±í•˜ì—¬ HTML ë Œë”ë§
                const tempIframe = document.createElement('iframe');
                tempIframe.style.cssText = 'position: absolute; left: -9999px; width: 210mm; height: 297mm; visibility: hidden;';
                document.body.appendChild(tempIframe);
                
                const iframeDoc = tempIframe.contentDocument || tempIframe.contentWindow.document;
                iframeDoc.open();
                iframeDoc.write(html);
                iframeDoc.close();
                
                // Chart.js ë Œë”ë§ ëŒ€ê¸° í›„ Canvas ë³€í™˜
                setTimeout(() => {
                    try {
                        const canvases = iframeDoc.querySelectorAll('canvas');
                        
                        canvases.forEach((canvas, idx) => {
                            try {
                                // Canvasê°€ ì‹¤ì œë¡œ ë Œë”ë§ë˜ì—ˆëŠ”ì§€ í™•ì¸
                                if (canvas.width > 0 && canvas.height > 0) {
                                    const dataUrl = canvas.toDataURL('image/png', 1.0);
                                    
                                    // Canvasë¥¼ img íƒœê·¸ë¡œ ëŒ€ì²´
                                    const img = iframeDoc.createElement('img');
                                    img.src = dataUrl;
                                    img.style.cssText = canvas.style.cssText || '';
                                    img.style.maxWidth = '100%';
                                    img.style.height = 'auto';
                                    img.className = canvas.className;
                                    img.setAttribute('data-converted-from', 'canvas');
                                    
                                    if (canvas.parentNode) {
                                        canvas.parentNode.replaceChild(img, canvas);
                                    }
                                }
                            } catch (e) {
                                console.warn(`Canvas ${idx} ë³€í™˜ ì‹¤íŒ¨:`, e);
                            }
                        });
                        
                        // ë³€í™˜ëœ HTML ì¶”ì¶œ
                        const convertedHtml = iframeDoc.documentElement.outerHTML;
                        document.body.removeChild(tempIframe);
                        resolve(convertedHtml);
                    } catch (e) {
                        console.warn('Canvas ë³€í™˜ ì˜¤ë¥˜:', e);
                        document.body.removeChild(tempIframe);
                        resolve(html); // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì›ë³¸ ë°˜í™˜
                    }
                }, 1500); // Chart.js ë Œë”ë§ì„ ìœ„í•´ 1.5ì´ˆ ëŒ€ê¸°
            });
        }
        
        // ===== ìµœì¢… ë¬¸ì„œ ë‚´ë³´ë‚´ê¸° =====
        async function exportFinalDocument() {
            console.log('[ì¶œë ¥] HTML ë¬¸ì„œ ë‚´ë³´ë‚´ê¸° ì‹œì‘');
            console.log('[ì¶œë ¥] allGenerated ìƒíƒœ:', state.allGenerated);
            
            // ë²„íŠ¼ ë¹„í™œì„±í™” (ì¤‘ë³µ í´ë¦­ ë°©ì§€)
            if (elements.exportBtn) {
                elements.exportBtn.disabled = true;
                elements.exportBtn.style.opacity = '0.6';
                elements.exportBtn.style.cursor = 'not-allowed';
            }
            
            // allGenerated ì²´í¬ë¥¼ ë” ìœ ì—°í•˜ê²Œ (ìƒì„±ëœ ë³´ë„ìë£Œê°€ ìˆìœ¼ë©´ ì§„í–‰)
            const hasGeneratedReports = Object.keys(state.generatedReports).some(
                type => state.generatedReports[type] && state.generatedReports[type].size > 0
            );
            
            if (!state.allGenerated && !hasGeneratedReports) {
                showToast('ë¨¼ì € ëª¨ë“  ë³´ë„ìë£Œë¥¼ ìƒì„±í•˜ì„¸ìš”.', 'warning');
                if (elements.exportBtn) {
                    elements.exportBtn.disabled = false;
                    elements.exportBtn.style.opacity = '1';
                    elements.exportBtn.style.cursor = 'pointer';
                }
                return;
            }
            
            // í˜„ì¬ ë¯¸ë¦¬ë³´ê¸° ë‚´ìš©ì„ ìºì‹œì— ë™ê¸°í™”
            try {
                syncCurrentPreviewToCache();
            } catch (e) {
                console.warn('[ì¶œë ¥] ìºì‹œ ë™ê¸°í™” ì‹¤íŒ¨ (ê³„ì† ì§„í–‰):', e);
            }
            
            // ë¡œë”© í‘œì‹œ
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingTitle = document.getElementById('loadingTitle');
            const loadingProgress = document.getElementById('loadingProgress');
            const loadingPercent = document.getElementById('loadingPercent');
            const loadingCurrent = document.getElementById('loadingCurrent');
            
            if (!loadingOverlay || !loadingTitle || !loadingProgress || !loadingPercent || !loadingCurrent) {
                console.error('[ì¶œë ¥] ë¡œë”© UI ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                showToast('ë¡œë”© UI ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                if (elements.exportBtn) {
                    elements.exportBtn.disabled = false;
                    elements.exportBtn.style.opacity = '1';
                    elements.exportBtn.style.cursor = 'pointer';
                }
                return;
            }
            
            loadingOverlay.style.display = 'flex';
            loadingTitle.textContent = 'ğŸ“„ HTML ë¬¸ì„œ ìƒì„± ì¤‘...';
            loadingCurrent.textContent = 'í˜ì´ì§€ ìˆ˜ì§‘ ì¤‘';
            loadingProgress.style.width = '0%';
            loadingPercent.textContent = '0%';
            
            try {
                // ëª¨ë“  ìºì‹œëœ HTML ìˆ˜ì§‘ (ìˆœì„œëŒ€ë¡œ)
                const rawPages = [];
                
                // HTML ê°€ì ¸ì˜¤ê¸° í—¬í¼ í•¨ìˆ˜ (htmlCache ìš°ì„ , cachedHtml í´ë°±)
                const getHtmlContent = (type, id) => {
                    const cacheKey = `${type}_${id}`;
                    // htmlCache ìš°ì„  í™•ì¸ (í¸ì§‘ëœ ë‚´ìš© í¬í•¨)
                    if (state.htmlCache[cacheKey]) {
                        return state.htmlCache[cacheKey];
                    }
                    // cachedHtml í´ë°±
                    if (state.cachedHtml[type] && state.cachedHtml[type][id]) {
                        return state.cachedHtml[type][id];
                    }
                    return null;
                };
                
                // 1. ìš”ì•½ ë³´ë„ìë£Œ
                for (const report of state.summaryReports) {
                    const html = getHtmlContent('summary', report.id);
                    if (html) {
                        rawPages.push({
                            html: html,
                            title: report.name,
                            category: 'summary'
                        });
                    }
                }
                
                // 2. ë¶€ë¬¸ë³„ ë³´ë„ìë£Œ
                for (const report of state.sectoralReports) {
                    const html = getHtmlContent('sectoral', report.id);
                    if (html) {
                        rawPages.push({
                            html: html,
                            title: report.name,
                            category: 'sectoral'
                        });
                    }
                }
                
                // 3. ì‹œë„ë³„ ë³´ë„ìë£Œ
                for (const region of state.regionalReports) {
                    const html = getHtmlContent('regional', region.id);
                    if (html) {
                        rawPages.push({
                            html: html,
                            title: region.name,
                            category: 'regional'
                        });
                    }
                }
                
                // 4. í†µê³„í‘œ
                for (const stat of state.statisticsReports) {
                    const html = getHtmlContent('statistics', stat.id);
                    if (html) {
                        rawPages.push({
                            html: html,
                            title: stat.name,
                            category: 'statistics'
                        });
                    }
                }
                
                // í˜ì´ì§€ê°€ ë¹„ì–´ìˆëŠ” ê²½ìš° ì—ëŸ¬ ì²˜ë¦¬
                if (rawPages.length === 0) {
                    loadingOverlay.style.display = 'none';
                    showToast('ìƒì„±ëœ ë³´ë„ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë³´ë„ìë£Œë¥¼ ìƒì„±í•˜ì„¸ìš”.', 'error');
                    return;
                }
                
                loadingCurrent.textContent = `${rawPages.length}ê°œ í˜ì´ì§€ ìˆ˜ì§‘ ì™„ë£Œ, ì°¨íŠ¸ ë³€í™˜ ì¤‘...`;
                loadingProgress.style.width = '20%';
                loadingPercent.textContent = '20%';
                
                // Canvasë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜ (ê° í˜ì´ì§€ ìˆœì°¨ ì²˜ë¦¬)
                const pages = [];
                for (let i = 0; i < rawPages.length; i++) {
                    const page = rawPages[i];
                    const progress = 20 + Math.floor((i / rawPages.length) * 60);
                    loadingProgress.style.width = `${progress}%`;
                    loadingPercent.textContent = `${progress}%`;
                    loadingCurrent.textContent = `ì°¨íŠ¸ ë³€í™˜ ì¤‘... (${i + 1}/${rawPages.length}) ${page.title}`;
                    
                    // Canvasê°€ í¬í•¨ëœ í˜ì´ì§€ë§Œ ë³€í™˜ ì²˜ë¦¬
                    let convertedHtml = page.html;
                    if (page.html.includes('<canvas')) {
                        try {
                            convertedHtml = await convertCanvasToImageInHtml(page.html);
                        } catch (e) {
                            console.warn(`í˜ì´ì§€ ${i + 1} ë³€í™˜ ì‹¤íŒ¨:`, e);
                        }
                    }
                    
                    // A4 í¬ê¸°ì— ë§ê²Œ ìµœì í™”
                    convertedHtml = optimizeForA4(convertedHtml);
                    
                    pages.push({
                        html: convertedHtml,
                        title: page.title,
                        category: page.category
                    });
                }
                
                loadingCurrent.textContent = `${pages.length}ê°œ í˜ì´ì§€ ë³€í™˜ ì™„ë£Œ, HTML ìƒì„± ì¤‘...`;
                loadingProgress.style.width = '85%';
                loadingPercent.textContent = '85%';
                
                // ì—°ë„/ë¶„ê¸° ê°€ì ¸ì˜¤ê¸°
                const year = parseInt(elements.yearSelect.value) || 2025;
                const quarter = parseInt(elements.quarterSelect.value) || 2;
                
                // API í˜¸ì¶œ (standalone HTML ìƒì„± ì˜µì…˜ ì¶”ê°€)
                console.log(`[ì¶œë ¥] API í˜¸ì¶œ: /api/export-final (${pages.length}ê°œ í˜ì´ì§€)`);
                const response = await fetch('/api/export-final', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        pages: pages,
                        year: year,
                        quarter: quarter,
                        standalone: true  // ì™„ì „í•œ standalone HTML ìš”ì²­
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('[ì¶œë ¥] API ì‘ë‹µ:', result.success ? 'ì„±ê³µ' : 'ì‹¤íŒ¨', result);
                
                loadingProgress.style.width = '100%';
                loadingPercent.textContent = '100%';
                
                if (result.success) {
                    loadingCurrent.textContent = 'ì €ì¥ ìœ„ì¹˜ ì„ íƒ ì¤‘...';
                    
                    // ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê³  íŒŒì¼ ì €ì¥ ëŒ€í™”ìƒì í‘œì‹œ
                    loadingOverlay.style.display = 'none';
                    
                    // íŒŒì¼ ì €ì¥ (ì‚¬ìš©ìê°€ ìœ„ì¹˜ ì„ íƒ)
                    const blob = new Blob([result.html], { type: 'text/html; charset=utf-8' });
                    const saved = await saveFileWithPicker(blob, result.filename);
                    
                    if (saved) {
                        showToast(`âœ… ${result.total_pages}í˜ì´ì§€ HTML ë¬¸ì„œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\nì°¨íŠ¸ê°€ ì´ë¯¸ì§€ë¡œ ë³€í™˜ë˜ì–´ ì˜¤í”„ë¼ì¸ì—ì„œë„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`, 'success');
                        
                        // ì‘ì—… ì™„ë£Œ í›„ ì—…ë¡œë“œ í´ë” ì •ë¦¬
                        setTimeout(async () => {
                            try {
                                const cleanupResponse = await fetch('/api/cleanup-uploads', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' }
                                });
                                const cleanupResult = await cleanupResponse.json();
                                if (cleanupResult.success && cleanupResult.deleted_count > 0) {
                                    console.log(`[ì •ë¦¬] ${cleanupResult.deleted_count}ê°œ íŒŒì¼ ì •ë¦¬ ì™„ë£Œ`);
                                }
                            } catch (e) {
                                console.warn('ì—…ë¡œë“œ í´ë” ì •ë¦¬ ì‹¤íŒ¨:', e);
                            }
                        }, 1000);
                    } else {
                        showToast('ì €ì¥ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
                    }
                } else {
                    loadingOverlay.style.display = 'none';
                    const errorMsg = result.error || 'ë¬¸ì„œ ìƒì„± ì‹¤íŒ¨';
                    console.error('[ì¶œë ¥] ë¬¸ì„œ ìƒì„± ì‹¤íŒ¨:', errorMsg);
                    showToast(`ë¬¸ì„œ ìƒì„± ì‹¤íŒ¨: ${errorMsg}`, 'error');
                }
            } catch (err) {
                console.error('[ì¶œë ¥] ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:', err);
                const loadingOverlay = document.getElementById('loadingOverlay');
                if (loadingOverlay) {
                    loadingOverlay.style.display = 'none';
                }
                showToast(`ë¬¸ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${err.message || err}`, 'error');
            } finally {
                // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                if (elements.exportBtn) {
                    elements.exportBtn.disabled = false;
                    elements.exportBtn.style.opacity = '1';
                    elements.exportBtn.style.cursor = 'pointer';
                }
            }
        }

        // ===== XLSX ë¬¸ì„œ ë‚´ë³´ë‚´ê¸° - ì œê±°ë¨ (ì¶”í›„ ì¬êµ¬í˜„ ì˜ˆì •) =====

        // ===== Canvasë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜ (ì›ë³¸ ë¹„ìœ¨ ìœ ì§€) - í•œê¸€ìš© =====
        function convertCanvasToImageForHwp(html) {
            return new Promise((resolve) => {
                // ì„ì‹œ iframe ìƒì„±í•˜ì—¬ HTML ë Œë”ë§
                const tempIframe = document.createElement('iframe');
                tempIframe.style.cssText = 'position: absolute; left: -9999px; width: 210mm; height: 297mm; visibility: hidden;';
                document.body.appendChild(tempIframe);
                
                const iframeDoc = tempIframe.contentDocument || tempIframe.contentWindow.document;
                iframeDoc.open();
                iframeDoc.write(html);
                iframeDoc.close();
                
                // Chart.js ë Œë”ë§ ëŒ€ê¸° í›„ Canvas ë³€í™˜
                setTimeout(() => {
                    try {
                        const canvases = iframeDoc.querySelectorAll('canvas');
                        
                        canvases.forEach((canvas, idx) => {
                            try {
                                // Canvasê°€ ì‹¤ì œë¡œ ë Œë”ë§ë˜ì—ˆëŠ”ì§€ í™•ì¸
                                if (canvas.width > 0 && canvas.height > 0) {
                                    // ì›ë³¸ ë¹„ìœ¨ ê³„ì‚°
                                    const originalWidth = canvas.width;
                                    const originalHeight = canvas.height;
                                    const aspectRatio = originalWidth / originalHeight;
                                    
                                    // ê³ í’ˆì§ˆ ì´ë¯¸ì§€ë¡œ ë³€í™˜
                                    const dataUrl = canvas.toDataURL('image/png', 1.0);
                                    
                                    // Canvasë¥¼ img íƒœê·¸ë¡œ ëŒ€ì²´ (ì›ë³¸ ë¹„ìœ¨ ìœ ì§€)
                                    const img = iframeDoc.createElement('img');
                                    img.src = dataUrl;
                                    img.setAttribute('data-original-width', originalWidth);
                                    img.setAttribute('data-original-height', originalHeight);
                                    img.setAttribute('data-aspect-ratio', aspectRatio.toFixed(4));
                                    img.style.cssText = `max-width: 100%; width: auto; height: auto; display: block; margin: 0 auto;`;
                                    img.className = 'chart-image-converted';
                                    
                                    if (canvas.parentNode) {
                                        canvas.parentNode.replaceChild(img, canvas);
                                    }
                                }
                            } catch (e) {
                                console.warn(`Canvas ${idx} ë³€í™˜ ì‹¤íŒ¨:`, e);
                            }
                        });
                        
                        // SVGë„ ì´ë¯¸ì§€ë¡œ ë³€í™˜
                        const svgs = iframeDoc.querySelectorAll('svg');
                        svgs.forEach((svg, idx) => {
                            try {
                                const svgData = new XMLSerializer().serializeToString(svg);
                                const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
                                const url = URL.createObjectURL(svgBlob);
                                
                                // SVGë¥¼ Canvasë¡œ ê·¸ë¦° í›„ PNGë¡œ ë³€í™˜
                                const svgWidth = svg.getBoundingClientRect().width || 400;
                                const svgHeight = svg.getBoundingClientRect().height || 300;
                                
                                const tempCanvas = document.createElement('canvas');
                                tempCanvas.width = svgWidth * 2; // ê³ í•´ìƒë„
                                tempCanvas.height = svgHeight * 2;
                                const ctx = tempCanvas.getContext('2d');
                                ctx.scale(2, 2);
                                
                                const tempImg = new Image();
                                tempImg.onload = function() {
                                    ctx.drawImage(tempImg, 0, 0);
                                    const dataUrl = tempCanvas.toDataURL('image/png', 1.0);
                                    
                                    const img = iframeDoc.createElement('img');
                                    img.src = dataUrl;
                                    img.style.cssText = `max-width: 100%; width: ${svgWidth}px; height: auto; display: block;`;
                                    img.className = 'svg-image-converted';
                                    
                                    if (svg.parentNode) {
                                        svg.parentNode.replaceChild(img, svg);
                                    }
                                    URL.revokeObjectURL(url);
                                };
                                tempImg.src = url;
                            } catch (e) {
                                console.warn(`SVG ${idx} ë³€í™˜ ì‹¤íŒ¨:`, e);
                            }
                        });
                        
                        // ì•½ê°„ ë” ëŒ€ê¸° í›„ ê²°ê³¼ ë°˜í™˜ (SVG ë³€í™˜ ì™„ë£Œ ëŒ€ê¸°)
                        setTimeout(() => {
                            const convertedHtml = iframeDoc.documentElement.outerHTML;
                            document.body.removeChild(tempIframe);
                            resolve(convertedHtml);
                        }, 500);
                    } catch (e) {
                        console.warn('Canvas/SVG ë³€í™˜ ì˜¤ë¥˜:', e);
                        document.body.removeChild(tempIframe);
                        resolve(html); // ë³€í™˜ ì‹¤íŒ¨ ì‹œ ì›ë³¸ ë°˜í™˜
                    }
                }, 2000); // Chart.js ë Œë”ë§ì„ ìœ„í•´ 2ì´ˆ ëŒ€ê¸°
            });
        }
        
        // ===== í•œê¸€ìš© XML ë¬¸ì„œ ë‚´ë³´ë‚´ê¸° - ì œê±°ë¨ (ì¶”í›„ ì¬êµ¬í˜„ ì˜ˆì •) =====

        // ===== í•œê¸€(HWP) ë³µë¶™ìš© HTML ë‚´ë³´ë‚´ê¸° - ì œê±°ë¨ (ì¶”í›„ ì¬êµ¬í˜„ ì˜ˆì •) =====

        // ===== í”„ë¡œì íŠ¸ ë©”ì¸ ë””ë ‰í† ë¦¬ì— HTML ì €ì¥ - ì œê±°ë¨ (ì¶”í›„ ì¬êµ¬í˜„ ì˜ˆì •) =====

        // ===== ê°€ì¤‘ì¹˜ ê²½ê³  ëª¨ë‹¬ í•¨ìˆ˜ =====
        function showWeightWarningModal(weightValidation) {
            // ì—…ë¡œë“œ ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ë¨¼ì € ë‹«ê¸°
            const uploadModal = document.getElementById('uploadModal');
            if (uploadModal && uploadModal.classList.contains('active')) {
                uploadModal.classList.remove('active');
            }
            
            const modal = document.getElementById('weightWarningModal');
            const detailsDiv = document.getElementById('weightMissingDetails');
            
            // ìƒì„¸ ì •ë³´ ì±„ìš°ê¸°
            let detailsHtml = '';
            if (weightValidation.missing_details && weightValidation.missing_details.length > 0) {
                weightValidation.missing_details.forEach(detail => {
                    detailsHtml += `<div style="margin-bottom: 0.75rem;">
                        <strong style="color: var(--warning);">ğŸ“‹ ${detail.sheet}</strong><br>
                        <span style="font-size: 0.75rem;">ëˆ„ë½ ${detail.missing_count}ê±´ / ì „ì²´ ${detail.total_count}ê±´</span>
                    `;
                    
                    if (detail.missing_industries && detail.missing_industries.length > 0) {
                        detailsHtml += `<div style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.7rem; color: var(--text-muted);">`;
                        detail.missing_industries.slice(0, 5).forEach(item => {
                            detailsHtml += `â€¢ ${item.region} - ${item.industry}<br>`;
                        });
                        if (detail.missing_industries.length > 5) {
                            detailsHtml += `<span style="color: var(--text-muted);">ì™¸ ${detail.missing_industries.length - 5}ê±´ ë”...</span>`;
                        }
                        detailsHtml += `</div>`;
                    }
                    detailsHtml += `</div>`;
                });
            } else {
                detailsHtml = '<p>ê°€ì¤‘ì¹˜ ëˆ„ë½ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            
            detailsDiv.innerHTML = detailsHtml;
            
            // ë²„íŠ¼ ì´ë²¤íŠ¸ ì„¤ì •
            document.getElementById('btnContinueWithMissing').onclick = () => {
                state.continueWithMissingWeights = true;
                hideWeightWarningModal();
                // ì—…ë¡œë“œ í›„ ì²˜ë¦¬ ê³„ì† ì§„í–‰
                proceedAfterWeightWarning();
            };
            
            document.getElementById('btnCancelAndReupload').onclick = () => {
                state.continueWithMissingWeights = false;
                hideWeightWarningModal();
                // ì´ˆê¸° ìƒíƒœë¡œ ë¦¬ì…‹
                resetUploadState();
                showToast('ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œë¥¼ ìˆ˜ì • í›„ ë‹¤ì‹œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'info', 4000);
            };
            
            modal.classList.add('active');
        }
        
        function hideWeightWarningModal() {
            document.getElementById('weightWarningModal').classList.remove('active');
        }
        
        function resetUploadState() {
            // ì—…ë¡œë“œ ìƒíƒœ ì´ˆê¸°í™”
            state.fileUploaded = false;
            state.fileType = null;
            state.weightValidation = null;
            state.continueWithMissingWeights = false;
            
            // UI ì´ˆê¸°í™”
            elements.uploadZone.classList.remove('uploaded');
            elements.uploadFilename.style.display = 'none';
            elements.uploadZone.querySelector('.upload-icon').textContent = 'ğŸ“';
            elements.uploadZone.querySelector('.upload-text').innerHTML = `
                <span style="color: var(--success);">ê¸°ì´ˆìë£Œ ìˆ˜ì§‘í‘œ</span> â†’ ë³´ë„ìë£Œ ì§ì ‘ ìƒì„±<br>
                <span style="color: var(--text-muted);">(ì°¨íŠ¸/ì¸í¬ê·¸ë˜í”½ ì œì™¸, í‘œ ê¸°ë°˜)</span>
            `;
            
            document.getElementById('periodValue').textContent = 'íŒŒì¼ ì—…ë¡œë“œ ëŒ€ê¸°ì¤‘...';
            document.getElementById('periodValue').classList.add('waiting');
            
            // ë³´ë„ìë£Œ ëª©ë¡ ì´ˆê¸°í™”
            renderAllReportsList();
        }
        
        // ê°€ì¤‘ì¹˜ ê²½ê³  í›„ ê³„ì† ì§„í–‰ ì‹œ í˜¸ì¶œ
        function proceedAfterWeightWarning() {
            // ë³´ë„ìë£Œ ìƒì„± ì§„í–‰
            showToast('ê²°ì¸¡ ë°ì´í„°ëŠ” N/Aë¡œ í‘œì‹œë©ë‹ˆë‹¤. ë³´ë„ìë£Œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.', 'info', 3000);
            
            // ë³´ë„ìë£Œ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
            setTimeout(() => {
                generateAllReports();
            }, 500);
        }

        // ===== GRDP ëª¨ë‹¬ í•¨ìˆ˜ =====
        function showGrdpModal() {
            // ë‹¤ë¥¸ ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ë¨¼ì € ë‹«ê¸°
            const weightModal = document.getElementById('weightWarningModal');
            if (weightModal && weightModal.classList.contains('active')) {
                hideWeightWarningModal();
            }
            
            const modal = document.getElementById('grdpModal');
            modal.classList.add('active');
            
            // ì´ˆê¸°í™”
            document.getElementById('grdpUploadProgress').style.display = 'none';
            document.getElementById('grdpModalFileInput').value = '';
        }
        
        function closeGrdpModal() {
            document.getElementById('grdpModal').classList.remove('active');
            // GRDP ëª¨ë‹¬ ë‹«íŒ í›„ ìë™ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
            if (!state.allGenerated) {
                setTimeout(() => {
                    generateAllReports();
                }, 500);
            }
        }
        
        function closeGrdpModalWithoutGenerate() {
            // GRDP ì—†ì´ N/Aë¡œ ì§„í–‰
            document.getElementById('grdpModal').classList.remove('active');
            showToast('GRDP ë°ì´í„°ê°€ N/Aë¡œ í‘œì‹œë©ë‹ˆë‹¤. KOSISì—ì„œ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë‚˜ì¤‘ì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'warning');
            
            // ë¯¸ë¦¬ë³´ê¸° ìƒì„±ì€ ì‹œì‘
            if (!state.allGenerated) {
                setTimeout(() => {
                    generateAllReports();
                }, 500);
            }
        }
        
        async function useDefaultGrdp() {
            // GRDP ë°ì´í„° ì—†ì´ N/Aë¡œ ì§„í–‰
            document.getElementById('grdpUploadProgress').style.display = 'block';
            document.getElementById('grdpUploadStatus').textContent = 'N/Aë¡œ ì§„í–‰ ì„¤ì • ì¤‘...';
            
            try {
                const response = await fetch('/api/use-default-grdp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('grdpUploadStatus').textContent = 'âœ… N/Aë¡œ ì§„í–‰í•©ë‹ˆë‹¤';
                    
                    // GRDP ì •ë³´ ì—…ë°ì´íŠ¸
                    document.getElementById('grdpMissing').style.display = 'block';
                    document.getElementById('grdpMissing').innerHTML = '<span style="color: var(--warning-color);">âš ï¸ GRDP: N/A (ë°ì´í„° ë¯¸ì—…ë¡œë“œ)</span>';
                    document.getElementById('grdpInfo').style.display = 'none';
                    
                    showToast('GRDP ë°ì´í„°ê°€ N/Aë¡œ í‘œì‹œë©ë‹ˆë‹¤. ë‚˜ì¤‘ì— KOSISì—ì„œ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”.', 'warning');
                    
                    // 1ì´ˆ í›„ ëª¨ë‹¬ ë‹«ê³  ë³´ë„ìë£Œ ìƒì„±
                    setTimeout(() => {
                        closeGrdpModal();
                    }, 1000);
                } else {
                    document.getElementById('grdpUploadStatus').textContent = 'âŒ ì„¤ì • ì‹¤íŒ¨';
                    showToast(data.error || 'GRDP ì„¤ì • ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                document.getElementById('grdpUploadStatus').textContent = 'âŒ ì˜¤ë¥˜ ë°œìƒ';
                showToast('GRDP ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                console.error('Default GRDP error:', error);
            }
        }
        
        function openKosisGrdpPage() {
            // KOSIS ì‹¤í—˜ì í†µê³„ í˜ì´ì§€ ì—´ê¸°
            window.open('https://kosis.kr/statisticsList/experimentStatistical.do#down23', '_blank');
            showToast('KOSIS í˜ì´ì§€ê°€ ìƒˆ íƒ­ì—ì„œ ì—´ë ¸ìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œ í›„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'info');
        }
        
        async function handleGrdpModalUpload(input) {
            if (!input.files || input.files.length === 0) return;
            
            const file = input.files[0];
            const formData = new FormData();
            formData.append('file', file);
            
            // ì§„í–‰ ìƒíƒœ í‘œì‹œ
            document.getElementById('grdpUploadProgress').style.display = 'block';
            document.getElementById('grdpUploadStatus').textContent = 'íŒŒì¼ ë¶„ì„ ì¤‘...';
            
            try {
                const response = await fetch('/api/upload-grdp', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('grdpUploadStatus').textContent = 'âœ… GRDP ì¶”ì¶œ ì™„ë£Œ!';
                    
                    // GRDP ì •ë³´ ì—…ë°ì´íŠ¸
                    document.getElementById('grdpMissing').style.display = 'none';
                    document.getElementById('grdpInfo').style.display = 'block';
                    document.getElementById('grdpNational').textContent = `${data.national_growth_rate}%`;
                    document.getElementById('grdpTopRegion').textContent = data.top_region;
                    
                    showToast('GRDP ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ì¶œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    
                    // 1.5ì´ˆ í›„ ëª¨ë‹¬ ë‹«ê¸°
                    setTimeout(() => {
                        closeGrdpModal();
                    }, 1500);
                } else {
                    document.getElementById('grdpUploadStatus').textContent = 'âŒ ì¶”ì¶œ ì‹¤íŒ¨';
                    showToast(data.error || 'GRDP íŒŒì¼ íŒŒì‹± ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                document.getElementById('grdpUploadStatus').textContent = 'âŒ ì˜¤ë¥˜ ë°œìƒ';
                showToast('GRDP ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                console.error('GRDP upload error:', error);
            }
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            input.value = '';
        }
        
        // ì‚¬ì´ë“œë°” GRDP ì—…ë¡œë“œ (ê¸°ì¡´ í˜¸í™˜)
        async function uploadGrdpFile(input) {
            await handleGrdpModalUpload(input);
        }
        
        // GRDP ëª¨ë‹¬ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            const grdpUploadArea = document.querySelector('.grdp-upload-area');
            if (grdpUploadArea) {
                grdpUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    grdpUploadArea.classList.add('dragover');
                });
                
                grdpUploadArea.addEventListener('dragleave', () => {
                    grdpUploadArea.classList.remove('dragover');
                });
                
                grdpUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    grdpUploadArea.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const input = document.getElementById('grdpModalFileInput');
                        input.files = files;
                        handleGrdpModalUpload(input);
                    }
                });
            }
        });

        // UI ìƒíƒœ ì—…ë°ì´íŠ¸ (íŒŒì¼ íƒ€ì…ì— ë”°ë¼)
        function updateUIForFileType(fileType) {
            const reportListSection = document.querySelector('.report-list-section');
            const previewPlaceholder = document.getElementById('previewPlaceholder');
            const reportGenerationHint = document.getElementById('reportGenerationHint');
            
            if (fileType === 'raw_direct' || fileType === 'raw_with_analysis' || fileType === 'raw') {
                // ===== ê¸°ì´ˆìë£Œ ì—…ë¡œë“œ â†’ ë°”ë¡œ ë³´ë„ìë£Œ ìƒì„± ëª¨ë“œ =====
                reportListSection.style.opacity = '1';
                
                // ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ ì•ˆë‚´ ë³€ê²½
                if (previewPlaceholder) {
                    previewPlaceholder.style.display = 'flex';
                    previewPlaceholder.innerHTML = `
                        <div style="text-align: center; padding: 2rem;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ‰</div>
                            <div style="font-size: 1.2rem; font-weight: 600; color: var(--text-primary); margin-bottom: 1rem;">ë³´ë„ìë£Œ ìƒì„± ì¤€ë¹„ ì™„ë£Œ!</div>
                            <div style="font-size: 0.9rem; color: var(--text-muted); line-height: 1.6; max-width: 400px; margin: 0 auto;">
                                <p style="margin-bottom: 0.5rem;">ì¢Œì¸¡ ëª©ë¡ì—ì„œ <strong style="color: var(--success);">ë³´ë„ìë£Œë¥¼ ì„ íƒ</strong>í•˜ì„¸ìš”.</p>
                                <p style="font-size: 0.8rem; color: var(--text-muted);">â€» í‘œ ê¸°ë°˜ ë³´ë„ìë£Œ (ì°¨íŠ¸/ì¸í¬ê·¸ë˜í”½ ì œì™¸)</p>
                            </div>
                        </div>
                    `;
                }
                
                if (reportGenerationHint) reportGenerationHint.style.display = 'block';
                
            } else if (fileType === 'analysis') {
                // ===== ë¶„ì„í‘œ ì—…ë¡œë“œ â†’ ë³´ë„ìë£Œ ìƒì„± ëª¨ë“œ (í´ë°±) =====
                reportListSection.style.opacity = '1';
                
                if (reportGenerationHint) reportGenerationHint.style.display = 'block';
            }
        }
        
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'âœ“',
                error: 'âœ•',
                warning: 'âš ',
                info: 'â„¹'
            };

            toast.innerHTML = `
                <span style="font-size: 1.2rem;">${icons[type] || icons.info}</span>
                <span>${message}</span>
            `;

            elements.toastContainer.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }
    </script>
</body>
</html>
