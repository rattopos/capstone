{% extends "base_report.html" %}

{% block title %}Ⅰ. 부문별 지역경제동향 - 건설동향 ({% if report_info.year is defined and report_info.quarter is defined and
report_info.year and report_info.quarter %}{{ report_info.year }}년 {{ report_info.quarter }}/4분기{% else %}[연도/분기 입력
필요]{% endif %}){% endblock %}

{% block styles %}
<style>
    /* 기본 리셋 */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: "Malgun Gothic", serif;
        font-size: 14pt;
        line-height: 1.5;
        color: #000;
        background: #fff;
    }

    .page {
        width: 210mm;
        min-height: 297mm;
        padding: 15mm 20mm;
        margin: 0 auto;
        background: #fff;
    }

    @media screen {
        .page {
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }
    }

    /* 숫자 제목 - 3. 건설 동향 */
    .section-title {
        font-family: "Malgun Gothic", serif;
        font-size: 17pt;
        font-weight: bold;
        margin-bottom: 12px;
    }

    /* 요약 박스 */
    .summary-box {
        border: 1px dotted #555;
        padding: 8px 12px;
        margin-bottom: 12px;
        background-color: transparent;
        line-height: 1.5;
    }

    .summary-box .headline {
        margin-bottom: 6px;
        text-indent: -12px;
        padding-left: 12px;
    }

    .summary-box .nationwide {
        margin-bottom: 4px;
        padding-left: 16px;
        text-indent: -16px;
    }

    .summary-box .regional {
        padding-left: 16px;
        text-indent: -16px;
    }

    .highlight {
        font-weight: bold;
    }

    .increase,
    .decrease {
        font-weight: bold;
    }

    /* 상세 박스 - 건설동향 특수 레이아웃 */
    .detail-box {
        border: 1px dotted #555;
        padding: 8px 12px;
        margin-bottom: 15px;
    }

    .detail-box .title {
        text-align: center;
        margin-bottom: 6px;
        font-size: 14pt;
    }

    .detail-item {
        margin-bottom: 6px;
        line-height: 1.6;
    }

    .detail-first-row {
        display: flex;
        align-items: flex-start;
        padding-left: 8px;
        text-indent: -8px;
        margin-bottom: 2px;
        flex-wrap: wrap;
    }

    .detail-first-row::before {
        content: "·";
        margin-right: 3px;
    }

    .detail-second-row {
        display: flex;
        align-items: flex-start;
        padding-left: 8px;
        margin-top: 2px;
        margin-left: 90px;
        flex-wrap: wrap;
    }

    .detail-region {
        min-width: 85px;
        display: inline-block;
        white-space: nowrap;
        margin-right: 5px;
    }

    .detail-type-col {
        min-width: 100px;
        display: inline-block;
        white-space: nowrap;
        margin-right: 5px;
    }

    .detail-arrow {
        margin: 0 5px;
        white-space: nowrap;
    }

    .detail-subtype {
        flex: 1;
        min-width: 120px;
        word-break: break-word;
        overflow-wrap: break-word;
    }

    .separator {
        border-top: 1px dotted #888;
        margin: 5px 0;
    }

    /* 테이블 */
    .table-container {
        margin-top: 12px;
    }

    .table-title {
        text-align: center;
        font-weight: bold;
        margin-bottom: 6px;
        font-size: 11pt;
        font-family: "Malgun Gothic", serif;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 6px;
        font-size: 11pt;
        table-layout: fixed;
    }

    .data-table th,
    .data-table td {

        padding: 2px 3px;
        text-align: center;
        vertical-align: middle;
        height: 22px;
        word-break: break-word;
        overflow-wrap: break-word;
    }

    /* 테이블 헤더 - 연보라색 */
    .data-table th {
        background-color: #e6e0ec;
        font-weight: normal;
    }

    /* 지역 그룹 셀 */
    .data-table .region-group {
        background-color: #f5f5f5;
        font-weight: normal;
        width: 28px;
    }

    .data-table .region-name {
        width: 32px;
    }

    /* 지수 섹션 */
    .data-table td.index-section {
        background-color: #fef9e7;
    }

    .data-table th.index-section {
        background-color: #e6e0ec;
    }

    .footnote {
        font-size: 11pt;
        color: #333;
        margin-top: 4px;
    }


    /* 결측치 플레이스홀더 */
    .editable-placeholder {
        background-color: #fff59d;
        padding: 0 4px;
        border: 1px dashed #fbc02d;
        color: #5d4037;
        display: inline-block;
        min-width: 25px;
        text-align: center;
    }

    .missing-cell {
        background-color: #fff9c4 !important;
    }

    sup {
        font-size: 70%;
        vertical-align: super;
    }

    /* 공통 디자인(광공업과 일치) */
    .section-main-title {
        font-family: "Malgun Gothic", serif;
        font-size: 18pt;
        font-weight: bold;
        text-align: center;
        padding: 8px 12px;
        margin-bottom: 18px;
        background-color: #6d78b8;
        color: #000;
        border-radius: 6px;
        position: relative;
        background-image:
            radial-gradient(circle at 18px 50%, rgba(255, 255, 255, 0.35) 0 9px, transparent 10px),
            radial-gradient(circle at 38px 50%, rgba(255, 255, 255, 0.25) 0 5px, transparent 6px),
            radial-gradient(circle at calc(100% - 18px) 50%, rgba(255, 255, 255, 0.35) 0 9px, transparent 10px),
            radial-gradient(circle at calc(100% - 38px) 50%, rgba(255, 255, 255, 0.25) 0 5px, transparent 6px);
    }

    .section-main-title__label {
        display: inline-block;
        background: #ffffff;
        padding: 4px 26px;
        border-radius: 999px;
        color: #000;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.06) inset;
    }

    .section-title {
        font-family: "Malgun Gothic", serif;
        font-size: 17pt;
        font-weight: bold;
        margin-bottom: 15px;
        margin-top: 10px;
    }

    .summary-box {
        border: none;
        padding: 0;
        margin-bottom: 10px;
        background-color: transparent;
        line-height: 1.6;
        font-size: 11pt;
    }

    .detail-box .title {
        font-size: 11pt;
    }

    .data-table th,
    .data-table td {
        border: 1px solid #000;
    }

    .data-table th {
        background-color: #e0e0e0;
        border: 1px solid #000;
    }

    .data-table .region-group,
    .data-table .region-name {
        border: 1px solid #000;
    }

    .data-table td.index-section {
        background-color: #fff6d6;
    }

    .data-table th.index-section {
        background-color: #e0e0e0;
    }

    @media print {
        .page {
            width: 100%;
            min-height: auto;
            padding: 0;
            margin: 0;
            box-shadow: none;
        }

        .data-table th {
            background-color: #e0e0e0 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="section-main-title"><span class="section-main-title__label">Ⅰ. 부문별 지역경제동향</span></div>
<div class="section-title">3. 건설 동향</div>

<!-- 요약 박스 -->
<div class="summary-box">
    <div class="headline">◆ 건설수주는
        {% if summary_box.decrease_count > summary_box.increase_count %}
        {% for region in top3_decrease_regions %}
        <span class="highlight">{{ region.region }}</span>({{ region.sub_type if region.sub_type else region.main_type
        }}){% if not loop.last %}, {% endif %}
        {% endfor %}
        {% for region in top3_increase_regions %}
        <span class="highlight">{{ region.region }}</span>({{ region.sub_type if region.sub_type else region.main_type
        }}){% if not loop.last %}, {% endif %}
        {% endfor %}
        {% set rate = nationwide_data.change_rate if nationwide_data.change_rate is defined else
        (nationwide_data.growth_rate if nationwide_data.growth_rate is defined else 0.0) %}
        {% if rate is not none and rate >= 0 %}
        <span class="highlight">{{ nationwide_data.main_category }}</span> 수주가 {{ get_terms(report_info.report_id,
        rate)[0] }} 전년동분기대비 <span class="increase">{{ "%.1f"|format(rate)
            }}% {{ get_terms(report_info.report_id, rate)[1] }}</span>
        {% else %}
        <span class="highlight">{{ nationwide_data.main_category if nationwide_data.main_category else "토목" }}</span>
        수주가 {{ get_terms(report_info.report_id, rate)[0] }} 전년동분기대비 <span class="decrease">{{
            "%.1f"|format(rate|abs) }}% {{ get_terms(report_info.report_id,
            rate)[1] }}</span>
        {% endif %}
        {% endif %}
    </div>
    <div class="regional">◦
        {% if regional_data.increase_regions %}
        {% for region in regional_data.increase_regions[:3] %}
        <span class="highlight">{{ region.region }}{% if loop.last %}{{ region.region | josa('Topic') }}{% endif
            %}</span>({{ "%.1f"|format(region.change_rate if region.change_rate is defined else region.growth_rate)
        }}%){% if not loop.last %}, {% endif %}
        {% endfor %} {{ increase_sub_types_text if increase_sub_types_text else "주택, 항만·공항" }} 등의 수주가 {{
        get_terms(report_info.report_id, 1)[0] }} <span class="increase">{{ get_terms(report_info.report_id, 1)[1]
            }}</span>{{ get_terms(report_info.report_id, 1)[2] }},
        {% endif %}
        {% if regional_data.decrease_regions %}
        {% for region in regional_data.decrease_regions[:3] %}
        <span class="highlight">{{ region.region }}{% if loop.last %}{{ region.region | josa('Topic') }}{% endif
            %}</span>({{ "%.1f"|format(region.change_rate if region.change_rate is defined else region.growth_rate)
        }}%){% if not loop.last %}, {% endif %}
        {% endfor %} {{ decrease_sub_types_text if decrease_sub_types_text else "사무실·점포, 주택, 도로·교량" }} 등의 수주가 {{
        get_terms(report_info.report_id, -1)[0] }} <span class="decrease">{{ get_terms(report_info.report_id, -1)[1]
            }}</span>
        {% endif %}
    </div>
</div>

<!-- 주요 증감 지역 및 공종 -->
<div class="detail-box">
    <div class="title">&lt; 주요 증감지역 및 공종 &gt;</div>

    <!-- 전국 -->
    <div class="detail-item">
        <div class="detail-first-row">
            <span class="detail-region">전 국({{ val(nationwide_data.change_rate if nationwide_data.change_rate is defined
                else nationwide_data.growth_rate, "%.1f", "%") }}):</span>
            <span class="detail-type-col">토목({{ val(nationwide_data.civil_growth, "%.1f", "%") }})</span>
            <span class="detail-arrow">⇒</span>
            <span class="detail-subtype">{{ nationwide_data.civil_subtypes if nationwide_data.civil_subtypes else
                "철도·궤도, 기계설치" }}</span>
        </div>
        <div class="detail-second-row">
            <span class="detail-type-col">건축({{ val(nationwide_data.building_growth, "%.1f", "%") }})</span>
            <span class="detail-arrow">⇒</span>
            <span class="detail-subtype">{{ nationwide_data.building_subtypes if nationwide_data.building_subtypes else
                "주택, 관공서 등" }}</span>
        </div>
    </div>

    <div class="separator"></div>

    <!-- 증가 지역 Top -->
    {% for region in top3_increase_regions %}
    <div class="detail-item">
        <div class="detail-first-row">
            <span class="detail-region">{{ region.region }}({{ val(region.change_rate if region.change_rate is defined
                else region.growth_rate, "%.1f", "%") }}):</span>
            <span class="detail-type-col">토목({{ val(region.civil_growth, "%.1f", "%") }})</span>
            <span class="detail-arrow">⇒</span>
            <span class="detail-subtype">{{ region.civil_subtypes if region.civil_subtypes else "철도·궤도, 도로·교량" }}</span>
        </div>
        <div class="detail-second-row">
            <span class="detail-type-col">건축({{ val(region.building_growth, "%.1f", "%") }})</span>
            <span class="detail-arrow">⇒</span>
            <span class="detail-subtype">{{ region.building_subtypes if region.building_subtypes else "주택, 관공서 등"
                }}</span>
        </div>
    </div>
    {% endfor %}

    <div class="separator"></div>

    <!-- 감소 지역 Top -->
    {% for region in top3_decrease_regions %}
    <div class="detail-item">
        <div class="detail-first-row">
            <span class="detail-region">{{ region.region }}({{ val(region.change_rate if region.change_rate is defined
                else region.growth_rate, "%.1f", "%") }}):</span>
            <span class="detail-type-col">토목({{ val(region.civil_growth, "%.1f", "%") }})</span>
            <span class="detail-arrow">⇒</span>
            <span class="detail-subtype">{{ region.civil_subtypes if region.civil_subtypes else "토지조성, 치산·치수" }}</span>
        </div>
        <div class="detail-second-row">
            <span class="detail-type-col">건축({{ val(region.building_growth, "%.1f", "%") }})</span>
            <span class="detail-arrow">⇒</span>
            <span class="detail-subtype">{{ region.building_subtypes if region.building_subtypes else "사무실·점포, 관공서 등"
                }}</span>
        </div>
    </div>
    {% endfor %}
</div>

<!-- 데이터 테이블 -->
<div class="table-container">
    <div class="table-title">《 건설수주액 및 증감률 》</div>
    {% set base_year = report_info.year if report_info and report_info.year else none %}
    {% set base_quarter = report_info.quarter if report_info and report_info.quarter else none %}
    {% if base_year and base_quarter %}
    {% set prev_q_year = base_year %}
    {% set prev_q = base_quarter - 1 %}
    {% if prev_q <= 0 %} {% set prev_q_year=base_year - 1 %} {% set prev_q=prev_q + 4 %} {% endif %} {% set
        growth_cols=[ (base_year - 2) ~ ". " ~ base_quarter ~ "/4" , (base_year - 1) ~ ". " ~ base_quarter ~ "/4" ,
        prev_q_year ~ ". " ~ prev_q ~ "/4" , base_year ~ ". " ~ base_quarter ~ "/4" ] %} {% set index_cols=[ (base_year
        - 1) ~ ". " ~ base_quarter ~ "/4" , base_year ~ ". " ~ base_quarter ~ "/4" ] %} {% else %} {% set
        growth_cols=["[기간]", "[기간]" , "[기간]" , "[기간]" ] %} {% set index_cols=["[기간]", "[기간]" ] %} {% endif %} <table
        style="border-collapse: collapse !important; border: 1px solid black !important;" class="data-table">
        <thead style="border: 1px solid black !important;">
            <tr>
                <th rowspan="2" colspan="2" style="width: 60px;; border: 1px solid black !important"></th>
                <th colspan="{{ growth_cols|length }}" style="border: 1px solid black !important;">전년동분기대비 증감률(%)</th>
                <th colspan="{{ index_cols|length }}" class="index-section" style="border: 1px solid black !important;">
                    건설수주액(백억원)</th>
            </tr>
            <tr>
                {% for col in growth_cols %}
                <th style="width: 58px;; border: 1px solid black !important">{{ col }}{% if loop.last %}<sup>p</sup>{%
                    endif %}</th>
                {% endfor %}
                {% for col in index_cols %}
                <th class="index-section" style="width: 70px;; border: 1px solid black !important">{{ col }}{% if
                    loop.last %}<sup>p</sup>{% endif %}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% set region_groups = [
            {'name': '경인', 'regions': ['서울', '인천', '경기']},
            {'name': '충청', 'regions': ['대전', '세종', '충북', '충남']},
            {'name': '호남', 'regions': ['광주', '전북', '전남', '제주']},
            {'name': '동북', 'regions': ['대구', '경북', '강원']},
            {'name': '동남', 'regions': ['부산', '울산', '경남']}
            ] %}
            {% set data_rows = summary_table.regions if summary_table and summary_table.regions is defined else [] %}
            {% set growth_len = growth_cols|length %}
            {% set index_len = index_cols|length %}
            {% set nationwide_row = (data_rows | selectattr('region', 'equalto', '전국') | list | first) %}
            <tr>
                <td class="region-group" style="border: 1px solid black !important;"></td>
                <td class="region-name" style="border: 1px solid black !important;">전국</td>
                {% for i in range(growth_len) %}
                {% set rate = nationwide_row.growth_rates[i] if nationwide_row and nationwide_row.growth_rates is
                defined and nationwide_row.growth_rates|length > i else none %}
                <td class="{% if rate is none or rate == '' or rate == '-' %}missing-cell{% endif %}"
                    style="border: 1px solid black !important;">
                    {{ val(rate) }}
                </td>
                {% endfor %}
                {% for i in range(index_len) %}
                {% set idx = nationwide_row.indices[i] if nationwide_row and nationwide_row.indices is defined and
                nationwide_row.indices|length > i else none %}
                <td class="index-section {% if idx is none or idx == '' or idx == '-' %}missing-cell{% endif %}"
                    style="border: 1px solid black !important;">
                    {{ val(idx) }}
                </td>
                {% endfor %}
            </tr>
            {% for group in region_groups %}
            {% for region_name in group.regions %}
            {% set row = (data_rows | selectattr('region', 'equalto', region_name) | list | first) %}
            <tr>
                {% if loop.first %}
                <td class="region-group" rowspan="{{ group.regions|length }}"
                    style="border: 1px solid black !important;">{{ group.name }}</td>
                {% endif %}
                <td class="region-name" style="border: 1px solid black !important;">{{ region_name }}</td>
                {% for i in range(growth_len) %}
                {% set rate = row.growth_rates[i] if row and row.growth_rates is defined and row.growth_rates|length > i
                else none %}
                <td class="{% if rate is none or rate == '' or rate == '-' %}missing-cell{% endif %}"
                    style="border: 1px solid black !important;">
                    {{ val(rate) }}
                </td>
                {% endfor %}
                {% for i in range(index_len) %}
                {% set idx = row.indices[i] if row and row.indices is defined and row.indices|length > i else none %}
                <td class="index-section {% if idx is none or idx == '' or idx == '-' %}missing-cell{% endif %}"
                    style="border: 1px solid black !important;">
                    {{ val(idx) }}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
            {% endfor %}
        </tbody>
        </table>
</div>
{% endblock %}