<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지역경제동향 인포그래픽 - {{ report_info.year }}년 {{ report_info.quarter }}/4분기</title>
    <style>
        @page {
            size: A4;
            margin: 0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #E0F4FF 50%, #87CEEB 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .infographic-container {
            max-width: 800px;
            margin: 0 auto;
            background: transparent;
        }
        
        /* 헤더 */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            margin-bottom: 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logo-img {
            height: 45px;
            width: auto;
        }
        
        .title-area {
            text-align: right;
        }
        
        .title-year {
            font-size: 24px;
            font-weight: bold;
            color: #1565C0;
        }
        
        .title-main {
            font-size: 36px;
            font-weight: bold;
            color: #0D47A1;
            letter-spacing: 2px;
        }
        
        /* 카드 그리드 */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 0 15px 20px;
        }
        
        /* 개별 카드 */
        .indicator-card {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #E0E0E0;
        }
        
        .card-title-area {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-icon {
            font-size: 20px;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        
        .card-unit {
            font-size: 11px;
            color: #666;
            background: #F5F5F5;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        /* 카드 본문 */
        .card-body {
            display: flex;
            gap: 15px;
        }
        
        /* 지역 순위 영역 - 좌우 배치 */
        .regions-area {
            flex: 1;
            display: flex;
            flex-direction: row;
            gap: 5px;
        }
        
        .region-section {
            flex: 1;
        }
        
        .section-label {
            font-size: 11px;
            font-weight: bold;
            padding: 3px 10px;
            border-radius: 3px;
            margin-bottom: 6px;
            display: inline-block;
        }
        
        .section-label.top {
            background: #FFCDD2;
            color: #C62828;
        }
        
        .section-label.bottom {
            background: #BBDEFB;
            color: #1565C0;
        }
        
        /* 고용률용 라벨 */
        .section-label.rise {
            background: #FFCDD2;
            color: #C62828;
        }
        
        .section-label.fall {
            background: #BBDEFB;
            color: #1565C0;
        }
        
        .region-list {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .region-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
        }
        
        .region-name {
            font-weight: bold;
            color: #333;
            min-width: 28px;
        }
        
        .region-value {
            font-weight: bold;
        }
        
        .region-value.positive {
            color: #C62828;
        }
        
        .region-value.negative {
            color: #1565C0;
        }
        
        .region-arrow {
            font-size: 10px;
        }
        
        .region-arrow.up {
            color: #C62828;
        }
        
        .region-arrow.down {
            color: #1565C0;
        }
        
        /* 지도 영역 */
        .map-area {
            width: 130px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .map-svg-container {
            width: 100%;
            height: 150px;
        }
        
        .map-svg-container svg {
            width: 100%;
            height: 100%;
        }
        
        /* SVG 지역 색상 */
        .region-increase { fill: #D7A3A0 !important; } /* Salmon Pink - 증가/상승 */
        .region-decrease { fill: #89BEDE !important; } /* Sky Blue - 감소/하락 */
        .region-neutral { fill: #DDDCDD !important; } /* Light Gray - 보합 */
        
        /* 소비자물가용 */
        .region-above-avg { fill: #D7A3A0 !important; } /* Salmon Pink - 전국 평균 초과 */
        .region-below-avg { fill: #BCADCC !important; } /* Lavender - 전국 평균 미만 */
        .region-avg { fill: #DDDCDD !important; } /* Light Gray - 전국 평균 수준 */
        
        /* 전국 평균 */
        .nationwide-value {
            margin-top: 5px;
            text-align: right;
            font-size: 12px;
            color: #333;
        }
        
        .nationwide-value strong {
            font-size: 14px;
        }
        
        .nationwide-arrow {
            font-size: 10px;
        }
        
        .nationwide-arrow.up { color: #C62828; }
        .nationwide-arrow.down { color: #1565C0; }
        
        /* 범례 */
        .legend {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #E0E0E0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            color: #666;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        
        .legend-color.increase { background: #D7A3A0; } /* Salmon Pink */
        .legend-color.decrease { background: #89BEDE; } /* Sky Blue */
        .legend-color.neutral { background: #DDDCDD; } /* Light Gray */
        
        /* 소비자물가 범례 */
        .legend-color.above-avg { background: #D7A3A0; } /* Salmon Pink - 전국 평균 초과 */
        .legend-color.below-avg { background: #BCADCC; } /* Lavender - 전국 평균 미만 */
        .legend-color.avg { background: #DDDCDD; } /* Light Gray - 전국 평균 수준 */
        
        /* 인쇄 스타일 */
        @media print {
            body {
                background: linear-gradient(135deg, #87CEEB 0%, #E0F4FF 50%, #87CEEB 100%) !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .indicator-card {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="infographic-container">
        <!-- 헤더 -->
        <div class="header">
            <div class="logo">
                <img src="/templates/logo_mods.png" alt="국가데이터처" class="logo-img">
            </div>
            <div class="title-area">
                <div class="title-year">{{ report_info.year }}년 {{ report_info.quarter }}/4분기</div>
                <div class="title-main">지역경제동향</div>
            </div>
        </div>
        
        <!-- 카드 그리드 -->
        <div class="cards-grid">
            {% for indicator in indicators %}
            <div class="indicator-card" data-indicator="{{ indicator.name }}">
                <div class="card-header">
                    <div class="card-title-area">
                        <span class="card-icon">{{ indicator.icon }}</span>
                        <span class="card-title">{{ indicator.name }}</span>
                    </div>
                    <span class="card-unit">{{ indicator.unit }}</span>
                </div>
                
                <div class="card-body">
                    <div class="regions-area">
                        <!-- 상위 지역 -->
                        <div class="region-section">
                            {% if indicator.name == '고용률' %}
                            <div class="section-label rise">상위</div>
                            {% else %}
                            <div class="section-label top">상위</div>
                            {% endif %}
                            <div class="region-list">
                                {% for region in indicator.top_regions %}
                                <div class="region-item">
                                    <span class="region-name">{{ region.name }}</span>
                                    <span class="region-value positive">{{ region.value }}</span>
                                    <span class="region-arrow up">▲</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <!-- 하위 지역 -->
                        <div class="region-section">
                            {% if indicator.name == '고용률' %}
                            <div class="section-label fall">하위</div>
                            {% else %}
                            <div class="section-label bottom">하위</div>
                            {% endif %}
                            <div class="region-list">
                                {% for region in indicator.bottom_regions %}
                                <div class="region-item">
                                    <span class="region-name">{{ region.name }}</span>
                                    <span class="region-value negative">{{ region.value }}</span>
                                    <span class="region-arrow down">▼</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- 지도 영역 -->
                    <div class="map-area">
                        <div class="map-svg-container" id="map-{{ loop.index0 }}">
                            <!-- SVG는 JavaScript로 로드 및 색칠 -->
                        </div>
                        <div class="nationwide-value">
                            전국<br>
                            <strong>{{ indicator.nationwide_value }}</strong>
                            {% if indicator.nationwide_change >= 0 %}
                            <span class="nationwide-arrow up">▲</span>
                            {% else %}
                            <span class="nationwide-arrow down">▼</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- 범례 -->
                <div class="legend">
                    {% if indicator.name == '소비자물가' %}
                    <div class="legend-item">
                        <div class="legend-color avg"></div>
                        <span>전국 평균</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color above-avg"></div>
                        <span>평균초과</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color below-avg"></div>
                        <span>평균미만</span>
                    </div>
                    {% elif indicator.name == '고용률' %}
                    <div class="legend-item">
                        <div class="legend-color increase"></div>
                        <span>상승</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color decrease"></div>
                        <span>하락</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color neutral"></div>
                        <span>보합</span>
                    </div>
                    {% else %}
                    <div class="legend-item">
                        <div class="legend-color increase"></div>
                        <span>증가</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color decrease"></div>
                        <span>감소</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color neutral"></div>
                        <span>보합</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <script>
        // 지표 데이터 (Jinja2로 주입)
        const indicatorsData = {{ indicators | tojson }};
        
        // 지역명 -> SVG path id 매핑
        const REGION_TO_SVG_ID = {
            '서울': 'seoul',
            '부산': 'busan',
            '대구': 'daegu',
            '인천': 'incheon',
            '광주': 'gwangju',
            '대전': 'daejeon',
            '울산': 'ulsan',
            '세종': 'sejong',
            '경기': 'gyeonggi',
            '강원': 'gangwon',
            '충북': 'chungbuk',
            '충남': 'chungnam',
            '전북': 'jeonbuk',
            '전남': 'jeonnam',
            '경북': 'gyeongbuk',
            '경남': 'gyeongnam',
            '제주': 'jeju'
        };
        
        // 색상 정의
        const COLORS = {
            increase: '#D7A3A0',   // 증가/상승: Salmon Pink
            decrease: '#89BEDE',   // 감소/하락: Sky Blue
            neutral: '#DDDCDD',    // 보합: Light Gray
            aboveAvg: '#D7A3A0',   // 평균 초과: Salmon Pink
            belowAvg: '#BCADCC',   // 평균 미만: Lavender
            avg: '#DDDCDD'         // 전국 평균: Light Gray
        };
        
        // SVG 원본 캐시
        let svgTemplate = null;
        
        // SVG 로드 및 지도 색칠
        async function loadAndColorMaps() {
            try {
                // SVG 파일 로드
                const response = await fetch('/templates/infographic_map.svg');
                svgTemplate = await response.text();
                
                // 각 지표별로 지도 색칠
                indicatorsData.forEach((indicator, idx) => {
                    const container = document.getElementById(`map-${idx}`);
                    if (container) {
                        colorMap(container, indicator);
                    }
                });
            } catch (error) {
                console.error('SVG 로드 오류:', error);
            }
        }
        
        // 지도 색칠 함수
        function colorMap(container, indicator) {
            if (!svgTemplate) return;
            
            // SVG 삽입
            container.innerHTML = svgTemplate;
            const svg = container.querySelector('svg');
            if (!svg) return;
            
            const indicatorName = indicator.name;
            const nationwideValue = indicator.nationwide_change;
            const allRegions = indicator.all_regions || [];
            
            // 지역별 색상 계산 및 적용
            const paths = svg.querySelectorAll('path.region, path[id]');
            
            paths.forEach(path => {
                const pathId = path.id;
                if (!pathId) return;
                
                // SVG id에서 지역명 찾기
                let regionName = null;
                for (const [name, svgId] of Object.entries(REGION_TO_SVG_ID)) {
                    if (svgId === pathId) {
                        regionName = name;
                        break;
                    }
                }
                
                if (!regionName) return;
                
                // 해당 지역 데이터 찾기
                const regionData = allRegions.find(r => r.name === regionName);
                if (!regionData) return;
                
                const value = regionData.value;
                let fillColor;
                
                // 소비자물가는 전국 평균 대비로 색상 결정
                if (indicatorName === '소비자물가') {
                    const tolerance = 0.05;  // 0.05% 오차 범위
                    if (Math.abs(value - nationwideValue) < tolerance) {
                        fillColor = COLORS.avg;  // 전국 평균과 동일: 회색
                    } else if (value > nationwideValue) {
                        fillColor = COLORS.aboveAvg;  // 평균 초과: 핑크
                    } else {
                        fillColor = COLORS.belowAvg;  // 평균 미만: 보라
                    }
                } else {
                    // 일반 지표: 증가/감소/보합
                    const tolerance = 0.05;
                    if (Math.abs(value) < tolerance) {
                        fillColor = COLORS.neutral;  // 보합: 회색
                    } else if (value > 0) {
                        fillColor = COLORS.increase;  // 증가: 핑크
                    } else {
                        fillColor = COLORS.decrease;  // 감소: 파랑
                    }
                }
                
                // 색상 적용
                path.style.fill = fillColor;
            });
        }
        
        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', loadAndColorMaps);
    </script>
</body>
</html>

