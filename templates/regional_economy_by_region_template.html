<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if report_info.year is defined and report_info.quarter is defined %}{{ report_info.year }}년 {{ report_info.quarter }}분기{% else %}[연도/분기 입력 필요]{% endif %} {{ region_name | default("[시도]") }} 지역경제동향</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Malgun Gothic", "맑은 고딕", sans-serif;
            font-size: 12pt;
            line-height: 1.6;
            color: #000;
            background: #fff;
            padding: 16mm 14mm;
            max-width: 210mm;
            margin: 0 auto;
        }

        .page-title {
            font-size: 20pt;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .page-subtitle {
            font-size: 12pt;
            color: #444;
            margin-bottom: 14px;
        }

        .section-title {
            font-size: 15pt;
            font-weight: bold;
            margin: 16px 0 8px;
        }

        .bullet-list {
            margin-left: 8px;
        }

        .bullet {
            display: flex;
            gap: 6px;
            margin: 4px 0;
        }

        .bullet-icon {
            font-weight: bold;
        }

        .subsection {
            margin-top: 8px;
        }

        .table-wrap {
            margin: 8px 0 4px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11pt;
        }

        th, td {
            border: 1px solid #000;
            padding: 6px 6px;
            text-align: center;
        }

        th {
            background: #f4f4f4;
            font-weight: bold;
        }

        .note {
            font-size: 10pt;
            color: #555;
            margin-top: 4px;
        }

        .divider {
            border-top: 1px solid #000;
            margin: 12px 0 6px;
        }

        .placeholder {
            background: #fff59d;
            padding: 1px 4px;
            border: 1px dashed #fbc02d;
        }

        .page-break {
            page-break-before: always;
        }

        .chapter-title {
            font-size: 22pt;
            font-weight: bold;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    {% set region_label = region_name | default(region_info.name if region_info is defined else "[시도]") %}
    
    <!-- 첫 번째 지역(서울)일 때만 페이지 브레이크와 큰 제목 표시 -->
    {% if region_info is defined and region_info.order is defined and region_info.order == 1 %}
    <div style="margin-top: 100pt; padding-top: 50pt;"></div>
    <div class="chapter-title" style="margin-top: 50pt;">III. 시도별 경제동향</div>
    {% endif %}
    
    <div class="page-title">{{ region_info.order ~ ". " if region_info is defined and region_info.order is defined else "" }}{{ region_label }}</div>
    <div class="page-subtitle">{% if report_info.year is defined and report_info.quarter is defined %}{{ report_info.year }}년 {{ report_info.quarter }}분기{% else %}<span class="placeholder">[연도/분기]</span>{% endif %} 지역경제동향</div>

    <!-- 생산 -->
    <div class="section-title">□ 생산</div>
    <div class="table-wrap">
        <table class="data-table">
            <thead>
                <tr>
                    <th rowspan="2">시도</th>
                    <th colspan="2">광공업생산</th>
                    <th colspan="2">서비스업생산</th>
                    <th colspan="2">소매판매</th>
                    <th colspan="2">수출</th>
                    <th colspan="2">소비자물가</th>
                    <th colspan="2">고용률</th>
                </tr>
                <tr>
                    <th>지수</th>
                    <th>증감률</th>
                    <th>지수</th>
                    <th>증감률</th>
                    <th>지수</th>
                    <th>증감률</th>
                    <th>금액</th>
                    <th>증감률</th>
                    <th>지수</th>
                    <th>증감률</th>
                    <th>비율</th>
                    <th>증감률</th>
                </tr>
            </thead>
            <tbody>
            {% set data_rows = table_df if table_df is defined else (table_data if table_data is defined else []) %}
            {% for row in data_rows %}
                <tr>
                    <td class="region-cell">{{ row.region_name }}</td>
                    <td class="value-cell">{{ row.mining_index }}</td>
                    <td class="value-cell">{{ row.mining_change }}</td>
                    <td class="value-cell">{{ row.service_index }}</td>
                    <td class="value-cell">{{ row.service_change }}</td>
                    <td class="value-cell">{{ row.retail_index }}</td>
                    <td class="value-cell">{{ row.retail_change }}</td>
                    <td class="value-cell">{{ row.export_amount }}</td>
                    <td class="value-cell">{{ row.export_change }}</td>
                    <td class="value-cell">{{ row.price_index }}</td>
                    <td class="value-cell">{{ row.price_change }}</td>
                    <td class="value-cell">{{ row.employment_rate }}</td>
                    <td class="value-cell">{{ row.employment_change }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- 건설 나레이션 -->
    <div class="bullet-list">
        <div class="bullet">
            <span class="bullet-icon">○</span>
            <span class="bullet-text">
                {% set construction_texts = sections.construction.narrative if sections and sections.construction is defined and sections.construction.narrative is defined else [] %}
                {% if construction_texts and construction_texts|length > 0 %}
                    {{ construction_texts[0] }}
                {% else %}
                    <span class="placeholder">[건설 나레이션]</span>
                {% endif %}
            </span>
        </div>
    </div>

    <!-- 수출입·물가 -->
    <div class="section-title">□ 수출입·물가</div>
    <div class="bullet-list">
        <div class="bullet">
            <span class="bullet-icon">○</span>
            <span class="bullet-text">
                {% set export_texts = sections.export.narrative if sections and sections.export is defined and sections.export.narrative is defined else [] %}
                {% if export_texts and export_texts|length > 0 %}
                    {{ export_texts[0] }}
                {% else %}
                    <span class="placeholder">[수출 나레이션]</span>
                {% endif %}
            </span>
        </div>
        <div class="bullet">
            <span class="bullet-icon">○</span>
            <span class="bullet-text">
                {% set import_texts = sections.import.narrative if sections and sections.import is defined and sections.import.narrative is defined else [] %}
                {% if import_texts and import_texts|length > 0 %}
                    {{ import_texts[0] }}
                {% else %}
                    <span class="placeholder">[수입 나레이션]</span>
                {% endif %}
            </span>
        </div>
        <div class="bullet">
            <span class="bullet-icon">○</span>
            <span class="bullet-text">
                {% set price_texts = sections.price.narrative if sections and sections.price is defined and sections.price.narrative is defined else [] %}
                {% if price_texts and price_texts|length > 0 %}
                    {{ price_texts[0] }}
                {% else %}
                    <span class="placeholder">[소비자물가 나레이션]</span>
                {% endif %}
            </span>
        </div>
    </div>

    <!-- 고용·인구이동 -->
    <div class="section-title">□ 고용·인구이동</div>
    <div class="bullet-list">
        <div class="bullet">
            <span class="bullet-icon">○</span>
            <span class="bullet-text">
                {% set employment_texts = sections.employment.narrative if sections and sections.employment is defined and sections.employment.narrative is defined else [] %}
                {% if employment_texts and employment_texts|length > 0 %}
                    {{ employment_texts[0] }}
                {% else %}
                    <span class="placeholder">[고용 나레이션]</span>
                {% endif %}
            </span>
        </div>
        <div class="bullet">
            <span class="bullet-icon">○</span>
            <span class="bullet-text">
                {% set migration_texts = sections.migration.narrative if sections and sections.migration is defined and sections.migration.narrative is defined else [] %}
                {% if migration_texts and migration_texts|length > 0 %}
                    {{ migration_texts[0] }}
                {% else %}
                    <span class="placeholder">[인구이동 나레이션]</span>
                {% endif %}
            </span>
        </div>
    </div>

    <div class="divider"></div>

    <!-- 섹션별 간단 표 -->
    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th style="width: 22%;">부문</th>
                    <th style="width: 39%;">{% if sections and sections.mining is defined and sections.mining.table is defined and sections.mining.table.periods is defined and sections.mining.table.periods|length > 0 %}{{ sections.mining.table.periods[0] }}{% else %}현 기간{% endif %}</th>
                    <th style="width: 39%;">전년동기대비(%)</th>
                </tr>
            </thead>
            <tbody>
                {% set sector_order = [
                    ('광공업생산', 'mining'),
                    ('서비스업생산', 'service'),
                    ('소비', 'consumption'),
                    ('건설', 'construction'),
                    ('수출', 'export'),
                    ('수입', 'import'),
                    ('고용률', 'employment'),
                    ('실업률', 'unemployment'),
                    ('소비자물가', 'price'),
                    ('순인구이동', 'migration')
                ] %}
                {% for label, key in sector_order %}
                {% set section = sections[key] if sections and sections[key] is defined else none %}
                {% set row = section.table.data[0] if section and section.table is defined and section.table.data is defined and section.table.data|length > 0 else none %}
                <tr>
                    <td>{{ label }}</td>
                    <td>{{ row['values'][0] if row and row['values'] is defined and row['values']|length > 0 else '-' }}</td>
                    <td>{{ row['values'][1] if row and row['values'] is defined and row['values']|length > 1 else '-' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="note">※ 그래프는 제외하고 나레이션과 표만 표시합니다.</div>
    </div>
</body>
</html>
