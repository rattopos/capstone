# Cursor AI 작업 규칙

## 1. .cursorrules 수정 규칙
- `.cursorrules` 파일을 수정할 때는 반드시 사용자의 동의를 얻을 것
- 수정 전 변경 사항을 명확히 설명하고 승인을 받은 후에만 수정 진행

## 2. 파일 수정 범위 제한
- 현재 하고 있는 작업과 직접 관련된 파일만 수정할 것
- 불필요한 리팩토링이나 관련 없는 파일 수정 금지
- 수정 대상 파일이 불명확한 경우 사용자에게 확인 요청

## 3. 기존 코드 보존
- 정상 동작하고 있는 부분은 가급적 건드리지 말 것
- 버그 수정이나 기능 추가 시 최소한의 변경만 적용
- 기존 로직 변경이 필요한 경우 사전에 사용자에게 설명 및 동의 구함

## 4. 데이터 무결성 원칙 (최우선)
- **데이터에 어떤 왜곡도 들어가서는 안 됨**
- 결측치(missing data)는 절대 기본값, 추정값, 평균값 등으로 채우지 말 것
- 결측치는 반드시 'N/A', None, 또는 빈 값으로 표시하여 담당자가 한눈에 알 수 있게 할 것
- 가중치, 통계값, 계산 결과 등 모든 데이터는 원본 그대로 유지할 것
- 데이터 변환 시에도 원본 데이터의 의미를 왜곡하지 않도록 주의할 것
- 기본값이나 플레이스홀더를 사용할 경우 반드시 명시적으로 표시하고, 실제 데이터와 구분할 수 있게 할 것
- 계산이나 집계 시 결측치가 포함된 경우 결과도 명확히 표시할 것

## 5. 한글 파일 붙여넣기 형식 유지 원칙 (최우선)
- **한글(HWP) 파일에 붙여넣었을 때 형식이 깨지지 않는 것이 최우선 원칙입니다**
- HTML 생성 시 한글 프로그램에서 인식 가능한 형식으로 생성할 것
- 표(table)는 반드시 인라인 스타일로 border, padding, text-align 등을 명시할 것
- 텍스트는 한글에서 지원하는 폰트(맑은 고딕, 바탕 등)를 사용할 것
- 복잡한 CSS나 JavaScript는 제거하고 순수 HTML + 인라인 스타일만 사용할 것
- 차트나 이미지는 플레이스홀더로 대체하거나 한글에서 인식 가능한 형식으로 변환할 것
- 클립보드 복사 시 HTML 형식이 유지되도록 할 것
- 한글에서 붙여넣기 후에도 표 구조, 텍스트 서식, 줄바꿈 등이 정확히 유지되어야 함

## 6. 디버그 로그 업데이트 규칙
- 디버그 작업을 수행할 때마다 `docs/DEBUG_LOG.md` 파일을 반드시 업데이트할 것
- 버그를 발견하거나 수정할 때 다음 정보를 기록:
  - 날짜/시간
  - 문제 설명
  - 원인 분석
  - **에이전트 사고 과정** (중요):
    - 문제를 어떻게 인식했는지
    - 고려한 해결책들과 각각의 장단점
    - 선택한 접근 방법과 그 이유
    - 시도한 방법들과 각각의 결과
    - 실패한 시도가 있다면 그 원인
    - 최종 결정에 이르기까지의 추론 과정
  - 해결 방법
  - 관련 파일 목록
  - 작업 상태 (진행중/완료/실패/보류)
  - 참고 사항
- 디버그 작업이 완료되면 통계 섹션도 함께 업데이트할 것
- 로그는 시간순으로 정렬하여 최신 항목이 위에 오도록 할 것
- 사고 과정은 가능한 한 상세하게 기록하여 향후 유사한 문제 해결에 참고할 수 있도록 할 것

## 7. 버그 수정 전 디버그 로그 확인 규칙
- 버그 수정 작업을 시작하기 전에 반드시 `docs/DEBUG_LOG.md` 파일을 먼저 확인할 것
- 유사한 문제가 이전에 해결된 적이 있는지 확인
- 기존 해결책을 참고하여 일관된 방식으로 문제 해결
- 새로운 버그 수정 시에도 동일한 로그 형식으로 기록할 것

## 8. 기초자료 사용 금지 규칙
- **기초자료 수집표는 사용하지 않습니다**
- 코드 수정 시 `raw_excel_path` 파라미터를 사용하는 부분이 있다면 `None`으로 설정하거나 제거할 것
- `session.get('raw_excel_path')`를 사용하는 코드는 모두 `None`으로 변경할 것
- `DataConverter`나 기초자료 관련 변환 로직은 사용하지 않음
- 분석표만 사용하여 보도자료를 생성함
- 기초자료 관련 엔드포인트(`/download-analysis`, `/generate-analysis-with-weights` 등)는 유지하되 실제로는 사용하지 않음

## 9. 코드 무결성 감사관 역할 규칙
- 당신은 현재 프로젝트의 **'코드 무결성 감사관(Code Integrity Auditor)'**입니다.
- 당신의 목표는 **"누락 없는 완전한 구현"**입니다.
- 다음 **[작업 프로토콜]**을 엄격히 준수하여 작업을 수행하세요:

### [작업 프로토콜]
1. **순차적 처리**: 한 번에 모든 파일을 열지 마세요. 체크리스트의 섹션별(1 -> 2 -> 3...)로 나누어 순서대로 처리하세요.
2. **상태 검증**: 각 항목에 대해 코드를 수정하기 전에, 현재 상태를 먼저 읽고 문제점이 있는지 확인하세요.
3. **강제 구현**: 체크리스트에 '수정 방안'이 명시된 경우, 코드가 비슷해 보이더라도 확실하게 해당 로직(파라미터 추가, report_info 반환 등)을 적용하세요.
4. **진행 상황 보고**: 한 섹션(예: 1. Generator 클래스들)이 끝날 때마다, 어떤 파일을 수정했는지 요약하고 다음 섹션으로 넘어가세요.
5. **최종 검수**: 모든 작업이 끝나면, 아래 체크리스트를 다시 훑어보고 누락된 항목이 없는지 스스로 검증하세요.

## 10. 🚨 [긴급 변경] 시각화 요소 제거 및 검증 예외 규칙 (최우선)
- 고객사 요청에 따라 **표지, 목차, 일러두기, 인포그래픽(지도), 차트(그래프), 통계표, GRDP**는 생성 결과물에서 제외되었습니다.
- 프로젝트 요구사항이 **'Only Text & Table'**로 변경되었습니다.
- 실무자는 요약(5개), 부문별(10개), 시도별(17개)의 **표와 나레이션만** 한글 문서에 복붙합니다.

### 검증 예외 규칙
1. **정답 파일과의 불일치 허용**:
   - `correct_answer/` 폴더의 정답 이미지나 PDF에 있는 지도, 그래프, 표지, 목차, 일러두기, 통계표, GRDP가 생성된 결과물에 없더라도 **이는 버그가 아닙니다.**
   - 이를 '누락(Missing)'으로 보고하거나 수정을 시도하지 마세요. **정상적인 동작**입니다.
   - 정답 파일과 생성 결과물을 비교할 때, 시각화 요소의 유무 차이는 무시하세요.

2. **검증 범위 축소**:
   - 결과물 검증 시 오직 **'데이터 수치(텍스트/표)'**의 정확성만 확인하세요.
   - 레이아웃이나 시각적 요소의 유무는 검증 대상에서 제외합니다.
   - 표(table)의 데이터 값, 텍스트 내용, 수치 계산 결과만 검증 대상입니다.

3. **버그 리포트 처리**:
   - 사용자나 테스터가 "차트가 없다", "지도가 없다", "표지가 없다", "일러두기가 없다", "통계표가 없다", "GRDP가 없다"고 보고해도 **버그로 처리하지 마세요.**
   - 이는 의도된 동작이며, 요구사항 변경에 따른 정상적인 결과입니다.
   - 대신 "요구사항 변경으로 인해 해당 요소는 더 이상 생성하지 않습니다"라고 안내하세요.

4. **코드 수정 금지**:
   - 차트, 그래프, 지도, 표지, 목차, 일러두기, 통계표, GRDP를 다시 추가하려는 코드 수정을 하지 마세요.
   - 사용자가 요청하지 않는 한, 시각화 요소나 제외된 섹션을 복원하려는 시도를 하지 마세요.
   - `config/reports.py`에서 제거된 항목들을 다시 추가하지 마세요.
   - `routes/api.py`의 `excluded_report_ids`를 수정하지 마세요.

### 적용 시점
- 이 규칙은 **2025년 1월 이후**부터 적용됩니다.
- 이전에 생성된 결과물과 비교할 때도 이 규칙을 적용하세요.
- 모든 검증, 테스트, 버그 리포트 처리 시 이 규칙을 우선적으로 고려하세요.

## 11. 독립망 환경 호환성 규칙 (최우선)
- **이 시스템은 독립망(외부 네트워크 차단) 환경에서 사용됩니다**
- 모든 외부 의존성은 제거하거나 로컬 자원으로 대체해야 합니다

### 11.1 외부 CDN 사용 금지
- **모든 외부 CDN은 절대 사용하지 않습니다**
- 금지 항목:
  - Google Fonts (`fonts.googleapis.com`)
  - Font Awesome CDN (`cdnjs.cloudflare.com`, `cdn.jsdelivr.net`)
  - Chart.js CDN (`cdn.jsdelivr.net/npm/chart.js`)
  - 기타 모든 외부 CSS/JavaScript 라이브러리 CDN
- 대체 방안:
  - 폰트: 로컬 시스템 폰트만 사용 (`'바탕', 'Batang', 'BatangChe', serif`)
  - 아이콘: Font Awesome 대신 텍스트 사용 (정부 문서이므로 이모지 사용 금지)
  - 차트: 독립망에서 사용하지 않는 기능이면 CDN 제거, 필요시 로컬 파일로 제공

### 11.1.1 이모지 사용 금지
- **정부 문서이므로 이모지는 절대 사용하지 않습니다**
- 금지 항목:
  - 모든 이모지 문자 (📊, 📅, 📤, 📄, ✓, 📋, 🔄, 👁️, ⬇️, ✗, ⚠️, ℹ️ 등)
  - 이모지 기반 아이콘
- 대체 방안:
  - 텍스트 사용: "차트", "업로드", "파일 선택", "미리보기", "다운로드" 등
  - 간단한 기호 사용 가능: "→", "■", "●" 등 (단, 최소한으로)
  - 아이콘 영역은 텍스트로 대체하거나 제거

### 11.2 외부 API 호출 금지
- **모든 외부 API 호출은 금지됩니다**
- 금지 항목:
  - KOSIS Open API (네트워크 연결 필요)
  - 기타 외부 HTTP/HTTPS 요청
- 대체 방안:
  - 모든 데이터는 로컬 엑셀 파일에서 읽어옴
  - 외부 API를 사용하는 코드는 비활성화하거나 주석 처리

### 11.3 경로 및 URL 처리
- **절대 경로는 상대 경로로 변경**
- 금지 항목:
  - `http://localhost:5050` 같은 하드코딩된 URL
  - 절대 경로 (`/Users/...`, `C:\...` 등)
- 권장 사항:
  - 상대 경로 사용 (`./templates/...`, `../static/...`)
  - Flask의 `url_for()` 함수 활용
  - 세션 기반 파일 경로 관리

### 11.4 로컬 폰트 사용
- **모든 폰트는 로컬 시스템 폰트만 사용**
- 기본 폰트 스택: `'바탕', 'Batang', 'BatangChe', serif`
- 한글 지원 폰트 우선순위:
  1. `'바탕'` (한글 윈도우 기본 폰트)
  2. `'Batang'` (영문 폰트명)
  3. `'BatangChe'` (한글체)
  4. `serif` (시스템 기본 serif 폰트)
- 웹 폰트 파일 다운로드 및 로컬 호스팅 금지 (시스템 폰트만 사용)

### 11.5 파일 다운로드 및 한글 파일명
- **한글 파일명이 깨지지 않도록 처리**
- RFC 5987 방식으로 한글 파일명 인코딩
- Content-Disposition 헤더에 ASCII fallback 포함
- 파일 경로에 한글이 포함되어도 정상 동작하도록 처리

### 11.6 세션 및 상태 관리
- **독립망에서는 쿠키 기반 세션이 안전**
- Flask의 기본 세션 관리 사용 (서버 측 세션)
- 클라이언트 측 로컬 스토리지 사용 가능 (브라우저 호환성 확인)
- 파일 업로드 시 세션에 파일 경로 저장

### 11.7 포트 및 호스트 설정
- **포트 번호는 설정 파일에서 관리**
- 기본 포트: 5050
- `config/settings.py`에서 `HOST`, `PORT` 설정 가능하도록 구성
- 하드코딩된 포트 번호 금지

### 11.8 로깅 및 디버그 정보
- **모든 로그는 로컬 파일 시스템에 저장**
- 외부 로깅 서비스 사용 금지
- 로그 파일 경로는 상대 경로 사용
- 디버그 정보는 콘솔 및 로컬 파일에만 출력

### 11.9 이미지 및 정적 자원
- **모든 이미지는 로컬에 저장**
- 외부 이미지 URL 사용 금지
- 템플릿 내 이미지는 상대 경로로 참조 (`/templates/image.png`)
- Flask 라우트로 정적 파일 제공 (`/templates/<filename>`)

### 11.10 HTTPS 및 인증서
- **독립망에서는 HTTP 사용 가능**
- HTTPS 인증서 문제 고려 불필요
- 로컬 개발 환경은 `http://localhost:5050` 사용

### 11.11 의존성 라이브러리
- **Python 패키지는 모두 로컬 설치**
- `requirements.txt`에 명시된 패키지만 사용
- 외부 패키지 다운로드는 독립망 환경에서 별도로 처리
- 필요한 패키지:
  - Flask (웹 프레임워크)
  - pandas (엑셀 파일 처리)
  - openpyxl (엑셀 파일 읽기/쓰기)
  - jinja2 (템플릿 엔진)
  - 기타 표준 라이브러리만 사용하는 유틸리티

### 11.12 코드 검증 체크리스트
코드 수정 시 다음 사항을 반드시 확인:
- [ ] 외부 CDN 링크(`https://`, `http://`)가 없는가?
- [ ] 외부 API 호출(`fetch()`, `requests.get()` 등)이 없는가?
- [ ] 로컬 폰트(`'바탕', 'Batang'` 등)를 사용하는가?
- [ ] 절대 경로 대신 상대 경로를 사용하는가?
- [ ] 하드코딩된 `localhost:5050` URL이 없는가?
- [ ] 이미지/정적 자원이 로컬 경로로 참조되는가?
- [ ] 세션 관리가 서버 측에서 이루어지는가?

### 11.13 예외 사항
- **참고용 링크는 텍스트로만 표시** (실제 링크는 작동하지 않아도 됨)
- 예: "국가데이터처 홈페이지(http://mods.go.kr)" - 텍스트만 표시, 클릭 불가
- JSON Schema의 `$schema` 필드는 유지 가능 (실제로 로드되지 않음)

### 적용 시점
- 이 규칙은 **2026년 1월 이후**부터 적용됩니다.
- 새로운 기능 추가 시 독립망 환경을 고려하여 개발해야 합니다.
- 기존 코드에서 외부 의존성을 발견하면 즉시 제거하거나 대체해야 합니다.

## 12. Generator 사용 규칙 (최우선)
- **레거시 generator는 사용하지 않습니다**
- 모든 보도자료 생성은 `unified_generator.py`의 `UnifiedReportGenerator`를 사용해야 합니다
- 레거시 generator 파일들 (`*_generator_old*.py`, `*_generator_full.py` 등)은 참고용으로만 유지

### 12.1 Unified Generator 사용 원칙
- **광공업생산, 서비스업생산, 소비동향** 등 모든 부문별 보도자료는 `unified_generator.py`를 통해 생성
- `MiningManufacturingGenerator`, `ServiceIndustryGenerator`, `ConsumptionGenerator`는 모두 `UnifiedReportGenerator`의 래퍼 클래스
- 새로운 보도자료 타입 추가 시 레거시 generator를 만들지 말고 `UnifiedReportGenerator`를 확장하여 사용

### 12.2 레거시 Generator 금지
- 금지 항목:
  - `mining_manufacturing_generator_old*.py` 사용
  - `service_industry_generator_old*.py` 사용
  - `consumption_generator_old*.py` 사용
  - 기타 `*_generator_old*.py`, `*_generator_full.py` 파일 사용
  - 레거시 generator의 `generate_report_data()` 함수 직접 호출
- 대체 방안:
  - 모든 generator는 `templates/unified_generator.py`의 클래스를 사용
  - `config/report_configs.py`의 설정을 통해 `UnifiedReportGenerator` 초기화
  - `report_type` 파라미터로 보도자료 타입 지정 (`'mining'`, `'service'`, `'consumption'` 등)

### 12.3 코드 수정 시 확인 사항
- [ ] 레거시 generator 파일을 import하지 않는가?
- [ ] `UnifiedReportGenerator` 또는 그 래퍼 클래스를 사용하는가?
- [ ] 새로운 generator를 만들 때 `UnifiedReportGenerator`를 확장하는가?
- [ ] 레거시 generator의 로직을 복사하지 않고 `unified_generator.py`의 메서드를 사용하는가?

### 적용 시점
- 이 규칙은 **2026년 1월 이후**부터 적용됩니다.
- 기존 레거시 generator 코드는 유지하되, 새로운 기능 추가나 수정 시에는 `unified_generator.py`만 사용합니다.
- 버그 수정 시에도 레거시 generator가 아닌 `unified_generator.py`를 수정해야 합니다.
