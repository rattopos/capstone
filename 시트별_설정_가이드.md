# 시트별 설정 가이드

## 개요

소비(소매, 추가) 시트에 적용된 업태 선택 로직을 다른 시트에도 적용할 수 있도록 일반화했습니다. 시트별 설정을 `SHEET_CONFIG` 딕셔너리에 정의하여 각 시트의 특성에 맞게 동작하도록 했습니다.

## 시트별 설정 구조

```python
SHEET_CONFIG = {
    '시트명': {
        'category_column': 5 또는 6,  # 산업/업태가 있는 열 번호
        'base_year': 2023,  # 기준 연도
        'base_quarter': 1 또는 3,  # 기준 분기
        'base_col': 56 또는 57,  # 기준 분기의 열 번호
        'name_mapping': {},  # 산업/업태 이름 매핑 딕셔너리
        'national_priorities': [],  # 전국 산업/업태 우선순위 (None이면 절대값 기준)
        'region_priorities': {},  # 지역별 산업/업태 우선순위
    },
}
```

## 현재 설정된 시트

### 1. 소비(소매, 추가)

```python
'소비(소매, 추가)': {
    'category_column': 5,  # E열에 업태 종류
    'base_year': 2023,
    'base_quarter': 3,
    'base_col': 57,  # 2023년 3분기
    'name_mapping': RETAIL_CATEGORY_MAPPING,
    'national_priorities': ['슈퍼마켓 및 잡화점', '면세점', '전문소매점'],
    'region_priorities': {
        '제주': ['면세점', '슈퍼마켓', '잡화점', '대형마트'],
        '경북': ['전문소매점', '슈퍼마켓', '잡화점', '대형마트'],
        '서울': ['면세점', '슈퍼마켓', '잡화점', '백화점'],
    },
}
```

**특징:**
- 전국: 감소한 업태만 선택, 특정 순서 (슈퍼마켓·잡화점 → 면세점 → 전문점)
- 증가한 지역: 증가한 업태만 선택, 증가율 큰 순서
- 감소한 지역: 감소한 업태만 선택, 지역별 우선순위 적용

### 2. 광공업생산

```python
'광공업생산': {
    'category_column': 6,  # F열에 산업 이름
    'base_year': 2023,
    'base_quarter': 1,
    'base_col': 56,  # 2023년 1분기
    'name_mapping': INDUSTRY_NAME_MAPPING,
    'national_priorities': None,  # 절대값 기준 정렬
    'region_priorities': {},  # 지역별 우선순위 없음
}
```

**특징:**
- 전국: 절대값 기준으로 정렬
- 지역: 증가/감소에 따라 필터링, 절대값 기준 정렬

### 3. 서비스업생산

```python
'서비스업생산': {
    'category_column': 6,  # F열에 산업 이름
    'base_year': 2023,
    'base_quarter': 1,
    'base_col': 56,  # 2023년 1분기
    'name_mapping': INDUSTRY_NAME_MAPPING,
    'national_priorities': None,
    'region_priorities': {},
}
```

**특징:**
- 광공업생산과 동일한 로직

### 4. 기본 설정 (default)

다른 시트들은 기본 설정을 사용합니다:

```python
'default': {
    'category_column': 6,  # F열에 산업 이름
    'base_year': 2023,
    'base_quarter': 1,
    'base_col': 56,  # 2023년 1분기
    'name_mapping': INDUSTRY_NAME_MAPPING,
    'national_priorities': None,
    'region_priorities': {},
}
```

## 새로운 시트 추가 방법

### 1. 시트 구조 확인

먼저 엑셀 파일에서 시트 구조를 확인합니다:
- 산업/업태가 있는 열 번호 (보통 5 또는 6)
- 분기별 데이터가 시작하는 열 번호
- 산업/업태 이름 형식

### 2. SHEET_CONFIG에 추가

`src/template_filler.py`의 `SHEET_CONFIG` 딕셔너리에 새 시트 설정을 추가합니다:

```python
'새시트명': {
    'category_column': 6,  # 산업/업태 열 번호
    'base_year': 2023,
    'base_quarter': 1,  # 기준 분기
    'base_col': 56,  # 기준 분기의 열 번호
    'name_mapping': INDUSTRY_NAME_MAPPING,  # 또는 새로운 매핑 딕셔너리
    'national_priorities': None,  # 또는 ['산업1', '산업2', ...]
    'region_priorities': {
        '지역명': ['산업1', '산업2', ...],
    },
}
```

### 3. 이름 매핑 추가 (필요시)

새로운 산업/업태 이름 매핑이 필요하면 별도 딕셔너리를 만들고 `name_mapping`에 지정합니다.

## 동작 원리

### 1. 전국 산업/업태 선택

- `national_priorities`가 설정되어 있으면:
  - 감소한 산업/업태만 필터링
  - 우선순위에 따라 선택
- `national_priorities`가 `None`이면:
  - 모든 산업/업태를 절대값 기준으로 정렬

### 2. 지역별 산업/업태 선택

- 지역 증감률이 증가(> 0)인 경우:
  - 증가한 산업/업태만 선택
  - 증가율이 큰 순서로 정렬
- 지역 증감률이 감소(< 0)인 경우:
  - 감소한 산업/업태만 선택
  - `region_priorities`에 지역이 설정되어 있으면 우선순위 적용
  - 우선순위가 없으면 절대값 기준 정렬

## 사용 예시

### 마커 형식

템플릿에서 다음과 같은 마커를 사용할 수 있습니다:

- `{시트명:전국_산업1_이름}` 또는 `{시트명:전국_업태1_이름}`
- `{시트명:전국_산업1_증감률}` 또는 `{시트명:전국_업태1_증감률}`
- `{시트명:상위시도1_산업1_이름}` 또는 `{시트명:상위시도1_업태1_이름}`
- `{시트명:하위시도1_산업1_이름}` 또는 `{시트명:하위시도1_업태1_이름}`

### 코드에서 사용

```python
from src.template_filler import TemplateFiller

template_filler = TemplateFiller(template_manager, excel_extractor)

# 전국 산업/업태 가져오기
categories = template_filler._get_categories_for_region(
    '시트명', '전국', 2025, 2, top_n=3
)

# 시트 설정 가져오기
config = template_filler._get_sheet_config('시트명')
```

## 주의사항

1. **열 번호 확인**: 시트별로 산업/업태가 있는 열 번호가 다를 수 있습니다.
2. **분기 기준점**: 시트별로 분기 데이터가 시작하는 열이 다를 수 있습니다.
3. **이름 매핑**: 엑셀의 산업/업태 이름과 템플릿에 표시할 이름이 다를 수 있습니다.
4. **우선순위**: 우선순위는 정확한 이름 일치가 아니라 부분 일치로 동작합니다.

## 확장 가능성

이 구조를 통해:
- 새로운 시트를 쉽게 추가할 수 있습니다
- 시트별로 다른 로직을 적용할 수 있습니다
- 지역별 우선순위를 세밀하게 제어할 수 있습니다
- 산업/업태 이름 매핑을 시트별로 관리할 수 있습니다

