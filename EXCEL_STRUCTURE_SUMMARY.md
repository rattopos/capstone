# 25년 3분기 분석표 엑셀 구조 분석 요약

## 📊 전체 구조

- **총 시트 수**: 42개
- **2025년 3분기 데이터 존재**: 40개 시트 (95%)

## 🎯 주요 보고서별 시트 정보

### 1. 광공업생산 (Manufacturing)
| 시트명 | 크기 | 2025 Q3 컬럼 | 헤더 행 |
|--------|------|--------------|---------|
| `A(광공업생산)집계` | 713행 × 27열 | 컬럼 26 | 행 2 |
| `A 분석` | 713행 × 39열 | 컬럼 21 | 행 2 |
| `A 참고` | 255행 × 14열 | 컬럼 12 | 행 1 |

**핵심 컬럼** (행 2):
- 지역코드 (컬럼 3-4)
- 지역이름 (컬럼 4)
- 분류단계 (컬럼 5-6)
- 가중치 (컬럼 6-7)
- 산업코드 (컬럼 7-8)
- 산업이름 (컬럼 8-9)

### 2. 서비스업생산 (Service)
| 시트명 | 크기 | 2025 Q3 컬럼 | 헤더 행 |
|--------|------|--------------|---------|
| `B(서비스업생산)집계` | 255행 × 26열 | 컬럼 25 | 행 2 |
| `B 분석` | 255행 × 36열 | 컬럼 20 | 행 2 |
| `B 참고` | 254행 × 14열 | 컬럼 12 | 행 1 |

**핵심 컬럼** (행 2):
- 조정산업코드 (컬럼 1)
- 지역코드 (컬럼 2)
- 지역이름 (컬럼 3)
- 분류단계 (컬럼 4)
- 가중치 (컬럼 5)
- 산업코드 (컬럼 6)
- 산업이름 (컬럼 7)

### 3. 소비동향 (Consumption)
| 시트명 | 크기 | 2025 Q3 컬럼 | 헤더 행 |
|--------|------|--------------|---------|
| `C(소비)집계` | 170행 × 25열 | 컬럼 24 | 행 2 |
| `C 분석` | 170행 × 36열 | 컬럼 20 | 행 2 |
| `C 참고` | 108행 × 14열 | 컬럼 12 | 행 1 |

**핵심 컬럼** (행 2):
- 지역코드 (컬럼 1-2)
- 지역이름 (컬럼 2-3)
- 분류단계 (컬럼 3-4)
- 가중치 (컬럼 4-5)
- 업태코드 (컬럼 5-6)
- 업태종류 (컬럼 6-7)

### 4. 건설수주 (Construction)
| 시트명 | 크기 | 2025 Q3 컬럼 | 헤더 행 |
|--------|------|--------------|---------|
| `F'(건설)집계` | 465행 × 23열 | 컬럼 19 | 행 2 |
| `F'분석` | 465행 × 29열 | 컬럼 19 | 행 2 |

**핵심 컬럼** (행 2):
- 지역코드 (컬럼 1)
- 지역이름 (컬럼 2)
- 분류단계 (컬럼 3)
- 분류코드 (컬럼 4)
- 순위 (컬럼 5)
- 공정이름 (컬럼 6)

### 5. 수출/수입 (Export/Import)
| 시트명 | 크기 | 2025 Q3 컬럼 | 헤더 행 |
|--------|------|--------------|---------|
| `G(수출)집계` | 3593행 × 57열 | - | 행 2 |
| `G 분석` | 3593행 × 86열 | - | 행 2 |
| `H(수입)집계` | 4260행 × 58열 | - | 행 2 |
| `H 분석` | 4260행 × 86열 | - | 행 2 |

### 6. 물가 (Price)
| 시트명 | 크기 | 2025 Q3 컬럼 | 헤더 행 |
|--------|------|--------------|---------|
| `E(품목성질물가)집계` | 471행 × 22열 | - | 행 2 |
| `E(품목성질물가)분석` | 471행 × 34열 | - | 행 2 |
| `E(지출목적물가)집계` | 324행 × 25열 | - | 행 2 |
| `E(지출목적물가) 분석` | 324행 × 37열 | - | 행 2 |

### 7. 고용/실업 (Employment/Unemployment)
| 시트명 | 크기 | 2025 Q3 컬럼 | 헤더 행 |
|--------|------|--------------|---------|
| `D(고용률)집계` | 112행 × 22열 | - | 행 2 |
| `D(고용률)분석` | 111행 × 22열 | - | 행 2 |
| `D(실업)집계` | 152행 × 20열 | - | 행 2 |
| `D(실업)분석` | 152행 × 24열 | - | 행 2 |
| `D(취업자 수)집계` | 720행 × 43열 | - | 행 2 |
| `D(취업자 수)분석` | 720행 × 29열 | - | 행 2 |

### 8. 인구이동 (Population)
| 시트명 | 크기 | 2025 Q3 컬럼 | 헤더 행 |
|--------|------|--------------|---------|
| `I(순인구이동)집계` | 420행 × 45열 | - | 행 2 |

---

## 🔍 핵심 발견사항

### 1. 헤더 구조 일관성
- **대부분 행 2에 헤더 위치** (일부 참고 시트는 행 1)
- **공통 컬럼 패턴**: 지역코드 → 지역이름 → 분류단계 → 가중치 → 산업/업태코드 → 이름

### 2. 연도/분기 컬럼 패턴
- **형식**: `YYYY Q/4` (예: `2025 3/4`, `2024 3/4`)
- **위치**: 헤더 행의 우측 부분 (시계열 데이터)
- **변동성**: 분기마다 컬럼 위치가 변경됨 → **동적 매핑 필수**

### 3. 지역 패턴
- **17개 시도**: 전국, 서울, 부산, 대구, 인천, 광주, 대전, 울산, 세종, 경기, 강원, 충북, 충남, 전북, 전남, 경북, 경남, 제주
- **지역코드**: 00(전국), 11(서울), 21(부산), ...

---

## ⚠️ 하드코딩 위험 영역

### 문제 1: 컬럼 인덱스 하드코딩
```python
# ❌ 나쁜 예
growth_rate = row[21]  # 2025년 3분기가 컬럼 21이라고 가정

# ✅ 좋은 예
target_col = find_target_col_index(header_row, 2025, 3)
growth_rate = row[target_col]
```

### 문제 2: 시트명 하드코딩
```python
# ❌ 나쁜 예
df = pd.read_excel(excel_path, sheet_name='A 분석')

# ✅ 좋은 예
sheet_name, use_raw = find_sheet(['A 분석', 'A(광공업생산)집계', '광공업생산'])
df = pd.read_excel(excel_path, sheet_name=sheet_name)
```

### 문제 3: 헤더 행 위치 하드코딩
```python
# ❌ 나쁜 예
header_row = df.iloc[2]

# ✅ 좋은 예
header_row_idx = find_header_row(df, keywords=['지역', '산업', '2025'])
header_row = df.iloc[header_row_idx]
```

---

## 🎯 동적 매핑 구현 전략

### Phase 1: 헤더 행 자동 감지
```python
def find_header_row(df, keywords=['지역', '산업'], max_rows=10):
    """첫 N행에서 키워드를 포함한 헤더 행 찾기"""
    for row_idx in range(min(max_rows, len(df))):
        row = df.iloc[row_idx]
        matches = sum(1 for cell in row if any(kw in str(cell) for kw in keywords))
        if matches >= 2:  # 최소 2개 키워드 매칭
            return row_idx
    return 2  # 기본값
```

### Phase 2: 컬럼 동적 탐색 (이미 구현됨)
```python
# base_generator.py의 find_target_col_index 활용
target_col = self.find_target_col_index(header_row, year, quarter)
```

### Phase 3: 시트명 Fallback 체계
```python
SHEET_FALLBACK = {
    'A 분석': ['A 분석', 'A(광공업생산)집계', '광공업생산'],
    'B 분석': ['B 분석', 'B(서비스업생산)집계', '서비스업생산'],
    'C 분석': ['C 분석', 'C(소비)집계', '소비(소매, 추가)'],
    # ...
}
```

---

## 📝 다음 단계

1. ✅ 엑셀 구조 분석 완료
2. 🔄 하드코딩된 컬럼 인덱스 식별
3. ⏳ 동적 헤더 행 감지 함수 구현
4. ⏳ 모든 generator에 동적 매핑 적용
5. ⏳ 통합 테스트 및 검증
